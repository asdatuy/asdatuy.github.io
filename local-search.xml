<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title></title>
    <link href="/2025/02/06/Banlance/"/>
    <url>/2025/02/06/Banlance/</url>
    
    <content type="html"><![CDATA[<h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="一键安装"><a href="#一键安装" class="headerlink" title="一键安装"></a>一键安装</h3><p>使用系统自带的包管理器(dnf&#x2F;apt&#x2F;zypper&#x2F;pacman&#x2F;emerge)安装</p><blockquote><p>例如 dnf install -y nginx</p></blockquote><h3 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h3><h4 id="需要安装一些编译的软件包"><a href="#需要安装一些编译的软件包" class="headerlink" title="需要安装一些编译的软件包"></a>需要安装一些编译的软件包</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum -y install gcc gcc-c++ pcre pcre-devel zlib zlib-devel gd gd-devel<br></code></pre></td></tr></table></figure><h4 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h4><blockquote><p>-s 指定登陆shell &#x2F;sbin&#x2F;nologin 表示不能用于控制台登陆</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">useradd -s /sbin/nologin nginx <br></code></pre></td></tr></table></figure><h4 id="下载软件包"><a href="#下载软件包" class="headerlink" title="下载软件包"></a>下载软件包</h4><p><a href="http://nginx.org/en/download.html">http://nginx.org/en/download.html</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget http://nginx.org/download/nginx-1.24.0.tar.gz<br>tar xzvf nginx-1.24.0.tar.gz<br><span class="hljs-built_in">cd</span> nginx-1.24.0<br><br>[root@Docker01 nginx-1.24.0]# ll<br>总用量 816<br>drwxr-xr-x. 6 1001 1001   4096 9月  18 23:15 auto<br>-rw-r--r--. 1 1001 1001 323312 4月  11 09:45 CHANGES<br>-rw-r--r--. 1 1001 1001 494234 4月  11 09:45 CHANGES.ru<br>drwxr-xr-x. 2 1001 1001    168 9月  18 23:15 conf<br>-rwxr-xr-x. 1 1001 1001   2611 4月  11 09:45 configure<br>drwxr-xr-x. 4 1001 1001     72 9月  18 23:15 contrib<br>drwxr-xr-x. 2 1001 1001     40 9月  18 23:15 html<br>-rw-r--r--. 1 1001 1001   1397 4月  11 09:45 LICENSE<br>drwxr-xr-x. 2 1001 1001     21 9月  18 23:15 man<br>-rw-r--r--. 1 1001 1001     49 4月  11 09:45 README<br>drwxr-xr-x. 9 1001 1001     91 9月  18 23:15 src<br></code></pre></td></tr></table></figure><h4 id="查看编译配置选项"><a href="#查看编译配置选项" class="headerlink" title="查看编译配置选项"></a>查看编译配置选项</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Docker01 nginx-1.24.0]# ./configure --<span class="hljs-built_in">help</span><br><br>  --<span class="hljs-built_in">help</span>                             <span class="hljs-built_in">print</span> this message<br><br>  --prefix=PATH                      <span class="hljs-built_in">set</span> installation prefix<br>  --sbin-path=PATH                   <span class="hljs-built_in">set</span> nginx binary pathname<br>  --modules-path=PATH                <span class="hljs-built_in">set</span> modules path<br>  --conf-path=PATH                   <span class="hljs-built_in">set</span> nginx.conf pathname<br>  --error-log-path=PATH              <span class="hljs-built_in">set</span> error <span class="hljs-built_in">log</span> pathname<br>  --pid-path=PATH                    <span class="hljs-built_in">set</span> nginx.pid pathname<br>  --lock-path=PATH                   <span class="hljs-built_in">set</span> nginx.lock pathname<br><br>  --user=USER                        <span class="hljs-built_in">set</span> non-privileged user <span class="hljs-keyword">for</span><br>                                     worker processes<br>  --group=GROUP                      <span class="hljs-built_in">set</span> non-privileged group <span class="hljs-keyword">for</span><br>                                     worker processes<br><br>  --build=NAME                       <span class="hljs-built_in">set</span> build name<br>  --builddir=DIR                     <span class="hljs-built_in">set</span> build directory<br><br>  --with-select_module               <span class="hljs-built_in">enable</span> <span class="hljs-keyword">select</span> module<br>  ..............<br>  --with-debug                       <span class="hljs-built_in">enable</span> debug logging<br></code></pre></td></tr></table></figure><h4 id="挑选一些参数配置"><a href="#挑选一些参数配置" class="headerlink" title="挑选一些参数配置"></a>挑选一些参数配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Docker01 nginx-1.24.0]# ./configure --prefix=/usr/local/nginx \<br>&gt; --user=nginx \<br>&gt; --group=nginx \<br>&gt; --with-pcre \<br>&gt; --with-http_ssl_module \<br>&gt; --with-http_v2_module \<br>&gt; --with-http_realip_module \<br>&gt; --with-http_addition_module \<br>&gt; --with-http_sub_module \<br>&gt; --with-http_dav_module \<br>&gt; --with-http_flv_module \<br>&gt; --with-http_mp4_module \<br>&gt; --with-http_gunzip_module \<br>&gt; --with-http_gzip_static_module \<br>&gt; --with-http_random_index_module \<br>&gt; --with-http_secure_link_module \<br>&gt; --with-http_stub_status_module \<br>&gt; --with-http_auth_request_module \<br>&gt; --with-http_image_filter_module \<br>&gt; --with-http_slice_module \<br>&gt; --with-mail \<br>&gt; --with-threads \<br>&gt; --with-file-aio \<br>&gt; --with-stream \<br>&gt; --with-mail_ssl_module \<br>&gt; --with-stream_ssl_module <br><br><span class="hljs-comment">##输出:</span><br>checking <span class="hljs-keyword">for</span> OS<br> + Linux 4.18.0-448.el8.x86_64 x86_64<br>checking <span class="hljs-keyword">for</span> C compiler ... found<br> + using GNU C compiler<br> + gcc version: 8.5.0 20210514 (Red Hat 8.5.0-4) (GCC) <br>checking <span class="hljs-keyword">for</span> gcc -pipe switch ... found<br>checking <span class="hljs-keyword">for</span> -Wl,-E switch ... found<br>checking <span class="hljs-keyword">for</span> gcc <span class="hljs-built_in">builtin</span> atomic operations ... found<br>checking <span class="hljs-keyword">for</span> C99 variadic macros ... found<br>checking <span class="hljs-keyword">for</span> gcc variadic macros ... found<br>checking <span class="hljs-keyword">for</span> gcc <span class="hljs-built_in">builtin</span> 64 bit byteswap ... found<br>.<br>checking <span class="hljs-keyword">for</span> getaddrinfo() ... found<br>checking <span class="hljs-keyword">for</span> PCRE2 library ... found<br>checking <span class="hljs-keyword">for</span> OpenSSL library ... found<br>checking <span class="hljs-keyword">for</span> zlib library ... found<br>checking <span class="hljs-keyword">for</span> GD library ... found<br>checking <span class="hljs-keyword">for</span> GD WebP support ... found<br>creating objs/Makefile<br><br>Configuration summary<br>  + using threads<br>  + using system PCRE2 library<br>  + using system OpenSSL library<br>  + using system zlib library<br><br>  nginx path prefix: <span class="hljs-string">&quot;/usr/local/nginx&quot;</span><br>  nginx binary file: <span class="hljs-string">&quot;/usr/local/nginx/sbin/nginx&quot;</span><br>  nginx modules path: <span class="hljs-string">&quot;/usr/local/nginx/modules&quot;</span><br>  nginx configuration prefix: <span class="hljs-string">&quot;/usr/local/nginx/conf&quot;</span><br>  nginx configuration file: <span class="hljs-string">&quot;/usr/local/nginx/conf/nginx.conf&quot;</span><br>  nginx pid file: <span class="hljs-string">&quot;/usr/local/nginx/logs/nginx.pid&quot;</span><br>  nginx error <span class="hljs-built_in">log</span> file: <span class="hljs-string">&quot;/usr/local/nginx/logs/error.log&quot;</span><br>  nginx http access <span class="hljs-built_in">log</span> file: <span class="hljs-string">&quot;/usr/local/nginx/logs/access.log&quot;</span><br>  nginx http client request body temporary files: <span class="hljs-string">&quot;client_body_temp&quot;</span><br>  nginx http proxy temporary files: <span class="hljs-string">&quot;proxy_temp&quot;</span><br>  nginx http fastcgi temporary files: <span class="hljs-string">&quot;fastcgi_temp&quot;</span><br>  nginx http uwsgi temporary files: <span class="hljs-string">&quot;uwsgi_temp&quot;</span><br>  nginx http scgi temporary files: <span class="hljs-string">&quot;scgi_temp&quot;</span><br></code></pre></td></tr></table></figure><h4 id="执行编译-因为目录中存在Makefile文件-会按照这个文件进行编译"><a href="#执行编译-因为目录中存在Makefile文件-会按照这个文件进行编译" class="headerlink" title="执行编译  ##因为目录中存在Makefile文件 会按照这个文件进行编译"></a>执行编译  ##因为目录中存在Makefile文件 会按照这个文件进行编译</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">make &amp;&amp; make install<br></code></pre></td></tr></table></figure><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><blockquote><p>因为先前指定了Nginx命令的安装目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;[root@Docker01 nginx-1.24.0]# /usr/local/nginx/sbin/nginx -V<br>&gt;nginx version: nginx/1.24.0<br>&gt;built by gcc 8.5.0 20210514 (Red Hat 8.5.0-4) (GCC) <br>&gt;built with OpenSSL 1.1.1k  FIPS 25 Mar 2021<br>&gt;TLS SNI support enabled<br>&gt;configure arguments: --prefix=/usr/local/nginx --user=nginx --group=nginx --with-pcre --with-http_ssl_module --with-http_v2_module --with-http_realip_module --with-http_addition_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_random_index_module --with-http_secure_link_module --with-http_stub_status_module --with-http_auth_request_module --with-http_image_filter_module --with-http_slice_module --with-mail --with-threads --with-file-aio --with-stream --with-mail_ssl_module --with-stream_ssl_module<br>&gt;[root@Docker01 nginx-1.24.0]# /usr/local/nginx/sbin/nginx<br>&gt;[root@Docker01 nginx-1.24.0]# netstat -tunlp<br>&gt;Active Internet connections (only servers)<br>&gt;Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    <br>&gt;tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      57369/nginx: master <br>&gt;tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      877/sshd            <br>&gt;tcp6       0      0 :::22                   :::*                    LISTEN      877/sshd            <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;[root@Docker01 nginx-1.24.0]# curl 127.0.0.1<br>&gt;&lt;!DOCTYPE html&gt;<br>&gt;&lt;html&gt;<br>&gt;&lt;<span class="hljs-built_in">head</span>&gt;<br>&gt;&lt;title&gt;Welcome to nginx!&lt;/title&gt;<br>&gt;&lt;style&gt;<br>&gt;html &#123; color-scheme: light dark; &#125;<br>&gt;body &#123; width: 35em; margin: 0 auto;<br>&gt;font-family: Tahoma, Verdana, Arial, sans-serif; &#125;<br>&gt;&lt;/style&gt;<br>&gt;&lt;/head&gt;<br>&gt;&lt;body&gt;<br>&gt;&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;<br>&gt;&lt;p&gt;If you see this page, the nginx web server is successfully installed and<br>&gt;working. Further configuration is required.&lt;/p&gt;<br><br>&gt;&lt;p&gt;For online documentation and support please refer to<br>&gt;&lt;a href=<span class="hljs-string">&quot;http://nginx.org/&quot;</span>&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;<br>&gt;Commercial support is available at<br>&gt;&lt;a href=<span class="hljs-string">&quot;http://nginx.com/&quot;</span>&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;<br><br>&gt;&lt;p&gt;&lt;em&gt;Thank you <span class="hljs-keyword">for</span> using nginx.&lt;/em&gt;&lt;/p&gt;<br>&gt;&lt;/body&gt;<br>&gt;&lt;/html&gt;<br><br></code></pre></td></tr></table></figure><p>当然可以导入环境变量 编写systemd文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;[root@Docker01 nginx-1.24.0]# <span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:/usr/local/nginx/sbin/<br>&gt;[root@Docker01 nginx-1.24.0]# nginx -V<br>&gt;nginx version: nginx/1.24.0<br>&gt;built by gcc 8.5.0 20210514 (Red Hat 8.5.0-4) (GCC) <br>&gt;built with OpenSSL 1.1.1k  FIPS 25 Mar 2021<br>&gt;TLS SNI support enabled<br>&gt;configure arguments: --prefix=/usr/local/nginx --user=nginx --group=nginx --with-pcre --with-http_ssl_module --with-http_v2_module --with-http_realip_module --with-http_addition_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_random_index_module --with-http_secure_link_module --with-http_stub_status_module --with-http_auth_request_module --with-http_image_filter_module --with-http_slice_module --with-mail --with-threads --with-file-aio --with-stream --with-mail_ssl_module --with-stream_ssl_module<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;[root@Docker01 nginx-1.24.0]# <span class="hljs-built_in">cat</span> /usr/lib/systemd/system/nginx.service<br>&gt;[Unit]<br>&gt;Description=nginx - high performance web server<br>&gt;Documentation=http://nginx.org/en/docs/<br>&gt;After=network.target remote-fs.target nss-lookup.target<br><br>&gt;[Service]<br>&gt;Type=forking<br>&gt;PIDFile=/usr/local/nginx/logs/nginx.pid<br>&gt;ExecStartPre=/usr/local/nginx/sbin/nginx -t -c /usr/local/nginx/conf/nginx.conf<br>&gt;ExecStart=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf<br>&gt;ExecReload= /usr/local/nginx/sbin/nginx -s reload<br>&gt;ExecStop= /usr/local/nginx/sbin/nginx -s stop<br>&gt;PrivateTmp=<span class="hljs-literal">true</span><br><br>&gt;[Install]<br>&gt;WantedBy=multi-user.target<br>&gt;[root@Docker01 nginx-1.24.0]# systemctl daemon-reload <br>&gt;[root@Docker01 nginx-1.24.0]# systemctl start nginx.service <br>&gt;[root@Docker01 nginx-1.24.0]# netstat -tunlp | grep nginx<br>&gt;tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      57512/nginx: master <br></code></pre></td></tr></table></figure></blockquote><h2 id="一些命令"><a href="#一些命令" class="headerlink" title="一些命令"></a>一些命令</h2><ol><li><p>nginx -s reload</p><blockquote><p>reload 在不重新启动nginx的情况下重载nginx的配置文件</p></blockquote></li><li><p>nginx -s stop|quit|reopen</p><blockquote><p>强制停止|正常停止|重新打开配置文件</p></blockquote></li><li><p>nginx -t</p><blockquote><p>测试配置文件有没有错误</p></blockquote></li></ol><h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Docker01 ~]# nginx -V<br>nginx version: nginx/1.24.0<br>built by gcc 8.5.0 20210514 (Red Hat 8.5.0-4) (GCC) <br>built with OpenSSL 1.1.1k  FIPS 25 Mar 2021<br>TLS SNI support enabled<br>configure arguments: --prefix=/usr/local/nginx --user=nginx --group=nginx --with-pcre --with-http_ssl_module --with-http_v2_module --with-http_realip_module --with-http_addition_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_random_index_module --with-http_secure_link_module --with-http_stub_status_module --with-http_auth_request_module --with-http_image_filter_module --with-http_slice_module --with-mail --with-threads --with-file-aio --with-stream --with-mail_ssl_module --with-stream_ssl_module<br><br>[root@Docker01 ~]# <span class="hljs-built_in">ls</span> /usr/local/nginx<br>client_body_temp  conf  fastcgi_temp  html  logs  proxy_temp  sbin  scgi_temp  uwsgi_temp<br><br>[root@Docker01 ~]# <span class="hljs-built_in">ls</span> /usr/local/nginx/conf/<br>fastcgi.conf          fastcgi_params.default  mime.types          nginx.conf.default   uwsgi_params<br>fastcgi.conf.default  koi-utf                 mime.types.default  scgi_params          uwsgi_params.default<br>fastcgi_params        koi-win                 nginx.conf          scgi_params.default  win-utf<br><span class="hljs-comment">## nginx -V 查看安装目录(--prefix) 配置文件就在这</span><br></code></pre></td></tr></table></figure><p><strong>一个简单的配置文件</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs nginx">[root@<span class="hljs-attribute">Docker01</span> nginx]<span class="hljs-comment"># cat conf/nginx.conf</span><br><br>user  nginx;<br><span class="hljs-comment">#工作时使用的用户</span><br><span class="hljs-attribute">worker_processes</span>  <span class="hljs-number">2</span>;<br><span class="hljs-comment">#工作进程数 通常为 物理机=(CPU Core*2) 虚拟机=(CPU Core)  </span><br><span class="hljs-comment">#因为这个参数本就是为了符合多线程 物理机开启超线程每个cpu都有俩个线程 所以*2 </span><br><span class="hljs-comment">#而vCPU就是开启超线程后分配的逻辑CPU 所以为CPU Core即可 </span><br><br><span class="hljs-attribute">worker_priority</span> -<span class="hljs-number">20</span>;<br><span class="hljs-comment">#进程优先级 -20～19 越小进程越优先 ps aox command,pid,ni 查看</span><br><br><span class="hljs-comment">#error_log  logs/error.log;</span><br><span class="hljs-comment">#error_log  logs/error.log  notice;</span><br><span class="hljs-comment">#error_log  logs/error.log  info;</span><br><br><span class="hljs-comment">#pid        logs/nginx.pid;</span><br><br><br><span class="hljs-section">events</span> &#123;<br> <span class="hljs-attribute">worker_connections</span>  <span class="hljs-number">1024</span>;            <br> <span class="hljs-comment">#每个进程的最大连接数</span><br>&#125;<br><br><br><span class="hljs-section">http</span> &#123;<br> <span class="hljs-attribute">include</span>       mime.types;<br> <span class="hljs-comment">#引入一些文件映射表</span><br> <span class="hljs-attribute">default_type</span>  application/octet-stream;<br> <span class="hljs-comment"># 全局默认映射类型为application/octet-stream</span><br><br> <span class="hljs-comment">#log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br> <span class="hljs-comment">#                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br> <span class="hljs-comment">#                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><br> <span class="hljs-comment">#access_log  logs/access.log  main;</span><br><br> <span class="hljs-attribute">sendfile</span>        <span class="hljs-literal">on</span>;<br> <span class="hljs-comment"># 零复制机制 加快传输 但会消耗cpu</span><br> <span class="hljs-attribute">tcp_nopush</span>     <span class="hljs-literal">on</span>;<br><span class="hljs-comment"># 加快访问也会消耗cpu</span><br><br> <span class="hljs-comment">#keepalive_timeout  0;</span><br> <span class="hljs-attribute">keepalive_timeout</span>  <span class="hljs-number">65</span>;<br><span class="hljs-comment"># 保持超时时间为65S</span><br> <span class="hljs-attribute">gzip</span>  <span class="hljs-literal">on</span>;<br><span class="hljs-comment"># 传输时压缩 加快传输速率 会消耗cpu</span><br> <span class="hljs-section">server</span> &#123;<br>     <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;<br>  <span class="hljs-comment"># 监听80端口</span><br>     <span class="hljs-attribute">server_name</span>  www.shawen.com;<br> <span class="hljs-comment"># 定义虚拟主机</span><br>     <span class="hljs-attribute">charset</span>utf-<span class="hljs-number">8</span>;<br> <span class="hljs-comment"># 字符编码</span><br>     <span class="hljs-comment">#access_log  logs/host.access.log  main;</span><br> <span class="hljs-attribute">error_log</span>logs/www.<span class="hljs-literal">error</span>.log  <span class="hljs-literal">error</span>;<br>     <span class="hljs-comment"># 错误日志记录</span><br>     <span class="hljs-section">location</span> / &#123;<br>         <span class="hljs-attribute">root</span>   html;<br>         <span class="hljs-attribute">index</span>  index.html index.htm;<br></code></pre></td></tr></table></figure><h2 id="配置一个代理服务器"><a href="#配置一个代理服务器" class="headerlink" title="配置一个代理服务器"></a>配置一个代理服务器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">server &#123;<br>        listen       443;<br>       <span class="hljs-comment"># listen       [::]:80 default_server;</span><br>        server_name  za.shanwen.com;<br>        root         /usr/share/nginx/html;<br>        ssl on;<br>        ssl_certificate <span class="hljs-string">&quot;/usr/share/nginx/ca/crt&quot;</span>;<br>        ssl_certificate_key <span class="hljs-string">&quot;/usr/share/nginx/ca/key&quot;</span>;<br>        ssl_session_cache shared:SSL:1m;<br>        ssl_session_timeout  10m;<br>        ssl_ciphers PROFILE=SYSTEM;<br><br>        include /etc/nginx/default.d/*.conf;<br><br>        location / &#123;<br>                proxy_pass http://10.88.0.2:80/;   <span class="hljs-comment">## 该地址为我的pod</span><br>        &#125;<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Host1 ~]# podman inspect n1 | grep -i ip<br>               <span class="hljs-string">&quot;IPAddress&quot;</span>: <span class="hljs-string">&quot;10.88.0.2&quot;</span>,<br>               <span class="hljs-string">&quot;IPPrefixLen&quot;</span>: 16,<br>               <span class="hljs-string">&quot;IPv6Gateway&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>               <span class="hljs-string">&quot;GlobalIPv6Address&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>               <span class="hljs-string">&quot;GlobalIPv6PrefixLen&quot;</span>: 0,<br>               <span class="hljs-string">&quot;LinkLocalIPv6Address&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>               <span class="hljs-string">&quot;LinkLocalIPv6PrefixLen&quot;</span>: 0,<br>                              <span class="hljs-string">&quot;HostIp&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>                         <span class="hljs-string">&quot;IPAddress&quot;</span>: <span class="hljs-string">&quot;10.88.0.2&quot;</span>,<br>                         <span class="hljs-string">&quot;IPPrefixLen&quot;</span>: 16,<br>                         <span class="hljs-string">&quot;IPv6Gateway&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>                         <span class="hljs-string">&quot;GlobalIPv6Address&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>                         <span class="hljs-string">&quot;GlobalIPv6PrefixLen&quot;</span>: 0,<br>                         <span class="hljs-string">&quot;IPAMConfig&quot;</span>: null,<br>                              <span class="hljs-string">&quot;HostIp&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>               <span class="hljs-string">&quot;IpcMode&quot;</span>: <span class="hljs-string">&quot;shareable&quot;</span>,<br>[root@Host1 ~]# curl 10.88.0.2<br>&lt;p&gt;n1&lt;/p1&gt;<br></code></pre></td></tr></table></figure><p><img src="/../Pic/image-20230910181358625.png" alt="image-20230910181358625"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2025/02/06/BigData/"/>
    <url>/2025/02/06/BigData/</url>
    
    <content type="html"><![CDATA[<h1 id="Zookkeeper"><a href="#Zookkeeper" class="headerlink" title="Zookkeeper"></a>Zookkeeper</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p><img src="/../Pic/image-20230906213848300.png" alt="image-20230906213848300"></p><h3 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h3><p><img src="/../Pic/image-20230906214032674.png" alt="image-20230906214032674"></p><h4 id="Leader-Master"><a href="#Leader-Master" class="headerlink" title="Leader(Master)"></a>Leader(Master)</h4><p>当一个Server获得一半以上的票数时 它会成为Leader 所以 Zookkeepr集群的Server数一般为奇数 </p><h3 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h3><p><img src="/../Pic/image-20230906214610098.png" alt="image-20230906214610098"></p><h3 id="读操作"><a href="#读操作" class="headerlink" title="读操作"></a>读操作</h3><p><img src="/../Pic/image-20230906215028868.png" alt="image-20230906215028868"></p><h3 id="写操作"><a href="#写操作" class="headerlink" title="写操作"></a>写操作</h3><p><img src="/../Pic/image-20230906215651622.png" alt="image-20230906215651622"></p><ol><li><p>Client向Leader发出写请求。</p></li><li><p>Leader将数据写入到本节点，并将数据发送到所有的Follower节点；</p></li><li><p>等待Follower节点返回；</p></li><li><p>当Leader接收到一半以上节点(包含自己)返回写成功的信息之后，返回写入成功消息给client;</p></li></ol><h3 id="一些命令"><a href="#一些命令" class="headerlink" title="一些命令"></a>一些命令</h3><p><img src="/../Pic/image-20230907145615551.png" alt=""></p><h2 id="实操"><a href="#实操" class="headerlink" title="实操"></a>实操</h2><h3 id="基本集群搭建"><a href="#基本集群搭建" class="headerlink" title="基本集群搭建"></a>基本集群搭建</h3><blockquote><p>因为推荐使用奇数节点 所以有三台主机 </p><ol><li>Host1 192.168.10.10</li><li>Host2 192.168.10.20</li><li>Host3 192.168.10.30</li></ol><p>自行下载zookkeeper文件和java运行环境</p></blockquote><h4 id="1-配置文件"><a href="#1-配置文件" class="headerlink" title="1. 配置文件"></a>1. 配置文件</h4><h5 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@Host1 apache-zookeeper-3.9.0-bin]# <span class="hljs-built_in">pwd</span> <br>/root/SoftWare/apache-zookeeper-3.9.0-bin<br>[root@Host1 apache-zookeeper-3.9.0-bin]# <span class="hljs-built_in">ls</span> <br>bin  conf  docs  lib  LICENSE.txt  logs  myid  NOTICE.txt  README.md  README_packaging.md<br></code></pre></td></tr></table></figure><h5 id="编辑每个主机的conf-zoo-cfg"><a href="#编辑每个主机的conf-zoo-cfg" class="headerlink" title="编辑每个主机的conf&#x2F;zoo.cfg"></a>编辑每个主机的conf&#x2F;zoo.cfg</h5><blockquote><p>可以从zoo.sample.cfg 参考复制 主要配置两个参数</p><ol><li>dataDir&#x3D;               ##此目录必须提前创建 如果需要集群设置 则须在该路径下创建myid</li><li>集群主机配置</li></ol></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json">tickTime=<span class="hljs-number">2000</span><br>initLimit=<span class="hljs-number">10</span><br>syncLimit=<span class="hljs-number">5</span><br>dataDir=/root/SoftWare/apache-zookeeper<span class="hljs-number">-3.9</span><span class="hljs-number">.0</span>-bin/myid<br>clientPort=<span class="hljs-number">2181</span><br>################################<br>server<span class="hljs-number">.1</span>=<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.10</span><span class="hljs-punctuation">:</span><span class="hljs-number">2888</span><span class="hljs-punctuation">:</span><span class="hljs-number">3888</span><br>server<span class="hljs-number">.2</span>=<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.20</span><span class="hljs-punctuation">:</span><span class="hljs-number">2888</span><span class="hljs-punctuation">:</span><span class="hljs-number">3888</span><br>server<span class="hljs-number">.3</span>=<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.30</span><span class="hljs-punctuation">:</span><span class="hljs-number">2888</span><span class="hljs-punctuation">:</span><span class="hljs-number">3888</span><br></code></pre></td></tr></table></figure><h5 id="编辑myid文件-目录在上面配置文件定义"><a href="#编辑myid文件-目录在上面配置文件定义" class="headerlink" title="编辑myid文件 目录在上面配置文件定义"></a>编辑myid文件 目录在上面配置文件定义</h5><blockquote><p>注意 配置文件定义了主机server.1&#x3D;192.168.10.10 所以 server1的myid文件的内容为1 其他主机依次填写</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Host1 apache-zookeeper-3.9.0-bin]# <span class="hljs-built_in">ls</span> /root/SoftWare/apache-zookeeper-3.9.0-bin/myid<br>myid<br>[root@Host1 apache-zookeeper-3.9.0-bin]# <span class="hljs-built_in">cat</span> /root/SoftWare/apache-zookeeper-3.9.0-bin/myid/myid <br>1<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Host2 apache-zookeeper-3.9.0-bin]# <span class="hljs-built_in">cat</span> myid/myid <br>2<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Host3 apache-zookeeper-3.9.0-bin]# <span class="hljs-built_in">cat</span> myid/myid <br>3<br></code></pre></td></tr></table></figure><h5 id="启动服务器"><a href="#启动服务器" class="headerlink" title="启动服务器"></a>启动服务器</h5><p>在bin有相应的二进制执行文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Host1 apache-zookeeper-3.9.0-bin]# <span class="hljs-built_in">ls</span> ./bin/<br>README.txt    zkEnv.sh                zkSnapshotComparer.sh                  zkTxnLogToolkit.cmd<br>zkCleanup.sh  zkServer.cmd            zkSnapshotRecursiveSummaryToolkit.cmd  zkTxnLogToolkit.sh<br>zkCli.cmd     zkServer-initialize.sh  zkSnapshotRecursiveSummaryToolkit.sh<br>zkCli.sh      zkServer.sh             zkSnapShotToolkit.cmd<br>zkEnv.cmd     zkSnapshotComparer.cmd  zkSnapShotToolkit.sh<br></code></pre></td></tr></table></figure><p>每个服务器执行 zkServer.sh start|stop|restart</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Host1 apache-zookeeper-3.9.0-bin]# ./bin/zkServer.sh start<br>/usr/bin/java<br>ZooKeeper JMX enabled by default<br>Using config: /root/SoftWare/apache-zookeeper-3.9.0-bin/bin/../conf/zoo.cfg<br>Starting zookeeper ... STARTED<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Host2 apache-zookeeper-3.9.0-bin]# ./bin/zkServer.sh start<br>bash: warning: setlocale: LC_ALL: cannot change locale (zh_CN.UTF-8)<br>/usr/bin/java<br>ZooKeeper JMX enabled by default<br>Using config: /root/SoftWare/apache-zookeeper-3.9.0-bin/bin/../conf/zoo.cfg<br>Starting zookeeper ... STARTED<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Host3 apache-zookeeper-3.9.0-bin]# ./bin/zkServer.sh start<br>bash: warning: setlocale: LC_ALL: cannot change locale (zh_CN.UTF-8)<br>/usr/bin/java<br>ZooKeeper JMX enabled by default<br>Using config: /root/SoftWare/apache-zookeeper-3.9.0-bin/bin/../conf/zoo.cfg<br>Starting zookeeper ... STARTED<br></code></pre></td></tr></table></figure><p>可以执行bin下的 zkSever.sh status 查看状态 这里利用ansible执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">shanwen@Shanwen:~/ansible$ ansible all -m shell -a <span class="hljs-string">&quot;/root/SoftWare/apache-zookeeper-3.9.0-bin/bin/zkServer.sh status&quot;</span><br>[WARNING]: Found both group and host with same name: Host1<br>[WARNING]: Found both group and host with same name: Host2<br>[WARNING]: Found both group and host with same name: Host3<br>Host2 | CHANGED | rc=0 &gt;&gt;<br>/usr/bin/java<br>Client port found: 2181. Client address: localhost. Client SSL: <span class="hljs-literal">false</span>.<br>Mode: leaderZooKeeper JMX enabled by default<br>Using config: /root/SoftWare/apache-zookeeper-3.9.0-bin/bin/../conf/zoo.cfg<br>Host3 | CHANGED | rc=0 &gt;&gt;<br>/usr/bin/java<br>Client port found: 2181. Client address: localhost. Client SSL: <span class="hljs-literal">false</span>.<br>Mode: followerZooKeeper JMX enabled by default<br>Using config: /root/SoftWare/apache-zookeeper-3.9.0-bin/bin/../conf/zoo.cfg<br>Host1 | CHANGED | rc=0 &gt;&gt;<br>/usr/bin/java<br>Client port found: 2181. Client address: localhost. Client SSL: <span class="hljs-literal">false</span>.<br>Mode: followerZooKeeper JMX enabled by default<br>Using config: /root/SoftWare/apache-zookeeper-3.9.0-bin/bin/../conf/zoo.cfg<br></code></pre></td></tr></table></figure><p>可以看到 Host2 成为了Leader 也就是master节点</p><h5 id="客户端连接"><a href="#客户端连接" class="headerlink" title="客户端连接"></a>客户端连接</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">shanwen@Shanwen:~/ansible$ ./SoftWare/zk/bin/zkCli.sh -server 192.168.10.10:2181     <span class="hljs-comment">## 连接那个客户端都行的 并不一定是leader</span><br>[zk: 192.168.10.10:2181(CONNECTED) 4] get /zookeeper/config <br>server.1=192.168.10.10:2888:3888:participant<br>server.2=192.168.10.20:2888:3888:participant<br>server.3=192.168.10.30:2888:3888:participant<br>version=0<br>[zk: 192.168.10.10:2181(CONNECTED) 5] create /testData<br>Created /testData<br>[zk: 192.168.10.10:2181(CONNECTED) 6] <span class="hljs-built_in">set</span> /testData TESTdATA<br>[zk: 192.168.10.10:2181(CONNECTED) 7] get /testData <br>TESTdATA<br>[zk: 192.168.10.10:2181(CONNECTED) 8] create /testData/testData2<br>Created /testData/testData2<br>[zk: 192.168.10.10:2181(CONNECTED) 9] del<br>delete      deleteall   delquota    <br>[zk: 192.168.10.10:2181(CONNECTED) 9] delete<br>delete      deleteall   <br>[zk: 192.168.10.10:2181(CONNECTED) 9] delete /testData <br>Node not empty: /testData<br>[zk: 192.168.10.10:2181(CONNECTED) 10] deleteall /testData <br>[zk: 192.168.10.10:2181(CONNECTED) 11] <br></code></pre></td></tr></table></figure><h1 id="HDFS"><a href="#HDFS" class="headerlink" title="HDFS"></a>HDFS</h1><h3 id="单点HDFS"><a href="#单点HDFS" class="headerlink" title="单点HDFS"></a>单点HDFS</h3><h4 id="架构-1"><a href="#架构-1" class="headerlink" title="架构"></a>架构<img src="/../Pic/image-20230906170802290.png"></h4><p><img src="/../Pic/image-20230906185500899.png" alt="image-20230906185500899"></p><h4 id="高可用"><a href="#高可用" class="headerlink" title="高可用"></a>高可用</h4><p>在<strong>HDFS1.0</strong>中 名称节点只有一个 在<strong>2.0</strong>中实现了高可用 采用了<strong>主备节点</strong><img src="/../Pic/image-20230906205555514.png" alt="image-20230906205555514"></p><h3 id="HDFS联邦"><a href="#HDFS联邦" class="headerlink" title="HDFS联邦"></a>HDFS联邦</h3><p>利用多个HDFS的NameNode获取更多的数据存储 也可以在多用户访问时 降低了单NameNode的负载 利用NameSpace实现隔<img src="/../Pic/image-20230906211229513.png" alt="image-20230906211229513"></p><h3 id="HDFS读写步骤"><a href="#HDFS读写步骤" class="headerlink" title="HDFS读写步骤"></a>HDFS读写步骤</h3><ol><li><p>客户端对分布式文件系统发送请求 在NameNode中查询元数据 找到底层对应的块设备 </p></li><li><p>然后通过FSDateOutputStream对底层的DataNode发送写入请求 </p></li><li><p>因为存在副本机制 在第一个DataNode写入到40%时 这个Node会把数据传给第二个DateNode 第二个传第三个</p></li><li><p>最后一个DateNode接受完数据后 发送确认包给客户端 确认收到数据  客户端发送命令 关闭文件</p></li></ol><p><img src="/../Pic/image-20230906212332735.png" alt="image-20230906212332735"></p><h4 id="搭建"><a href="#搭建" class="headerlink" title="搭建"></a>搭建</h4><h4 id="集群关闭SElinux-Firewalld、设置ssh免密"><a href="#集群关闭SElinux-Firewalld、设置ssh免密" class="headerlink" title="集群关闭SElinux Firewalld、设置ssh免密"></a>集群关闭SElinux Firewalld、设置ssh免密</h4><blockquote><p>不做赘述 不会重开</p></blockquote><h4 id="配置HDFS"><a href="#配置HDFS" class="headerlink" title="配置HDFS"></a>配置HDFS</h4><h5 id="配置环境变量JAVA-HOME"><a href="#配置环境变量JAVA-HOME" class="headerlink" title="配置环境变量JAVA_HOME"></a>配置环境变量JAVA_HOME</h5><ol><li><p>&#x2F;etc&#x2F;profile</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Host1 ~]# <span class="hljs-built_in">tail</span> -n 1 /etc/profile<br><span class="hljs-built_in">export</span> JAVA_HOME=/root/jdk1.8.0_381/<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$&#123;JAVA_HOME&#125;</span>/bin<br>[root@Host1 ~]# <span class="hljs-built_in">ls</span> /root/jdk1.8.0_381/<br>bin             jmc.txt        lib          release<br>COPYRIGHT       jre            LICENSE      src.zip<br>include         jvisualvm.txt  man          THIRDPARTYLICENSEREADME-JAVAFX.txt<br>javafx-src.zip  legal          README.html  THIRDPARTYLICENSEREADME.txt<br></code></pre></td></tr></table></figure></li><li><p>hadoop文件夹下的&#x2F;etc&#x2F;hadoop.env.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Host1 ~]# <span class="hljs-built_in">ls</span> /root/SoftWare/hadoop-3.3.6/etc/hadoop/<br>capacity-scheduler.xml            httpfs-env.sh               mapred-site.xml<br>configuration.xsl                 httpfs-log4j.properties     shellprofile.d<br>container-executor.cfg            httpfs-site.xml             ssl-client.xml.example<br>core-site.xml                     kms-acls.xml                ssl-server.xml.example<br>hadoop-env.sh                     kms-env.sh                  user_ec_policies.xml.template<br>hadoop-metrics2.properties        kms-log4j.properties        workers<br>hadoop-policy.xml                 kms-site.xml                yarn-env.sh<br>hadoop-user-functions.sh.example  log4j.properties            yarnservice-log4j.properties<br>hdfs-rbf-site.xml                 mapred-env.sh               yarn-site.xml<br>hdfs-site.xml                     mapred-queues.xml.template<br><span class="hljs-comment">#####文件修改内容</span><br><span class="hljs-built_in">export</span> JAVA_HOME=/root/jdk1.8.0_381/<br><span class="hljs-built_in">export</span> HADOOP_CONF_DIR=/root/SoftWare/hadoop-3.3.6/etc/hadoop<br></code></pre></td></tr></table></figure></li></ol><h5 id="查看版本"><a href="#查看版本" class="headerlink" title="查看版本"></a>查看版本</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Host1 ~]# hadoop version<br>Hadoop 3.3.6<br>Source code repository https://github.com/apache/hadoop.git -r 1be78238728da9266a4f88195058f08fd012bf9c<br>Compiled by ubuntu on 2023-06-18T08:22Z<br>Compiled on platform linux-x86_64<br>Compiled with protoc 3.7.1<br>From <span class="hljs-built_in">source</span> with checksum 5652179ad55f76cb287d9c633bb53bbd<br>This <span class="hljs-built_in">command</span> was run using /root/SoftWare/hadoop-3.3.6/share/hadoop/common/hadoop-common-3.3.6.jar<br></code></pre></td></tr></table></figure><h5 id="全部操作步骤"><a href="#全部操作步骤" class="headerlink" title="全部操作步骤"></a>全部操作步骤</h5><h1 id="HIVE"><a href="#HIVE" class="headerlink" title="HIVE"></a>HIVE</h1><p>大数据存储仓库</p><h2 id="HIVE运行流程"><a href="#HIVE运行流程" class="headerlink" title="HIVE运行流程"></a>HIVE运行流程</h2><p><img src="/../Pic/image-20230908165329405.png" alt="image-20230908165329405"></p><h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2><p><img src="/../Pic/image-20230908165517100.png" alt="image-20230908165517100"></p><p><img src="/../Pic/image-20230908165626017.png" alt="image-20230908165626017"></p><h2 id="一些函数"><a href="#一些函数" class="headerlink" title="一些函数"></a>一些函数</h2><p><img src="/../Pic/image-20230908165833957.png" alt="image-20230908165833957"></p><h1 id="MapReduce分布式计算框架"><a href="#MapReduce分布式计算框架" class="headerlink" title="MapReduce分布式计算框架"></a>MapReduce分布式计算框架</h1><h2 id="MapReduce-概念"><a href="#MapReduce-概念" class="headerlink" title="MapReduce 概念"></a>MapReduce 概念</h2><p><img src="/../Pic/image-20230917165445505.png" alt="image-20230917165445505"></p><h2 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h2><p>Map：对杂乱无章的数据 对他们的特征 进行解析和归类 提取出Key&#x3D;Value</p><p>Reduce：针对Map处理的数据 进行下一步处理</p><p>将HDFS中的数据经过分片 发送给Map处理 经过洗牌 变得有规律 发送给Reduce() 最后输出结果</p><p><img src="/../Pic/image-20230917170650666.png" alt="image-20230917170650666"></p><p><img src="/../Pic/image-20230917170947344.png" alt="image-20230917170947344"></p><p><img src="/../Pic/image-20230917171114046.png" alt="image-20230917171114046"></p><h1 id="Yarn资源调度控制器"><a href="#Yarn资源调度控制器" class="headerlink" title="Yarn资源调度控制器"></a>Yarn资源调度控制器</h1><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p><img src="/../Pic/image-20230917165709364.png" alt="image-20230917165709364"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2025/02/06/English/"/>
    <url>/2025/02/06/English/</url>
    
    <content type="html"><![CDATA[<h2 id="固定短语搭配"><a href="#固定短语搭配" class="headerlink" title="固定短语搭配"></a>固定短语搭配</h2><table><thead><tr><th align="left"><strong>English</strong></th><th align="left"><strong>Translate</strong></th><th align="left"><strong>说明</strong></th></tr></thead><tbody><tr><td align="left">be supposed to do</td><td align="left">应该做某事 主动</td><td align="left">约等于should</td></tr><tr><td align="left">be sent to</td><td align="left">被派往</td><td align="left"></td></tr><tr><td align="left">remember to do</td><td align="left">记得去做某事</td><td align="left"></td></tr><tr><td align="left">remember doing</td><td align="left">记得做过某事</td><td align="left"></td></tr><tr><td align="left">be interested in</td><td align="left">对….感兴趣</td><td align="left"></td></tr><tr><td align="left">play an important part in</td><td align="left">扮演了重要的角色</td><td align="left"></td></tr><tr><td align="left">ask for</td><td align="left">征求</td><td align="left"></td></tr><tr><td align="left"></td><td align="left"></td><td align="left"></td></tr><tr><td align="left"></td><td align="left"></td><td align="left"></td></tr><tr><td align="left"></td><td align="left"></td><td align="left"></td></tr></tbody></table><h2 id="五大基本句型"><a href="#五大基本句型" class="headerlink" title="五大基本句型"></a>五大基本句型</h2><ul><li>主谓</li><li>主谓宾</li><li>主系表</li><li>主谓宾宾补</li><li>主谓双宾</li></ul><h2 id="谓语"><a href="#谓语" class="headerlink" title="谓语"></a>谓语</h2><ul><li><p><strong>时态</strong>：现在，过去，将来</p></li><li><p><strong>语态</strong>：主动 Or 被动</p></li><li><p><strong>三单</strong>：看**主语 ** I am 、 You are 、 其余三单</p></li></ul><h3 id="提示词"><a href="#提示词" class="headerlink" title="提示词"></a>提示词</h3><h4 id="时态"><a href="#时态" class="headerlink" title="时态"></a>时态</h4><table><thead><tr><th>ing the past … years</th><th>过去几年</th><th>完成时</th></tr></thead><tbody><tr><td>since + 时间点</td><td>自从</td><td>现在完成时</td></tr><tr><td>at the moment</td><td>眼下</td><td>现在进行时</td></tr><tr><td>Now</td><td>现在</td><td>进行时</td></tr><tr><td>up to now</td><td>到现在</td><td>现在完成时</td></tr></tbody></table><h4 id="三单"><a href="#三单" class="headerlink" title="三单"></a>三单</h4><h5 id="就近"><a href="#就近" class="headerlink" title="就近"></a>就近</h5><table><thead><tr><th>not only …. but also ….</th><th>不仅… 而且…</th></tr></thead><tbody><tr><td>Neither … Nor …</td><td>既不… 也不…</td></tr></tbody></table><h5 id="就远"><a href="#就远" class="headerlink" title="就远"></a>就远</h5><table><thead><tr><th>with</th><th>和</th></tr></thead></table><h5 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h5><ul><li><p>动名词短语做主语 属于<strong>三单</strong></p><ul><li>Doing exercise</li><li>Eating more vegatables</li></ul></li><li></li></ul><h5 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h5><p><img src="/home/shanwen/Documents/Note/Pic/image-20231224173824242.png" alt="image-20231224173824242"></p><p>Not only … but also 就近原则 </p><p>My friends属于复数 排除三单</p><p>when后面为过去 <strong>were</strong> 前面也应当为过去 选were</p><h2 id="非谓语动词"><a href="#非谓语动词" class="headerlink" title="非谓语动词"></a>非谓语动词</h2><blockquote><p> I <strong>want</strong> to <strong>play</strong> games</p></blockquote><p>Want就是<strong>主谓语动词</strong></p><p>play就是<strong>非位于动词</strong></p><p>一个主语只能有一个主谓语动词 但可以有多个非谓语动词</p><blockquote><p>Playing the piano is my habbit</p></blockquote><p>上述主谓语动词为 is 非谓语动词为Playing</p><p><img src="/home/shanwen/Documents/Note/Pic/image-20231227172513286.png" alt="image-20231227172513286"></p><h3 id="不定式-to-do"><a href="#不定式-to-do" class="headerlink" title="不定式 to do"></a>不定式 <strong>to do</strong></h3><blockquote><p>I want to play games</p></blockquote><p><strong>表示将来 或 表目的</strong></p><p>这件事情还没有做 将要去做 用<strong>to do</strong></p><h3 id="分词"><a href="#分词" class="headerlink" title="分词"></a>分词</h3><blockquote><p>My favorite thing is reading                       ##我的爱好是读书</p><p>I stand outside waiting for Mr. Chen.          ##我在外面等陈先生</p></blockquote><p>上述句子中 第二句才为分词(现在分词)</p><ul><li>第一句中 reading 是一个动名词</li><li>第二句中 waiting才是一个动词</li></ul><h4 id="现在分词-doing"><a href="#现在分词-doing" class="headerlink" title="现在分词 doing"></a>现在分词 <strong>doing</strong></h4><blockquote><p>I like <strong>playing</strong> games</p><p>He sat there <strong>reading</strong> a book</p></blockquote><ul><li><p>非谓语后面为<strong>动名词</strong> 用doing</p></li><li><p>非谓语动词为<strong>主动（非被动）、进行</strong>的用doing</p></li></ul><h4 id="过去分词-done"><a href="#过去分词-done" class="headerlink" title="过去分词 done"></a>过去分词 <strong>done</strong></h4><blockquote><p>I like the book <strong>written</strong> by Luxun</p><p>Tom lives in lunatic hospital , tom <strong>studied</strong>  ## Tom住在精神病院被研究</p></blockquote><ul><li>非谓语动词表<strong>被动</strong>、<strong>完成</strong>了的 用done</li><li>所以第二句 studied为过去分词 表被动 被研究了</li></ul><h3 id="动名词"><a href="#动名词" class="headerlink" title="动名词"></a>动名词</h3><blockquote><p>My favorite thing is <strong>reading</strong>## 我最喜欢的事情是读书</p></blockquote><ul><li><strong>仅改变词性,不改变意思</strong></li><li>所以 当我们有了主谓语动词 <strong>is</strong> 后 非谓语动词 <strong>read</strong>变为动名词形式</li></ul><h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><p>play:</p><ul><li>过去分词played  被动,已经玩了</li><li>现在分词    playing     主动,正在做什么</li><li>动名词       ping         动名词,不改变意思</li><li>不定式       to play      想要去做什么</li></ul><table><thead><tr><th>remember to do</th><th>记得做某事</th></tr></thead><tbody><tr><td>remember doing</td><td>记得做过某事</td></tr><tr><td>finish doing</td><td>完成了某事</td></tr><tr><td>enjoy doing</td><td>享受</td></tr></tbody></table><h2 id="代词"><a href="#代词" class="headerlink" title="代词"></a>代词</h2><p>代指主语的词 He,It,That,One</p><h3 id="物主代词"><a href="#物主代词" class="headerlink" title="物主代词"></a>物主代词</h3><p><img src="/home/shanwen/Documents/Note/Pic/image-20240312214236333.png" alt="image-20240312214236333"></p><blockquote><p>I have three books , and this book is <em><strong>my</strong></em> favorite book.</p><p>The desktop have three books , and they are <em><strong>mine</strong></em>.</p></blockquote><h3 id="不定代词-人"><a href="#不定代词-人" class="headerlink" title="不定代词(人)"></a>不定代词(人)</h3><p><img src="/home/shanwen/Documents/Note/Pic/image-20240312215010670.png" alt="image-20240312215010670"></p><p><img src="/home/shanwen/Documents/Note/Pic/image-20240312215227839.png" alt="image-20240312215227839"></p><h3 id="不定代词-物"><a href="#不定代词-物" class="headerlink" title="不定代词(物)"></a>不定代词(物)</h3><p><img src="/home/shanwen/Documents/Note/Pic/image-20240312215432909.png" alt="image-20240312215432909"></p><h3 id="人称代词"><a href="#人称代词" class="headerlink" title="人称代词"></a>人称代词</h3><p><img src="/home/shanwen/Documents/Note/Pic/image-20240312215626625.png" alt="image-20240312215626625"></p><h3 id="区分"><a href="#区分" class="headerlink" title="区分"></a>区分</h3><p><img src="/home/shanwen/Documents/Note/Pic/image-20240312215832334.png" alt="image-20240312215832334"></p><p><img src="/home/shanwen/Documents/Note/Pic/image-20240312221621725.png" alt="image-20240312221621725"></p><h3 id="思维导图"><a href="#思维导图" class="headerlink" title="思维导图"></a>思维导图</h3><p><img src="/home/shanwen/Documents/Note/Pic/image-20240312221750882.png" alt="image-20240312221750882"></p><p><img src="/home/shanwen/Documents/Note/Pic/image-20240312223628629.png" alt="image-20240312223628629"></p><p><img src="/home/shanwen/Documents/Note/Pic/image-20240312225040519.png" alt="image-20240312225040519"></p><h2 id="冠词"><a href="#冠词" class="headerlink" title="冠词"></a>冠词</h2><p>冠词后面就是名词，常见的冠词有a,an,the</p><h3 id="特指-Or-泛指"><a href="#特指-Or-泛指" class="headerlink" title="特指 Or 泛指"></a>特指 Or 泛指</h3><p>特指：我喜欢这个饼干</p><p>泛指：我喜欢饼干</p><h3 id="原则"><a href="#原则" class="headerlink" title="原则"></a>原则</h3><ol><li>可数名词的单数必须加冠词</li><li>可数名词的负数和不可数名词泛指时可以不加冠词</li><li>任何名词在特指时，都要加The</li></ol><blockquote><p>I have a book</p><p>I have three books</p><p>I have the book</p></blockquote><h3 id="不定冠词"><a href="#不定冠词" class="headerlink" title="不定冠词"></a>不定冠词</h3><p>泛指某一个人或者事物中的其中一个</p><blockquote><p>I want to buy a car</p></blockquote><p>a: 用于辅音音素的可数名词单数形式</p><p>an：用于<em><strong>元音音素</strong></em>的可数名词单数形式</p><blockquote><p>通常为AEIOU开头的单词为<em><strong>元音</strong></em></p></blockquote><h3 id="定冠词"><a href="#定冠词" class="headerlink" title="定冠词"></a>定冠词</h3><p>特指 I want to buy the car</p><p>the: 这个 特指</p><ol><li>用于形容词最高级及起特定作用的比较级前</li><li>用于序数词或者其他表示顺序的词前</li><li>用于姓氏的负数形式前，表示全家或者夫妇二人</li></ol><h3 id="零冠词"><a href="#零冠词" class="headerlink" title="零冠词"></a>零冠词</h3><p>就是不填冠词 通常放在<strong>专业名词</strong>的前面</p><blockquote><p>We had a good time on <strong>Christmas day</strong></p></blockquote><p>用于</p><ol><li>一日三餐，球类运动和娱乐运动之前，不用冠词</li><li>名词前已经有 That,This,My,His,Every,Some 等词修饰，不用冠词</li></ol><h2 id="名词"><a href="#名词" class="headerlink" title="名词"></a>名词</h2><p>表示人，物，地点的名称</p><h3 id="专有名词"><a href="#专有名词" class="headerlink" title="专有名词"></a>专有名词</h3><p>一般都会大写 </p><h3 id="普通名词"><a href="#普通名词" class="headerlink" title="普通名词"></a>普通名词</h3><h4 id="可数名词"><a href="#可数名词" class="headerlink" title="可数名词"></a>可数名词</h4><p><code>musics songs</code></p><h4 id="不可数名词"><a href="#不可数名词" class="headerlink" title="不可数名词"></a>不可数名词</h4><ol><li><p><strong>无法分割的东西</strong></p><p><code>water soup milk air maet tea bread</code></p></li><li><p><strong>体积微小的东西</strong></p></li></ol><p>​<code>hair rice salt corn cell</code></p><ol start="3"><li>一类物品的总称</li></ol><p>​<code> food fruit money clothing</code></p><ol start="4"><li><strong>学科类</strong></li></ol><p>​<code>math science history</code></p><ol start="5"><li><p><strong>抽象名词</strong></p><p><code>love life experience nutrition</code></p></li></ol><h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><p><img src="/home/shanwen/Documents/Note/Pic/image-20240314201346095.png" alt="image-20240314201346095"></p><p><img src="/home/shanwen/Documents/Note/Pic/image-20240314235856892.png" alt="image-20240314235856892"></p><h3 id="名词短语"><a href="#名词短语" class="headerlink" title="名词短语"></a>名词短语</h3><p>限定词() + 形容词() + 名词</p><p><img src="/home/shanwen/Documents/Note/Pic/image-20240314233815951.png" alt="image-20240314233815951"></p><p><img src="/home/shanwen/Documents/Note/Pic/image-20240314233901167.png" alt="image-20240314233901167"></p><p><img src="/home/shanwen/Documents/Note/Pic/image-20240314234738695.png" alt="image-20240314234738695"></p><p><img src="/home/shanwen/Documents/Note/Pic/image-20240314235246294.png" alt="image-20240314235246294"></p><h3 id="名词所有格"><a href="#名词所有格" class="headerlink" title="名词所有格"></a>名词所有格</h3><h4 id="名词’s"><a href="#名词’s" class="headerlink" title="名词’s"></a>名词’s</h4><p><code>This is Jim&#39;s friend</code> </p><h4 id="A-0f-B"><a href="#A-0f-B" class="headerlink" title="A 0f B"></a>A 0f B</h4><p><code>This is friend of Jim</code></p><h4 id="双重所有格"><a href="#双重所有格" class="headerlink" title="双重所有格"></a>双重所有格</h4><p><code>A friend of Jim&#39;s</code></p><blockquote><p>限定词 + 名词 + of  + ‘s的名词所有格&#x2F;名词性物主代词</p></blockquote><p><img src="/home/shanwen/Documents/Note/Pic/image-20240315162825391.png" alt="image-20240315162825391"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2025/02/06/Contailer/"/>
    <url>/2025/02/06/Contailer/</url>
    
    <content type="html"><![CDATA[<h1 id="Podman"><a href="#Podman" class="headerlink" title="Podman"></a>Podman</h1><h2 id="自定义镜像"><a href="#自定义镜像" class="headerlink" title="自定义镜像"></a>自定义镜像</h2><p>Docker中叫做Docker build，podman叫 <strong>Buildah</strong>；它们都遵循OCI，通过编写DockerFile构建镜像</p><h2 id="故障排错"><a href="#故障排错" class="headerlink" title="故障排错"></a>故障排错</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">podman --log-level debug ps<br></code></pre></td></tr></table></figure><h3 id="Error-cannot-re-exec-process-to-join-the-existing-user-namespace"><a href="#Error-cannot-re-exec-process-to-join-the-existing-user-namespace" class="headerlink" title="Error: cannot re-exec process to join the existing user namespace"></a>Error: cannot re-exec process to join the existing user namespace</h3><blockquote><p>rm -rf .local&#x2F;tmp&#x2F;libpod&#x2F;</p></blockquote><h1 id="LNMP容器部署"><a href="#LNMP容器部署" class="headerlink" title="LNMP容器部署"></a>LNMP容器部署</h1><h2 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h2><p>可以创建一个容器内部网络 同一个网络的容器 使用 <strong>–name</strong> 指定的容器名称通信</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker network create WeCenter --driver bridge<br></code></pre></td></tr></table></figure><blockquote><p><strong>driver类型 默认为Bridge</strong></p><ol><li><p>桥接网络（Bridge Network）：桥接网络是 Docker 默认的网络类型。它创建一个桥接接口，允许容器通过桥接网络与主机和其他容器进行通信。每个容器都可以分配一个独立的 IP 地址，并且可以使用容器名称进行互相访问。</p></li><li><p>IPvlan 网络（IPvlan Network）：IPvlan 网络允许在单个物理接口上创建多个虚拟接口，每个接口都具有独立的 MAC 和 IP 地址。这意味着每个容器都可以拥有自己的网络身份，并且可以直接与主机网络进行通信。IPvlan 网络适用于需要高性能和隔离性的场景。</p></li><li><p>Macvlan 网络（Macvlan Network）：Macvlan 网络允许将容器直接映射到物理网络上的 MAC 地址，使容器能够与物理网络中的其他设备进行通信。这使得容器可以像物理设备一样直接连接到网络，对于需要容器直接与网络进行交互的场景非常有用。</p></li><li><p>Overlay 网络（Overlay Network）：Overlay 网络是一种允许在多个 Docker 主机上创建虚拟网络的类型。它使用网络虚拟化技术将容器连接到一个逻辑网络中，使得容器可以跨主机进行通信。这对于构建分布式应用程序和容器编排系统非常有用。</p></li></ol></blockquote><h2 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h2><p>创建PHP-fpm的容器 需要支持mysqli扩展等 这里我自己利用php:7.4-fpm封装了了一个 可以拉取到本地部署</p><blockquote><p><a href="https://console.huaweicloud.com/swr/?region=cn-north-4#/swr/warehouse/list/private">https://console.huaweicloud.com/swr/?region=cn-north-4#/swr/warehouse/list/private</a></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Docker01 WeCenter]# docker run -dit --name php --restart always -v /root/WeCenter/:/var/www/html --network WeCenter myphp:latest <br>9d8df4f25d588afa89ec5752f16b2cb32764eb9cc50fb462a454b3c340c3a28e<br>[root@Docker01 WeCenter]# docker ps<br>CONTAINER ID   IMAGE          COMMAND                   CREATED         STATUS       PORTS     NAMES<br>9d8df4f25d58   myphp:latest   <span class="hljs-string">&quot;docker-php-entrypoi…&quot;</span>   5 seconds ago   Up 4 seconds  9000/tcp   php<br></code></pre></td></tr></table></figure><p><strong><code>注意这个挂载的文件 是php的目录文件 包含了php的idnex.php等文件 他需要在php和nginx中都挂载</code></strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Docker01 WeCenter]# <span class="hljs-built_in">ls</span> /root/WeCenter/<br>app            composer.json  install      models          README.md   system   vendor<br>cache          composer.lock  language     nginx.htaccess  robots.txt  tmp      version.php<br>changelog.txt  index.php      license.txt  plugins         static      uploads  views<br></code></pre></td></tr></table></figure><h2 id="NGINX"><a href="#NGINX" class="headerlink" title="NGINX"></a>NGINX</h2><p>普通的nginx即可 记得改配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Docker01 WeCenter]# docker run -dit --name n1 --restart always -v /root/WeCenter/:/usr/share/nginx/html -p 8888:80 --network WeCenter nginx:php <br>a824a09a8b8a23b8b28136c960e9d317e9da8db93327ea8045a87509d9b2fb44<br>root@Docker01 WeCenter]# docker ps<br>CONTAINER ID   IMAGE          COMMAND                   CREATED         STATUS         PORTS                                   NAMES<br>a824a09a8b8a   nginx:php      <span class="hljs-string">&quot;/docker-entrypoint.…&quot;</span>   6 seconds ago   Up 5 seconds   0.0.0.0:8888-&gt;80/tcp, :::8888-&gt;80/tcp   n1<br>9d8df4f25d58   myphp:latest   <span class="hljs-string">&quot;docker-php-entrypoi…&quot;</span>   2 minutes ago   Up 2 minutes   9000/tcp                                php<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@a824a09a8b8a:/# <span class="hljs-built_in">cat</span> /etc/nginx/conf.d/default.conf <br>server &#123;<br>    listen       80;<br>    server_name  localhost;<br>    <span class="hljs-comment">#access_log  /var/log/nginx/host.access.log  main;</span><br>    <span class="hljs-comment">#</span><br>    location / &#123;<br>            root   /usr/share/nginx/html;<br>            index  index.html index.php;<br>        &#125;<br><br>    location ~ \.php$ &#123;<br>        root           /var/www/html;<br>        fastcgi_pass   php:9000;<br>        fastcgi_index  index.php;<br>        fastcgi_param  SCRIPT_FILENAME$document_root<span class="hljs-variable">$fastcgi_script_name</span>;<br>        include        fastcgi_params;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Mysql"><a href="#Mysql" class="headerlink" title="Mysql"></a>Mysql</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Docker01 WeCenter]# docker run -dit --name mysql -v /root/zrlog/sql/:/var/lib/mysql --network WeCenter --restart always mysql:latest<br>c5f6a611a2e6f319791ab9576979e0cd30f3313ceddb2f6bb932d31d253902a7<br>[root@Docker01 WeCenter]# <span class="hljs-built_in">ls</span> /root/zrlog/sql/<br> auto.cnf           binlog.000006   ca.pem               ibdata1         performance_schema   undo_002<br> b8142d95ce8d.err   binlog.000007   classicmodels        ibtmp1          private_key.pem      WeCenter<br> binlog.000001      binlog.000008   client-cert.pem     <span class="hljs-string">&#x27;#innodb_redo&#x27;</span>   public_key.pem       Zrlog<br> binlog.000002      binlog.000009   client-key.pem      <span class="hljs-string">&#x27;#innodb_temp&#x27;</span>   server-cert.pem<br> binlog.000003      binlog.000010  <span class="hljs-string">&#x27;#ib_16384_0.dblwr&#x27;</span>   mysql           server-key.pem<br> binlog.000004      binlog.index   <span class="hljs-string">&#x27;#ib_16384_1.dblwr&#x27;</span>   mysql.ibd       sys<br> binlog.000005      ca-key.pem      ib_buffer_pool       mysql.sock      undo_001<br></code></pre></td></tr></table></figure><p><img src="/../Pic/image-20231016233155576.png" alt="image-20231016233155576"></p><h2 id="可能的错误"><a href="#可能的错误" class="headerlink" title="可能的错误"></a>可能的错误</h2><p>看 我们直接启动mysql会报错 说没有环境变量</p><p>因为之前那个Mysql我指定了默认的mysql文件 所以不需要我输入环境变量等</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Docker01 WeCenter]# docker run -dit --name mysql1 --restart always mysql<br>561778c279f983e6ec15e90af7c203e4fbb0c0958ad75afb06b87aa28e6f2deb<br>[root@Docker01 WeCenter]# docker ps <br>CONTAINER ID   IMAGE          COMMAND                   CREATED         STATUS                                  PORTS                                   NAMES<br>561778c279f9   mysql          <span class="hljs-string">&quot;docker-entrypoint.s…&quot;</span>   2 seconds ago   Restarting (1) Less than a second ago                                           mysql1<br>[root@Docker01 WeCenter]# docker logs mysql1<br>2023-10-16 15:18:35+00:00 [Note] [Entrypoint]: Entrypoint script <span class="hljs-keyword">for</span> MySQL Server 8.1.0-1.el8 started.<br>2023-10-16 15:18:36+00:00 [Note] [Entrypoint]: Switching to dedicated user <span class="hljs-string">&#x27;mysql&#x27;</span><br>2023-10-16 15:18:36+00:00 [Note] [Entrypoint]: Entrypoint script <span class="hljs-keyword">for</span> MySQL Server 8.1.0-1.el8 started.<br>2023-10-16 15:18:36+00:00 [ERROR] [Entrypoint]: Database is uninitialized and password option is not specified<br>    You need to specify one of the following as an environment variable:<br>    - MYSQL_ROOT_PASSWORD<br>    - MYSQL_ALLOW_EMPTY_PASSWORD<br>    - MYSQL_RANDOM_ROOT_PASSWORD<br></code></pre></td></tr></table></figure><p>现在我们删除pod 指定环境变量就不会报错了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Docker01 WeCenter]# docker run -dit --name mysql1 --restart always --<span class="hljs-built_in">env</span> MYSQL_ROOT_PASSWORD=qweQWE123  mysql<br>9f8973e4c85d4431239fe00c1bb4fccbff61077a54e07a9331a86d90cb43d0b9<br>[root@Docker01 WeCenter]# docker ps <br>CONTAINER ID   IMAGE          COMMAND                   CREATED          STATUS          PORTS                                   NAMES<br>9f8973e4c85d   mysql          <span class="hljs-string">&quot;docker-entrypoint.s…&quot;</span>   4 seconds ago    Up 3 seconds    3306/tcp, 33060/tcp                     mysql1<br>[root@Docker01 WeCenter]# docker logs mysql1 <br>2023-10-16 15:21:05+00:00 [Note] [Entrypoint]: Entrypoint script <span class="hljs-keyword">for</span> MySQL Server 8.1.0-1.el8 started.<br>2023-10-16 15:21:06+00:00 [Note] [Entrypoint]: Switching to dedicated user <span class="hljs-string">&#x27;mysql&#x27;</span><br>2023-10-16 15:21:06+00:00 [Note] [Entrypoint]: Entrypoint script <span class="hljs-keyword">for</span> MySQL Server 8.1.0-1.el8 started.<br>2023-10-16 15:21:06+00:00 [Note] [Entrypoint]: Initializing database files<br>2023-10-16T15:21:06.183614Z 0 [System] [MY-015017] [Server] MySQL Server Initialization - start.<br>2023-10-16T15:21:06.185024Z 0 [Warning] [MY-011068] [Server] The syntax <span class="hljs-string">&#x27;--skip-host-cache&#x27;</span> is deprecated and will be removed <span class="hljs-keyword">in</span> a future release. Please use SET GLOBAL host_cache_size=0 instead.<br>2023-10-16T15:21:06.185107Z 0 [System] [MY-013169] [Server] /usr/sbin/mysqld (mysqld 8.1.0) initializing of server <span class="hljs-keyword">in</span> progress as process 78<br>2023-10-16T15:21:06.193531Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.<br>2023-10-16T15:21:07.550901Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.<br>2023-10-16T15:21:10.699357Z 6 [Warning] [MY-010453] [Server] root@localhost is created with an empty password ! Please consider switching off the --initialize-insecure option.<br>2023-10-16T15:21:16.508014Z 0 [System] [MY-015018] [Server] MySQL Server Initialization - end.<br>2023-10-16 15:21:16+00:00 [Note] [Entrypoint]: Database files initialized<br>2023-10-16 15:21:16+00:00 [Note] [Entrypoint]: Starting temporary server<br>mysqld will <span class="hljs-built_in">log</span> errors to /var/lib/mysql/9f8973e4c85d.err<br>mysqld is running as pid 122<br>2023-10-16T15:21:17.377491Z 0 [System] [MY-015016] [Server] MySQL Server - end.<br>2023-10-16 15:21:17+00:00 [Note] [Entrypoint]: Temporary server started.<br><span class="hljs-string">&#x27;/var/lib/mysql/mysql.sock&#x27;</span> -&gt; <span class="hljs-string">&#x27;/var/run/mysqld/mysqld.sock&#x27;</span><br>Warning: Unable to load <span class="hljs-string">&#x27;/usr/share/zoneinfo/iso3166.tab&#x27;</span> as <span class="hljs-keyword">time</span> zone. Skipping it.<br>Warning: Unable to load <span class="hljs-string">&#x27;/usr/share/zoneinfo/leap-seconds.list&#x27;</span> as <span class="hljs-keyword">time</span> zone. Skipping it.<br>Warning: Unable to load <span class="hljs-string">&#x27;/usr/share/zoneinfo/leapseconds&#x27;</span> as <span class="hljs-keyword">time</span> zone. Skipping it.<br></code></pre></td></tr></table></figure><h1 id="Zrlog容器部署"><a href="#Zrlog容器部署" class="headerlink" title="Zrlog容器部署"></a>Zrlog容器部署</h1><h2 id="启动tomcat容器"><a href="#启动tomcat容器" class="headerlink" title="启动tomcat容器"></a>启动tomcat容器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Docker01 ~]# <span class="hljs-built_in">ls</span> /root/zrlog/<br>sql  war<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Docker01 ~]# docker run -dit --name zrlog  -v /root/zrlog/war/:/usr/local/tomcat/webapps -p 8081:8080 tomcat:9.0  <br></code></pre></td></tr></table></figure><blockquote><p>别用Tomcat10 会报错</p></blockquote><h2 id="启动SQL"><a href="#启动SQL" class="headerlink" title="启动SQL"></a>启动SQL</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Docker01 ~]# docker run -dit \ <br>--name sql \ <br>--<span class="hljs-built_in">env</span> MYSQL_ROOT_PASSWORD=qweQWE123 --<span class="hljs-built_in">env</span> MYSQL_DATABASE=Zrlog \ <br>-v /root/zrlog/sql/:/var/lib/mysql/  \<br>mysql<br></code></pre></td></tr></table></figure><p>查看SQL的地址</p><blockquote><p>用内部地址即可 不用映射</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Docker01 ~]# docker inspect sql | grep  -i ipaddress<br>            <span class="hljs-string">&quot;SecondaryIPAddresses&quot;</span>: null,<br>            <span class="hljs-string">&quot;IPAddress&quot;</span>: <span class="hljs-string">&quot;172.17.0.3&quot;</span>,<br>                    <span class="hljs-string">&quot;IPAddress&quot;</span>: <span class="hljs-string">&quot;172.17.0.3&quot;</span>,<br></code></pre></td></tr></table></figure><h2 id="去浏览器对接SQL"><a href="#去浏览器对接SQL" class="headerlink" title="去浏览器对接SQL"></a>去浏览器对接SQL</h2><p><img src="/../Pic/image-20230922221640790.png"></p><p><img src="/../Pic/image-20230922221737724.png" alt="image-20230922221737724"></p><p><img src="/../Pic/image-20230922221853493.png" alt="image-20230922221853493"></p><h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Docker01 ~]# tree zrlog/ -L 2<br>zrlog/<br>├── sql<br>│   ├── auto.cnf<br>│   ├── b8142d95ce8d.err<br>│   ├── binlog.000001<br>│   ├── binlog.000002<br>│   ├── binlog.index<br>│   ├── ca-key.pem<br>│   ├── ca.pem<br>│   ├── client-cert.pem<br>│   ├── client-key.pem<br>│   ├── <span class="hljs-comment">#ib_16384_0.dblwr</span><br>│   ├── <span class="hljs-comment">#ib_16384_1.dblwr</span><br>│   ├── ib_buffer_pool<br>│   ├── ibdata1<br>│   ├── ibtmp1<br>│   ├── <span class="hljs-comment">#innodb_redo</span><br>│   ├── <span class="hljs-comment">#innodb_temp</span><br>│   ├── mysql<br>│   ├── mysql.ibd<br>│   ├── mysql.sock -&gt; /var/run/mysqld/mysqld.sock<br>│   ├── performance_schema<br>│   ├── private_key.pem<br>│   ├── public_key.pem<br>│   ├── server-cert.pem<br>│   ├── server-key.pem<br>│   ├── sys<br>│   ├── undo_001<br>│   ├── undo_002<br>│   └── Zrlog<br>└── war<br>    ├── ROOT<br>    └── ROOT.war<br></code></pre></td></tr></table></figure><h2 id="docker-compose部署"><a href="#docker-compose部署" class="headerlink" title="docker-compose部署"></a>docker-compose部署</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">sql:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:latest</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">MYSQL_ROOT_PASSWORD=qweQWE123</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">MYSQL_DATABASE=Zrlog</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/root/zrlog/sql/:/var/lib/mysql/</span><br>  <span class="hljs-attr">Zrlog:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">tomcat:9.0</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/root/zrlog/war/:/usr/local/tomcat/webapps</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">8082</span><span class="hljs-string">:8080</span><br></code></pre></td></tr></table></figure><blockquote><p>删除ROOT遗留目录</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Docker01 ~]# <span class="hljs-built_in">cd</span> /root/zrlog/war/<br>[root@Docker01 war]# <span class="hljs-built_in">ls</span><br>ROOT  ROOT.war<br>[root@Docker01 war]# <span class="hljs-built_in">rm</span> -rf ROOT<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Docker01 ~]# <span class="hljs-built_in">ls</span><br>anaconda-ks.cfg  docker-compose.yml  nginx-1.24.0  zrlog<br>[root@Docker01 ~]# docker compose -f docker-compose.yml up -d<br>[+] Running 2/2<br> ✔ Container root-Zrlog-1  Started                                                                                 0.1s <br> ✔ Container root-sql-1    Started                                                                                 0.1s <br>[root@Docker01 ~]# docker ps<br>CONTAINER ID   IMAGE          COMMAND                   CREATED         STATUS         PORTS                                       NAMES<br>014520470bed   tomcat:9.0     <span class="hljs-string">&quot;catalina.sh run&quot;</span>         3 seconds ago   Up 2 seconds   0.0.0.0:8082-&gt;8080/tcp, :::8082-&gt;8080/tcp   root-Zrlog-1<br>7687c105e8d5   mysql:latest   <span class="hljs-string">&quot;docker-entrypoint.s…&quot;</span>   3 seconds ago   Up 2 seconds   3306/tcp, 33060/tcp                         root-sql-1<br></code></pre></td></tr></table></figure><blockquote><p>访问浏览器继续找数据库ip 部署即可</p></blockquote><h2 id="清理环境"><a href="#清理环境" class="headerlink" title="清理环境"></a>清理环境</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Docker01 ~]# docker compose -f docker-compose.yml stop <br>[+] Stopping 2/2<br> ✔ Container root-Zrlog-1  Stopped                                                                                 0.6s <br> ✔ Container root-sql-1    Stopped                                                                                 3.0s <br>[root@Docker01 ~]# docker compose -f docker-compose.yml <span class="hljs-built_in">rm</span><br>? Going to remove root-Zrlog-1, root-sql-1 Yes<br>[+] Removing 2/0<br> ✔ Container root-sql-1    Removed                                                                                 0.0s <br> ✔ Container root-Zrlog-1  Removed   <br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2025/02/06/HCIE/"/>
    <url>/2025/02/06/HCIE/</url>
    
    <content type="html"><![CDATA[<h1 id="相关概念"><a href="#相关概念" class="headerlink" title="相关概念"></a>相关概念</h1><p><strong>单体架构</strong><br>在物理服务器上安装操作系统，然后在系统上跑服务，资源利用率低，无高可用。</p><p><strong>虚拟化架构</strong><br>在物理服务上安装支持虚拟化(KVM,XEN,ESXI)的操作系统，然后在系统上虚拟化出多个Guest OS，应用运行于Guest OS，这样一个服务器就可以满足多个应用；也可以在单服务器和多服务器情况下实现高可用。</p><p><strong>容器架构</strong><br>在系统中使用 cgroup 和 namespace 等内核技术，将整个应用封装为镜像；不同的系统(Linux,Windows,Unix)可以使用这个镜像运行多个容器示例。多个系统之间可以运行于K8S之类的容器编排系统，实现应用的高可用。</p><p><strong>微服务架构</strong><br>将原来的高耦合程序拆分为多个低耦合的模块，每个模块可以独立开发部署。</p><p><strong>DevOps</strong><br>将开发好的应用交由运维测试 ，通过测试后发布到生产环境。</p><p><strong>CI&#x2F;CD</strong><br>将每个微服务拆分后的模块，单独开发，当代码提交后就会出发打包发布到测试环境，通过后发布到生产环境，依赖于Jenkins等平台，过程都是全自动的。</p><p><strong>云原生架构</strong><br>容器架构 + 微服务 + DevOps + CI&#x2F;CD</p><p><strong>云计算架构</strong><br>使用虚拟化或容器化等技术，将物理资源池化，让用户可以在任何地方，通过互联网快速获取按需自主，弹性可扩展的服务；说人话就是集中一切资源，一致对外。<br><img src="/../Pic/CloudComputing.png"></p><h2 id="云计算部署模式"><a href="#云计算部署模式" class="headerlink" title="云计算部署模式"></a>云计算部署模式</h2><p><strong>私有云</strong>：某一个组织或企业内部使用的云。<br><strong>公有云</strong>：面向所有用户的云，例如华为云，阿里云，腾讯云。<br><strong>行业云</strong>：政务云&#x2F;教育云等，针对某一个行业的痛点开发的云。</p><h2 id="云计算服务模式"><a href="#云计算服务模式" class="headerlink" title="云计算服务模式"></a>云计算服务模式</h2><p><img src="/../Pic/IaaS.png" alt="IaaS"></p><p><strong>IaaS(基础设施即服务)</strong><br>云厂商将物理基础设施作为服务提供，用户需要搭建服务的平台、配置平台、最后向外提供服务；例如ECS，EVS。</p><p><strong>PaaS(平台即服务)</strong><br>云厂商提供平台；用户只需要配置这个平台，然后向外提供服务；例如 RDS，CCE。</p><p><strong>SaaS(软件即服务)</strong><br>云厂商直接提供服务，用户直接使用即可；例如 云桌面，云会议。</p><h1 id="FusionCompute"><a href="#FusionCompute" class="headerlink" title="FusionCompute"></a>FusionCompute</h1><p><strong>华为的企业级虚拟化解决方案 早期叫 FusionSphere</strong></p><h2 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h2><h2 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h2><p>FC包含两个核心组件: CNA和VRM</p><h3 id="CNA"><a href="#CNA" class="headerlink" title="CNA"></a>CNA</h3><p><strong>Couputing Node Agent</strong>，计算节点代理；将物理服务器的资源虚拟化，为虚拟机提供计算资源(CPU、内存、磁盘、网络…)；本质是经过裁剪的<strong>EulerOS</strong>安装了<strong>KVM</strong>，具有了<strong>一型虚拟化</strong>的能力。<br>也可以在CNA上使用一些KVM的底层命令。</p><p><img src="/../Pic/Snipaste_2025-01-10_12-27-15.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">virsh list --all<br>virsh start TestVM<br>virsh shutdown TestVM<br></code></pre></td></tr></table></figure><p><img src="/../Pic/CNA.drawio.png"></p><h4 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h4><p>仅支持在物理服务器上部署</p><ol><li>登陆到物理服务器的BIOS或者BMC</li><li>设置启动项</li><li>将CAN.ISO挂载为虚拟光驱</li><li>配置磁盘RAID</li><li>安装系统</li><li>执行<code>cnaInit</code>配置CNA相关参数</li></ol><h5 id="Vmware模拟部署"><a href="#Vmware模拟部署" class="headerlink" title="Vmware模拟部署"></a>Vmware模拟部署</h5><p>体会不到1-4，直接到5，6安装系统和配置CNA，熟悉过程</p><p><img src="/../Pic/Snipaste_2025-01-10_11-34-03.png"></p><p><img src="/../Pic/Snipaste_2025-01-10_11-34-34.png"></p><p><img src="/../Pic/Snipaste_2025-01-10_11-36-41.png"></p><p>Tab和空格键导航，Enter键配置和确定 带*的为必配置项</p><h6 id="安装位置"><a href="#安装位置" class="headerlink" title="安装位置"></a>安装位置</h6><p><img src="/../Pic/Snipaste_2025-01-10_11-41-45.png"></p><p>选择将系统安装到那个磁盘，后面软RAID一般不用管，都是在服务器上配置硬件RAID；然后直接将系统安装到这个RAID磁盘上；swap其他保持默认即可。Tab到OK Enter即可</p><h6 id="网络配置"><a href="#网络配置" class="headerlink" title="网络配置"></a>网络配置</h6><p>根据环境输入，现VMware环境没有Vlan</p><p><img src="/../Pic/Snipaste_2025-01-10_11-44-55.png"></p><p><img src="/../Pic/Snipaste_2025-01-10_11-47-20.png"></p><p><img src="/../Pic/Snipaste_2025-01-10_11-51-05.png"></p><h6 id="主机名配置"><a href="#主机名配置" class="headerlink" title="主机名配置"></a>主机名配置</h6><p><img src="/../Pic/Snipaste_2025-01-10_11-51-57.png"></p><h6 id="时区配置"><a href="#时区配置" class="headerlink" title="时区配置"></a>时区配置</h6><p>默认是Asia&#x2F;Beijing 默认即可</p><p><img src="/../Pic/Snipaste_2025-01-10_11-52-31.png"></p><h6 id="root密码配置"><a href="#root密码配置" class="headerlink" title="root密码配置"></a>root密码配置</h6><p>下面选项决定是否加密 有密码复杂性要求</p><p><img src="/../Pic/Snipaste_2025-01-10_11-54-01.png"></p><h6 id="引导命令配置"><a href="#引导命令配置" class="headerlink" title="引导命令配置"></a>引导命令配置</h6><p>Linux系统引导选项 默认即可</p><p><img src="/../Pic/Snipaste_2025-01-10_11-56-47.png"></p><h6 id="Grub密码配置"><a href="#Grub密码配置" class="headerlink" title="Grub密码配置"></a>Grub密码配置</h6><p>Grub引导密码 有密码复杂性要求</p><p><img src="/../Pic/Snipaste_2025-01-10_11-57-55.png"></p><h6 id="开始安装"><a href="#开始安装" class="headerlink" title="开始安装"></a>开始安装</h6><p>点击ok 等待进度条走完后便会自动重启</p><p><img src="/../Pic/Snipaste_2025-01-10_12-04-40.png"></p><h6 id="配置CNA"><a href="#配置CNA" class="headerlink" title="配置CNA"></a>配置CNA</h6><p>root登陆，执行<code>cnaInit</code>，选择常规模式，开始配置远程用户<code>gandalf</code> 和 <code>redis</code> 密码</p><p><img src="/../Pic/Snipaste_2025-01-10_12-41-53.png"><br><img src="/../Pic/Snipaste_2025-01-10_12-49-15.png"></p><h3 id="VRM"><a href="#VRM" class="headerlink" title="VRM"></a><strong>VRM</strong></h3><p><strong>Virtual Resources Management</strong>，虚拟资源管理；底层是一个经过裁剪的Euler OS，系统上具有VRM相关的软件；运行了位于<strong>8443</strong>端口的<strong>https</strong>服务，提供web界面，可以对接和统一管理多个CNA提供的虚拟资源；并提供热迁移，高可用等高级特性。</p><p><img src="/../Pic/vrm.jpg"></p><h4 id="部署方式"><a href="#部署方式" class="headerlink" title="部署方式"></a><strong>部署方式</strong></h4><p><strong>建议</strong>根据<strong>CNA节点数量</strong>决定部署方式:<br>CNA节点大于50 &#x3D;&gt; 物理机部署<br>CNA节点小于50 &#x3D;&gt; 虚拟化部署<br>物理机部署VRM，性能肯定是高于虚拟机部署的。</p><h5 id="虚拟化部署"><a href="#虚拟化部署" class="headerlink" title="虚拟化部署"></a><strong>虚拟化部署</strong></h5><p>提供一个VRM.ZIP的文件，在CNA中解压并运行<code>./webInstaller install</code>，提供一个8080端口的web服务器，用于配置即将运行于CNA中的VRM虚拟机的参数。</p><h5 id="物理机部署"><a href="#物理机部署" class="headerlink" title="物理机部署"></a><strong>物理机部署</strong></h5><p>安装方式和CNA一样，提供VRM.ISO。直接安装于物理服务器上。</p><p><img src="/../Pic/vrmDep01.drawio.png"> </p><h4 id="部署模式"><a href="#部署模式" class="headerlink" title="部署模式"></a><strong>部署模式</strong></h4><h5 id="单节点部署"><a href="#单节点部署" class="headerlink" title="单节点部署"></a>单节点部署</h5><p>单单部署一台VRM；不推荐；因为VRM挂了，WebUI也就挂了，没有容错。</p><p><img src="/../Pic/vrmSingDep.drawio.png"></p><h5 id="主备部署"><a href="#主备部署" class="headerlink" title="主备部署"></a>主备部署</h5><p>推荐的部署方式；使用两台VRM互做<strong>备份</strong>；确认主备角色后；浮动IP(VIP)会优先运行于主(Master)VRM，当VRM宕机后，VIP会自动漂移到备(Backup)VRM接替当前业务，当主(Master)恢复业务后成为备节点，底层有GuassDB主从同步状态</p><p><img src="/../Pic/vrmHaDep.drawio.png"></p><h4 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h4><p>部署过程同CNA，安装后运行的命令变为<code>vrmInit</code></p><h5 id="模拟物理机主备部署"><a href="#模拟物理机主备部署" class="headerlink" title="模拟物理机主备部署"></a>模拟物理机主备部署</h5><p>安装系统不在赘述</p><h6 id="执行vrmInit"><a href="#执行vrmInit" class="headerlink" title="执行vrmInit"></a>执行<code>vrmInit</code></h6><ol><li>选择模式 0(常规) 1(sm加密)</li><li>配置<code>gandalf</code>用户密码</li><li>安装模式 1(普通) 2(三员分立)</li><li>配置web端登陆<code>admin</code>用户的密码</li><li>配置<code>gaussdb</code>的<code>postgres</code>用户的密码</li><li>配置<code>gaussdb</code>的<code>galax</code>用户的密码</li></ol><p><img src="/../Pic/Snipaste_2025-01-10_23-24-52.png"></p><h6 id="web登陆"><a href="#web登陆" class="headerlink" title="web登陆"></a>web登陆</h6><p>VRM提供web界面，对接并管理CNA，运行于8443端口<br><img src="/../Pic/Snipaste_2025-01-10_23-41-52.png"><br>打开浏览器，admin用户登陆，密码初始化时设置的。<br><img src="/../Pic/Snipaste_2025-01-10_23-42-52.png"><br>点击左侧<strong>资源池</strong>，右键<strong>创建集群</strong><br><img src="/../Pic/Snipaste_2025-01-10_23-43-36.png"></p><p><strong>至此单节点手动VRM安装已经完成；后续内容为单节点扩展为主备</strong></p><h6 id="添加第二台vrm"><a href="#添加第二台vrm" class="headerlink" title="添加第二台vrm"></a>添加第二台vrm</h6><p>重复<a href="#%E5%AE%9E%E8%B7%B5">前面步骤</a>，再安装一个vrm</p><p><img src="/../Pic/Snipaste_2025-01-11_18-12-21.png"></p><p>选择一台作为主VRM并登陆Web端；导航到 <strong>系统管理</strong>&#x2F;<strong>系统配置</strong>&#x2F;<strong>服务和管理节点</strong>；点击<strong>主备配置</strong></p><p><img src="/../Pic/Snipaste_2025-01-11_18-16-00.png"></p><p>填写相应参数</p><p><img src="/../Pic/Snipaste_2025-01-11_18-18-18.png"></p><p><img src="/../Pic/Snipaste_2025-01-11_21-09-20.png"></p><p>仲裁IP：至少一个，最多三个；配置完后确定，等待几分钟；使用浮动IP登陆。<br>什么是仲裁IP？<br>主和备都会一直发送ICMP包来维持心跳检测，若VRM无法ping通对方，则会去ping仲裁IP<br>只有<strong>当主全不通仲裁，备通一个或多个仲裁时，触发主备切换</strong><br><strong>所以 这个仲裁IP应该是一个稳定的服务器</strong></p><p><img src="/../Pic/Snipaste_2025-01-11_21-09-20.png"></p><p>使用vip登陆web界面</p><p>若主备节点的<strong>admin</strong>密码不同，按照配置主备时登陆的VRM<strong>admin</strong>的密码，即使主备切换也一样。</p><p><img src="/../Pic/Snipaste_2025-01-11_22-08-53.png"></p><p>主备切换测试</p><p><img src="/../Pic/Snipaste_2025-01-11_22-12-11.png"></p><p><img src="/../Pic/Snipaste_2025-01-11_22-15-11.png"></p><p><img src="/../Pic/Snipaste_2025-01-11_22-15-36.png"></p><h3 id="物理服务器主备部署"><a href="#物理服务器主备部署" class="headerlink" title="物理服务器主备部署"></a>物理服务器主备部署</h3><h4 id="登陆IPMI"><a href="#登陆IPMI" class="headerlink" title="登陆IPMI"></a>登陆IPMI</h4><p>IPMI是一个带外管理口；登陆进去设置启动项为光驱</p><p><img src="/../Pic/Snipaste_2025-01-12_22-27-03.png"></p><p>使用VNC工具连接IPMI</p><p><img src="/../Pic/Snipaste_2025-01-12_22-29-27.png"></p><p><img src="/../Pic/Snipaste_2025-01-12_22-32-13.png"></p><p>选择虚拟光驱挂载后点击连接；点击重启安装系统</p><p><img src="/../Pic/Snipaste_2025-01-12_22-37-43.png"></p><p><img src="/../Pic/Snipaste_2025-01-12_22-38-54.png"></p><p><img src="/../Pic/Snipaste_2025-01-12_22-41-22.png"></p><p>接着走流程即可；网络根据环境设置；该网络环境具有VLAN属性</p><p><img src="/../Pic/Snipaste_2025-01-12_22-53-22.png"></p><p><img src="/../Pic/Snipaste_2025-01-12_22-54-54.png"></p><p><img src="/../Pic/Snipaste_2025-01-12_22-55-52.png"></p><p>等待重启</p><p><img src="/../Pic/Snipaste_2025-01-12_23-04-25.png"></p><h5 id="主备部署VRM"><a href="#主备部署VRM" class="headerlink" title="主备部署VRM"></a>主备部署VRM</h5><p>采用华为官方系统的工具，在CNA中运行一个脚本，开启一个WEB服务，在WEB端对VRM进行配置</p><h5 id="CNA初始化"><a href="#CNA初始化" class="headerlink" title="CNA初始化"></a>CNA初始化</h5><p>使用<strong>cnaInit</strong>初始化CNA；所有<strong>CNA</strong>都需要</p><h5 id="上传部署文件"><a href="#上传部署文件" class="headerlink" title="上传部署文件"></a>上传部署文件</h5><ol><li>使用<code>gandalf</code>用户通过<strong>SCP</strong> CNA传输部署文件；可以使用工具上传文件</li><li>使用<code>gandalf</code>用户远程登陆到CNA节点；或者直接去VNC使用<code>root</code>运行</li></ol><p><img src="/../Pic/Snipaste_2025-01-12_23-11-21.png"></p><p><img src="/../Pic/Snipaste_2025-01-12_23-13-31.png"></p><p><img src="/../Pic/Snipaste_2025-01-12_23-17-27.png"></p><p>可以看到WEB端口是8080</p><p><img src="/../Pic/Snipaste_2025-01-12_23-19-40.png"></p><h5 id="web配置"><a href="#web配置" class="headerlink" title="web配置"></a>web配置</h5><p>填写相关参数；开始安装</p><p><img src="/../Pic/Snipaste_2025-01-12_23-21-08.png"></p><p><img src="/../Pic/Snipaste_2025-01-12_23-21-56.png"></p><p>点击自定义安装；选择安装组件；<strong>主机</strong>和<strong>VRM</strong></p><p>主机：也就是CNA，选择该选择；配置TFTP，DHCP等协议后，将该CNA节点配置成一个PXE服务器；用于部署多台CNA</p><p>VRM：在CNA节点中部署VRM</p><p>我们选择VRM即可，因为两台CNA都已经手动部署了</p><p><img src="/../Pic/Snipaste_2025-01-12_23-25-06.png"></p><p>上传文件</p><p><img src="/../Pic/Snipaste_2025-01-12_23-38-15.png"></p><p><img src="/../Pic/Snipaste_2025-01-12_23-38-36.png"></p><p>主备模式安装；容器选项酌情勾选；预估后期的规模；根据规模调整<strong>VRM</strong>虚拟机的配置</p><p><img src="/../Pic/Snipaste_2025-01-12_23-42-53.png"></p><p>管理VLAN；个人理解是手动安装VRM时；网络配置的<code>with vlan</code>；也就是<strong>VRM</strong>网络所在的<strong>VLAN</strong></p><p><img src="/../Pic/Snipaste_2025-01-12_23-43-29.png"></p><p>填写CNA相关的信息；点击开始配置主机</p><p><img src="/../Pic/Snipaste_2025-01-12_23-44-56.png"></p><p>选择存储</p><p><img src="/../Pic/Snipaste_2025-01-12_23-57-32.png"></p><p>选择普通即可</p><p><img src="/../Pic/Snipaste_2025-01-12_23-58-13.png"></p><p>开始安装VRM</p><p><img src="/../Pic/Snipaste_2025-01-12_23-59-15.png"></p><p>安装完成</p><p><img src="/../Pic/Snipaste_2025-01-13_00-24-28.png"></p><p>点击确定或者链接；弹出对话框；点击完成完成，在CNA上卸载安装服务</p><p><img src="/../Pic/Snipaste_2025-01-13_00-25-34.png"></p><h5 id="登陆VRM"><a href="#登陆VRM" class="headerlink" title="登陆VRM"></a>登陆VRM</h5><p><img src="/../Pic/Snipaste_2025-01-13_00-31-49.png"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2025/02/06/Storage/"/>
    <url>/2025/02/06/Storage/</url>
    
    <content type="html"><![CDATA[<h1 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h1><p>提供方类型</p><ul><li>厂商硬件存储<ul><li>Huawei</li><li>DELL IMC</li></ul></li><li>软件存储<ul><li>CEPH</li><li>GlusterFS</li><li>Minio</li></ul></li></ul><p>按组网方式</p><ul><li>DAS 直连存储</li><li>NAS 文件存储 NFS、CIFS</li><li>SAN 块存储<ul><li>FC—SAN 光纤交换机</li><li>IP-SAN 通过TCP&#x2F;IP实现</li></ul></li></ul><p>按存储形态</p><ul><li>文件存储</li><li>块存储</li><li>对象存储</li></ul><p>按存储方式</p><ul><li>集中式存储</li><li>分布式存储</li></ul><h1 id="硬件存储"><a href="#硬件存储" class="headerlink" title="硬件存储"></a>硬件存储</h1><p>通常是厂商提供的硬件存储解决方案，他有自己的存储芯片，存储架构。</p><p><img src="/../Pic/Pasted%20image%2020250114113054.png"></p><p><img src="/../Pic/Pasted%20image%2020250114113120.png"></p><p>上下分别为<strong>A控</strong>和<strong>B控</strong>；为了提供冗余<br><strong>H0-H3</strong> 业务口；为存储客户端提供访问<br><strong>Exp</strong>   级连口；连接其他的存储服务器<br><strong>H4-h5</strong> 管理口；为管理员提供访问<br><strong>Console口</strong>；管理口无法连接时；电脑直连该口管理</p><h2 id="华为存储"><a href="#华为存储" class="headerlink" title="华为存储"></a>华为存储</h2><h3 id="模拟器"><a href="#模拟器" class="headerlink" title="模拟器"></a>模拟器</h3><p><img src="/../Pic/Pasted%20image%2020250114122022.png"></p><p><img src="/../Pic/Pasted%20image%2020250114121915.png"></p><h1 id="软件存储"><a href="#软件存储" class="headerlink" title="软件存储"></a>软件存储</h1><h2 id="GlusterFS"><a href="#GlusterFS" class="headerlink" title="GlusterFS"></a>GlusterFS</h2><p>文件级存储(NAS) 提供快照 复制 条带卷</p><h3 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h3><ul><li>磁盘分区挂载</li><li>守护进程</li><li>Firewalld SElinux</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">0 ~&gt; ansible GlusterFS -m shell -a  <span class="hljs-string">&quot;df -Th /GlusterFS&quot;</span><br>192.168.100.110 | CHANGED | rc=0 &gt;&gt;<br>Filesystem                          Type  Size  Used Avail Use% Mounted on<br>/dev/mapper/GlusterFSVg-Glu..M   20G   3% /GlusterFS<br>192.168.100.112 | CHANGED | rc=0 &gt;&gt;<br>Filesystem                          Type  Size  Used Avail Use% Mounted on<br>/dev/mapper/GlusterFSVg-GlusterFSLv xfs    20G  424M   20G   3% /GlusterFS<br>192.168.100.111 | CHANGED | rc=0 &gt;&gt;<br>Filesystem                          Type  Size  Used Avail Use% Mounted on<br>/dev/mapper/GlusterFSVg-GlusterFSLv xfs    20G  424M   20G   3% /GlusterFS<br><br>0 ~&gt; ansible GlusterFS -m shell -a  <span class="hljs-string">&quot;systemctl status glusterd | grep active&quot;</span><br>192.168.100.110 | CHANGED | rc=0 &gt;&gt;<br>     Active: active (running) since Mon 2024-10-07 16:39:39 CST; 16min ago<br>192.168.100.111 | CHANGED | rc=0 &gt;&gt;<br>     Active: active (running) since Mon 2024-10-07 16:39:39 CST; 15min ago<br>192.168.100.112 | CHANGED | rc=0 &gt;&gt;<br>     Active: active (running) since Mon 2024-10-07 16:39:40 CST; 15min ago<br>0 ~&gt; <br></code></pre></td></tr></table></figure><h4 id="配置信任池"><a href="#配置信任池" class="headerlink" title="配置信任池"></a>配置信任池</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">130 ~/WorkSpace/Ansible&gt; ansible GlusterFS01 -m shell -a <span class="hljs-string">&quot;gluster peer probe GlusterFS02 &amp;&amp; gluster peer probe GlusterFS03&quot;</span><br>192.168.100.110 | CHANGED | rc=0 &gt;&gt;<br>peer probe: success<br>peer probe: success<br>0 ~/WorkSpace/Ansible&gt; ansible GlusterFS02 -m shell -a <span class="hljs-string">&quot;gluster peer probe GlusterFS03 &amp;&amp; gluster peer probe GlusterFS01&quot;</span><br>192.168.100.111 | CHANGED | rc=0 &gt;&gt;<br>peer probe: Host GlusterFS03 port 24007 already <span class="hljs-keyword">in</span> peer list<br>peer probe: Host GlusterFS01 port 24007 already <span class="hljs-keyword">in</span> peer list<br></code></pre></td></tr></table></figure><blockquote><p>随意一方配置即可</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">0 ~/WorkSpace/Ansible&gt; ansible GlusterFS -m shell -a <span class="hljs-string">&quot;gluster peer status&quot;</span><br>192.168.100.110 | CHANGED | rc=0 &gt;&gt;<br>Number of Peers: 2<br><br>Hostname: GlusterFS02<br>Uuid: 8e1de9fd-a094-49c1-ab69-32773f78296a<br>State: Peer <span class="hljs-keyword">in</span> Cluster (Connected)<br><br>Hostname: GlusterFS03<br>Uuid: 7a82c9c4-9a84-4398-91d7-fc195f7a2178<br>State: Peer <span class="hljs-keyword">in</span> Cluster (Connected)<br>192.168.100.112 | CHANGED | rc=0 &gt;&gt;<br>Number of Peers: 2<br><br>Hostname: GlusterFS01<br>Uuid: 449da5fe-c09b-43f3-a865-3500b108e7ad<br>State: Peer <span class="hljs-keyword">in</span> Cluster (Connected)<br><br>Hostname: GlusterFS02<br>Uuid: 8e1de9fd-a094-49c1-ab69-32773f78296a<br>State: Peer <span class="hljs-keyword">in</span> Cluster (Connected)<br>192.168.100.111 | CHANGED | rc=0 &gt;&gt;<br>Number of Peers: 2<br><br>Hostname: GlusterFS01<br>Uuid: 449da5fe-c09b-43f3-a865-3500b108e7ad<br>State: Peer <span class="hljs-keyword">in</span> Cluster (Connected)<br><br>Hostname: GlusterFS03<br>Uuid: 7a82c9c4-9a84-4398-91d7-fc195f7a2178<br>State: Peer <span class="hljs-keyword">in</span> Cluster (Connected)<br></code></pre></td></tr></table></figure><h3 id="卷类型"><a href="#卷类型" class="headerlink" title="卷类型"></a>卷类型</h3><h4 id="分布式卷"><a href="#分布式卷" class="headerlink" title="分布式卷"></a>分布式卷</h4><p>将多台服务器提供的brick看作一个整体 写入的数据由底层brick随意(位置)存放 无冗余</p><p><img src="/../Pic/image-20241007171452885.png" alt="image-20241007171452885"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">gluster volume create NEW-VOLNAME [transport [tcp | rdma | tcp,rdma]] NEW-BRICK...<br><br></code></pre></td></tr></table></figure><p>创建brick目录 为卷提供存储位置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">0 ~/WorkSpace/Ansible&gt; ansible GlusterFS -m shell -a <span class="hljs-string">&quot;mkdir /GlusterFS/gv01&quot;</span><br>192.168.100.112 | CHANGED | rc=0 &gt;&gt;<br><br>192.168.100.110 | CHANGED | rc=0 &gt;&gt;<br><br>192.168.100.111 | CHANGED | rc=0 &gt;&gt;<br><br></code></pre></td></tr></table></figure><p>创建分布式卷 并启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">1 ~/WorkSpace/Ansible&gt; ssh root@GlusterFS01<br><br>[root@GlusterFS01 ~]# gluster volume create -h<br>Usage:<br>volume create &lt;NEW-VOLNAME&gt; [[replica &lt;COUNT&gt; [arbiter &lt;COUNT&gt;]]|[replica 2 thin-arbiter 1]] [disperse [&lt;COUNT&gt;]] [disperse-data &lt;COUNT&gt;] [redundancy &lt;COUNT&gt;] [transport &lt;tcp|rdma|tcp,rdma&gt;] &lt;NEW-BRICK&gt; &lt;TA-BRICK&gt;... [force]<br><br>[root@GlusterFS01 ~]# gluster volume create gv01Dis GlusterFS01:/GlusterFS/gv01 GlusterFS02:/GlusterFS/gv01 GlusterFS03:/GlusterFS/gv01<br>volume create: gv01Dis: success: please start the volume to access data<br><br>[root@GlusterFS01 ~]# gluster volume start gv01Dis<br>volume start: gv01Dis: success<br><br>[root@GlusterFS01 ~]# gluster volume info gv01Dis <br> <br>Volume Name: gv01Dis<br>Type: Distribute<br>Volume ID: 9e29bb17-20e7-4619-84f6-362d5461e4b5<br>Status: Started<br>Snapshot Count: 0<br>Number of Bricks: 3<br>Transport-<span class="hljs-built_in">type</span>: tcp<br>Bricks:<br>Brick1: GlusterFS01:/GlusterFS/gv01<br>Brick2: GlusterFS02:/GlusterFS/gv01<br>Brick3: GlusterFS03:/GlusterFS/gv01<br>Options Reconfigured:<br>storage.fips-mode-rchecksum: on<br>transport.address-family: inet<br>nfs.disable: on<br></code></pre></td></tr></table></figure><p>客户端测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">0 ~/WorkSpace/Ansible&gt; <span class="hljs-built_in">sudo</span> mount -t glusterfs GlusterFS01:/gv01Dis /tmp/test<br><span class="hljs-comment">## 随机任一个节点都可以</span><br><span class="hljs-comment">## 0 ~/WorkSpace/Ansible&gt; sudo umount /tmp/test</span><br><span class="hljs-comment">## 0 ~/WorkSpace/Ansible&gt; sudo mount -t glusterfs  GlusterFS02:/gv01Dis /tmp/test</span><br><span class="hljs-comment">## 0 ~/WorkSpace/Ansible&gt; df -Th /tmp/test</span><br><span class="hljs-comment">## 文件系统             类型            大小  已用  可用 已用% 挂载点</span><br><span class="hljs-comment">## GlusterFS02:/gv01Dis fuse.glusterfs   60G  1.9G   58G    4% /tmp/test</span><br><br><br>1 ~/WorkSpace/Ansible&gt; <span class="hljs-built_in">df</span> -Th /tmp/test/<br>文件系统             类型            大小  已用  可用 已用% 挂载点<br>GlusterFS01:/gv01Dis fuse.glusterfs   60G  1.9G   58G    4% /tmp/test<br><br>0 ~/WorkSpace/Ansible&gt; <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> `<span class="hljs-built_in">seq</span> 1 100`; <span class="hljs-keyword">do</span> <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">touch</span> /tmp/test/<span class="hljs-variable">$i</span>; <span class="hljs-keyword">done</span><br>0 ~/WorkSpace/Ansible&gt; <br></code></pre></td></tr></table></figure><p>在我们创建100个文件后 他会被随机分布到brick服务器的目录上</p><p>在删除这些文件后 底层也会随之删除</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">0 ~/WorkSpace/Ansible&gt; <span class="hljs-built_in">ls</span> /tmp/test/<br>1    12  16  2   23  27  30  34  38  41  45  49  52  56  6   63  67  70  74  78  81  85  89  92  96<br>10   13  17  20  24  28  31  35  39  42  46  5   53  57  60  64  68  71  75  79  82  86  9   93  97<br>100  14  18  21  25  29  32  36  4   43  47  50  54  58  61  65  69  72  76  8   83  87  90  94  98<br>11   15  19  22  26  3   33  37  40  44  48  51  55  59  62  66  7   73  77  80  84  88  91  95  99<br>0 ~/WorkSpace/Ansible&gt; ansible GlusterFS -m shell -a <span class="hljs-string">&quot;ls /GlusterFS/gv01 | wc -l&quot;</span><br>192.168.100.112 | CHANGED | rc=0 &gt;&gt;<br>29<br>192.168.100.110 | CHANGED | rc=0 &gt;&gt;<br>35<br>192.168.100.111 | CHANGED | rc=0 &gt;&gt;<br>36<br>0 ~/WorkSpace/Ansible&gt;<br>0 ~/WorkSpace/Ansible&gt; <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">rm</span> -rf /tmp/test/*<br>0 ~/WorkSpace/Ansible&gt; ansible GlusterFS -m shell -a <span class="hljs-string">&quot;ls /GlusterFS/gv01 | wc -l&quot;</span><br>192.168.100.110 | CHANGED | rc=0 &gt;&gt;<br>0<br>192.168.100.112 | CHANGED | rc=0 &gt;&gt;<br>0<br>192.168.100.111 | CHANGED | rc=0 &gt;&gt;<br>0<br></code></pre></td></tr></table></figure><h4 id="复制卷"><a href="#复制卷" class="headerlink" title="复制卷"></a>复制卷</h4><p><strong>分布式卷</strong>会将用户的数据打散成多份(组成卷的Brick数量) 随机存储到底层的Brick</p><p><strong>复制卷</strong>就是将数据在底层的Brick各存储一分 实现数据冗余 只要还存活一个Brick 那么数据就仍然可以访问</p><p><img src="/../Pic/image-20241013134408782.png" alt="image-20241013134408782"></p><p>创建复制的卷</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gluster volume create NEW-VOLNAME [replica COUNT] [transport [tcp |rdma | tcp,rdma]] NEW-BRICK...<br></code></pre></td></tr></table></figure><p>Brick创建卷存储路径</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">0 ~&gt; ansible GlusterFS -m shell -a <span class="hljs-string">&quot;mkdir /GlusterFS/gv02; ls /GlusterFS&quot;</span><br>192.168.100.112 | CHANGED | rc=0 &gt;&gt;<br>gv01<br>gv02<br>192.168.100.110 | CHANGED | rc=0 &gt;&gt;<br>gv01<br>gv02<br>192.168.100.111 | CHANGED | rc=0 &gt;&gt;<br>gv01<br>gv02<br>0 ~&gt; <br></code></pre></td></tr></table></figure><p>GlusterFS Cli创建、激活卷</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs nginx">[root@<span class="hljs-attribute">GlusterFS01</span> ~]<span class="hljs-comment"># gluster volume create gv02rep replica 3 GlusterFS01:/GlusterFS/gv02 GlusterFS02:/GlusterFS/gv02 GlusterFS03:/GlusterFS/gv02</span><br>volume create: gv02rep: success: please start the volume to access data     <br><br>[root<span class="hljs-variable">@GlusterFS01</span> ~]<span class="hljs-comment"># gluster volume start gv02rep</span><br>volume start: gv02rep: success<br><br>[root<span class="hljs-variable">@GlusterFS01</span> ~]<span class="hljs-comment"># gluster volume info gv02rep</span><br> <br>Volume Name: gv02rep<br>Type: Replicate<br>Volume ID: 152a1093-dbc4-<span class="hljs-number">4792</span>-86e1-1d3a00af35b4<br>Status: Started<br>Snapshot Count: <span class="hljs-number">0</span><br>Number of Bricks: <span class="hljs-number">1</span> x <span class="hljs-number">3</span> = <span class="hljs-number">3</span><br>Transport-type: tcp<br>Bricks:<br>Brick1: GlusterFS01:/GlusterFS/gv02<br>Brick2: GlusterFS02:/GlusterFS/gv02<br>Brick3: GlusterFS03:/GlusterFS/gv02<br>Options Reconfigured:<br>cluster.granular-entry-heal: <span class="hljs-literal">on</span><br>storage.fips-mode-rchecksum: <span class="hljs-literal">on</span><br>transport.address-family: inet<br>nfs.disable: <span class="hljs-literal">on</span><br>performance.client-io-threads: <span class="hljs-literal">off</span><br></code></pre></td></tr></table></figure><p>客户端测试</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs nginx">0 ~&gt; <span class="hljs-attribute">mkdir</span> /tmp/test<br><span class="hljs-number">1</span> ~&gt; sudo mount -t glusterfs GlusterFS01:/gv02rep /tmp/test/<br>grep: 警告：- 前有多余的 \<br><span class="hljs-number">0</span> ~&gt; df -Th /tmp/test/<br>文件系统             类型            大小  已用  可用 已用% 挂载点<br>GlusterFS01:/gv02rep fuse.glusterfs   <span class="hljs-number">20G</span>  <span class="hljs-number">628M</span>   <span class="hljs-number">20G</span>    <span class="hljs-number">4</span>% /tmp/test<br></code></pre></td></tr></table></figure><p>每一个Brick都有该卷的副本</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs nginx">0 ~&gt; <span class="hljs-attribute">for</span> i in `seq <span class="hljs-number">1</span> <span class="hljs-number">33</span>` ; <span class="hljs-attribute">do</span> sudo touch /tmp/test/<span class="hljs-variable">$i</span>; <span class="hljs-attribute">done</span><br><span class="hljs-number">0</span> ~&gt; ls /tmp/test/ | wc -l<br><span class="hljs-number">33</span><br><span class="hljs-number">0</span> ~&gt; ansible GlusterFS -m shell -a <span class="hljs-string">&quot;ls /GlusterFS/gv02 | wc -l&quot;</span><br><span class="hljs-number">192.168.100.112</span> | CHANGED | rc=<span class="hljs-number">0</span> &gt;&gt;<br><span class="hljs-number">33</span><br><span class="hljs-number">192.168.100.110</span> | CHANGED | rc=<span class="hljs-number">0</span> &gt;&gt;<br><span class="hljs-number">33</span><br><span class="hljs-number">192.168.100.111</span> | CHANGED | rc=<span class="hljs-number">0</span> &gt;&gt;<br><span class="hljs-number">33</span><br></code></pre></td></tr></table></figure><h4 id="分布式复制卷"><a href="#分布式复制卷" class="headerlink" title="分布式复制卷"></a>分布式复制卷</h4><p><img src="/../Pic/image-20241013153430927.png" alt="image-20241013153430927"></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">gluster</span> volume create NEW-VOLNAME [replica COUNT] [transport [tcp | rdma | tcp,rdma]] NEW-BRICK...<br></code></pre></td></tr></table></figure><p>此类卷结合了 <strong>复制卷</strong>和<strong>分布式卷</strong> 通过设置<code>replica</code>来指定一份文件的复制数量 而Brick最少需要<code>replica</code>的倍数</p><p>在3节点环境下 实现此实验 则需要复用Brick创建卷挂载点 </p><p>在每个节点创建两个卷挂载点 使得这两个挂载点 成为互相的复制</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx">0 ~&gt; <span class="hljs-attribute">ansible</span> GlusterFS -m shell -a <span class="hljs-string">&quot;mkdir /GlusterFS/gv03disRep;mkdir /GlusterFS/serverGv03DisRep ; ls /GlusterFS&quot;</span><br></code></pre></td></tr></table></figure><p>注意创建时需要加上force 否则提示错误</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@GlusterFS01 ~]# gluster volume create gv03DisRep replica 2 GlusterFS01:/GlusterFS/gv03disRep GlusterFS01:/GlusterFS/serverGv03DisRep GlusterFS02:/GlusterFS/gv03disRep GlusterFS02:/GlusterFS/serverGv03DisRep GlusterFS03:/GlusterFS/gv03disRep GlusterFS03:/GlusterFS/serverGv03DisRep<br>Replica 2 volumes are prone to split-brain. Use Arbiter or Replica 3 to avoid this. See: http://docs.gluster.org/en/latest/Administrator-Guide/Split-brain-and-ways-to-deal-with-it/.<br>Do you still want to <span class="hljs-built_in">continue</span>?<br> (y/n) y<br>volume create: gv03DisRep: failed: Multiple bricks of a replicate volume are present on the same server. This setup is not optimal. Bricks should be on different nodes to have best fault tolerant configuration. Use <span class="hljs-string">&#x27;force&#x27;</span> at the end of the <span class="hljs-built_in">command</span> <span class="hljs-keyword">if</span> you want to override this behavior. <br></code></pre></td></tr></table></figure><p>加上force 注意brick之间的位置 相邻数量(replica)的brick会成为一个<code>Replicated</code></p><p>根据文档 最后测试100个文件 会在每个<code>Relicated</code>下存入33 (<code>100/3</code>) 个文件 而<code>Replicated</code>的下的每个<code>brick</code>都会有这33(<code>replica</code>)个文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@GlusterFS01 ~]# gluster volume create gv03DisRep replica 2 \<br>&gt; GlusterFS01:/GlusterFS/gv03disRep GlusterFS01:/GlusterFS/serverGv03DisRep \<br>&gt; GlusterFS02:/GlusterFS/gv03disRep GlusterFS02:/GlusterFS/serverGv03DisRep \<br>&gt; GlusterFS03:/GlusterFS/gv03disRep GlusterFS03:/GlusterFS/serverGv03DisRep \<br>&gt; force<br>volume create: gv03DisRep: success: please start the volume to access data<br>[root@GlusterFS01 ~]# gluster volume  start  gv03DisRep <br>volume start: gv03DisRep: success<br></code></pre></td></tr></table></figure><p>测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">0 ~&gt; <span class="hljs-built_in">sudo</span> mount -t glusterfs GlusterFS02:/gv03DisRep /tmp/test/<br>grep: 警告：- 前有多余的 \<br>0 ~&gt; <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> `<span class="hljs-built_in">seq</span> 1 100`; <span class="hljs-keyword">do</span> <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">touch</span> /tmp/test/<span class="hljs-variable">$i</span> ; <span class="hljs-keyword">done</span><br>0 ~&gt; <span class="hljs-built_in">ls</span> /tmp/test/ | <span class="hljs-built_in">wc</span> -l<br>100<br><br>0 ~&gt; ansible GlusterFS -m shell -a <span class="hljs-string">&#x27;\</span><br><span class="hljs-string">echo &quot;gv03disRep dir---&quot; ; ls /GlusterFS/gv03disRep | wc -l ; \</span><br><span class="hljs-string">echo &quot;serverGv03DisRep dir---&quot; ; ls /GlusterFS/serverGv03DisRep | wc -l&#x27;</span><br><br>192.168.100.110 | CHANGED | rc=0 &gt;&gt;<br>gv03disRep <span class="hljs-built_in">dir</span>---<br>35<br>serverGv03DisRep <span class="hljs-built_in">dir</span>---<br>35<br>192.168.100.112 | CHANGED | rc=0 &gt;&gt;<br>gv03disRep <span class="hljs-built_in">dir</span>---<br>29<br>serverGv03DisRep <span class="hljs-built_in">dir</span>---<br>29<br>192.168.100.111 | CHANGED | rc=0 &gt;&gt;<br>gv03disRep <span class="hljs-built_in">dir</span>---<br>36<br>serverGv03DisRep <span class="hljs-built_in">dir</span>---<br>36<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@GlusterFS01 GlusterFS]# <span class="hljs-built_in">ls</span> gv03disRep/<br>10   12  15  2   25  3   31  39  40  45  52  59  66  74  76  81  87  95<br>100  14  17  21  29  30  36  4   42  50  55  6   67  75  77  84  90<br>[root@GlusterFS01 GlusterFS]# <span class="hljs-built_in">ls</span> serverGv03DisRep/<br>10   12  15  2   25  3   31  39  40  45  52  59  66  74  76  81  87  95<br>100  14  17  21  29  30  36  4   42  50  55  6   67  75  77  84  90<br></code></pre></td></tr></table></figure><h4 id="分散卷"><a href="#分散卷" class="headerlink" title="分散卷"></a>分散卷</h4><p>基于纠删码来实现数据的完整、冗余 在节点少的情况下实现高可用</p><p>注意 前面的复制卷、分布式卷、分布式复制卷都是不分割文件的 只会把存入的多个文件 随机负载到多个Brick上</p><p>分散卷会把<strong>数据切割成多份(<code>disperse</code>)</strong> 存入到Brick 然后算出纠删码存入到其中一个(<code>redundancy</code>)Brick中</p><p><img src="/../Pic/image-20241013162814455.png" alt="image-20241013162814455"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">0 ~&gt; ansible GlusterFS -m shell -a <span class="hljs-string">&quot;mkdir /GlusterFS/gv04Disperse&quot;</span><br>192.168.100.111 | CHANGED | rc=0 &gt;&gt;<br><br>192.168.100.112 | CHANGED | rc=0 &gt;&gt;<br><br>192.168.100.110 | CHANGED | rc=0 &gt;&gt;<br><br>[root@GlusterFS01 ~]# gluster volume create gv04Disperse disperse 3 redundancy 1 GlusterFS01:/GlusterFS/gv04Disperse GlusterFS02:/GlusterFS/gv04Disperse GlusterFS03:/GlusterFS/gv04Disperse<br>volume create: gv04Disperse: success: please start the volume to access data<br><br>[root@GlusterFS01 ~]# gluster volume  start gv04Disperse <br>volume start: gv04Disperse: success<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">0 ~&gt; <span class="hljs-built_in">sudo</span> mount -t glusterfs GlusterFS03:/gv04Disperse /tmp/test/<br>grep: 警告：- 前有多余的 \<br>0 ~&gt; <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero count=1 bs=20M of=/tmp/test/testFiles<br>输入了 1+0 块记录<br>输出了 1+0 块记录<br>20971520 字节 (21 MB, 20 MiB) 已复制，0.0449326 s，467 MB/s<br>0 ~&gt; <span class="hljs-built_in">du</span> -ah /tmp/test/<br>20M/tmp/test/testFiles<br>20M/tmp/test/<br><br>0 ~&gt; ansible GlusterFS -m shell -a <span class="hljs-string">&quot;du -csh /GlusterFS/gv04Disperse&quot;</span><br>192.168.100.110 | CHANGED | rc=0 &gt;&gt;<br>11M/GlusterFS/gv04Disperse<br>11Mtotal<br>192.168.100.112 | CHANGED | rc=0 &gt;&gt;<br>11M/GlusterFS/gv04Disperse<br>11Mtotal<br>192.168.100.111 | CHANGED | rc=0 &gt;&gt;<br>11M/GlusterFS/gv04Disperse<br>11Mtotal<br></code></pre></td></tr></table></figure><p>实际上每个Brick还有很多小文件 来实现纠删码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@GlusterFS02 gv04Disperse]# <span class="hljs-built_in">ls</span> -a<br>.  ..  .glusterfs  testFiles<br>[root@GlusterFS02 gv04Disperse]# <span class="hljs-built_in">ls</span> -a .glusterfs/<br>.   09  14  1f  2a  35  40  4b  56  61  6c  77  82  8d  98  a3  ae  b9  c4  cf          d9  e4  ef  fa<br>..  0a  15  20  2b  36  41  4c  57  62  6d  78  83  8e  99  a4  af  ba  c5  changelogs  da  e5  f0  fb<br>00  0b  16  21  2c  37  42  4d  58  63  6e  79  84  8f  9a  a5  b0  bb  c6  d0          db  e6  f1  <span class="hljs-built_in">fc</span><br>01  0c  17  22  2d  38  43  4e  59  64  6f  7a  85  90  9b  a6  b1  bc  c7  d1          dc  e7  f2  fd<br>02  0d  18  23  2e  39  44  4f  5a  65  70  7b  86  91  9c  a7  b2  bd  c8  d2          <span class="hljs-built_in">dd</span>  e8  f3  fe<br>03  0e  19  24  2f  3a  45  50  5b  66  71  7c  87  92  9d  a8  b3  be  c9  d3          de  e9  f4  ff<br>04  0f  1a  25  30  3b  46  51  5c  67  72  7d  88  93  9e  a9  b4  bf  ca  d4          <span class="hljs-built_in">df</span>  ea  f5  health_check<br>05  10  1b  26  31  3c  47  52  5d  68  73  7e  89  94  9f  aa  b5  c0  cb  d5          e0  eb  f6  indices<br>06  11  1c  27  32  3d  48  53  5e  69  74  7f  8a  95  a0  ab  b6  c1  cc  d6          e1  ec  f7  landfill<br>07  12  1d  28  33  3e  49  54  5f  6a  75  80  8b  96  a1  ac  b7  c2  <span class="hljs-built_in">cd</span>  d7          e2  ed  f8  <span class="hljs-built_in">unlink</span><br>08  13  1e  29  34  3f  4a  55  60  6b  76  81  8c  97  a2  ad  b8  c3  ce  d8          e3  ee  f9<br></code></pre></td></tr></table></figure><h4 id="分布式复制卷-1"><a href="#分布式复制卷-1" class="headerlink" title="分布式复制卷"></a>分布式复制卷</h4><p>和分布式复制卷差不多 </p><p><img src="/../Pic/image-20241013170943626.png" alt="image-20241013170943626"></p><p>因为只有3节点 还是之前的做法</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">0 ~&gt; ansible GlusterFS -m shell -a <span class="hljs-string">&quot;mkdir /GlusterFS/&#123;gv05Disdis,serverGv05Disdi&#125;&quot;</span><br>192.168.100.110 | CHANGED | rc=0 &gt;&gt;<br><br>192.168.100.112 | CHANGED | rc=0 &gt;&gt;<br><br>192.168.100.111 | CHANGED | rc=0 &gt;&gt;<br><br>[root@GlusterFS01 ~]# gluster volume create gv05Disdis disperse 3 redundancy 1 \<br>&gt; GlusterFS01:/GlusterFS/gv05Disdis GlusterFS01:/GlusterFS/serverGv05Disdi \<br>&gt; GlusterFS02:/GlusterFS/gv05Disdis GlusterFS02:/GlusterFS/serverGv05Disdi \<br>&gt; GlusterFS03:/GlusterFS/gv05Disdis GlusterFS03:/GlusterFS/serverGv05Disdi \<br>&gt; force<br>volume create: gv05Disdis: success: please start the volume to access data<br><br>[root@GlusterFS01 ~]# gluster volume start gv05Disdis <br>volume start: gv05Disdis: success<br><br></code></pre></td></tr></table></figure><p>三个节点都有该文件 然后在分布阶段就将整个文件<strong>切割</strong> 最后算出纠删码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">0 ~&gt; <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero count=1 bs=10M of=/tmp/test/gv05test<br>2 ~&gt; ansible GlusterFS -m shell -a <span class="hljs-string">&quot;du -chs /GlusterFS/gv05Disdis&quot;</span><br>192.168.100.110 | CHANGED | rc=0 &gt;&gt;<br>5.1M/GlusterFS/gv05Disdis<br>5.1Mtotal<br>192.168.100.111 | CHANGED | rc=0 &gt;&gt;<br>5.1M/GlusterFS/gv05Disdis<br>5.1Mtotal<br>192.168.100.112 | CHANGED | rc=0 &gt;&gt;<br>16K/GlusterFS/gv05Disdis<br>16Ktotal<br>0 ~&gt; ansible GlusterFS -m shell -a <span class="hljs-string">&quot;du -chs /GlusterFS/serverGv05Disdi&quot;</span><br>192.168.100.110 | CHANGED | rc=0 &gt;&gt;<br>5.1M/GlusterFS/serverGv05Disdi<br>5.1Mtotal<br>192.168.100.111 | CHANGED | rc=0 &gt;&gt;<br>16K/GlusterFS/serverGv05Disdi<br>16Ktotal<br>192.168.100.112 | CHANGED | rc=0 &gt;&gt;<br>16K/GlusterFS/serverGv05Disdi<br>16Ktotal<br></code></pre></td></tr></table></figure><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>每<code>start</code>一个<code>volume</code>就会在<code>Brick</code>上开启一个<code>glusterfsd</code>服务并打开一个端口</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@GlusterFS01 ~]# netstat -tunlp | grep gluster<br>tcp        0      0 0.0.0.0:53309           0.0.0.0:*               LISTEN      1138/glusterfsd     <br>tcp        0      0 0.0.0.0:56326           0.0.0.0:*               LISTEN      1305/glusterfsd     <br>tcp        0      0 0.0.0.0:51378           0.0.0.0:*               LISTEN      1098/glusterfsd     <br>tcp        0      0 0.0.0.0:52425           0.0.0.0:*               LISTEN      1425/glusterfsd     <br>tcp        0      0 0.0.0.0:55657           0.0.0.0:*               LISTEN      956/glusterfsd     ## will stop <br>tcp        0      0 0.0.0.0:24007           0.0.0.0:*               LISTEN      865/glusterd        <br>tcp        0      0 0.0.0.0:51744           0.0.0.0:*               LISTEN      1460/glusterfsd     <br>tcp        0      0 0.0.0.0:56234           0.0.0.0:*               LISTEN      1028/glusterfsd        <br>[root@GlusterFS01 ~]# gluster volume stop gv01Dis <br>Stopping volume will make its data inaccessible. Do you want to continue? (y/n) y<br>volume stop: gv01Dis: success<br>[root@GlusterFS01 ~]# netstat -tunlp | grep gluster<br>tcp        0      0 0.0.0.0:53309           0.0.0.0:*               LISTEN      1138/glusterfsd     <br>tcp        0      0 0.0.0.0:56326           0.0.0.0:*               LISTEN      1305/glusterfsd     <br>tcp        0      0 0.0.0.0:51378           0.0.0.0:*               LISTEN      1098/glusterfsd     <br>tcp        0      0 0.0.0.0:52425           0.0.0.0:*               LISTEN      1425/glusterfsd     <br>tcp        0      0 0.0.0.0:24007           0.0.0.0:*               LISTEN      865/glusterd        <br>tcp        0      0 0.0.0.0:51744           0.0.0.0:*               LISTEN      1460/glusterfsd     <br>tcp        0      0 0.0.0.0:56234           0.0.0.0:*               LISTEN      1028/glusterfsd <br></code></pre></td></tr></table></figure><p>每有一个<code>Volume</code>被挂载 就会在<code>Brick</code>上生成一个<code>glusterfs</code>的进程</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@GlusterFS01 ~]# pidstat | grep gluster<br>02:25:45 PM     0       856    0.01    0.01    0.00    0.00    0.02     0  glusterd<br>02:25:45 PM     0       955    0.00    0.01    0.00    0.00    0.01     1  glusterfsd<br>02:25:45 PM     0       990    0.00    0.01    0.00    0.00    0.01     1  glusterfsd<br>02:25:45 PM     0      1161    0.00    0.01    0.00    0.00    0.01     1  glusterfsd<br>02:25:45 PM     0      1267    0.00    0.01    0.00    0.00    0.01     0  glusterfsd<br>02:25:45 PM     0      1309    0.00    0.01    0.00    0.00    0.01     0  glusterfsd<br>02:25:45 PM     0      1347    0.00    0.01    0.00    0.00    0.01     1  glusterfsd<br>02:25:45 PM     0      1409    0.00    0.01    0.00    0.00    0.01     0  glusterfsd<br>02:25:45 PM     0      1496    0.02    0.01    0.00    0.00    0.03     1  glusterfs<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">0 /tmp/testDir&gt; <span class="hljs-built_in">df</span> -Th /tmp/testDir/<br>文件系统             类型            大小  已用  可用 已用% 挂载点<br>GlusterFS01:/gv01Dis fuse.glusterfs   60G  2.0G   58G    4% /tmp/testDir<br>32 /tmp/testDir&gt; <span class="hljs-built_in">cd</span><br>0 ~&gt; <span class="hljs-built_in">sudo</span> umount /tmp/testDir/<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2025/02/06/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6/"/>
    <url>/2025/02/06/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6/</url>
    
    <content type="html"><![CDATA[<h2 id="集合论"><a href="#集合论" class="headerlink" title="集合论"></a>集合论</h2><h3 id="符号"><a href="#符号" class="headerlink" title="符号"></a>符号</h3><h4 id="包含"><a href="#包含" class="headerlink" title="包含"></a>包含</h4><p><img src="/../Pic/image-20241026221307545.png" alt="image-20241026221307545"></p><p><img src="/../Pic/image-20241026221411181.png" alt="image-20241026221411181"></p><h4 id="相等"><a href="#相等" class="headerlink" title="相等"></a>相等</h4><p><img src="/../Pic/image-20241026221515445.png" alt="image-20241026221515445"></p><p><img src="/../Pic/image-20241026221648178.png" alt="image-20241026221648178"></p><p><img src="/../Pic/image-20241026221716734.png" alt="image-20241026221716734"></p><h4 id="真包含"><a href="#真包含" class="headerlink" title="真包含"></a>真包含</h4><p><img src="/../Pic/image-20241026221747081.png" alt="image-20241026221747081"></p><p><img src="/../Pic/image-20241026221833425.png" alt="image-20241026221833425"></p><h4 id="全集"><a href="#全集" class="headerlink" title="全集"></a>全集</h4><p><img src="/../Pic/image-20241026222156331.png" alt="image-20241026222156331"></p><p><img src="/../Pic/image-20241026222227063.png" alt="image-20241026222227063"></p><h4 id="全集-1"><a href="#全集-1" class="headerlink" title="全集"></a>全集</h4><p><img src="/../Pic/image-20241026222305461.png" alt="image-20241026222305461"></p><p><img src="/../Pic/image-20241026222504826.png" alt="image-20241026222504826"></p><p>前面相等的定义 </p><p>A⊆B∧B⊆A ⇔A&#x3D;B</p><h3 id="集合运算"><a href="#集合运算" class="headerlink" title="集合运算"></a>集合运算</h3><h4 id="交运算"><a href="#交运算" class="headerlink" title="交运算"></a>交运算</h4><p><img src="/../Pic/image-20241026224109646.png" alt="image-20241026224109646"></p><p><img src="/../Pic/image-20241026224232480.png" alt="image-20241026224232480"></p><p><img src="/../Pic/image-20241026224443532.png" alt="image-20241026224443532"></p><p><img src="/../Pic/image-20241026224602818.png" alt="image-20241026224602818"></p><p><img src="/../Pic/image-20241026230121612.png" alt="image-20241026230121612"></p><h4 id="并运算"><a href="#并运算" class="headerlink" title="并运算"></a>并运算</h4><p><img src="/../Pic/image-20241026230229975.png" alt="image-20241026230229975"></p><p><img src="/../Pic/image-20241026230312004.png" alt="image-20241026230312004"></p><p><img src="/../Pic/image-20241026230355091.png" alt="image-20241026230355091"></p><p><img src="/../Pic/image-20241026230738310.png" alt="image-20241026230738310"></p><p><img src="/../Pic/image-20241026230956304.png" alt="image-20241026230956304"></p><p><img src="/../Pic/image-20241026231511035.png" alt="image-20241026231511035"></p><h4 id="差运算"><a href="#差运算" class="headerlink" title="差运算"></a>差运算</h4><p><img src="/../Pic/image-20241026231615223.png" alt="image-20241026231615223"></p><p><img src="/../Pic/image-20241026231748153.png" alt="image-20241026231748153"></p><p><img src="/../Pic/image-20241026232213092.png" alt="image-20241026232213092"></p><p><img src="/../Pic/image-20241026232435922.png" alt="image-20241026232435922"><img src="/../Pic/image-20241026232919574.png" alt="image-20241026232919574"></p><p><img src="/../Pic/image-20241026233350657.png" alt="image-20241026233350657"></p><h3 id="序偶和笛卡尔积"><a href="#序偶和笛卡尔积" class="headerlink" title="序偶和笛卡尔积"></a>序偶和笛卡尔积</h3><h4 id="理论"><a href="#理论" class="headerlink" title="理论"></a>理论</h4><p><img src="/../Pic/image-20241027131341652.png" alt="image-20241027131341652"></p><p><img src="/../Pic/image-20241027131930939.png" alt="image-20241027131930939"></p><p>集合 x&#x3D;{2,3} y&#x3D;{3,2} 则 x&#x3D;y</p><p>序偶 &lt;1,3&gt; &lt;3,1&gt; 这两个序偶是不相等的</p><p>序偶 &lt;x,y&gt; &lt;a,u&gt; 若 x&#x3D;a ∧ y&#x3D;u 则 &lt;x,y&gt; &#x3D; &lt;a,u&gt;</p><p><img src="/../Pic/image-20241027132102829.png" alt="image-20241027132102829"></p><h4 id="笛卡尔积"><a href="#笛卡尔积" class="headerlink" title="笛卡尔积"></a>笛卡尔积</h4><p><img src="/../Pic/image-20241027132546367.png" alt="image-20241027132546367"></p><p><img src="/../Pic/image-20241027132956957.png" alt="image-20241027132956957"></p><p><img src="/../Pic/image-20241027133140374.png" alt="image-20241027133140374"></p><p><img src="/../Pic/image-20241027133252458.png" alt="image-20241027133252458"></p><p><img src="/../Pic/image-20241027134923222.png" alt="image-20241027134923222"></p><p><img src="/../Pic/image-20241027135021997.png" alt="image-20241027135021997"></p><p><img src="/../Pic/image-20241027140233615.png" alt="image-20241027140233615"></p><p><img src="/../Pic/image-20241027140318071.png" alt="image-20241027140318071"></p><p><img src="/../Pic/image-20241027140541165.png" alt="image-20241027140541165"></p><p><img src="/../Pic/image-20241027140607312.png" alt="image-20241027140607312"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2025/02/06/VXLAN/"/>
    <url>/2025/02/06/VXLAN/</url>
    
    <content type="html"><![CDATA[<h2 id="VXLAN"><a href="#VXLAN" class="headerlink" title="VXLAN"></a>VXLAN</h2><p>迎合云计算，超融合场景中的虚拟机热迁移</p><h3 id="热迁移"><a href="#热迁移" class="headerlink" title="热迁移"></a>热迁移</h3><p>从一台物理机迁移到另一台物理机中，业务不停，IP、MAC不变;所以需要在二层网络中迁移，但在需要跨地域时迁移，就不是很好实现，二层不可能开这么大</p><p><img src="/../Pic/image-20231009101448981.png" alt="image-20231009101448981"></p><p><img src="/../Pic/image-20231009101741928.png" alt="image-20231009101741928"></p><p><img src="/../Pic/image-20231009102324653.png" alt="image-20231009102324653"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2025/02/06/MySQL%E5%9F%BA%E6%9C%AC%E8%AF%AD%E5%8F%A5/"/>
    <url>/2025/02/06/MySQL%E5%9F%BA%E6%9C%AC%E8%AF%AD%E5%8F%A5/</url>
    
    <content type="html"><![CDATA[<h1 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h1><h1 id="数据库语言分类"><a href="#数据库语言分类" class="headerlink" title="数据库语言分类"></a>数据库语言分类</h1><ul><li><p>DDL</p><p>数据库定义语言 <code>Create drop</code></p></li><li><p>DML</p><p>数据库操作语言 <code>update delete</code></p></li><li><p>DQL</p><p>数据库查询语言 <code>select</code></p></li><li><p>DCL</p><p>数据库操作语言 <code>grant</code></p></li></ul><h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show global variables like &quot;%default%&quot;;<br>+------------------------------------------+--------------------+<br>| Variable_name                            | Value              |<br>+------------------------------------------+--------------------+<br>| default_collation_for_utf8mb4            | utf8mb4_0900_ai_ci |<br>| default_password_lifetime                | 0                  |<br>| default_storage_engine                   | InnoDB             |<br>| default_table_encryption                 | OFF                |<br>| default_tmp_storage_engine               | InnoDB             |<br>| default_week_format                      | 0                  |<br>| explicit_defaults_for_timestamp          | ON                 |<br>| innodb_default_row_format                | dynamic            |<br>| mysqlx_deflate_default_compression_level | 3                  |<br>| mysqlx_lz4_default_compression_level     | 2                  |<br>| mysqlx_zstd_default_compression_level    | 3                  |<br>+------------------------------------------+--------------------+<br>11 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>配置文件可以在服务器启动时修改<strong>一些</strong>启动变量 比如默认的存储引擎是InnoDB 默认的行格式是dynamic </p><table><thead><tr><th align="center">优先级</th><th align="center">目录</th><th align="center">文件名</th></tr></thead><tbody><tr><td align="center">最低</td><td align="center">&#x2F;etc&#x2F;</td><td align="center">my.cnf</td></tr><tr><td align="center">低</td><td align="center">&#x2F;etc&#x2F;mysql&#x2F;</td><td align="center">my.cnf</td></tr><tr><td align="center">中</td><td align="center">~&#x2F;</td><td align="center">.my.cnf</td></tr><tr><td align="center">高</td><td align="center">指定目录</td><td align="center">defalts-file 指定文件名称</td></tr><tr><td align="center">最高</td><td align="center">-</td><td align="center">-命令行参数方式传入</td></tr></tbody></table><h2 id="字符集和比较规则"><a href="#字符集和比较规则" class="headerlink" title="字符集和比较规则"></a>字符集和比较规则</h2><p>从上到下三个级别</p><ul><li><p>服务器</p><ul><li>character_set_server     | utf8mb4</li><li>collation_server              | utf8mb4_0900_ai_ci</li></ul></li><li><p>数据库</p><ul><li>character_set_database   | utf8mb4</li><li>collation_database           | utf8mb4_0900_ai_ci</li></ul></li><li><p>表</p><ul><li>创建表时指定</li></ul></li><li><p>行</p><ul><li>创建表时指定</li></ul></li></ul><p>未显式指定的字符集会按照上一级的配置 字符集和比较规则是一一对应的 修改一个 另一个也会修改</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show character set; <br>+----------+---------------------------------+---------------------+--------+<br>| Charset  | Description                     | Default collation   | Maxlen |<br>+----------+---------------------------------+---------------------+--------+<br>| armscii8 | ARMSCII-8 Armenian              | armscii8_general_ci |      1 |<br>| ascii    | US ASCII                        | ascii_general_ci    |      1 |<br>| big5     | Big5 Traditional Chinese        | big5_chinese_ci     |      2 |<br>| binary   | Binary pseudo charset           | binary              |      1 |<br>| cp1250   | Windows Central European        | cp1250_general_ci   |      1 |<br>| cp1251   | Windows Cyrillic                | cp1251_general_ci   |      1 |<br>| cp1256   | Windows Arabic                  | cp1256_general_ci   |      1 |<br>| cp1257   | Windows Baltic                  | cp1257_general_ci   |      1 |<br>| cp850    | DOS West European               | cp850_general_ci    |      1 |<br>| cp852    | DOS Central European            | cp852_general_ci    |      1 |<br>| cp866    | DOS Russian                     | cp866_general_ci    |      1 |<br>| cp932    | SJIS for Windows Japanese       | cp932_japanese_ci   |      2 |<br>| dec8     | DEC West European               | dec8_swedish_ci     |      1 |<br>| eucjpms  | UJIS for Windows Japanese       | eucjpms_japanese_ci |      3 |<br>| euckr    | EUC-KR Korean                   | euckr_korean_ci     |      2 |<br>| gb18030  | China National Standard GB18030 | gb18030_chinese_ci  |      4 |<br>| gb2312   | GB2312 Simplified Chinese       | gb2312_chinese_ci   |      2 |<br>| gbk      | GBK Simplified Chinese          | gbk_chinese_ci      |      2 |<br>| geostd8  | GEOSTD8 Georgian                | geostd8_general_ci  |      1 |<br>| greek    | ISO 8859-7 Greek                | greek_general_ci    |      1 |<br>| hebrew   | ISO 8859-8 Hebrew               | hebrew_general_ci   |      1 |<br>| hp8      | HP West European                | hp8_english_ci      |      1 |<br>| keybcs2  | DOS Kamenicky Czech-Slovak      | keybcs2_general_ci  |      1 |<br>| koi8r    | KOI8-R Relcom Russian           | koi8r_general_ci    |      1 |<br>| koi8u    | KOI8-U Ukrainian                | koi8u_general_ci    |      1 |<br>| latin1   | cp1252 West European            | latin1_swedish_ci   |      1 |<br>| latin2   | ISO 8859-2 Central European     | latin2_general_ci   |      1 |<br>| latin5   | ISO 8859-9 Turkish              | latin5_turkish_ci   |      1 |<br>| latin7   | ISO 8859-13 Baltic              | latin7_general_ci   |      1 |<br>| macce    | Mac Central European            | macce_general_ci    |      1 |<br>| macroman | Mac West European               | macroman_general_ci |      1 |<br>| sjis     | Shift-JIS Japanese              | sjis_japanese_ci    |      2 |<br>| swe7     | 7bit Swedish                    | swe7_swedish_ci     |      1 |<br>| tis620   | TIS620 Thai                     | tis620_thai_ci      |      1 |<br>| ucs2     | UCS-2 Unicode                   | ucs2_general_ci     |      2 |<br>| ujis     | EUC-JP Japanese                 | ujis_japanese_ci    |      3 |<br>| utf16    | UTF-16 Unicode                  | utf16_general_ci    |      4 |<br>| utf16le  | UTF-16LE Unicode                | utf16le_general_ci  |      4 |<br>| utf32    | UTF-32 Unicode                  | utf32_general_ci    |      4 |<br>| utf8mb3  | UTF-8 Unicode                   | utf8mb3_general_ci  |      3 |<br>| utf8mb4  | UTF-8 Unicode                   | utf8mb4_0900_ai_ci  |      4 |<br>+----------+---------------------------------+---------------------+--------+<br>41 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show global variables like &quot;%character%&quot;;<br>+--------------------------+--------------------------------+<br>| Variable_name            | Value                          |<br>+--------------------------+--------------------------------+<br>| character_set_client     | utf8mb4                        |<br>| character_set_connection | utf8mb4                        |<br>| character_set_database   | utf8mb4                        |<br>| character_set_filesystem | binary                         |<br>| character_set_results    | utf8mb4                        |<br>| character_set_server     | utf8mb4                        |<br>| character_set_system     | utf8mb3                        |<br>| character_sets_dir       | /usr/share/mysql-8.4/charsets/ |<br>+--------------------------+--------------------------------+<br>8 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show global variables like &quot;%collation%&quot;;<br>+-------------------------------+--------------------+<br>| Variable_name                 | Value              |<br>+-------------------------------+--------------------+<br>| collation_connection          | utf8mb4_0900_ai_ci |<br>| collation_database            | utf8mb4_0900_ai_ci |<br>| collation_server              | utf8mb4_0900_ai_ci |<br>| default_collation_for_utf8mb4 | utf8mb4_0900_ai_ci |<br>+-------------------------------+--------------------+<br>4 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h1 id="DDL"><a href="#DDL" class="headerlink" title="DDL"></a>DDL</h1><h2 id="创建库"><a href="#创建库" class="headerlink" title="创建库"></a>创建库</h2><p>现式指定字符集 否则就是数据库级别的 <code>utf8mb4</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create database test1 default character set ascii collate ascii_general_ci;<br>Query OK, 1 row affected (0.03 sec)<br><br>mysql&gt; show create database test1\G <br>*************************** 1. row ***************************<br>       Database: test1<br>Create Database: CREATE DATABASE `test1` /*!40100 DEFAULT CHARACTER SET ascii */ /*!80016 DEFAULT ENCRYPTION=&#x27;N&#x27; */<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; alter database test1 default character set utf8;<br>Query OK, 1 row affected, 1 warning (0.03 sec)<br><br>mysql&gt; show create database test1\G<br>*************************** 1. row ***************************<br>       Database: test1<br>Create Database: CREATE DATABASE `test1` /*!40100 DEFAULT CHARACTER SET utf8mb3 */ /*!80016 DEFAULT ENCRYPTION=&#x27;N&#x27; */<br>1 row in set (0.00 sec)<br><br></code></pre></td></tr></table></figure><blockquote><p>Mysql中的utf8是<code>utf8mb3</code>占<code>3</code>字节</p><p>原版的utf8叫<code>utf8mb4</code> 占<code>4</code>字节</p><p>不现式指定就是<code>utf8mb3</code></p></blockquote><h2 id="删除库"><a href="#删除库" class="headerlink" title="删除库"></a>删除库</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; drop database test1;<br>Query OK, 0 rows affected (0.04 sec)<br><br>mysql&gt; show databases; <br>+--------------------+<br>| Database           |<br>+--------------------+<br>| classicmodels      |<br>| information_schema |<br>| mysql              |<br>| performance_schema |<br>| sys                |<br>+--------------------+<br>5 rows in set (0.00 sec)表<br></code></pre></td></tr></table></figure><h2 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE [IF NOT EXISTS] table_name(<br>   column1 datatype constraints,<br>   column2 datatype constraints,<br>   ...<br>) ENGINE=storage_engine;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create database test1 character set utf8mb4 collate utf8mb4_0900_ai_ci;<br>Query OK, 1 row affected (0.03 sec)<br><br>mysql&gt; show create database test1\G<br>*************************** 1. row ***************************<br>       Database: test1<br>Create Database: CREATE DATABASE `test1` /*!40100 DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci */ /*!80016 DEFAULT ENCRYPTION=&#x27;N&#x27; */<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>在该数据库中创建表 不显式指定字符集和比较规则就会是数据库级别的<code>utf8mb4</code> <code>utf8mb4_0900_ai_ci</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create table t1 (id int auto_increment not null primary key,name varchar(10) not null) engine=innodb character set utf8mb3;<br>Query OK, 0 rows affected, 1 warning (0.06 sec)<br><br>mysql&gt; show create table t1\G<br>*************************** 1. row ***************************<br>       Table: t1<br>Create Table: CREATE TABLE `t1` (<br>  `id` int NOT NULL AUTO_INCREMENT,<br>  `name` varchar(10) NOT NULL,<br>  PRIMARY KEY (`id`)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>存储引擎默认是InnoDB 也可以指定其他engines <code>show engines </code> 查看支持的引擎</p><h3 id="列"><a href="#列" class="headerlink" title="列"></a>列</h3><h4 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; alter table t1 add column city varchar(10) not null,charset ascii;<br>Query OK, 0 rows affected (0.09 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt; alter table t1 add column habbit text null after name, character set utf8mb4;<br>Query OK, 0 rows affected (0.16 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt; alter table t1 add column age int not null;<br>Query OK, 0 rows affected (0.05 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br></code></pre></td></tr></table></figure><ul><li>列不指定字符集 就会安装数据表级别的 <code>utf8mb3</code></li><li>不指定列的位置就会在最后 使用 <code>after</code> 创建在一列之后</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show full columns from t1\G <br>*************************** 1. row ***************************<br>     Field: id<br>      Type: int<br> Collation: NULL<br>      Null: NO<br>       Key: PRI<br>   Default: NULL<br>     Extra: auto_increment<br>Privileges: select,insert,update,references<br>   Comment: <br>*************************** 2. row ***************************<br>     Field: name<br>      Type: varchar(10)<br> Collation: utf8mb3_general_ci<br>      Null: NO<br>       Key: <br>   Default: NULL<br>     Extra: <br>Privileges: select,insert,update,references<br>   Comment: <br>*************************** 3. row ***************************<br>     Field: habbit<br>      Type: text<br> Collation: utf8mb4_0900_ai_ci<br>      Null: YES<br>       Key: <br>   Default: NULL<br>     Extra: <br>Privileges: select,insert,update,references<br>   Comment: <br>*************************** 4. row ***************************<br>     Field: city<br>      Type: varchar(10)<br> Collation: ascii_general_ci<br>      Null: NO<br>       Key: <br>   Default: NULL<br>     Extra: <br>Privileges: select,insert,update,references<br>   Comment: <br>*************************** 5. row ***************************<br>     Field: age<br>      Type: int<br> Collation: NULL<br>      Null: NO<br>       Key: <br>   Default: NULL<br>     Extra: <br>Privileges: select,insert,update,references<br>   Comment: <br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show columns from t1; <br>+--------+-------------+------+-----+---------+----------------+<br>| Field  | Type        | Null | Key | Default | Extra          |<br>+--------+-------------+------+-----+---------+----------------+<br>| id     | int         | NO   | PRI | NULL    | auto_increment |<br>| name   | varchar(10) | NO   |     | NULL    |                |<br>| habbit | text        | YES  |     | NULL    |                |<br>| city   | varchar(10) | NO   |     | NULL    |                |<br>| age    | int         | NO   |     | NULL    |                |<br>+--------+-------------+------+-----+---------+----------------+<br>5 rows in set (0.00 sec)<br><br>mysql&gt; alter table t1 drop column habbit, drop column city;<br>Query OK, 0 rows affected (0.15 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt; show columns from t1;<br>+-------+-------------+------+-----+---------+----------------+<br>| Field | Type        | Null | Key | Default | Extra          |<br>+-------+-------------+------+-----+---------+----------------+<br>| id    | int         | NO   | PRI | NULL    | auto_increment |<br>| name  | varchar(10) | NO   |     | NULL    |                |<br>| age   | int         | NO   |     | NULL    |                |<br>+-------+-------------+------+-----+---------+----------------+<br>3 rows in set (0.01 sec)<br></code></pre></td></tr></table></figure><h3 id="一些约束字段"><a href="#一些约束字段" class="headerlink" title="一些约束字段"></a>一些约束字段</h3><h4 id="auto-increment"><a href="#auto-increment" class="headerlink" title="auto_increment"></a>auto_increment</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show columns from t1;<br>+-------+-------------+------+-----+---------+----------------+<br>| Field | Type        | Null | Key | Default | Extra          |<br>+-------+-------------+------+-----+---------+----------------+<br>| id    | int         | NO   | PRI | NULL    | auto_increment |<br>| name  | varchar(10) | NO   |     | NULL    |                |<br>+-------+-------------+------+-----+---------+----------------+<br>2 rows in set (0.00 sec)<br><br>mysql&gt; insert into t1(name) values <br>    -&gt; (&quot;ZhangSan&quot;),<br>    -&gt; (&quot;LiSi&quot;); <br>Query OK, 2 rows affected (0.03 sec)<br>Records: 2  Duplicates: 0  Warnings: 0<br><br>mysql&gt; select * from t1 as aa; <br>+----+----------+<br>| id | name     |<br>+----+----------+<br>|  1 | ZhangSan |<br>|  2 | LiSi     |<br>+----+----------+<br>2 rows in set (0.00 sec)<br><br>### 获取当前插入的ID<br>mysql&gt; select last_insert_id(id) from t1 as t1_as;<br>+--------------------+<br>| last_insert_id(id) |<br>+--------------------+<br>|                  1 |<br>|                  2 |<br>+--------------------+<br>2 rows in set (0.00 sec)<br><br></code></pre></td></tr></table></figure><h5 id="更改递增开始值"><a href="#更改递增开始值" class="headerlink" title="更改递增开始值"></a>更改递增开始值</h5><blockquote><p>只有大于表中的最大值 才会生效</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from t1 as aa;<br>+----+----------+<br>| id | name     |<br>+----+----------+<br>|  1 | ZhangSan |<br>|  2 | LiSi     |<br>+----+----------+<br>2 rows in set (0.01 sec)<br><br>mysql&gt; alter table t1 auto_increment=1; <br>Query OK, 0 rows affected (0.02 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt; insert into t1(name) values (&quot;ZhangSan2&quot;);<br>Query OK, 1 row affected (0.02 sec)<br><br>mysql&gt; select * from t1 as aa;<br>+----+-----------+<br>| id | name      |<br>+----+-----------+<br>|  1 | ZhangSan  |<br>|  2 | LiSi      |<br>|  3 | ZhangSan2 |<br>+----+-----------+<br>3 rows in set (0.01 sec)<br><br>mysql&gt; alter table t1 auto_increment=5;<br>Query OK, 0 rows affected (0.02 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt; insert into t1(name) values (&quot;ZhangSan3&quot;);<br>Query OK, 1 row affected (0.02 sec)<br><br>mysql&gt; select * from t1 as aa;<br>+----+-----------+<br>| id | name      |<br>+----+-----------+<br>|  1 | ZhangSan  |<br>|  2 | LiSi      |<br>|  3 | ZhangSan2 |<br>|  5 | ZhangSan3 |<br>+----+-----------+<br>4 rows in set (0.00 sec)<br><br></code></pre></td></tr></table></figure><h5 id="清除数据"><a href="#清除数据" class="headerlink" title="清除数据"></a>清除数据</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; truncate table t1; <br>Query OK, 0 rows affected (0.12 sec)<br><br>mysql&gt; select * from t1 as aa;<br>Empty set (0.01 sec) <br></code></pre></td></tr></table></figure><h4 id="PARIMARY-KEY"><a href="#PARIMARY-KEY" class="headerlink" title="PARIMARY KEY"></a>PARIMARY KEY</h4><h5 id="多主键创建"><a href="#多主键创建" class="headerlink" title="多主键创建"></a>多主键创建</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create table t3 (<br>    -&gt; id int not null primary key, <br>    -&gt; name varchar(10) not null primary key); <br>ERROR 1068 (42000): Multiple primary key defined<br><br>mysql&gt; create table t3 ( id int not null , name varchar(10) not null ,primary key(id,name));<br>Query OK, 0 rows affected (0.08 sec)<br><br>mysql&gt; desc t3; <br>+-------+-------------+------+-----+---------+-------+<br>| Field | Type        | Null | Key | Default | Extra |<br>+-------+-------------+------+-----+---------+-------+<br>| id    | int         | NO   | PRI | NULL    |       |<br>| name  | varchar(10) | NO   | PRI | NULL    |       |<br>+-------+-------------+------+-----+---------+-------+<br>2 rows in set (0.03 sec)<br></code></pre></td></tr></table></figure><h5 id="添加新列为主键"><a href="#添加新列为主键" class="headerlink" title="添加新列为主键"></a>添加新列为主键</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create table t4 ( col1 int not null); <br>Query OK, 0 rows affected (0.07 sec)<br><br>mysql&gt; desc t4; <br>+-------+------+------+-----+---------+-------+<br>| Field | Type | Null | Key | Default | Extra |<br>+-------+------+------+-----+---------+-------+<br>| col1  | int  | NO   |     | NULL    |       |<br>+-------+------+------+-----+---------+-------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; alter table t4 add column col int not null primary key first; <br>Query OK, 0 rows affected (0.14 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt; desc t4;<br>+-------+------+------+-----+---------+-------+<br>| Field | Type | Null | Key | Default | Extra |<br>+-------+------+------+-----+---------+-------+<br>| col   | int  | NO   | PRI | NULL    |       |<br>| col1  | int  | NO   |     | NULL    |       |<br>+-------+------+------+-----+---------+-------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h5 id="删除列的主键"><a href="#删除列的主键" class="headerlink" title="删除列的主键"></a>删除列的主键</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; desc t3;<br>+-------+-------------+------+-----+---------+-------+<br>| Field | Type        | Null | Key | Default | Extra |<br>+-------+-------------+------+-----+---------+-------+<br>| id    | int         | NO   | PRI | NULL    |       |<br>| name  | varchar(10) | NO   | PRI | NULL    |       |<br>+-------+-------------+------+-----+---------+-------+<br>2 rows in set (0.01 sec)<br><br>mysql&gt; alter table t3 drop primary key;<br>Query OK, 0 rows affected (0.15 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt; desc t3;<br>+-------+-------------+------+-----+---------+-------+<br>| Field | Type        | Null | Key | Default | Extra |<br>+-------+-------------+------+-----+---------+-------+<br>| id    | int         | NO   |     | NULL    |       |<br>| name  | varchar(10) | NO   |     | NULL    |       |<br>+-------+-------------+------+-----+---------+-------+<br>2 rows in set (0.00 sec)<br><br>mysql&gt; alter table t3 modify id int primary key;<br>Query OK, 0 rows affected (0.14 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt; desc t3;<br>+-------+-------------+------+-----+---------+-------+<br>| Field | Type        | Null | Key | Default | Extra |<br>+-------+-------------+------+-----+---------+-------+<br>| id    | int         | NO   | PRI | NULL    |       |<br>| name  | varchar(10) | NO   |     | NULL    |       |<br>+-------+-------------+------+-----+---------+-------+<br>2 rows in set (0.01 sec)<br></code></pre></td></tr></table></figure><h4 id="Foreign-Key"><a href="#Foreign-Key" class="headerlink" title="!! Foreign Key"></a>!! Foreign Key</h4><p>Mysql为关系形数据库 在一个表中存在<strong>另一个表的主键</strong> 就叫做外键(foreign key)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; desc orders;<br>+----------------+-------------+------+-----+---------+-------+<br>| Field          | Type        | Null | Key | Default | Extra |<br>+----------------+-------------+------+-----+---------+-------+<br>| orderNumber    | int         | NO   | PRI | NULL    |       |<br>| orderDate      | date        | NO   |     | NULL    |       |<br>| requiredDate   | date        | NO   |     | NULL    |       |<br>| shippedDate    | date        | YES  |     | NULL    |       |<br>| status         | varchar(15) | NO   |     | NULL    |       |<br>| comments       | text        | YES  |     | NULL    |       |<br>| customerNumber | int         | NO   | MUL | NULL    |       |<br>+----------------+-------------+------+-----+---------+-------+<br>7 rows in set (0.00 sec)<br><br>mysql&gt; desc customers; <br>+------------------------+---------------+------+-----+---------+-------+<br>| Field                  | Type          | Null | Key | Default | Extra |<br>+------------------------+---------------+------+-----+---------+-------+<br>| customerNumber         | int           | NO   | PRI | NULL    |       |<br>| customerName           | varchar(50)   | NO   |     | NULL    |       |<br>| contactLastName        | varchar(50)   | NO   |     | NULL    |       |<br>| contactFirstName       | varchar(50)   | NO   |     | NULL    |       |<br>| phone                  | varchar(50)   | NO   |     | NULL    |       |<br>| addressLine1           | varchar(50)   | NO   |     | NULL    |       |<br>| addressLine2           | varchar(50)   | YES  |     | NULL    |       |<br>| city                   | varchar(50)   | NO   |     | NULL    |       |<br>| state                  | varchar(50)   | YES  |     | NULL    |       |<br>| postalCode             | varchar(15)   | YES  |     | NULL    |       |<br>| country                | varchar(50)   | NO   |     | NULL    |       |<br>| salesRepEmployeeNumber | int           | YES  | MUL | NULL    |       |<br>| creditLimit            | decimal(10,2) | YES  |     | NULL    |       |<br>+------------------------+---------------+------+-----+---------+-------+<br>13 rows in set (0.01 sec)<br></code></pre></td></tr></table></figure><p>其中 <code>orders</code> 表的外键为 <code>customerNumber</code> 也就是 <code>customers</code> 的主键</p><p><code>orders</code> 表就称为 <code>customers</code> 的子表</p><p><code>customers</code> 表就称为主表</p><h5 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">[CONSTRAINT constraint_name]<br>FOREIGN KEY [foreign_key_name] (column_name, ...)<br>REFERENCES parent_table(colunm_name,...)<br>[ON DELETE reference_option]<br>[ON UPDATE reference_option]<br></code></pre></td></tr></table></figure><ol><li>ON DELETE 约束:<ul><li>定义在从表(子表)的外键列上,当主表记录被删除时,从表记录如何处理。</li><li>主要选项包括:<ul><li>CASCADE: 级联删除从表相关记录。</li><li>SET NULL: 将从表外键列设置为 NULL。</li><li>SET DEFAULT: 将从表外键列设置为默认值。</li><li>NO ACTION: 不做任何操作,如果从表有关联记录则无法删除主表记录。</li></ul></li></ul></li><li>ON UPDATE 约束:<ul><li>定义在从表(子表)的外键列上,当主表记录的键值被更新时,从表记录如何处理。</li><li>主要选项包括:<ul><li>CASCADE: 级联更新从表相关记录。</li><li>SET NULL: 将从表外键列设置为 NULL。</li><li>SET DEFAULT: 将从表外键列设置为默认值。</li><li>NO ACTION: 不做任何操作,如果从表有关联记录则无法更新主表记录。</li></ul></li></ul></li><li>RESTRICT 约束:<ul><li>默认行为,当主表记录被删除或更新时,如果从表有关联记录,则拒绝操作。</li></ul></li><li>SET DEFAULT 约束:<ul><li>当主表记录被删除时,将从表外键列设置为默认值。</li></ul></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create table t2_fk (t2_fk_id int primary key auto_increment, comment text null, t2_fk int ,constraint t2_fk foreign key (t2_fk) references t2(id));<br>Query OK, 0 rows affected (0.10 sec)<br></code></pre></td></tr></table></figure><h4 id="unique"><a href="#unique" class="headerlink" title="unique"></a>unique</h4><p>可以保证一列数据的独立性</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create table t3 ( id int primary key auto_increment, mail text not null );<br>Query OK, 0 rows affected (0.08 sec)<br><br>mysql&gt; insert into t3(id,mail) values (1,&quot;1@qq.com&quot;);<br>Query OK, 1 row affected (0.03 sec)<br><br>mysql&gt; insert into t3(id,mail) values (2,&quot;1@qq.com&quot;);<br>Query OK, 1 row affected (0.04 sec<br><br>mysql&gt; alter table t3 modify column mail varchar(100) unique;<br>ERROR 1062 (23000): Duplicate entry &#x27;1@qq.com&#x27; for key &#x27;t3.mail&#x27;<br><br>mysql&gt; delete from  t3 where id=2;<br>Query OK, 1 row affected (0.03 sec)<br><br>mysql&gt; alter table t3 modify column mail varchar(100) unique;<br>Query OK, 1 row affected (0.10 sec)<br>Records: 1  Duplicates: 0  Warnings: 0<br><br>mysql&gt; insert into t3(mail) values (&quot;2@qq.com&quot;);<br>Query OK, 1 row affected (0.04 sec)<br><br>mysql&gt; select * from t3;<br>+----+----------+<br>| id | mail     |<br>+----+----------+<br>|  1 | 1@qq.com |<br>|  3 | 2@qq.com |<br>+----+----------+<br>2 rows in set (0.00 sec)<br><br>mysql&gt; insert into t3(mail) values (&quot;2@qq.com&quot;);<br>ERROR 1062 (23000): Duplicate entry &#x27;2@qq.com&#x27; for key &#x27;t3.mail&#x27;<br></code></pre></td></tr></table></figure><p>NULL不能确定唯一</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; insert into t3 values (4,NULL); <br>Query OK, 1 row affected (0.03 sec)<br><br>mysql&gt; insert into t3 values (5,NULL);<br>Query OK, 1 row affected (0.03 sec)<br><br>mysql&gt; select * from t3;<br>+----+----------+<br>| id | mail     |<br>+----+----------+<br>|  4 | NULL     |<br>|  5 | NULL     |<br>|  1 | 1@qq.com |<br>|  3 | 2@qq.com |<br>+----+----------+<br>4 rows in set (0.00 sec)<br><br></code></pre></td></tr></table></figure><h4 id="check"><a href="#check" class="headerlink" title="check"></a>check</h4><h5 id="列级别"><a href="#列级别" class="headerlink" title="列级别"></a>列级别</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create table tCheck ( productId int primary key, detail int not null check (detail &gt; 0), number int not null check (number &gt;= 1) );<br>Query OK, 0 rows affected (0.09 sec)<br><br>mysql&gt; desc tCheck; <br>+-----------+------+------+-----+---------+-------+<br>| Field     | Type | Null | Key | Default | Extra |<br>+-----------+------+------+-----+---------+-------+<br>| productId | int  | NO   | PRI | NULL    |       |<br>| detail    | int  | NO   |     | NULL    |       |<br>| number    | int  | NO   |     | NULL    |       |<br>+-----------+------+------+-----+---------+-------+<br>3 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>以上表约束了 <code>detail&gt; 0</code>  <code>number &gt;= 1</code> 当我们尝试插入违规数据 将会报错</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; insert into tCheck(productId,detail,number) values (1,100,2);<br>Query OK, 1 row affected (0.03 sec)  <br><br>mysql&gt; insert into tCheck(productId,detail,number) values (2,0,2);<br>ERROR 3819 (HY000): Check constraint &#x27;tCheck_chk_1&#x27; is violated.<br><br>mysql&gt; insert into tCheck(productId,detail,number) values (2,1,0);<br>ERROR 3819 (HY000): Check constraint &#x27;tCheck_chk_2&#x27; is violated.<br><br>mysql&gt; select * from tCheck; <br>+-----------+--------+--------+<br>| productId | detail | number |<br>+-----------+--------+--------+<br>|         1 |    100 |      2 |<br>+-----------+--------+--------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; show create table tCheck\G<br>*************************** 1. row ***************************<br>       Table: tCheck<br>Create Table: CREATE TABLE `tCheck` (<br>  `productId` int NOT NULL,<br>  `detail` int NOT NULL,<br>  `number` int NOT NULL,<br>  PRIMARY KEY (`productId`),<br>  CONSTRAINT `tCheck_chk_1` CHECK ((`detail` &gt; 0)),<br>  CONSTRAINT `tCheck_chk_2` CHECK ((`number` &gt;= 1))<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci<br>1 row in set (0.01 sec)<br></code></pre></td></tr></table></figure><h5 id="表级别"><a href="#表级别" class="headerlink" title="表级别"></a>表级别</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create table tCheck_T ( id int, age int, constraint ageCheck check(age &gt;= 18) );<br>Query OK, 0 rows affected (0.06 sec)<br><br>mysql&gt; show create table tCheck_T\G<br>*************************** 1. row ***************************<br>       Table: tCheck_T<br>Create Table: CREATE TABLE `tCheck_T` (<br>  `id` int DEFAULT NULL,<br>  `age` int DEFAULT NULL,<br>  CONSTRAINT `ageCheck` CHECK ((`age` &gt;= 18))<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci<br>1 row in set (0.00 sec)<br><br>mysql&gt; insert into tCheck_T values (1,18);<br>Query OK, 1 row affected (0.04 sec)<br><br>mysql&gt; insert into tCheck_T values (2,17);<br>ERROR 3819 (HY000): Check constraint &#x27;ageCheck&#x27; is violated.<br></code></pre></td></tr></table></figure><h5 id="添加check到表"><a href="#添加check到表" class="headerlink" title="添加check到表"></a>添加check到表</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; alter table t1 add check (age &gt;= 18);<br>ERROR 3819 (HY000): Check constraint &#x27;t1_chk_1&#x27; is violated.<br><br>mysql&gt; select * from t1; <br>+----+-----------+-----+<br>| id | name      | age |<br>+----+-----------+-----+<br>|  1 | ZhangSan  |   0 |<br>|  2 | LiSi      |   0 |<br>|  3 | ZhangSan2 |   0 |<br>|  5 | ZhangSan3 |   0 |<br>+----+-----------+-----+<br>4 rows in set (0.00 sec)<br><br>mysql&gt; delete from t1 where age=0;<br>Query OK, 4 rows affected (0.04 sec)<br><br>mysql&gt; select * from t1;<br>Empty set (0.00 sec)<br><br>mysql&gt; alter table t1 add check (age &gt;= 18);<br>Query OK, 0 rows affected (0.10 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt; insert into t1(name,age) values (&#x27;a&#x27;,17); <br>ERROR 3819 (HY000): Check constraint &#x27;t1_chk_1&#x27; is violated.<br><br>mysql&gt; insert into t1(name,age) values (&#x27;a&#x27;,18);<br>Query OK, 1 row affected (0.03 sec)<br></code></pre></td></tr></table></figure><h4 id="DEFAULT"><a href="#DEFAULT" class="headerlink" title="DEFAULT"></a>DEFAULT</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create table tDefault ( <br>    -&gt; name varchar(7) not null primary key, <br>    -&gt; gender enum(&#x27;Male&#x27;,&#x27;Female&#x27;) not null default &#x27;Male&#x27;<br>    -&gt; ); <br>Query OK, 0 rows affected (0.05 sec)<br><br>mysql&gt; desc tDefault; <br>+--------+-----------------------+------+-----+---------+-------+<br>| Field  | Type                  | Null | Key | Default | Extra |<br>+--------+-----------------------+------+-----+---------+-------+<br>| name   | varchar(7)            | NO   | PRI | NULL    |       |<br>| gender | enum(&#x27;Male&#x27;,&#x27;Female&#x27;) | NO   |     | Male    |       |<br>+--------+-----------------------+------+-----+---------+-------+<br>2 rows in set (0.00 sec)<br><br>mysql&gt; insert into tDefault(name) values (&#x27;zs&#x27;);<br>Query OK, 1 row affected (0.02 sec)<br><br>mysql&gt; select * from tDefault; <br>+------+--------+<br>| name | gender |<br>+------+--------+<br>| zs   | Male   |<br>+------+--------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><h5 id="增加DEFAULT到表"><a href="#增加DEFAULT到表" class="headerlink" title="增加DEFAULT到表"></a>增加DEFAULT到表</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; alter table tDefault add column age int not null;<br>Query OK, 0 rows affected (0.07 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt; desc tDefault; <br>+--------+-----------------------+------+-----+---------+-------+<br>| Field  | Type                  | Null | Key | Default | Extra |<br>+--------+-----------------------+------+-----+---------+-------+<br>| name   | varchar(7)            | NO   | PRI | NULL    |       |<br>| gender | enum(&#x27;Male&#x27;,&#x27;Female&#x27;) | NO   |     | Male    |       |<br>| age    | int                   | NO   |     | NULL    |       |<br>+--------+-----------------------+------+-----+---------+-------+<br>3 rows in set (0.00 sec)<br><br>mysql&gt; alter table tDefault alter column age set default &#x27;18&#x27;;<br>Query OK, 0 rows affected (0.04 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt; desc tDefault; <br>+--------+-----------------------+------+-----+---------+-------+<br>| Field  | Type                  | Null | Key | Default | Extra |<br>+--------+-----------------------+------+-----+---------+-------+<br>| name   | varchar(7)            | NO   | PRI | NULL    |       |<br>| gender | enum(&#x27;Male&#x27;,&#x27;Female&#x27;) | NO   |     | Male    |       |<br>| age    | int                   | NO   |     | 18      |       |<br>+--------+-----------------------+------+-----+---------+-------+<br>3 rows in set (0.01 sec)<br><br>mysql&gt; insert into tDefault(name) values (&#x27;lisi&#x27;);<br>Query OK, 1 row affected (0.03 sec)<br><br>mysql&gt; select * from tDefault;<br>+------+--------+------+<br>| name | gender | age  |<br>+------+--------+------+<br>| lisi | Male   |   18 |<br>| zs   | Male   |   18 |<br>+------+--------+------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h5 id="从表中删除DEFAULT"><a href="#从表中删除DEFAULT" class="headerlink" title="从表中删除DEFAULT"></a>从表中删除DEFAULT</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; alter table tDefault alter column age drop default;<br>Query OK, 0 rows affected (0.04 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt; desc tDefault;<br>+--------+-----------------------+------+-----+---------+-------+<br>| Field  | Type                  | Null | Key | Default | Extra |<br>+--------+-----------------------+------+-----+---------+-------+<br>| name   | varchar(7)            | NO   | PRI | NULL    |       |<br>| gender | enum(&#x27;Male&#x27;,&#x27;Female&#x27;) | NO   |     | Male    |       |<br>| age    | int                   | NO   |     | NULL    |       |<br>+--------+-----------------------+------+-----+---------+-------+<br>3 rows in set (0.01 sec)<br><br></code></pre></td></tr></table></figure><h4 id="NOT-NULL"><a href="#NOT-NULL" class="headerlink" title="NOT NULL"></a>NOT NULL</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create table tNotNull ( <br>    -&gt; name varchar(7) primary key, <br>    -&gt; habbit text); <br>Query OK, 0 rows affected (0.08 sec)<br><br>mysql&gt; desc tNotNull; <br>+--------+------------+------+-----+---------+-------+<br>| Field  | Type       | Null | Key | Default | Extra |<br>+--------+------------+------+-----+---------+-------+<br>| name   | varchar(7) | NO   | PRI | NULL    |       |<br>| habbit | text       | YES  |     | NULL    |       |<br>+--------+------------+------+-----+---------+-------+<br>2 rows in set (0.00 sec)<br><br>mysql&gt; insert into tNotNull values (&#x27;zs&#x27;,null);<br>Query OK, 1 row affected (0.03 sec)<br><br>mysql&gt; select * from tNotNull; <br>+------+--------+<br>| name | habbit |<br>+------+--------+<br>| zs   | NULL   |<br>+------+--------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><h5 id="列添加NOT-NUll约束"><a href="#列添加NOT-NUll约束" class="headerlink" title="列添加NOT NUll约束"></a>列添加NOT NUll约束</h5><p>向表中&#96;&#96;habbit<code>列添加</code>NOT NULL&#96; 报错 因为表中已经有了NULL数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; alter table tNotNull modify habbit text not null; <br>ERROR 1138 (22004): Invalid use of NULL value<br><br>mysql&gt; delete from tNotNull where habbit is null; <br>Query OK, 1 row affected (0.03 sec)<br><br>mysql&gt; alter table tNotNull modify habbit text not null;<br>Query OK, 0 rows affected (0.14 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt; desc tNotNull;<br>+--------+------------+------+-----+---------+-------+<br>| Field  | Type       | Null | Key | Default | Extra |<br>+--------+------------+------+-----+---------+-------+<br>| name   | varchar(7) | NO   | PRI | NULL    |       |<br>| habbit | text       | NO   |     | NULL    |       |<br>+--------+------------+------+-----+---------+-------+<br>2 rows in set (0.01 sec)<br></code></pre></td></tr></table></figure><h5 id="删除列NOT-NUll约束"><a href="#删除列NOT-NUll约束" class="headerlink" title="删除列NOT NUll约束"></a>删除列NOT NUll约束</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; alter table tNotNull modify column habbit text null;<br>Query OK, 0 rows affected (0.14 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt; desc tNotNull;<br>+--------+------------+------+-----+---------+-------+<br>| Field  | Type       | Null | Key | Default | Extra |<br>+--------+------------+------+-----+---------+-------+<br>| name   | varchar(7) | NO   | PRI | NULL    |       |<br>| habbit | text       | YES  |     | NULL    |       |<br>+--------+------------+------+-----+---------+-------+<br>2 rows in set (0.00 sec)<br><br></code></pre></td></tr></table></figure><h4 id="外键"><a href="#外键" class="headerlink" title="外键"></a>外键</h4><p>主键所在的表就是主表（父表），外键所在的表就是从表（子表）</p><p><strong>定义外键时，需要遵守下列规则：</strong></p><ul><li>主表必须已经存在于数据库中，或者是当前正在创建的表。如果是后一种情况，则主表与从表是同一个表，这样的表称为自参照表，这种结构称为自参照完整性。</li><li>必须为主表定义主键。</li><li>主键不能包含空值，但允许在外键中出现空值。也就是说，只要外键的每个非空值出现在指定的主键中，这个外键的内容就是正确的。</li><li>在主表的表名后面指定列名或列名的组合。这个列或列的组合必须是主表的主键或候选键。</li><li>外键中列的数目必须和主表的主键中列的数目相同。</li><li>外键中列的数据类型必须和主表主键中对应列的数据类型相同。</li><li>被外键引用的列需要唯一。</li></ul><h5 id="创建外键"><a href="#创建外键" class="headerlink" title="创建外键"></a>创建外键</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">[<span class="hljs-keyword">CONSTRAINT</span> constraint_name]<br><span class="hljs-keyword">FOREIGN KEY</span> [foreign_key_name] (column_name, ...)<br><span class="hljs-keyword">REFERENCES</span> parent_table(colunm_name,...)<br>[<span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> reference_option]<br>[<span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> reference_option]<br></code></pre></td></tr></table></figure><p>MySQL 有五个引用选项： <code>CASCADE</code> 、 <code>SET NULL</code> 、 <code>NO ACTION</code> 、 <code>RESTRICT</code>和<code>SET DEFAULT</code> 。</p><ul><li><code>CASCADE</code> ：如果父表中的一行被删除或更新，子表中匹配行的值将自​​动删除或更新。</li><li><code>SET NULL</code> ：如果删除或更新父表中的行，则子表中的外键列（或多列）的值将设置为<code>NULL</code> 。</li><li><code>RESTRICT</code> ：如果父表中的行在子表中具有匹配的行，则 MySQL 拒绝删除或更新父表中的行。</li><li><code>NO ACTION</code> ：与<code>RESTRICT</code>相同。</li><li><code>SET DEFAULT</code> ：被 MySQL 解析器识别。但是，此操作会被 InnoDB 和 NDB 表拒绝。</li></ul><p>事实上，MySQL 完全支持三种操作： <code>RESTRICT</code> 、 <code>CASCADE</code>和<code>SET NULL</code> 。</p><p>如果未指定<code>ON DELETE</code>和<code>ON UPDATE</code>子句，则默认操作为<code>RESTRICT</code> 。</p><p>首先创建主表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create table</span> `Product List` (<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> id <span class="hljs-type">int</span> <span class="hljs-keyword">primary key</span> auto_increment,<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> catagoryID <span class="hljs-type">int</span> <span class="hljs-keyword">not null</span>,<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> detail <span class="hljs-type">int</span> <span class="hljs-keyword">not null</span> <span class="hljs-keyword">check</span>(detail <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>)<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> );<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create table</span> `Catagory List` (<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> name <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">primary key</span>,<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> catagoryID <span class="hljs-type">int</span>,<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">constraint</span> fkProduct <span class="hljs-keyword">foreign key</span> (catagoryID) <span class="hljs-keyword">references</span> `Product List`(catagoryID)<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> );<br>ERROR <span class="hljs-number">6125</span> (HY000): Failed <span class="hljs-keyword">to</span> <span class="hljs-keyword">add</span> the <span class="hljs-keyword">foreign key</span> constraint. Missing <span class="hljs-keyword">unique</span> key <span class="hljs-keyword">for</span> <span class="hljs-keyword">constraint</span> <span class="hljs-string">&#x27;fkProduct&#x27;</span> <span class="hljs-keyword">in</span> the referenced <span class="hljs-keyword">table</span> <span class="hljs-string">&#x27;Product List&#x27;</span><br></code></pre></td></tr></table></figure><p>报错了 因为<strong>外键</strong>引用的列 需要唯一</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">alter table</span> `Product List` modify <span class="hljs-keyword">column</span> catagoryID <span class="hljs-type">int</span> <span class="hljs-keyword">not null</span> <span class="hljs-keyword">unique</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br>Records: <span class="hljs-number">0</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create table</span> `Catagory List` ( name <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">primary key</span>, catagoryID <span class="hljs-type">int</span>, <span class="hljs-keyword">constraint</span> `fk_product` <span class="hljs-keyword">foreign key</span> (catagoryID) <span class="hljs-keyword">references</span> `Product List`(catagoryID) );<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">desc</span> `Product List`;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------+------+------+-----+---------+----------------+</span><br><span class="hljs-operator">|</span> Field      <span class="hljs-operator">|</span> Type <span class="hljs-operator">|</span> <span class="hljs-keyword">Null</span> <span class="hljs-operator">|</span> Key <span class="hljs-operator">|</span> <span class="hljs-keyword">Default</span> <span class="hljs-operator">|</span> Extra          <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------+------+------+-----+---------+----------------+</span><br><span class="hljs-operator">|</span> id         <span class="hljs-operator">|</span> <span class="hljs-type">int</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">NO</span>   <span class="hljs-operator">|</span> PRI <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span> auto_increment <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> catagoryID <span class="hljs-operator">|</span> <span class="hljs-type">int</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">NO</span>   <span class="hljs-operator">|</span> UNI <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> detail     <span class="hljs-operator">|</span> <span class="hljs-type">int</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">NO</span>   <span class="hljs-operator">|</span>     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------+------+------+-----+---------+----------------+</span><br><span class="hljs-number">3</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">desc</span> `Catagory List`;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------+-------------+------+-----+---------+-------+</span><br><span class="hljs-operator">|</span> Field      <span class="hljs-operator">|</span> Type        <span class="hljs-operator">|</span> <span class="hljs-keyword">Null</span> <span class="hljs-operator">|</span> Key <span class="hljs-operator">|</span> <span class="hljs-keyword">Default</span> <span class="hljs-operator">|</span> Extra <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------+-------------+------+-----+---------+-------+</span><br><span class="hljs-operator">|</span> name       <span class="hljs-operator">|</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-operator">|</span> <span class="hljs-keyword">NO</span>   <span class="hljs-operator">|</span> PRI <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> catagoryID <span class="hljs-operator">|</span> <span class="hljs-type">int</span>         <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span> MUL <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------+-------------+------+-----+---------+-------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>插入数据测试</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> `Product List`(id,catagoryID,detail) <span class="hljs-keyword">values</span> (<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">10</span>), (<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">11</span>);<br>Query OK, <span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br>Records: <span class="hljs-number">2</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `Product List`;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------+--------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> catagoryID <span class="hljs-operator">|</span> detail <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------+--------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span>     <span class="hljs-number">10</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span>          <span class="hljs-number">2</span> <span class="hljs-operator">|</span>     <span class="hljs-number">11</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------+--------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec) <br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span>  `Catagory List`(name,catagoryID) <span class="hljs-keyword">values</span> (&quot;Apple&quot;,<span class="hljs-number">1</span>),(&quot;banana&quot;,<span class="hljs-number">2</span>);<br>Query OK, <span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br>Records: <span class="hljs-number">2</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span>  `Catagory List`(name,catagoryID) <span class="hljs-keyword">values</span> (&quot;Shit&quot;,<span class="hljs-number">4</span>);<br>ERROR <span class="hljs-number">1452</span> (<span class="hljs-number">23000</span>): Cannot <span class="hljs-keyword">add</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">update</span> a child <span class="hljs-type">row</span>: a <span class="hljs-keyword">foreign key</span> <span class="hljs-keyword">constraint</span> fails (`testDB`.`Catagory List`, <span class="hljs-keyword">CONSTRAINT</span> `fk_product` <span class="hljs-keyword">FOREIGN KEY</span> (`catagoryID`) <span class="hljs-keyword">REFERENCES</span> `Product List` (`catagoryID`)) <br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `Catagory List`;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------+------------+</span><br><span class="hljs-operator">|</span> name   <span class="hljs-operator">|</span> catagoryID <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------+------------+</span><br><span class="hljs-operator">|</span> Apple  <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> banana <span class="hljs-operator">|</span>          <span class="hljs-number">2</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------+------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span>  `Product List` <span class="hljs-keyword">where</span> catagoryID <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>ERROR <span class="hljs-number">1451</span> (<span class="hljs-number">23000</span>): Cannot <span class="hljs-keyword">delete</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">update</span> a parent <span class="hljs-type">row</span>: a <span class="hljs-keyword">foreign key</span> <span class="hljs-keyword">constraint</span> fails (`testDB`.`Catagory List`, <span class="hljs-keyword">CONSTRAINT</span> `fk_product` <span class="hljs-keyword">FOREIGN KEY</span> (`catagoryID`) <span class="hljs-keyword">REFERENCES</span> `Product List` (`catagoryID`))  <br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">update</span> `Product List` <span class="hljs-keyword">set</span> catagoryID <span class="hljs-operator">=</span> <span class="hljs-number">4</span> <span class="hljs-keyword">where</span> catagoryID <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>ERROR <span class="hljs-number">1451</span> (<span class="hljs-number">23000</span>): Cannot <span class="hljs-keyword">delete</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">update</span> a parent <span class="hljs-type">row</span>: a <span class="hljs-keyword">foreign key</span> <span class="hljs-keyword">constraint</span> fails (`testDB`.`Catagory List`, <span class="hljs-keyword">CONSTRAINT</span> `fk_product` <span class="hljs-keyword">FOREIGN KEY</span> (`catagoryID`) <span class="hljs-keyword">REFERENCES</span> `Product List` (`catagoryID`))<br></code></pre></td></tr></table></figure><p>只有存在于主表 <code>Product List</code>中 <code>catagory</code> 列中的数据 才能添加到从表中</p><p>因为我们没有指定主表和从表之间的级联关系 默认是RESTRICT,主表是是无法update存在的数据</p><p>    <code>RESTRICT</code> ：如果父表中的行在子表中具有匹配的行，则 MySQL 拒绝删除或更新父表中的行。</p><h5 id="完整性"><a href="#完整性" class="headerlink" title="完整性"></a>完整性</h5><h6 id="CASCAED"><a href="#CASCAED" class="headerlink" title="CASCAED"></a>CASCAED</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> <span class="hljs-keyword">create table</span> `Catagory List`\G<br><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-number">1.</span> <span class="hljs-type">row</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><br>       <span class="hljs-keyword">Table</span>: Catagory List<br><span class="hljs-keyword">Create Table</span>: <span class="hljs-keyword">CREATE TABLE</span> `Catagory List` (<br>  `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT NULL</span>,<br>  `catagoryID` <span class="hljs-type">int</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY KEY</span> (`name`),<br>  KEY `fk_product` (`catagoryID`),<br>  <span class="hljs-keyword">CONSTRAINT</span> `fk_product` <span class="hljs-keyword">FOREIGN KEY</span> (`catagoryID`) <span class="hljs-keyword">REFERENCES</span> `Product List` (`catagoryID`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_0900_ai_ci<br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> `Catagory List`;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span>  <span class="hljs-keyword">CREATE TABLE</span> `Catagory List` (   `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT NULL</span>,   `catagoryID` <span class="hljs-type">int</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,   <span class="hljs-keyword">PRIMARY KEY</span> (`name`),   KEY `fk_product` (`catagoryID`),   <span class="hljs-keyword">CONSTRAINT</span> `fk_product` <span class="hljs-keyword">FOREIGN KEY</span> (`catagoryID`) <span class="hljs-keyword">REFERENCES</span> `Product List` (`catagoryID`)  <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> CASCADE );<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `Catagory List`;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------+------------+</span><br><span class="hljs-operator">|</span> name   <span class="hljs-operator">|</span> catagoryID <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------+------------+</span><br><span class="hljs-operator">|</span> Apple  <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> banana <span class="hljs-operator">|</span>          <span class="hljs-number">2</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------+------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>现在更新主表<code>Apple</code>的<code>CatagoryID</code>为100 根据<code>CASCADE</code>的规则 从表会随着父表更新</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">update</span> `Product List` <span class="hljs-keyword">set</span> catagoryID <span class="hljs-operator">=</span> <span class="hljs-number">100</span> <span class="hljs-keyword">where</span> catagoryID <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.01</span> sec)<br><span class="hljs-keyword">Rows</span> matched: <span class="hljs-number">1</span>  Changed: <span class="hljs-number">1</span>  Warnings: <span class="hljs-number">0</span><br><br>mysql<span class="hljs-operator">&gt;</span>  <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `Catagory List`;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------+------------+</span><br><span class="hljs-operator">|</span> name   <span class="hljs-operator">|</span> catagoryID <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------+------------+</span><br><span class="hljs-operator">|</span> banana <span class="hljs-operator">|</span>          <span class="hljs-number">2</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> Apple  <span class="hljs-operator">|</span>        <span class="hljs-number">100</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------+------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)  <br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> `Product List` <span class="hljs-keyword">where</span> catagoryID <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span>  <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `Catagory List`;<br><span class="hljs-operator">+</span><span class="hljs-comment">-------+------------+</span><br><span class="hljs-operator">|</span> name  <span class="hljs-operator">|</span> catagoryID <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+------------+</span><br><span class="hljs-operator">|</span> Apple <span class="hljs-operator">|</span>        <span class="hljs-number">100</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span>  <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `Product List`;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------+--------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> catagoryID <span class="hljs-operator">|</span> detail <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------+--------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span>        <span class="hljs-number">100</span> <span class="hljs-operator">|</span>     <span class="hljs-number">10</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------+--------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><h6 id="set-null"><a href="#set-null" class="headerlink" title="set null"></a>set null</h6><p>顾名思义 再主表更新时 将从表对应的字段设置为<code>null</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span>  <span class="hljs-keyword">CREATE TABLE</span> `Catagory List` (<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>   `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>   `catagoryID` <span class="hljs-type">int</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>   <span class="hljs-keyword">PRIMARY KEY</span> (`name`),<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>   KEY `fk_product` (`catagoryID`),<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>   <span class="hljs-keyword">CONSTRAINT</span> `fk_product` <span class="hljs-keyword">FOREIGN KEY</span> (`catagoryID`) <span class="hljs-keyword">REFERENCES</span> `Product List` (`catagoryID`) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">ON</span><br> <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">null</span> );<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec) <br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `Product List`;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------+--------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> catagoryID <span class="hljs-operator">|</span> detail <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------+--------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span>        <span class="hljs-number">100</span> <span class="hljs-operator">|</span>     <span class="hljs-number">10</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------+--------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> `Catagory List` <span class="hljs-keyword">values</span> (<span class="hljs-string">&#x27;apple&#x27;</span>,<span class="hljs-number">100</span>);<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `Catagory List`;<br><span class="hljs-operator">+</span><span class="hljs-comment">-------+------------+</span><br><span class="hljs-operator">|</span> name  <span class="hljs-operator">|</span> catagoryID <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+------------+</span><br><span class="hljs-operator">|</span> apple <span class="hljs-operator">|</span>        <span class="hljs-number">100</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">update</span> `Product List` <span class="hljs-keyword">set</span> catagoryID <span class="hljs-operator">=</span> <span class="hljs-number">200</span> <span class="hljs-keyword">where</span> catagoryID <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.01</span> sec)<br><br><span class="hljs-keyword">Rows</span> matched: <span class="hljs-number">1</span>  Changed: <span class="hljs-number">1</span>  Warnings: <span class="hljs-number">0</span>   <br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> `Product List` <span class="hljs-keyword">values</span> (<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">50</span>);<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> `Catagory List` <span class="hljs-keyword">values</span> (<span class="hljs-string">&#x27;shit&#x27;</span>,<span class="hljs-number">2</span>);<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `Product List` <span class="hljs-keyword">AS</span> Product;<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `Catagory List`;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------+--------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> catagoryID <span class="hljs-operator">|</span> detail <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------+--------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span>        <span class="hljs-number">200</span> <span class="hljs-operator">|</span>     <span class="hljs-number">10</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span>          <span class="hljs-number">2</span> <span class="hljs-operator">|</span>     <span class="hljs-number">50</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------+--------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+------------+</span><br><span class="hljs-operator">|</span> name  <span class="hljs-operator">|</span> catagoryID <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+------------+</span><br><span class="hljs-operator">|</span> apple <span class="hljs-operator">|</span>       <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> shit  <span class="hljs-operator">|</span>          <span class="hljs-number">2</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">update</span> `Product List` <span class="hljs-keyword">set</span> catagoryID <span class="hljs-operator">=</span> <span class="hljs-number">20</span> <span class="hljs-keyword">where</span> catagoryID <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.01</span> sec)<br><span class="hljs-keyword">Rows</span> matched: <span class="hljs-number">1</span>  Changed: <span class="hljs-number">1</span>  Warnings: <span class="hljs-number">0</span><br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `Product List` <span class="hljs-keyword">AS</span> Product;<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `Catagory List`;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------+--------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> catagoryID <span class="hljs-operator">|</span> detail <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------+--------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span>        <span class="hljs-number">200</span> <span class="hljs-operator">|</span>     <span class="hljs-number">10</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span>         <span class="hljs-number">20</span> <span class="hljs-operator">|</span>     <span class="hljs-number">50</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------+--------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+------------+</span><br><span class="hljs-operator">|</span> name  <span class="hljs-operator">|</span> catagoryID <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+------------+</span><br><span class="hljs-operator">|</span> apple <span class="hljs-operator">|</span>       <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> shit  <span class="hljs-operator">|</span>       <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>删除主表<code>Product List</code>列的字段 从表中<code>CatagoryID</code>列的对应字段就会设置为<code>NULL</code></p><h5 id="删除外键"><a href="#删除外键" class="headerlink" title="删除外键"></a>删除外键</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> <span class="hljs-keyword">create table</span> `Catagory List`\G<br><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-number">1.</span> <span class="hljs-type">row</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><br>       <span class="hljs-keyword">Table</span>: Catagory List<br><span class="hljs-keyword">Create Table</span>: <span class="hljs-keyword">CREATE TABLE</span> `Catagory List` (<br>  `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT NULL</span>,<br>  `catagoryID` <span class="hljs-type">int</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY KEY</span> (`name`),<br>  KEY `fk_product` (`catagoryID`),<br>  <span class="hljs-keyword">CONSTRAINT</span> `fk_product` <span class="hljs-keyword">FOREIGN KEY</span> (`catagoryID`) <span class="hljs-keyword">REFERENCES</span> `Product List` (`catagoryID`) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">SET</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">SET</span> <span class="hljs-keyword">NULL</span><br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_0900_ai_ci<br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">alter table</span> `Catagory List` <span class="hljs-keyword">drop</span> <span class="hljs-keyword">foreign key</span> fk_product;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.01</span> sec)<br>Records: <span class="hljs-number">0</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><h3 id="使用列生成列"><a href="#使用列生成列" class="headerlink" title="使用列生成列"></a>使用列生成列</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-built_in">column_name</span> data_type [<span class="hljs-keyword">GENERATED</span> <span class="hljs-keyword">ALWAYS</span>] <span class="hljs-keyword">AS</span> (expression)<br>   [VIRTUAL | STORED] [<span class="hljs-keyword">UNIQUE</span> [KEY]]<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create table t3 ( id int not null auto_increment primary key, firtName varchar(10) not null,<br>lastName varchar(10) not null, fullName varchar(21) generated always as (concat(firtName,&#x27; &#x27;,lastName)));<br>Query OK, 0 rows affected (0.08 sec)<br><br>mysql&gt; show columns from t3; <br>+----------+-------------+------+-----+---------+-------------------+<br>| Field    | Type        | Null | Key | Default | Extra             |<br>+----------+-------------+------+-----+---------+-------------------+<br>| id       | int         | NO   | PRI | NULL    | auto_increment    |<br>| firtName | varchar(10) | NO   |     | NULL    |                   |<br>| lastName | varchar(10) | NO   |     | NULL    |                   |<br>| fullName | varchar(21) | YES  |     | NULL    | VIRTUAL GENERATED |<br>+----------+-------------+------+-----+---------+-------------------+<br>4 rows in set (0.00 sec)<br><br>mysql&gt; insert into t3(firtName,lastName) values (&quot;Zhang&quot;,&quot;San&quot;);<br>Query OK, 1 row affected (0.05 sec)<br><br>mysql&gt; select * from t3; <br>+----+----------+----------+-----------+<br>| id | firtName | lastName | fullName  |<br>+----+----------+----------+-----------+<br>|  1 | Zhang    | San      | Zhang San |<br>+----+----------+----------+-----------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; alter table t3 add column alias varchar(15) generated always as (concat(&#x27;Dear&#x27;,&#x27; &#x27;,lastName));<br>Query OK, 0 rows affected (0.06 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt; show columns from t3;<br>+----------+-------------+------+-----+---------+-------------------+<br>| Field    | Type        | Null | Key | Default | Extra             |<br>+----------+-------------+------+-----+---------+-------------------+<br>| id       | int         | NO   | PRI | NULL    | auto_increment    |<br>| firtName | varchar(10) | NO   |     | NULL    |                   |<br>| lastName | varchar(10) | NO   |     | NULL    |                   |<br>| fullName | varchar(21) | YES  |     | NULL    | VIRTUAL GENERATED |<br>| alias    | varchar(15) | YES  |     | NULL    | VIRTUAL GENERATED |<br>+----------+-------------+------+-----+---------+-------------------+<br>5 rows in set (0.00 sec)<br><br>mysql&gt; select * from t3;<br>+----+----------+----------+-----------+----------+<br>| id | firtName | lastName | fullName  | alias    |<br>+----+----------+----------+-----------+----------+<br>|  1 | Zhang    | San      | Zhang San | Dear San |<br>+----+----------+----------+-----------+----------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><h2 id="复制表"><a href="#复制表" class="headerlink" title="复制表"></a>复制表</h2><h3 id="仅复制表"><a href="#仅复制表" class="headerlink" title="仅复制表"></a>仅复制表</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create table t2 like t1; <br>Query OK, 0 rows affected (0.08 sec)<br><br>mysql&gt; show tables;<br>+-----------------+<br>| Tables_in_test1 |<br>+-----------------+<br>| t1              |<br>| t2              |<br>+-----------------+<br>2 rows in set (0.00 sec)<br><br>mysql&gt; select * from t2;<br>Empty set (0.00 sec)<br><br>mysql&gt; select * from t1;<br>+----+-----------+-----+<br>| id | name      | age |<br>+----+-----------+-----+<br>|  1 | ZhangSan  |   0 |<br>|  2 | LiSi      |   0 |<br>|  3 | ZhangSan2 |   0 |<br>|  5 | ZhangSan3 |   0 |<br>+----+-----------+-----+<br>4 rows in set (0.00 sec)<br><br></code></pre></td></tr></table></figure><h3 id="复制表和数据"><a href="#复制表和数据" class="headerlink" title="复制表和数据"></a>复制表和数据</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show tables; <br>+-------------------------+<br>| Tables_in_classicmodels |<br>+-------------------------+<br>| customers               |<br>| employees               |<br>| offices                 |<br>| orderdetails            |<br>| orders                  |<br>| payments                |<br>| productlines            |<br>| products                |<br>| tables1                 |<br>+-------------------------+<br>9 rows in set (0.00 sec)<br><br>mysql&gt; create table test1.testT1 (select * from tables1);<br>Query OK, 4 rows affected (0.09 sec)<br>Records: 4  Duplicates: 0  Warnings: 0<br><br>mysql&gt; check table test1.testT1;<br>+--------------+-------+----------+----------+<br>| Table        | Op    | Msg_type | Msg_text |<br>+--------------+-------+----------+----------+<br>| test1.testT1 | check | status   | OK       |<br>+--------------+-------+----------+----------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select * from test1.testT1; <br>+----+-----------+-----+<br>| id | name      | age |<br>+----+-----------+-----+<br>|  1 | ZhangSan  |   0 |<br>|  2 | LiSi      |   0 |<br>|  3 | ZhangSan2 |   0 |<br>|  5 | ZhangSan3 |   0 |<br>+----+-----------+-----+<br>4 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h2 id="删除表"><a href="#删除表" class="headerlink" title="删除表"></a>删除表</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show tables; <br>+-------------------------+<br>| Tables_in_classicmodels |<br>+-------------------------+<br>| customers               |<br>| employees               |<br>| offices                 |<br>| orderdetails            |<br>| orders                  |<br>| payments                |<br>| productlines            |<br>| products                |<br>| tables1                 |<br>+-------------------------+<br>9 rows in set (0.00 sec)<br><br>mysql&gt; drop table tables1;<br>Query OK, 0 rows affected (0.06 sec)<br><br>mysql&gt; show tables like &quot;tables1&quot;;<br>Empty set (0.00 sec)<br></code></pre></td></tr></table></figure><h2 id="重命名表"><a href="#重命名表" class="headerlink" title="重命名表"></a>重命名表</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show tables; <br>+-----------------+<br>| Tables_in_test1 |<br>+-----------------+<br>| testT1          |<br>+-----------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; rename table testT1 to T1;<br>Query OK, 0 rows affected (0.08 sec)<br><br>mysql&gt; show tables;<br>+-----------------+<br>| Tables_in_test1 |<br>+-----------------+<br>| T1              |<br>+-----------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; alter table T1 rename to t1; <br>Query OK, 0 rows affected (0.07 sec)<br><br>mysql&gt; show tables;<br>+-----------------+<br>| Tables_in_test1 |<br>+-----------------+<br>| t1              |<br>+-----------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><h1 id="DML"><a href="#DML" class="headerlink" title="DML"></a>DML</h1><h2 id="insert"><a href="#insert" class="headerlink" title="insert"></a>insert</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> T1(id,name) <span class="hljs-keyword">values</span> (<span class="hljs-number">1</span>,&quot;ZhangSan&quot;);<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> T1 <span class="hljs-keyword">values</span> (<span class="hljs-number">2</span>,&quot;LiSi&quot;),(<span class="hljs-number">3</span>,&quot;WangWu&quot;);<br>Query OK, <span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br>Records: <span class="hljs-number">2</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> T1; <br><span class="hljs-operator">+</span><span class="hljs-comment">----+----------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> name     <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+----------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> ZhangSan <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span> LiSi     <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">3</span> <span class="hljs-operator">|</span> WangWu   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+----------+</span><br><span class="hljs-number">3</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; use testDB; <br>Database changed<br>mysql&gt; create table t1 ( <br>    -&gt; id int primary key auto_increment, <br>    -&gt; name varchar(10) not null, <br>    -&gt; date date not null) <br>    -&gt; character set utf8 engine=MYISAM; <br>Query OK, 0 rows affected, 1 warning (0.03 sec)<br><br>mysql&gt; insert into t1 values (1,&#x27;ZS&#x27;,&#x27;2021-8-9&#x27;),(2,&#x27;LiSi&#x27;,current_time());<br>Query OK, 2 rows affected, 1 warning (0.03 sec)<br>Records: 2  Duplicates: 0  Warnings: 1<br><br>mysql&gt; select * from t1; <br>+----+------+------------+<br>| id | name | date       |<br>+----+------+------------+<br>|  1 | ZS   | 2021-08-09 |<br>|  2 | LiSi | 2024-07-30 |<br>+----+------+------------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h2 id="insert-into-select"><a href="#insert-into-select" class="headerlink" title="insert into select"></a>insert into select</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">truncate</span> t1;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t2;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+--------+------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> name   <span class="hljs-operator">|</span> <span class="hljs-type">date</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+--------+------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> ZS     <span class="hljs-operator">|</span> <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-09</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span> LiSi   <span class="hljs-operator">|</span> <span class="hljs-number">2024</span><span class="hljs-number">-07</span><span class="hljs-number">-30</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">3</span> <span class="hljs-operator">|</span> WangWu <span class="hljs-operator">|</span> <span class="hljs-number">2024</span><span class="hljs-number">-07</span><span class="hljs-number">-30</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">4</span> <span class="hljs-operator">|</span> MaZi   <span class="hljs-operator">|</span> <span class="hljs-number">2024</span><span class="hljs-number">-07</span><span class="hljs-number">-30</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+--------+------------+</span><br><span class="hljs-number">4</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> t1(name,<span class="hljs-type">date</span>) <span class="hljs-keyword">select</span> name,<span class="hljs-type">date</span> <span class="hljs-keyword">from</span> t2 <span class="hljs-keyword">where</span> id <span class="hljs-operator">&gt;</span> <span class="hljs-number">2</span>; <br>Query OK, <span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br>Records: <span class="hljs-number">2</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t1;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+--------+------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> name   <span class="hljs-operator">|</span> <span class="hljs-type">date</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+--------+------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> WangWu <span class="hljs-operator">|</span> <span class="hljs-number">2024</span><span class="hljs-number">-07</span><span class="hljs-number">-30</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span> MaZi   <span class="hljs-operator">|</span> <span class="hljs-number">2024</span><span class="hljs-number">-07</span><span class="hljs-number">-30</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+--------+------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><h2 id="INSERT-INTO-ON-DUPLICATE-KEY-UPDATE"><a href="#INSERT-INTO-ON-DUPLICATE-KEY-UPDATE" class="headerlink" title="INSERT INTO ON DUPLICATE KEY UPDATE"></a>INSERT INTO ON DUPLICATE KEY UPDATE</h2><p>在插入的数据中 因为<code>unique</code>和主键的约束 导致一些值无法插入 可以使用<code>INSERT INTO ON DUPLICATE KEY UPDATE</code>更新插入错误数据的其他值</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> <span class="hljs-keyword">create table</span> t3\G<br><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-number">1.</span> <span class="hljs-type">row</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><br>       <span class="hljs-keyword">Table</span>: t3<br><span class="hljs-keyword">Create Table</span>: <span class="hljs-keyword">CREATE TABLE</span> `t3` (<br>  `id` <span class="hljs-type">int</span> <span class="hljs-keyword">NOT NULL</span> AUTO_INCREMENT,<br>  `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT NULL</span>,<br>  `emails` <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT NULL</span>,<br>  <span class="hljs-keyword">PRIMARY KEY</span> (`id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `emails` (`emails`)<br>) ENGINE<span class="hljs-operator">=</span>MyISAM AUTO_INCREMENT<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb3<br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> t3(name,emails)  <span class="hljs-keyword">values</span> (<span class="hljs-string">&#x27;ZhangSan&#x27;</span>,<span class="hljs-string">&#x27;1@qq.com&#x27;</span>),(<span class="hljs-string">&#x27;LiSi&#x27;</span>,<span class="hljs-string">&#x27;1@qq.com&#x27;</span>); <br>ERROR <span class="hljs-number">1062</span> (<span class="hljs-number">23000</span>): Duplicate entry <span class="hljs-string">&#x27;1@qq.com&#x27;</span> <span class="hljs-keyword">for</span> key <span class="hljs-string">&#x27;t3.emails&#x27;</span><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t3; <br><span class="hljs-operator">+</span><span class="hljs-comment">----+----------+----------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> name     <span class="hljs-operator">|</span> emails   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+----------+----------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> ZhangSan <span class="hljs-operator">|</span> <span class="hljs-number">1</span><span class="hljs-variable">@qq</span>.com <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+----------+----------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> t3(name,emails) <span class="hljs-keyword">values</span> (&quot;asd&quot;,&quot;1@qq.com&quot;) <span class="hljs-keyword">on</span> duplicate key <span class="hljs-keyword">update</span> name<span class="hljs-operator">=</span><span class="hljs-keyword">values</span>(name); <br>Query OK, <span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> affected, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t3;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+----------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span> emails   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+----------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> asd  <span class="hljs-operator">|</span> <span class="hljs-number">1</span><span class="hljs-variable">@qq</span>.com <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+----------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; insert into t3 values (1,&quot;ZhangSan&quot;,&quot;1@qq.com&quot;),(2,&quot;LiSi&quot;,&quot;1@qq.com&quot;) on duplicate key update name=values(name);<br>Query OK, 3 rows affected, 1 warning (0.02 sec)<br>Records: 2  Duplicates: 1  Warnings: 1<br><br>mysql&gt; select * from t3; <br>+----+------+----------+<br>| id | name | emails   |<br>+----+------+----------+<br>|  1 | LiSi | 1@qq.com |<br>+----+------+----------+<br>1 row in set (0.00 sec)<br><br></code></pre></td></tr></table></figure><h2 id="MySQL-INSERT-IGNORE-Statement"><a href="#MySQL-INSERT-IGNORE-Statement" class="headerlink" title="MySQL INSERT IGNORE Statement"></a>MySQL INSERT IGNORE Statement</h2><p>在插入数据无效时的处理</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show create table t4\G<br>*************************** 1. row ***************************<br>       Table: t4<br>Create Table: CREATE TABLE `t4` (<br>  `name` varchar(10) NOT NULL,<br>  `age` int NOT NULL,<br>  PRIMARY KEY (`name`),<br>  CONSTRAINT `t4_chk_1` CHECK ((`age` &gt; 18))<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci<br>1 row in set (0.00 sec)<br><br>mysql&gt; insert into t4 values (&#x27;zs&#x27;,18),(&#x27;ls&#x27;,15); <br>ERROR 3819 (HY000): Check constraint &#x27;t4_chk_1&#x27; is violated.<br><br>mysql&gt; select * from t4; <br>Empty set (0.01 sec)<br><br>mysql&gt; insert ignore into t4 values (&#x27;zs&#x27;,19),(&#x27;ls&#x27;,15);<br>Query OK, 1 row affected, 1 warning (0.03 sec)<br>Records: 1  Duplicates: 0  Warnings: 1<br><br>mysql&gt; select * from t4;<br>+------+-----+<br>| name | age |<br>+------+-----+<br>| zs   |  19 |<br>+------+-----+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create table</span> t5 (name <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">unique</span> <span class="hljs-keyword">not null</span>,age <span class="hljs-type">int</span> <span class="hljs-keyword">not null</span>);<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.09</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> t5 <span class="hljs-keyword">values</span> (<span class="hljs-string">&#x27;zs&#x27;</span>,<span class="hljs-number">2</span>),(<span class="hljs-string">&#x27;zs&#x27;</span>,<span class="hljs-number">4</span>);<br>ERROR <span class="hljs-number">1062</span> (<span class="hljs-number">23000</span>): Duplicate entry <span class="hljs-string">&#x27;zs&#x27;</span> <span class="hljs-keyword">for</span> key <span class="hljs-string">&#x27;t5.name&#x27;</span><br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t5;<br><span class="hljs-keyword">Empty</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert</span> ignore <span class="hljs-keyword">into</span> t5 <span class="hljs-keyword">values</span> (<span class="hljs-string">&#x27;zs&#x27;</span>,<span class="hljs-number">2</span>),(<span class="hljs-string">&#x27;zs&#x27;</span>,<span class="hljs-number">4</span>);<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.02</span> sec)<br>Records: <span class="hljs-number">2</span>  Duplicates: <span class="hljs-number">1</span>  Warnings: <span class="hljs-number">1</span><br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t5;<br><span class="hljs-operator">+</span><span class="hljs-comment">------+-----+</span><br><span class="hljs-operator">|</span> name <span class="hljs-operator">|</span> age <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+-----+</span><br><span class="hljs-operator">|</span> zs   <span class="hljs-operator">|</span>   <span class="hljs-number">2</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+-----+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br></code></pre></td></tr></table></figure><h2 id="update"><a href="#update" class="headerlink" title="update"></a>update</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create table</span> t6 (name <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">primary key</span>, gender enum(&quot;m&quot;,&quot;w&quot;) <span class="hljs-keyword">default</span>(&quot;m&quot;),age <span class="hljs-type">int</span> <span class="hljs-keyword">not null</span>); <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.05</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span>  t6 <span class="hljs-keyword">values</span> (<span class="hljs-string">&#x27;zs&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-number">18</span>),(<span class="hljs-string">&#x27;ls&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>,<span class="hljs-number">29</span>);<br>Query OK, <span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br>Records: <span class="hljs-number">2</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t6; <br><span class="hljs-operator">+</span><span class="hljs-comment">------+--------+-----+</span><br><span class="hljs-operator">|</span> name <span class="hljs-operator">|</span> gender <span class="hljs-operator">|</span> age <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+--------+-----+</span><br><span class="hljs-operator">|</span> ls   <span class="hljs-operator">|</span> w      <span class="hljs-operator">|</span>  <span class="hljs-number">29</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> zs   <span class="hljs-operator">|</span> m      <span class="hljs-operator">|</span>  <span class="hljs-number">18</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+--------+-----+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">update</span> t6 <span class="hljs-keyword">set</span> age<span class="hljs-operator">=</span><span class="hljs-number">10</span> <span class="hljs-keyword">where</span> name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;ls&#x27;</span>;<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.02</span> sec)<br><span class="hljs-keyword">Rows</span> matched: <span class="hljs-number">1</span>  Changed: <span class="hljs-number">1</span>  Warnings: <span class="hljs-number">0</span><br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">update</span> t6 <span class="hljs-keyword">set</span> age<span class="hljs-operator">=</span><span class="hljs-number">15</span>,gender<span class="hljs-operator">=</span><span class="hljs-string">&#x27;w&#x27;</span> <span class="hljs-keyword">where</span> name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;zs&#x27;</span>;<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.03</span> sec)<br><span class="hljs-keyword">Rows</span> matched: <span class="hljs-number">1</span>  Changed: <span class="hljs-number">1</span>  Warnings: <span class="hljs-number">0</span><br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t6; <br><span class="hljs-operator">+</span><span class="hljs-comment">------+--------+-----+</span><br><span class="hljs-operator">|</span> name <span class="hljs-operator">|</span> gender <span class="hljs-operator">|</span> age <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+--------+-----+</span><br><span class="hljs-operator">|</span> ls   <span class="hljs-operator">|</span> w      <span class="hljs-operator">|</span>  <span class="hljs-number">10</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> zs   <span class="hljs-operator">|</span> w      <span class="hljs-operator">|</span>  <span class="hljs-number">15</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+--------+-----+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><h2 id="delete-truncate"><a href="#delete-truncate" class="headerlink" title="delete &amp; truncate"></a>delete &amp; truncate</h2><p>delete: 删除多行数据</p><p>truncate: 清除表中全部数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t7; <br><span class="hljs-operator">+</span><span class="hljs-comment">------+--------+-----+</span><br><span class="hljs-operator">|</span> name <span class="hljs-operator">|</span> gender <span class="hljs-operator">|</span> age <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+--------+-----+</span><br><span class="hljs-operator">|</span> ls   <span class="hljs-operator">|</span> w      <span class="hljs-operator">|</span>  <span class="hljs-number">10</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> zs   <span class="hljs-operator">|</span> w      <span class="hljs-operator">|</span>  <span class="hljs-number">15</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> ww   <span class="hljs-operator">|</span> m      <span class="hljs-operator">|</span>   <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> wmz  <span class="hljs-operator">|</span> m      <span class="hljs-operator">|</span>  <span class="hljs-number">15</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+--------+-----+</span><br><span class="hljs-number">4</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> t7 <span class="hljs-keyword">where</span> age<span class="hljs-operator">=</span><span class="hljs-number">15</span> <span class="hljs-keyword">and</span> gender<span class="hljs-operator">=</span><span class="hljs-string">&#x27;m&#x27;</span>;<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.20</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">truncate</span> t7; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.07</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t7; <br><span class="hljs-keyword">Empty</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><h1 id="DCL"><a href="#DCL" class="headerlink" title="DCL"></a>DCL</h1><h2 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h2><p>MySQL安装是 会自带几个关键数据库 其中mysql.user中就是用户的表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases; <br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql              <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> sys                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-number">4</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> Host,<span class="hljs-keyword">User</span> <span class="hljs-keyword">from</span> mysql.user;<br><span class="hljs-operator">+</span><span class="hljs-comment">-----------+------------------+</span><br><span class="hljs-operator">|</span> Host      <span class="hljs-operator">|</span> <span class="hljs-keyword">User</span>             <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------+------------------+</span><br><span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span> mysql.infoschema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span> mysql.session    <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span> mysql.sys        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span> root             <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------+------------------+</span><br><span class="hljs-number">4</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>用户的格式是 user@host </p><p><code>user</code> 为用户名 <code>host</code> 为连接数据库的主机名</p><h3 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h3><p>创建了两个用户 <code>shanwen</code> 只能在主机名为<code>localhost</code>的主机登陆 而<code>others</code>可以在所有主机上登陆 密码都为qweQWE123..</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> shanwen<span class="hljs-variable">@localhost</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;qweQWE123..&#x27;</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.04</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> others@&quot;%&quot; identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;qweQWE123..&#x27;</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> Host,<span class="hljs-keyword">User</span> <span class="hljs-keyword">from</span> mysql.user;<br><span class="hljs-operator">+</span><span class="hljs-comment">-----------+------------------+</span><br><span class="hljs-operator">|</span> Host      <span class="hljs-operator">|</span> <span class="hljs-keyword">User</span>             <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------+------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span> others           <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span> mysql.infoschema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span> mysql.session    <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span> mysql.sys        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span> root             <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span> shanwen          <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------+------------------+</span><br><span class="hljs-number">6</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec<br></code></pre></td></tr></table></figure><p>其他客户端只能登陆<code>others</code> 用户 不能使用<code>shanwen</code>登陆</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@Client</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uothers <span class="hljs-operator">-</span>pqweQWE123.. <span class="hljs-operator">-</span>h192<span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.101</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>(); <br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>()                 <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------+</span><br><span class="hljs-operator">|</span> others<span class="hljs-variable">@192</span><span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.110</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>[root<span class="hljs-variable">@Client</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>ushanwen <span class="hljs-operator">-</span>pqweQWE123.. <span class="hljs-operator">-</span>h192<span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.101</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br>ERROR <span class="hljs-number">1045</span> (<span class="hljs-number">28000</span>): Access denied <span class="hljs-keyword">for</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;shanwen&#x27;</span>@<span class="hljs-string">&#x27;192.168.100.110&#x27;</span> (<span class="hljs-keyword">using</span> password: YES)<br></code></pre></td></tr></table></figure><p>现在无法进行任何操作 因为没有相关的权限</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> database d1;<br>ERROR <span class="hljs-number">1044</span> (<span class="hljs-number">42000</span>): Access denied <span class="hljs-keyword">for</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;others&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> <span class="hljs-keyword">to</span> database <span class="hljs-string">&#x27;d1&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h3><p>查看存在用户</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>,host <span class="hljs-keyword">from</span> mysql.user; <br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>             <span class="hljs-operator">|</span> host      <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> others           <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.infoschema <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.session    <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.sys        <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> root             <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> shanwen          <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-number">6</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>创建示例用户</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> u1@<span class="hljs-string">&#x27;%&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;qweQWE123..&#x27;</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.05</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> u2@<span class="hljs-string">&#x27;%&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;qweQWE123..&#x27;</span>; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.05</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>,host <span class="hljs-keyword">from</span> mysql.user;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>             <span class="hljs-operator">|</span> host      <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> others           <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> u1               <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> u2               <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.infoschema <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.session    <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.sys        <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> root             <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> shanwen          <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-number">8</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">drop</span> <span class="hljs-keyword">user</span> u1@<span class="hljs-string">&#x27;%&#x27;</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">drop</span> <span class="hljs-keyword">user</span> u2@<span class="hljs-string">&#x27;%&#x27;</span>,shanwen<span class="hljs-variable">@localhost</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.05</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>,host <span class="hljs-keyword">from</span> mysql.user;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>             <span class="hljs-operator">|</span> host      <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> others           <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.infoschema <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.session    <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.sys        <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> root             <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-number">5</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>查看在线进程 </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> processlist \G<br><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-number">1.</span> <span class="hljs-type">row</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><br>     Id: <span class="hljs-number">5</span><br>   <span class="hljs-keyword">User</span>: event_scheduler<br>   Host: localhost<br>     db: <span class="hljs-keyword">NULL</span><br>Command: Daemon<br>   <span class="hljs-type">Time</span>: <span class="hljs-number">2667</span><br>  State: Waiting <span class="hljs-keyword">on</span> <span class="hljs-keyword">empty</span> queue<br>   Info: <span class="hljs-keyword">NULL</span><br><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-number">2.</span> <span class="hljs-type">row</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><br>     Id: <span class="hljs-number">20</span><br>   <span class="hljs-keyword">User</span>: root<br>   Host: localhost<br>     db: <span class="hljs-keyword">NULL</span><br>Command: Query<br>   <span class="hljs-type">Time</span>: <span class="hljs-number">0</span><br>  State: init<br>   Info: <span class="hljs-keyword">show</span> processlist<br><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-number">3.</span> <span class="hljs-type">row</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><br>     Id: <span class="hljs-number">21</span><br>   <span class="hljs-keyword">User</span>: test1<br>   Host: <span class="hljs-number">192.168</span><span class="hljs-number">.100</span><span class="hljs-number">.110</span>:<span class="hljs-number">56274</span><br>     db: <span class="hljs-keyword">NULL</span><br>Command: Sleep<br>   <span class="hljs-type">Time</span>: <span class="hljs-number">11</span><br>  State: <br>   Info: <span class="hljs-keyword">NULL</span><br><span class="hljs-number">3</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p><code>test1</code>仍然在进程中 建议手动<code>kill</code>后<code>drop</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> kill <span class="hljs-number">21</span>; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">drop</span> <span class="hljs-keyword">user</span> test1@<span class="hljs-string">&#x27;%&#x27;</span>; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.04</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> processlist \G<br><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-number">1.</span> <span class="hljs-type">row</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><br>     Id: <span class="hljs-number">5</span><br>   <span class="hljs-keyword">User</span>: event_scheduler<br>   Host: localhost<br>     db: <span class="hljs-keyword">NULL</span><br>Command: Daemon<br>   <span class="hljs-type">Time</span>: <span class="hljs-number">2742</span><br>  State: Waiting <span class="hljs-keyword">on</span> <span class="hljs-keyword">empty</span> queue<br>   Info: <span class="hljs-keyword">NULL</span><br><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-number">2.</span> <span class="hljs-type">row</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><br>     Id: <span class="hljs-number">20</span><br>   <span class="hljs-keyword">User</span>: root<br>   Host: localhost<br>     db: <span class="hljs-keyword">NULL</span><br>Command: Query<br>   <span class="hljs-type">Time</span>: <span class="hljs-number">0</span><br>  State: init<br>   Info: <span class="hljs-keyword">show</span> processlist<br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>客户端</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases; <br>ERROR <span class="hljs-number">2013</span> (HY000): Lost connection <span class="hljs-keyword">to</span> MySQL server during query<br><span class="hljs-keyword">No</span> connection. Trying <span class="hljs-keyword">to</span> reconnect...<br>ERROR <span class="hljs-number">1045</span> (<span class="hljs-number">28000</span>): Access denied <span class="hljs-keyword">for</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;test1&#x27;</span>@<span class="hljs-string">&#x27;192.168.100.110&#x27;</span> (<span class="hljs-keyword">using</span> password: YES)<br>ERROR: <br>Can<span class="hljs-string">&#x27;t connect to the server</span><br></code></pre></td></tr></table></figure><h3 id="更改密码"><a href="#更改密码" class="headerlink" title="更改密码"></a>更改密码</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>,host <span class="hljs-keyword">from</span> mysql.user;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>             <span class="hljs-operator">|</span> host      <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> others           <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> shanwen          <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.infoschema <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.session    <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.sys        <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> root             <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-number">6</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> test1 identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;qweQWE123..&#x27;</span>; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.04</span> sec)<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@Client</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>utest1 <span class="hljs-operator">-</span>pqweQWE123.. <span class="hljs-operator">-</span>h192<span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.101</span> <span class="hljs-operator">-</span>e <span class="hljs-string">&#x27;select user();&#x27;</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>()                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------+</span><br><span class="hljs-operator">|</span> test1<span class="hljs-variable">@192</span><span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.110</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------+</span><br></code></pre></td></tr></table></figure><p>修改密码</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">alter</span> <span class="hljs-keyword">user</span> test1 identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;qweQWE123@!&#x27;</span>; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.04</span> sec)<br><br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@Client</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>utest1 <span class="hljs-operator">-</span>pqweQWE123.. <span class="hljs-operator">-</span>h192<span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.101</span> <span class="hljs-operator">-</span>e <span class="hljs-string">&#x27;select user();&#x27;</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br>ERROR <span class="hljs-number">1045</span> (<span class="hljs-number">28000</span>): Access denied <span class="hljs-keyword">for</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;test1&#x27;</span>@<span class="hljs-string">&#x27;192.168.100.110&#x27;</span> (<span class="hljs-keyword">using</span> password: YES)<br>[root<span class="hljs-variable">@Client</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>utest1 <span class="hljs-operator">-</span>pqweQWE123@<span class="hljs-operator">!</span> <span class="hljs-operator">-</span>h192<span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.101</span> <span class="hljs-operator">-</span>e <span class="hljs-string">&#x27;select user();&#x27;</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>()                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------+</span><br><span class="hljs-operator">|</span> test1<span class="hljs-variable">@192</span><span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.110</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------+</span><br><br></code></pre></td></tr></table></figure><h3 id="重命名账号"><a href="#重命名账号" class="headerlink" title="重命名账号"></a>重命名账号</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> rename <span class="hljs-keyword">user</span> test1 <span class="hljs-keyword">to</span> testUser; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.05</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>,host <span class="hljs-keyword">from</span> mysql.user; <br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>             <span class="hljs-operator">|</span> host      <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> others           <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> shanwen          <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> testUser         <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.infoschema <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.session    <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.sys        <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> root             <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-number">7</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@Client</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>utest1 <span class="hljs-operator">-</span>pqweQWE123@<span class="hljs-operator">!</span> <span class="hljs-operator">-</span>h192<span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.101</span> <span class="hljs-operator">-</span>e <span class="hljs-string">&#x27;select user();&#x27;</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br>ERROR <span class="hljs-number">1045</span> (<span class="hljs-number">28000</span>): Access denied <span class="hljs-keyword">for</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;test1&#x27;</span>@<span class="hljs-string">&#x27;192.168.100.110&#x27;</span> (<span class="hljs-keyword">using</span> password: YES)<br>[root<span class="hljs-variable">@Client</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>utestUser <span class="hljs-operator">-</span>pqweQWE123@<span class="hljs-operator">!</span> <span class="hljs-operator">-</span>h192<span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.101</span> <span class="hljs-operator">-</span>e <span class="hljs-string">&#x27;select user();&#x27;</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>()                   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------+</span><br><span class="hljs-operator">|</span> testUser<span class="hljs-variable">@192</span><span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.110</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------+</span><br><br></code></pre></td></tr></table></figure><h3 id="锁定账号"><a href="#锁定账号" class="headerlink" title="锁定账号"></a>锁定账号</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">alter</span> <span class="hljs-keyword">user</span> testUser account lock; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@Client</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>utestUser <span class="hljs-operator">-</span>pqweQWE123@<span class="hljs-operator">!</span> <span class="hljs-operator">-</span>h192<span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.101</span> <span class="hljs-operator">-</span>e <span class="hljs-string">&#x27;select user();&#x27;</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br>ERROR <span class="hljs-number">3118</span> (HY000): Access denied <span class="hljs-keyword">for</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;testUser&#x27;</span>@<span class="hljs-string">&#x27;192.168.100.110&#x27;</span>. Account <span class="hljs-keyword">is</span> locked.<br><br></code></pre></td></tr></table></figure><h3 id="解锁账号"><a href="#解锁账号" class="headerlink" title="解锁账号"></a>解锁账号</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">alter</span> <span class="hljs-keyword">user</span> testUser account unlock;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.04</span> sec)<br><br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@Client</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>utestUser <span class="hljs-operator">-</span>pqweQWE123@<span class="hljs-operator">!</span> <span class="hljs-operator">-</span>h192<span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.101</span> <span class="hljs-operator">-</span>e <span class="hljs-string">&#x27;select user();&#x27;</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br>ERROR <span class="hljs-number">3118</span> (HY000): Access denied <span class="hljs-keyword">for</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;testUser&#x27;</span>@<span class="hljs-string">&#x27;192.168.100.110&#x27;</span>. Account <span class="hljs-keyword">is</span> locked.<br>[root<span class="hljs-variable">@Client</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>utestUser <span class="hljs-operator">-</span>pqweQWE123@<span class="hljs-operator">!</span> <span class="hljs-operator">-</span>h192<span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.101</span> <span class="hljs-operator">-</span>e <span class="hljs-string">&#x27;select user();&#x27;</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>()                   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------+</span><br><span class="hljs-operator">|</span> testUser<span class="hljs-variable">@192</span><span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.110</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------+</span><br><br></code></pre></td></tr></table></figure><h2 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h2><p><img src="/home/shanwen/Documents/Note/Pic/image-20240806174952905.png" alt="image-20240806174952905"></p><p>全局权限 </p><ul><li>对数据库所有库</li></ul><p>库权限 </p><ul><li>对一个库的权限</li></ul><p>表权限</p><ul><li>对某库中的某个表有权限</li></ul><p>列权限</p><ul><li>对某个列有权限</li></ul><p>存储过程权限</p><ul><li>对存储过程权限</li></ul><p>代理权限</p><ul><li>使某个用户具有其他用户的权限 代理</li></ul><h3 id="赋予权限"><a href="#赋予权限" class="headerlink" title="赋予权限"></a>赋予权限</h3><p>查看权限</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> others@<span class="hljs-string">&#x27;%&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------+</span><br><span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> others@<span class="hljs-operator">%</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>` <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> shanwen<span class="hljs-variable">@localhost</span>; <br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------------+</span><br><span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> shanwen<span class="hljs-variable">@localhost</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `shanwen`@`localhost` <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br></code></pre></td></tr></table></figure><h4 id="全局权限"><a href="#全局权限" class="headerlink" title="全局权限"></a>全局权限</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">grant</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">on</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">to</span> others@<span class="hljs-string">&#x27;%&#x27;</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> flush privileges;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>(); <br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>()         <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@Client</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uothers <span class="hljs-operator">-</span>pqweQWE123.. <span class="hljs-operator">-</span>h192<span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.101</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>(); <br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>()                 <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------+</span><br><span class="hljs-operator">|</span> others<span class="hljs-variable">@192</span><span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.110</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases; <br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql              <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> sys                <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> testDB             <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-number">5</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><h4 id="库权限"><a href="#库权限" class="headerlink" title="库权限"></a>库权限</h4><p>这时候我想other增加一个在<code>testDB</code>库中创建表的权限</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">grant</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">on</span> testDB.<span class="hljs-operator">*</span> <span class="hljs-keyword">to</span> others@<span class="hljs-string">&#x27;%&#x27;</span>; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> flush privileges; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>(); <br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>()                 <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------+</span><br><span class="hljs-operator">|</span> others<span class="hljs-variable">@192</span><span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.110</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create table</span> testDB.t2(id <span class="hljs-type">int</span> <span class="hljs-keyword">primary key</span> auto_increment ); <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">1.12</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> tables <span class="hljs-keyword">from</span> testDB;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span><br><span class="hljs-operator">|</span> Tables_in_testDB <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span><br><span class="hljs-operator">|</span> t1               <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> t2               <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br></code></pre></td></tr></table></figure><h4 id="表权限"><a href="#表权限" class="headerlink" title="表权限"></a>表权限</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> testDB.t2 <span class="hljs-keyword">values</span> (<span class="hljs-number">1</span>); <br>ERROR <span class="hljs-number">1142</span> (<span class="hljs-number">42000</span>): <span class="hljs-keyword">INSERT</span> command denied <span class="hljs-keyword">to</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;others&#x27;</span>@<span class="hljs-string">&#x27;192.168.100.110&#x27;</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">table</span> <span class="hljs-string">&#x27;t2&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">grant</span> <span class="hljs-keyword">insert</span> <span class="hljs-keyword">on</span> testDB.t2 <span class="hljs-keyword">to</span> others@<span class="hljs-string">&#x27;%&#x27;</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> flush privileges; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> testDB.t2 <span class="hljs-keyword">values</span> (<span class="hljs-number">1</span>);<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.06</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> testDB.t2; <br><span class="hljs-operator">+</span><span class="hljs-comment">----+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><h4 id="列权限"><a href="#列权限" class="headerlink" title="列权限"></a>列权限</h4><p>赋予<code>others@%</code> 对 <code>testDB.t2</code> <code>id</code> 列的<code>insert</code> 权限</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> others@<span class="hljs-string">&#x27;%&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------------------+</span><br><span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> others@<span class="hljs-operator">%</span>                           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>`           <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">ON</span> `testDB`.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>`    <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">ON</span> `testDB`.`t2` <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>` <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------------------+</span><br><span class="hljs-number">3</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> testDB.t1; <br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> zs   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">grant</span> <span class="hljs-keyword">insert</span>(id) <span class="hljs-keyword">on</span> testDB.t1 <span class="hljs-keyword">to</span> others@<span class="hljs-string">&#x27;%&#x27;</span>; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> flush privileges; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">desc</span> testDB.t1; <br><span class="hljs-operator">+</span><span class="hljs-comment">-------+-------------+------+-----+---------+----------------+</span><br><span class="hljs-operator">|</span> Field <span class="hljs-operator">|</span> Type        <span class="hljs-operator">|</span> <span class="hljs-keyword">Null</span> <span class="hljs-operator">|</span> Key <span class="hljs-operator">|</span> <span class="hljs-keyword">Default</span> <span class="hljs-operator">|</span> Extra          <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+-------------+------+-----+---------+----------------+</span><br><span class="hljs-operator">|</span> id    <span class="hljs-operator">|</span> <span class="hljs-type">int</span>         <span class="hljs-operator">|</span> <span class="hljs-keyword">NO</span>   <span class="hljs-operator">|</span> PRI <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span> auto_increment <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> name  <span class="hljs-operator">|</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-operator">|</span> <span class="hljs-keyword">NO</span>   <span class="hljs-operator">|</span>     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+-------------+------+-----+---------+----------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> testDB.t1 <span class="hljs-keyword">values</span> (<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;ls&#x27;</span>);<br>ERROR <span class="hljs-number">1142</span> (<span class="hljs-number">42000</span>): <span class="hljs-keyword">INSERT</span> command denied <span class="hljs-keyword">to</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;others&#x27;</span>@<span class="hljs-string">&#x27;192.168.100.110&#x27;</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">table</span> <span class="hljs-string">&#x27;t1&#x27;</span><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> testDB.t1(id) <span class="hljs-keyword">values</span> (<span class="hljs-number">2</span>);<br>ERROR <span class="hljs-number">1364</span> (HY000): Field <span class="hljs-string">&#x27;name&#x27;</span> doesn<span class="hljs-string">&#x27;t have a default value</span><br></code></pre></td></tr></table></figure><p>因为<code>testDB.t1</code>的<code>name</code>约束有<code>not null</code> 且没有默认值 所以无法只插入<code>id</code> </p><p>修改<code>testDB.t1</code>的表属性</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">alter table</span> testDB.t1 modify <span class="hljs-keyword">column</span> name <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">null</span>; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.18</span> sec)<br>Records: <span class="hljs-number">0</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> testDB.t1(id) <span class="hljs-keyword">values</span> (<span class="hljs-number">2</span>);<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.04</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> testDB.t1; <br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> zs   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> testDB.t1 <span class="hljs-keyword">values</span> (<span class="hljs-number">3</span>,<span class="hljs-string">&#x27;ww&#x27;</span>);<br>ERROR <span class="hljs-number">1142</span> (<span class="hljs-number">42000</span>): <span class="hljs-keyword">INSERT</span> command denied <span class="hljs-keyword">to</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;others&#x27;</span>@<span class="hljs-string">&#x27;192.168.100.110&#x27;</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">table</span> <span class="hljs-string">&#x27;t1&#x27;</span><br></code></pre></td></tr></table></figure><h4 id="代理用户权限"><a href="#代理用户权限" class="headerlink" title="代理用户权限"></a>代理用户权限</h4><p>将<code>shanwen@localhost</code>设置为<code>root@localhost</code>的代理用户 这样<code>shanwen@localhost</code>就拥有了<code>root@localhost</code>的权限 </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">grant</span> proxy <span class="hljs-keyword">on</span> root <span class="hljs-keyword">to</span> shanwen<span class="hljs-variable">@localhost</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> flush privileges; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>(); <br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>()         <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> shanwen<span class="hljs-variable">@localhost</span>; <br><span class="hljs-operator">+</span><span class="hljs-comment">----------------------------------------------------+</span><br><span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> shanwen<span class="hljs-variable">@localhost</span>                       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `shanwen`@`localhost`        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> PROXY <span class="hljs-keyword">ON</span> `root`@`<span class="hljs-operator">%</span>` <span class="hljs-keyword">TO</span> `shanwen`@`localhost` <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------------------------------------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@MySQL01</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>ushanwen <span class="hljs-operator">-</span>pqweQWE123..<br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants; <br><span class="hljs-operator">+</span><span class="hljs-comment">----------------------------------------------------+</span><br><span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> shanwen<span class="hljs-variable">@localhost</span>                       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `shanwen`@`localhost`        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> PROXY <span class="hljs-keyword">ON</span> `root`@`<span class="hljs-operator">%</span>` <span class="hljs-keyword">TO</span> `shanwen`@`localhost` <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------------------------------------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br></code></pre></td></tr></table></figure><h3 id="撤销权限"><a href="#撤销权限" class="headerlink" title="撤销权限"></a>撤销权限</h3><h4 id="全局权限-1"><a href="#全局权限-1" class="headerlink" title="全局权限"></a>全局权限</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;others&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>; <br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------------+</span><br><span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> others@<span class="hljs-operator">%</span>                                  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>`                  <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">ON</span> `testDB`.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>`           <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">INSERT</span> (`id`) <span class="hljs-keyword">ON</span> `testDB`.`t1` <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>` <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">ON</span> `testDB`.`t2` <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>`        <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------------+</span><br><span class="hljs-number">4</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">revoke</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">on</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `others`@`<span class="hljs-operator">%</span>`; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> flush privileges; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;others&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------------+</span><br><span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> others@<span class="hljs-operator">%</span>                                  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>`                   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">ON</span> `testDB`.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>`           <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">INSERT</span> (`id`) <span class="hljs-keyword">ON</span> `testDB`.`t1` <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>` <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">ON</span> `testDB`.`t2` <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>`        <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------------+</span><br><span class="hljs-number">4</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>是不是少了几张表 testDB会被看到是因为赋予了该用户testDB库下表的权限</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> testDB             <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-number">3</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><h4 id="库权限-1"><a href="#库权限-1" class="headerlink" title="库权限"></a>库权限</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">revoke</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">ON</span> `testDB`.<span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `others`@`<span class="hljs-operator">%</span>`<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> ;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> flush privileges;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;others&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------------+</span><br><span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> others@<span class="hljs-operator">%</span>                                  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>`                   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">INSERT</span> (`id`) <span class="hljs-keyword">ON</span> `testDB`.`t1` <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>` <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">ON</span> `testDB`.`t2` <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>`        <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------------+</span><br><span class="hljs-number">3</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> testDB             <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-number">3</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> tables <span class="hljs-keyword">from</span> testDB; <br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span><br><span class="hljs-operator">|</span> Tables_in_testDB <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span><br><span class="hljs-operator">|</span> t1               <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> t2               <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><h4 id="表权限-1"><a href="#表权限-1" class="headerlink" title="表权限"></a>表权限</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">revoke</span> <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">on</span> testDB.t2 <span class="hljs-keyword">from</span> `others`@`<span class="hljs-operator">%</span>`; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> flush privileges; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;others&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------------+</span><br><span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> others@<span class="hljs-operator">%</span>                                  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>`                   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">INSERT</span> (`id`) <span class="hljs-keyword">ON</span> `testDB`.`t1` <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>` <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>因为撤销了<code>testDB.t2</code>的相关权限 以及看不到<code>testDB.t2</code>了</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> testDB             <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-number">3</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> tables <span class="hljs-keyword">from</span> testDB;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span><br><span class="hljs-operator">|</span> Tables_in_testDB <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span><br><span class="hljs-operator">|</span> t1               <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br></code></pre></td></tr></table></figure><h4 id="列权限-1"><a href="#列权限-1" class="headerlink" title="列权限"></a>列权限</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">revoke</span> <span class="hljs-keyword">insert</span>(id) <span class="hljs-keyword">on</span> testDB.t1 <span class="hljs-keyword">from</span> others@`<span class="hljs-operator">%</span>`; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> flush privileges; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;others&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------+</span><br><span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> others@<span class="hljs-operator">%</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>` <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br></code></pre></td></tr></table></figure><p>因为<code>testDB.t1</code>的权限撤销 该账户在<code>testDB</code>库中没有任何权限 所以也看不见<code>testDB</code>了</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> tables <span class="hljs-keyword">from</span> testDB;<br>ERROR <span class="hljs-number">1044</span> (<span class="hljs-number">42000</span>): Access denied <span class="hljs-keyword">for</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;others&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> <span class="hljs-keyword">to</span> database <span class="hljs-string">&#x27;testDB&#x27;</span><br></code></pre></td></tr></table></figure><p>使用权限是无法删除的</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">revoke</span> usage <span class="hljs-keyword">on</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `others`@`<span class="hljs-operator">%</span>`;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> flush privileges; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;others&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------+</span><br><span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> others@<span class="hljs-operator">%</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>` <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br></code></pre></td></tr></table></figure><h4 id="代理人权限"><a href="#代理人权限" class="headerlink" title="代理人权限"></a>代理人权限</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">revoke</span> proxy <span class="hljs-keyword">on</span> root <span class="hljs-keyword">from</span> shanwen<span class="hljs-variable">@localhost</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> shanwen<span class="hljs-variable">@localhost</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------------+</span><br><span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> shanwen<span class="hljs-variable">@localhost</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `shanwen`@`localhost` <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br></code></pre></td></tr></table></figure><h2 id="角色管理"><a href="#角色管理" class="headerlink" title="角色管理"></a>角色管理</h2><p>某一些用户需要拥有相同的权限 就可以创建角色 将权限赋予给角色 在将角色授权给用户 </p><h4 id="创建角色"><a href="#创建角色" class="headerlink" title="创建角色"></a>创建角色</h4><p>角色的格式也是(role@Host) 省略Host则为’%’</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> role admin,guest; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.05</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>,host <span class="hljs-keyword">from</span> mysql.user; <br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>             <span class="hljs-operator">|</span> host      <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> admin            <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> guest            <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> others           <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.infoschema <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.session    <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.sys        <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> root             <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-number">7</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><h4 id="为角色赋予权限"><a href="#为角色赋予权限" class="headerlink" title="为角色赋予权限"></a>为角色赋予权限</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">grant</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">on</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">to</span> guest;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.04</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">on</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">to</span> admin; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.04</span> sec)<br><br></code></pre></td></tr></table></figure><h4 id="创建用户-1"><a href="#创建用户-1" class="headerlink" title="创建用户"></a>创建用户</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> user1 identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;qweQWE123..&#x27;</span>; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.04</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> admin1 identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;qweQWE123..&#x27;</span>; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.04</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> shanwen identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;qweQWE123..&#x27;</span>; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>,host <span class="hljs-keyword">from</span> mysql.user; <br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>             <span class="hljs-operator">|</span> host      <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> admin            <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> admin1           <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> guest            <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> others           <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> shanwen          <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> user1            <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.infoschema <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.session    <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.sys        <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> root             <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-number">10</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br></code></pre></td></tr></table></figure><h4 id="将角色授权给用户"><a href="#将角色授权给用户" class="headerlink" title="将角色授权给用户"></a>将角色授权给用户</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">grant</span> admin <span class="hljs-keyword">to</span> admin1; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">grant</span> guest <span class="hljs-keyword">to</span> user1;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.18</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">grant</span> guest,admin <span class="hljs-keyword">to</span> shanwen;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.04</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> shanwen; <br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------+</span><br><span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> shanwen@<span class="hljs-operator">%</span>                           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `shanwen`@`<span class="hljs-operator">%</span>`            <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> `admin`@`<span class="hljs-operator">%</span>`,`guest`@`<span class="hljs-operator">%</span>` <span class="hljs-keyword">TO</span> `shanwen`@`<span class="hljs-operator">%</span>` <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> admin1;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------+</span><br><span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> admin1@<span class="hljs-operator">%</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `admin1`@`<span class="hljs-operator">%</span>` <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> `admin`@`<span class="hljs-operator">%</span>` <span class="hljs-keyword">TO</span> `admin1`@`<span class="hljs-operator">%</span>`  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> user1;<br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------+</span><br><span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> user1@<span class="hljs-operator">%</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `user1`@`<span class="hljs-operator">%</span>` <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> `guest`@`<span class="hljs-operator">%</span>` <span class="hljs-keyword">TO</span> `user1`@`<span class="hljs-operator">%</span>`  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>登陆测试 发现没有权限 </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@Client</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uadmin1 <span class="hljs-operator">-</span>pqweQWE123.. <span class="hljs-operator">-</span>h192<span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.101</span><br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br></code></pre></td></tr></table></figure><p>查看当前用户和角色 </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">current_user</span>(); <br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">current_user</span>() <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> admin1@<span class="hljs-operator">%</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">current_role</span>();<br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">current_role</span>() <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">NONE</span>           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br></code></pre></td></tr></table></figure><p>设置角色</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> role admin; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">current_role</span>();<br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">current_role</span>() <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> `admin`@`<span class="hljs-operator">%</span>`    <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql              <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> sys                <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> testDB             <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-number">5</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>如果不想手动切换角色 可以为用户设置默认角色(root用户权限)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">default</span> role guest <span class="hljs-keyword">to</span> user1;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>[root<span class="hljs-variable">@Client</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uuser1 <span class="hljs-operator">-</span>pqweQWE123.. <span class="hljs-operator">-</span>h192<span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.101</span><br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">current_role</span>(); <br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">current_role</span>() <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> `guest`@`<span class="hljs-operator">%</span>`    <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>多角色权限管理</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">default</span> role <span class="hljs-keyword">all</span> <span class="hljs-keyword">to</span> shanwen; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>[root<span class="hljs-variable">@Client</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>ushanwen <span class="hljs-operator">-</span>pqweQWE123.. <span class="hljs-operator">-</span>h192<span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.101</span><br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">current_role</span>();<br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">current_role</span>()          <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+</span><br><span class="hljs-operator">|</span> `admin`@`<span class="hljs-operator">%</span>`,`guest`@`<span class="hljs-operator">%</span>` <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>也可以手动切换</p><p><code>set role none|all|admin|admin,guest</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">current_role</span>();<br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">current_role</span>()          <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+</span><br><span class="hljs-operator">|</span> `admin`@`<span class="hljs-operator">%</span>`,`guest`@`<span class="hljs-operator">%</span>` <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> role <span class="hljs-keyword">none</span>; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">current_role</span>();<br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">current_role</span>() <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">NONE</span>           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> role admin; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">current_role</span>();<br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">current_role</span>() <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> `admin`@`<span class="hljs-operator">%</span>`    <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> role <span class="hljs-keyword">none</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">current_role</span>();<br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">current_role</span>() <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">NONE</span>           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> role <span class="hljs-keyword">all</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">current_role</span>();<br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">current_role</span>()          <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+</span><br><span class="hljs-operator">|</span> `admin`@`<span class="hljs-operator">%</span>`,`guest`@`<span class="hljs-operator">%</span>` <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><h4 id="撤销权限-1"><a href="#撤销权限-1" class="headerlink" title="撤销权限"></a>撤销权限</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">revoke</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">on</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> admin; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">current_role</span>();<br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">current_role</span>()          <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+</span><br><span class="hljs-operator">|</span> `admin`@`<span class="hljs-operator">%</span>`,`guest`@`<span class="hljs-operator">%</span>` <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases; <br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql              <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> sys                <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> testDB             <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-number">5</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br><br>ERROR <span class="hljs-number">1044</span> (<span class="hljs-number">42000</span>): Access denied <span class="hljs-keyword">for</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;shanwen&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> <span class="hljs-keyword">to</span> database <span class="hljs-string">&#x27;test1&#x27;</span><br></code></pre></td></tr></table></figure><h4 id="删除角色"><a href="#删除角色" class="headerlink" title="删除角色"></a>删除角色</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">drop</span> role admin; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.04</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>,host <span class="hljs-keyword">from</span> mysql.user;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>             <span class="hljs-operator">|</span> host      <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> admin1           <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> guest            <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> others           <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> shanwen          <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> user1            <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.infoschema <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.session    <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.sys        <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> root             <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-number">9</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><h1 id="DQL"><a href="#DQL" class="headerlink" title="DQL"></a>DQL</h1><p><img src="/home/shanwen/Documents/Note/Pic/image-20240702172005549.png" alt="image-20240702172005549"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; use classicmodels -A;<br>Database changed<br>mysql&gt; show tables; <br>+-------------------------+<br>| Tables_in_classicmodels |<br>+-------------------------+<br>| customers               |<br>| employees               |<br>| offices                 |<br>| orderdetails            |<br>| orders                  |<br>| payments                |<br>| productlines            |<br>| products                |<br>+-------------------------+<br>8 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>查看表结构</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show columns from classicmodels.offices; <br>+--------------+-------------+------+-----+---------+-------+<br>| Field        | Type        | Null | Key | Default | Extra |<br>+--------------+-------------+------+-----+---------+-------+<br>| officeCode   | varchar(10) | NO   | PRI | NULL    |       |<br>| city         | varchar(50) | NO   |     | NULL    |       |<br>| phone        | varchar(50) | NO   |     | NULL    |       |<br>| addressLine1 | varchar(50) | NO   |     | NULL    |       |<br>| addressLine2 | varchar(50) | YES  |     | NULL    |       |<br>| state        | varchar(50) | YES  |     | NULL    |       |<br>| country      | varchar(50) | NO   |     | NULL    |       |<br>| postalCode   | varchar(15) | NO   |     | NULL    |       |<br>| territory    | varchar(10) | NO   |     | NULL    |       |<br>+--------------+-------------+------+-----+---------+-------+<br>9 rows in set (0.02 sec)<br><br>mysql&gt; desc offices;<br>+--------------+-------------+------+-----+---------+-------+<br>| Field        | Type        | Null | Key | Default | Extra |<br>+--------------+-------------+------+-----+---------+-------+<br>| officeCode   | varchar(10) | NO   | PRI | NULL    |       |<br>| city         | varchar(50) | NO   |     | NULL    |       |<br>| phone        | varchar(50) | NO   |     | NULL    |       |<br>| addressLine1 | varchar(50) | NO   |     | NULL    |       |<br>| addressLine2 | varchar(50) | YES  |     | NULL    |       |<br>| state        | varchar(50) | YES  |     | NULL    |       |<br>| country      | varchar(50) | NO   |     | NULL    |       |<br>| postalCode   | varchar(15) | NO   |     | NULL    |       |<br>| territory    | varchar(10) | NO   |     | NULL    |       |<br>+--------------+-------------+------+-----+---------+-------+<br>9 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h2 id="Select"><a href="#Select" class="headerlink" title="Select"></a>Select</h2><p>\G垂直显示</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from offices\G<br>*************************** 1. row ***************************<br>  officeCode: 1<br>        city: San Francisco<br>       phone: +1 650 219 4782<br>addressLine1: 100 Market Street<br>addressLine2: Suite 300<br>       state: CA<br>     country: USA<br>  postalCode: 94080<br>   territory: NA<br>*************************** 2. row ***************************<br>  officeCode: 2<br>        city: Boston<br>       phone: +1 215 837 0825<br>addressLine1: 1550 Court Place<br>addressLine2: Suite 102<br>       state: MA<br>     country: USA<br>  postalCode: 02107<br>   territory: NA<br></code></pre></td></tr></table></figure><p>选择字段查询</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select city,phone from offices; <br>+---------------+------------------+<br>| city          | phone            |<br>+---------------+------------------+<br>| San Francisco | +1 650 219 4782  |<br>| Boston        | +1 215 837 0825  |<br>| NYC           | +1 212 555 3000  |<br>| Paris         | +33 14 723 4404  |<br>| Tokyo         | +81 33 224 5000  |<br>| Sydney        | +61 2 9264 2451  |<br>| London        | +44 20 7877 2041 |<br>+---------------+------------------+<br>7 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>select可以不指定表</p><h3 id="数值计算"><a href="#数值计算" class="headerlink" title="数值计算"></a>数值计算</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select 1=1;<br>+-----+<br>| 1=1 |<br>+-----+<br>|   1 |<br>+-----+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select 1=2;<br>+-----+<br>| 1=2 |<br>+-----+<br>|   0 |<br>+-----+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select 1+1;<br>+-----+<br>| 1+1 |<br>+-----+<br>|   2 |<br>+-----+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><h3 id="输出函数"><a href="#输出函数" class="headerlink" title="输出函数"></a>输出函数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select now(); <br>+---------------------+<br>| now()               |<br>+---------------------+<br>| 2024-06-28 07:42:16 |<br>+---------------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select current_date();<br>+----------------+<br>| current_date() |<br>+----------------+<br>| 2024-06-28     |<br>+----------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select current_time();<br>+----------------+<br>| current_time() |<br>+----------------+<br>| 07:42:38       |<br>+----------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><h3 id="带参数的函数"><a href="#带参数的函数" class="headerlink" title="带参数的函数"></a>带参数的函数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select concat(&#x27;A&#x27;,&#x27; &#x27;,&#x27;Sample&#x27;);<br>+--------------------------+<br>| concat(&#x27;A&#x27;,&#x27; &#x27;,&#x27;Sample&#x27;) |<br>+--------------------------+<br>| A Sample                 |<br>+--------------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><h2 id="As-别名"><a href="#As-别名" class="headerlink" title="As 别名"></a>As 别名</h2><h4 id="字段别名"><a href="#字段别名" class="headerlink" title="字段别名"></a>字段别名</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select city Chengshi,phone Dianhua from offices;<br>+---------------+------------------+<br>| Chengshi      | Dianhua          |<br>+---------------+------------------+<br>| San Francisco | +1 650 219 4782  |<br>| Boston        | +1 215 837 0825  |<br>| NYC           | +1 212 555 3000  |<br>| Paris         | +33 14 723 4404  |<br>| Tokyo         | +81 33 224 5000  |<br>| Sydney        | +61 2 9264 2451  |<br>| London        | +44 20 7877 2041 |<br>+---------------+------------------+<br>7 rows in set (0.00 sec)<br><br>mysql&gt; select city as Chengshi,phone as Dianhua from offices;<br>+---------------+------------------+<br>| Chengshi      | Dianhua          |<br>+---------------+------------------+<br>| San Francisco | +1 650 219 4782  |<br>| Boston        | +1 215 837 0825  |<br>| NYC           | +1 212 555 3000  |<br>| Paris         | +33 14 723 4404  |<br>| Tokyo         | +81 33 224 5000  |<br>| Sydney        | +61 2 9264 2451  |<br>| London        | +44 20 7877 2041 |<br>+---------------+------------------+<br>7 rows in set (0.00 sec)<br><br>mysql&gt; select concat (&#x27;舒克&#x27;,&#x27;和贝塔&#x27;) As 节目名;<br>+-----------------+<br>| 节目名          |<br>+-----------------+<br>| 舒克和贝塔      |<br>+-----------------+<br>1 row in set (0.01 sec)<br><br>mysql&gt; select concat_ws(&#x27; &#x27;,firstName,lastName) as name,email from employees limit 5;<br>+-------------------+---------------------------------+<br>| name              | email                           |<br>+-------------------+---------------------------------+<br>| Diane Murphy      | dmurphy@classicmodelcars.com    |<br>| Mary Patterson    | mpatterso@classicmodelcars.com  |<br>| Jeff Firrelli     | jfirrelli@classicmodelcars.com  |<br>| William Patterson | wpatterson@classicmodelcars.com |<br>| Gerard Bondur     | gbondur@classicmodelcars.com    |<br>+-------------------+---------------------------------+<br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h4 id="表别名"><a href="#表别名" class="headerlink" title="表别名"></a>表别名</h4><p>查询时 尽量使用<code>As</code> 别名表 有如下好处</p><blockquote><ol><li><strong>简化查询语句</strong><ul><li>使用表别名可以让 SQL 语句更加简洁和易读。</li><li>特别是在查询涉及多个表时,表别名可以大大减少字符输入。</li></ul></li><li><strong>区分多个表</strong><ul><li>当查询中涉及多个同名表时,使用表别名可以明确指定要引用的是哪个表。</li><li>这对于避免歧义和正确识别字段非常重要。</li></ul></li><li><strong>提高查询性能</strong><ul><li>表别名可以作为字段前缀,减少字段名称的冗长度。</li><li>这样可以减少查询解析时的资源消耗,提高查询性能。</li></ul></li><li><strong>支持自连接</strong><ul><li>表别名是实现自连接的关键,因为同一张表需要以不同的别名引用。</li><li>通过自连接可以实现复杂的层级查询和树形结构的遍历。</li></ul></li><li><strong>增强可读性</strong><ul><li>合理使用表别名可以让 SQL 语句更加语义化和易于理解。</li><li>这对于维护和优化查询非常有帮助。</li></ul></li></ol></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select count(t1.orderNumber) from orderdetails as t1;<br>+-----------------------+<br>| count(t1.orderNumber) |<br>+-----------------------+<br>|                  2996 |<br>+-----------------------+<br>1 row in set (0.00 sec)<br><br></code></pre></td></tr></table></figure><h2 id="ORDER-BY-排序"><a href="#ORDER-BY-排序" class="headerlink" title="ORDER BY 排序"></a>ORDER BY 排序</h2><p>根据<code>排序规则</code>来 排序<code>列</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show full columns from products\G<br>*************************** 1. row ***************************<br>     Field: productCode<br>      Type: varchar(15)<br> Collation: utf8mb4_0900_ai_ci<br>      Null: NO<br>       Key: PRI<br>   Default: NULL<br>     Extra: <br>Privileges: select,insert,update,references<br>   Comment: <br>*************************** 2. row ***************************<br>     Field: productName<br>      Type: varchar(70)<br> Collation: utf8mb4_0900_ai_ci<br>      Null: NO<br>       Key: <br>   Default: NULL<br>     Extra: <br>Privileges: select,insert,update,references<br>   Comment: <br>...<br>9 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>这个表的<code>productCode</code>字段排序规则是<code>utf8mb4_0900_ai_ci</code> </p><p><img src="/home/shanwen/Documents/Note/Pic/image-20240628160906100.png" alt="image-20240628160906100"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select customerNumber,city from customers order by customerNumber;<br>+----------------+-------------------+<br>| customerNumber | city              |<br>+----------------+-------------------+<br>|            103 | Nantes            |<br>|            112 | Las Vegas         |<br><br>mysql&gt; select customerNumber,city from customers order by customerNumber asc;<br>+----------------+-------------------+<br>| customerNumber | city              |<br>+----------------+-------------------+<br>|            103 | Nantes            |<br>|            112 | Las Vegas         |<br><br>mysql&gt; select customerNumber,city from customers order by customerNumber desc;<br>+----------------+-------------------+<br>| customerNumber | city              |<br>+----------------+-------------------+<br>|            496 | Auckland          |<br>|            495 | Boston            |<br></code></pre></td></tr></table></figure><p>升序<code>ase</code> 降序<code>desc</code>  不显式指定就是<code>asc</code> </p><blockquote><p>在使用asc排序时 null会在数据前面</p></blockquote><p>也可一次设置多个排序规则</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select customerNumber,city from customers order by customerNumber desc, state desc;<br>+----------------+-------------------+<br>| customerNumber | city              |<br>+----------------+-------------------+<br>|            496 | Auckland          |<br>|            495 | Boston            |<br>|            489 | London            |<br><br></code></pre></td></tr></table></figure><p>用算数运算符重命名一个新字段 并利用新字段排序 <code>limit</code>限制输出为10行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select orderNumber,orderLineNumber,quantityOrdered * priceEach total from orderdetails order by total limit 10; <br>+-------------+-----------------+--------+<br>| orderNumber | orderLineNumber | total  |<br>+-------------+-----------------+--------+<br>|       10419 |               7 | 481.50 |<br>|       10420 |               3 | 529.35 |<br>|       10322 |               3 | 531.00 |<br>|       10407 |               3 | 546.66 |<br>|       10425 |               6 | 553.52 |<br>|       10344 |               6 | 557.60 |<br>|       10110 |               3 | 577.60 |<br>|       10280 |              12 | 597.40 |<br>|       10408 |               1 | 615.45 |<br>|       10409 |               2 | 625.50 |<br>+-------------+-----------------+--------+<br>10 rows in set (0.01 sec)<br><br></code></pre></td></tr></table></figure><h2 id="GROUP-BY-分组"><a href="#GROUP-BY-分组" class="headerlink" title="GROUP BY 分组"></a>GROUP BY 分组</h2><p>选择字段分组 使得选择的列 数据的唯一</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select status from orders limit 10;<br>+---------+<br>| status  |<br>+---------+<br>| Shipped |<br>| Shipped |<br>| Shipped |<br>| Shipped |<br>| Shipped |<br>| Shipped |<br>| Shipped |<br>| Shipped |<br>| Shipped |<br>| Shipped |<br>+---------+<br>10 rows in set (0.00 sec)<br><br>mysql&gt; select status from orders group by status;<br>+------------+<br>| status     |<br>+------------+<br>| Shipped    |<br>| Resolved   |<br>| Cancelled  |<br>| On Hold    |<br>| Disputed   |<br>| In Process |<br>+------------+<br>6 rows in set (0.00 sec)<br><br></code></pre></td></tr></table></figure><h2 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h2><h3 id="WHERE"><a href="#WHERE" class="headerlink" title="WHERE"></a>WHERE</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT <br>    selectList<br>FROM<br>    tableName<br>WHERE<br>    searchCondition;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select *  from employees where employeeNumber=1002\G<br>*************************** 1. row ***************************<br>employeeNumber: 1002<br>      lastName: Murphy<br>     firstName: Diane<br>     extension: x5800<br>         email: dmurphy@classicmodelcars.com<br>    officeCode: 1<br>     reportsTo: NULL<br>      jobTitle: President<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><h3 id="AND-OR"><a href="#AND-OR" class="headerlink" title="AND OR"></a>AND OR</h3><p><code>And</code> 全真为真 有假为假</p><p><code>Or</code>   全假为假 有真为真</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select 1 and 1 , 1 and 0 ;<br>+---------+---------+<br>| 1 and 1 | 1 and 0 |<br>+---------+---------+<br>|       1 |       0 |<br>+---------+---------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select 1 or 1, 0 or 1, 0 or 0; <br>+--------+--------+--------+<br>| 1 or 1 | 0 or 1 | 0 or 0 |<br>+--------+--------+--------+<br>|      1 |      1 |      0 |<br>+--------+--------+--------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select *  from employees where jobTitle=&quot;Sales Rep&quot; and officeCode=&quot;1&quot;\G<br>*************************** 1. row ***************************<br>employeeNumber: 1165<br>      lastName: Jennings<br>     firstName: Leslie<br>     extension: x3291<br>         email: ljennings@classicmodelcars.com<br>    officeCode: 1<br>     reportsTo: 1143<br>      jobTitle: Sales Rep<br>*************************** 2. row ***************************<br>employeeNumber: 1166<br>      lastName: Thompson<br>     firstName: Leslie<br>     extension: x4065<br>         email: lthompson@classicmodelcars.com<br>    officeCode: 1<br>     reportsTo: 1143<br>      jobTitle: Sales Rep<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from employees where jobTitle=&quot;Sales Manager (NA)&quot; or jobTitle=&quot;VP Sales&quot;\G<br>*************************** 1. row ***************************<br>employeeNumber: 1056<br>      lastName: Patterson<br>     firstName: Mary<br>     extension: x4611<br>         email: mpatterso@classicmodelcars.com<br>    officeCode: 1<br>     reportsTo: 1002<br>      jobTitle: VP Sales<br>*************************** 2. row ***************************<br>employeeNumber: 1143<br>      lastName: Bow<br>     firstName: Anthony<br>     extension: x5428<br>         email: abow@classicmodelcars.com<br>    officeCode: 1<br>     reportsTo: 1056<br>      jobTitle: Sales Manager (NA)<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h3 id="NOT-BETWEEN"><a href="#NOT-BETWEEN" class="headerlink" title="(NOT) BETWEEN"></a>(NOT) BETWEEN</h3><p>查找字段的值位于 x和y 之间</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from employees where officeCode between 4 and 6 limit 3\G<br>*************************** 1. row ***************************<br>employeeNumber: 1088<br>      lastName: Patterson<br>     firstName: William<br>     extension: x4871<br>         email: wpatterson@classicmodelcars.com<br>    officeCode: 6<br>     reportsTo: 1056<br>      jobTitle: Sales Manager (APAC)<br>*************************** 2. row ***************************<br>employeeNumber: 1102<br>      lastName: Bondur<br>     firstName: Gerard<br>     extension: x5408<br>         email: gbondur@classicmodelcars.com<br>    officeCode: 4<br>     reportsTo: 1056<br>      jobTitle: Sale Manager (EMEA)<br><br>mysql&gt; select * from employees where officeCode &gt; 4 and officeCode &lt; 6 limit 3\G<br>*************************** 1. row ***************************<br>employeeNumber: 1621<br>      lastName: Nishi<br>     firstName: Mami<br>     extension: x101<br>         email: mnishi@classicmodelcars.com<br>    officeCode: 5<br>     reportsTo: 1056<br>      jobTitle: Sales Rep<br>*************************** 2. row ***************************<br>employeeNumber: 1625<br>      lastName: Kato<br>     firstName: Yoshimi<br>     extension: x102<br>         email: ykato@classicmodelcars.com<br>    officeCode: 5<br>     reportsTo: 1621<br>      jobTitle: Sales Rep<br>2 rows in set (0.00 sec)<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select jobTitle,officeCode from employees where officeCode not between 1 and 3 limit 5;<br>+----------------------+------------+<br>| jobTitle             | officeCode |<br>+----------------------+------------+<br>| Sales Manager (APAC) | 6          |<br>| Sale Manager (EMEA)  | 4          |<br>| Sales Rep            | 4          |<br>| Sales Rep            | 4          |<br>| Sales Rep            | 4          |<br>+----------------------+------------+<br>5 rows in set (0.00 sec)<br><br></code></pre></td></tr></table></figure><h3 id="NOT-LIKE"><a href="#NOT-LIKE" class="headerlink" title="(NOT) LIKE"></a>(NOT) LIKE</h3><p>MySQL 提供了两个用于构造模式的通配符：百分比%和下划线_。</p><ul><li>百分比 <code>%</code> 通配符可匹配零个或多个字符的任意字符串。</li><li>下划线 <code>_ </code> 通配符匹配任意单个字符。</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select jobTitle,email from employees where jobTitle like &quot;%Sale%&quot;;<br>+----------------------+---------------------------------+<br>| jobTitle             | email                           |<br>+----------------------+---------------------------------+<br>| VP Sales             | mpatterso@classicmodelcars.com  |<br>| Sales Manager (APAC) | wpatterson@classicmodelcars.com |<br>| Sale Manager (EMEA)  | gbondur@classicmodelcars.com    |<br>| Sales Manager (NA)   | abow@classicmodelcars.com       |<br>| Sales Rep            | ljennings@classicmodelcars.com  |<br>| Sales Rep            | lthompson@classicmodelcars.com  |<br>| Sales Rep            | jfirrelli@classicmodelcars.com  |<br><br>mysql&gt; select jobTitle,email from employees where jobTitle like &quot;Sale%&quot;;<br>+----------------------+---------------------------------+<br>| jobTitle             | email                           |<br>+----------------------+---------------------------------+<br>| Sales Manager (APAC) | wpatterson@classicmodelcars.com |<br>| Sale Manager (EMEA)  | gbondur@classicmodelcars.com    |<br>| Sales Manager (NA)   | abow@classicmodelcars.com       |<br>| Sales Rep            | ljennings@classicmodelcars.com  |<br>| Sales Rep            | lthompson@classicmodelcars.com  |<br><br>mysql&gt; select jobTitle,email from employees where jobTitle like &quot;Sales%&quot;;<br>+----------------------+---------------------------------+<br>| jobTitle             | email                           |<br>+----------------------+---------------------------------+<br>| Sales Manager (APAC) | wpatterson@classicmodelcars.com |<br>| Sales Manager (NA)   | abow@classicmodelcars.com       |<br>| Sales Rep            | ljennings@classicmodelcars.com  |<br><br>mysql&gt;  select jobTitle,email from employees where jobTitle like &quot;Sale_____&quot;;<br>+-----------+---------------------------------+<br>| jobTitle  | email                           |<br>+-----------+---------------------------------+<br>| Sales Rep | ljennings@classicmodelcars.com  |<br>| Sales Rep | lthompson@classicmodelcars.com  |<br>+-----------+---------------------------------+<br>17 rows in set (0.00 sec)<br><br>mysql&gt;  select jobTitle,email from employees where jobTitle like &quot;%Sale_&quot;;<br>+----------+--------------------------------+<br>| jobTitle | email                          |<br>+----------+--------------------------------+<br>| VP Sales | mpatterso@classicmodelcars.com |<br>+----------+--------------------------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select jobTitle,email from employees where jobTitle not like &quot;%Sale_&quot; limit 6;<br>+----------------------+---------------------------------+<br>| jobTitle             | email                           |<br>+----------------------+---------------------------------+<br>| President            | dmurphy@classicmodelcars.com    |<br>| VP Marketing         | jfirrelli@classicmodelcars.com  |<br>| Sales Manager (APAC) | wpatterson@classicmodelcars.com |<br>| Sale Manager (EMEA)  | gbondur@classicmodelcars.com    |<br>| Sales Manager (NA)   | abow@classicmodelcars.com       |<br>| Sales Rep            | ljennings@classicmodelcars.com  |<br>+----------------------+---------------------------------+<br>6 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h4 id="转义"><a href="#转义" class="headerlink" title="转义"></a>转义</h4><p>默认为 <code>\</code></p><p>也可以用 <code>escape</code> 指定转义符</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT productCode,productName FROM products where productCode LIKE &#x27;%\_20%&#x27;;<br>+-------------+-------------------------------------------+<br>| productCode | productName                               |<br>+-------------+-------------------------------------------+<br>| S10_2016    | 1996 Moto Guzzi 1100i                     |<br>| S24_2000    | 1960 BSA Gold Star DBD34                  |<br>| S24_2011    | 18th century schooner                     |<br>| S24_2022    | 1938 Cadillac V-16 Presidential Limousine |<br>| S700_2047   | HMS Bounty                                |<br>+-------------+-------------------------------------------+<br>5 rows in set (0.00 sec)<br><br>mysql&gt; SELECT productCode,productName FROM products where productCode LIKE &#x27;%$_20%&#x27; escape &#x27;$&#x27;;<br>+-------------+-------------------------------------------+<br>| productCode | productName                               |<br>+-------------+-------------------------------------------+<br>| S10_2016    | 1996 Moto Guzzi 1100i                     |<br>| S24_2000    | 1960 BSA Gold Star DBD34                  |<br>| S24_2011    | 18th century schooner                     |<br>| S24_2022    | 1938 Cadillac V-16 Presidential Limousine |<br>| S700_2047   | HMS Bounty                                |<br>+-------------+-------------------------------------------+<br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h3 id="IN-NOT-IN"><a href="#IN-NOT-IN" class="headerlink" title="IN , NOT IN"></a>IN , NOT IN</h3><p>查询某个值是否在记录中</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select 1 in (1,2,3);<br>+--------------+<br>| 1 in (1,2,3) |<br>+--------------+<br>|            1 |<br>+--------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select 4 in (1,2,3);<br>+--------------+<br>| 4 in (1,2,3) |<br>+--------------+<br>|            0 |<br>+--------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select 4 not in (1,2,3);<br>+------------------+<br>| 4 not in (1,2,3) |<br>+------------------+<br>|                1 |<br>+------------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select 1 not in (1,2,3);<br>mysql&gt; select 1 not in (1,2,3);<br>+------------------+<br>| 1 not in (1,2,3) |<br>+------------------+<br>|                0 |<br>+------------------+<br>1 row in set (0.00 sec)<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select lastName,firstName,officeCode from employees where officeCode in (4,5,6) order by officeCode;<br>+-----------+-----------+------------+<br>| lastName  | firstName | officeCode |<br>+-----------+-----------+------------+<br>| Bondur    | Gerard    | 4          |<br>| Bondur    | Loui      | 4          |<br>| Hernandez | Gerard    | 4          |<br>| Castillo  | Pamela    | 4          |<br>| Gerard    | Martin    | 4          |<br>| Nishi     | Mami      | 5          |<br>| Kato      | Yoshimi   | 5          |<br>| Patterson | William   | 6          |<br>| Fixter    | Andy      | 6          |<br>| Marsh     | Peter     | 6          |<br>| King      | Tom       | 6          |<br>+-----------+-----------+------------+<br>11 rows in set (0.00 sec)<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select lastName,firstName,officeCode from employees where officeCode not in (4,5,6) order by officeCode;<br>+-----------+-----------+------------+<br>| lastName  | firstName | officeCode |<br>+-----------+-----------+------------+<br>| Murphy    | Diane     | 1          |<br>| Patterson | Mary      | 1          |<br>| Firrelli  | Jeff      | 1          |<br>| Bow       | Anthony   | 1          |<br>| Jennings  | Leslie    | 1          |<br>| Thompson  | Leslie    | 1          |<br>| Firrelli  | Julie     | 2          |<br>| Patterson | Steve     | 2          |<br>| Tseng     | Foon Yue  | 3          |<br>| Vanauf    | George    | 3          |<br>| Bott      | Larry     | 7          |<br>| Jones     | Barry     | 7          |<br>+-----------+-----------+------------+<br>12 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h3 id="数字运算"><a href="#数字运算" class="headerlink" title="数字运算"></a>数字运算</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select lastName,firstName,officeCode from employees where officeCode &gt; 5 order by officeCode;<br>+-----------+-----------+------------+<br>| lastName  | firstName | officeCode |<br>+-----------+-----------+------------+<br>| Patterson | William   | 6          |<br>| Fixter    | Andy      | 6          |<br>| Marsh     | Peter     | 6          |<br>| King      | Tom       | 6          |<br>| Bott      | Larry     | 7          |<br>| Jones     | Barry     | 7          |<br>+-----------+-----------+------------+<br>6 rows in set (0.01 sec)<br><br>mysql&gt; select lastName,firstName,officeCode from employees where officeCode = 5;<br>+----------+-----------+------------+<br>| lastName | firstName | officeCode |<br>+----------+-----------+------------+<br>| Nishi    | Mami      | 5          |<br>| Kato     | Yoshimi   | 5          |<br>+----------+-----------+------------+<br>2 rows in set (0.00 sec)<br><br>mysql&gt; select lastName,firstName,officeCode from employees where officeCode != 5 limit 5;<br>+-----------+-----------+------------+<br>| lastName  | firstName | officeCode |<br>+-----------+-----------+------------+<br>| Murphy    | Diane     | 1          |<br>| Patterson | Mary      | 1          |<br>| Firrelli  | Jeff      | 1          |<br>| Patterson | William   | 6          |<br>| Bondur    | Gerard    | 4          |<br>+-----------+-----------+------------+<br>5 rows in set (0.00 sec)<br><br>mysql&gt; select lastName,firstName,officeCode from employees where officeCode &gt;= 5 limit 5;<br>+-----------+-----------+------------+<br>| lastName  | firstName | officeCode |<br>+-----------+-----------+------------+<br>| Patterson | William   | 6          |<br>| Bott      | Larry     | 7          |<br>| Jones     | Barry     | 7          |<br>| Fixter    | Andy      | 6          |<br>| Marsh     | Peter     | 6          |<br>+-----------+-----------+------------+<br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h3 id="DISTINCT"><a href="#DISTINCT" class="headerlink" title="DISTINCT"></a>DISTINCT</h3><p>按字段去除重复项</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT DISTINCT<br>    select_list<br>FROM<br>    table_name<br>WHERE <br>    search_condition<br>ORDER BY <br>    sort_expression;<br></code></pre></td></tr></table></figure><p>去除 <code>jobTitile</code> 的重复项</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select jobTitle from employees;<br>+----------------------+<br>| jobTitle             |<br>+----------------------+<br>| President            |<br>| VP Sales             |<br>| VP Marketing         |<br>| Sales Manager (APAC) |<br>| Sale Manager (EMEA)  |<br>| Sales Manager (NA)   |<br>| Sales Rep            |<br>| Sales Rep            |<br>| Sales Rep            |<br>...<br>+----------------------+<br>23 rows in set (0.00 sec)<br><br>mysql&gt; select distinct jobTitle from employees;<br>+----------------------+<br>| jobTitle             |<br>+----------------------+<br>| President            |<br>| VP Sales             |<br>| VP Marketing         |<br>| Sales Manager (APAC) |<br>| Sale Manager (EMEA)  |<br>| Sales Manager (NA)   |<br>| Sales Rep            |<br>+----------------------+<br>7 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>输出 <code>jobTitle </code>和<code>officeCode</code> 并清除都重复的项</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select jobTitle,officeCode from employees order by officeCode; <br>+----------------------+------------+<br>| jobTitle             | officeCode |<br>+----------------------+------------+<br>| VP Sales             | 1          |<br>| VP Marketing         | 1          |<br>| President            | 1          |<br>| Sales Manager (NA)   | 1          |<br>| Sales Rep            | 1          |<br>| Sales Rep            | 1          |<br>| Sales Rep            | 2          |<br>| Sales Rep            | 2          |<br>| Sales Rep            | 3          |<br>| Sales Rep            | 3          |<br>| Sale Manager (EMEA)  | 4          |<br>| Sales Rep            | 4          |<br>| Sales Rep            | 4          |<br>| Sales Rep            | 4          |<br>| Sales Rep            | 4          |<br>| Sales Rep            | 5          |<br>| Sales Rep            | 5          |<br>| Sales Manager (APAC) | 6          |<br>| Sales Rep            | 6          |<br>| Sales Rep            | 6          |<br>| Sales Rep            | 6          |<br>| Sales Rep            | 7          |<br>| Sales Rep            | 7          |<br>+----------------------+------------+<br>23 rows in set (0.00 sec)<br><br>mysql&gt; select distinct jobTitle,officeCode from employees order by officeCode;<br>+----------------------+------------+<br>| jobTitle             | officeCode |<br>+----------------------+------------+<br>| President            | 1          |<br>| Sales Manager (NA)   | 1          |<br>| Sales Rep            | 1          |<br>| VP Marketing         | 1          |<br>| VP Sales             | 1          |<br>| Sales Rep            | 2          |<br>| Sales Rep            | 3          |<br>| Sale Manager (EMEA)  | 4          |<br>| Sales Rep            | 4          |<br>| Sales Rep            | 5          |<br>| Sales Manager (APAC) | 6          |<br>| Sales Rep            | 6          |<br>| Sales Rep            | 7          |<br>+----------------------+------------+<br>13 rows in set (0.00 sec)<br><br></code></pre></td></tr></table></figure><h3 id="IS-NOT-NULL"><a href="#IS-NOT-NULL" class="headerlink" title="IS (NOT) NULL"></a>IS (NOT) NULL</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select 1 is not null; <br>+---------------+<br>| 1 is not null |<br>+---------------+<br>|             1 |<br>+---------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select null is not null;<br>+------------------+<br>| null is not null |<br>+------------------+<br>|                0 |<br>+------------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select null is  null;<br>+---------------+<br>| null is  null |<br>+---------------+<br>|             1 |<br>+---------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select 1 is  null;<br>+------------+<br>| 1 is  null |<br>+------------+<br>|          0 |<br>+------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select customerName,state from customers where state is null limit 5;<br>+----------------------+-------+<br>| customerName         | state |<br>+----------------------+-------+<br>| Atelier graphique    | NULL  |<br>| La Rochelle Gifts    | NULL  |<br>| Baane Mini Imports   | NULL  |<br>| Havel &amp; Zbyszek Co   | NULL  |<br>| Blauer See Auto, Co. | NULL  |<br>+----------------------+-------+<br>5 rows in set (0.00 sec)<br><br>mysql&gt; select customerName,state from customers where state is not null;<br>+-----------------------------------+---------------+<br>| customerName                      | state         |<br>+-----------------------------------+---------------+<br>| Signal Gift Stores                | NV            |<br>| Australian Collectors, Co.        | Victoria      |<br>| Mini Gifts Distributors Ltd.      | CA            |<br>| Mini Wheels Co.                   | CA            |<br>| Land of Toys Inc.                 | NY            |<br>| Diecast Collectables              | MA            |<br>+-----------------------------------+---------------+<br>49 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h3 id="LIMIT"><a href="#LIMIT" class="headerlink" title="LIMIT"></a>LIMIT</h3><p>从第一行开始输出5行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select lastName,jobTitle from employees limit 5;<br>+-----------+----------------------+<br>| lastName  | jobTitle             |<br>+-----------+----------------------+<br>| Murphy    | President            |<br>| Patterson | VP Sales             |<br>| Firrelli  | VP Marketing         |<br>| Patterson | Sales Manager (APAC) |<br>| Bondur    | Sale Manager (EMEA)  |<br>+-----------+----------------------+<br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>从第5行开始 输出10行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select lastName,jobTitle from employees limit 10;<br>+-----------+----------------------+<br>| lastName  | jobTitle             |<br>+-----------+----------------------+<br>| Murphy    | President            |<br>| Patterson | VP Sales             |<br>| Firrelli  | VP Marketing         |<br>| Patterson | Sales Manager (APAC) |<br>| Bondur    | Sale Manager (EMEA)  |<br>| Bow       | Sales Manager (NA)   |<br>| Jennings  | Sales Rep            |<br>| Thompson  | Sales Rep            |<br>| Firrelli  | Sales Rep            |<br>| Patterson | Sales Rep            |<br>+-----------+----------------------+<br>10 rows in set (0.00 sec)<br><br>mysql&gt; select lastName,jobTitle from employees limit 5,5;<br>+-----------+--------------------+<br>| lastName  | jobTitle           |<br>+-----------+--------------------+<br>| Bow       | Sales Manager (NA) |<br>| Jennings  | Sales Rep          |<br>| Thompson  | Sales Rep          |<br>| Firrelli  | Sales Rep          |<br>| Patterson | Sales Rep          |<br>+-----------+--------------------+<br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>配合Order 获取最小\最大值</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select customerName,creditLimit from customers order by creditLimit limit 1;<br>+--------------------+-------------+<br>| customerName       | creditLimit |<br>+--------------------+-------------+<br>| Havel &amp; Zbyszek Co |        0.00 |<br>+--------------------+-------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select customerName,creditLimit from customers order by creditLimit desc limit 1;<br>+------------------------+-------------+<br>| customerName           | creditLimit |<br>+------------------------+-------------+<br>| Euro+ Shopping Channel |   227600.00 |<br>+------------------------+-------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><h2 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h2><p>Mysql作为关系形数据库 表中除了<code>主键</code> 还有<code>外键</code> A表中的主键可以是B表，C表的外键</p><p>所以可以利用这些<code>外键</code>为基础 链接多个表进行查询</p><p>MySQL支持以下类型的联接：</p><ol><li>内部连接</li><li>左联接</li><li>右加入</li><li>交叉联接</li></ol><h3 id="内连接"><a href="#内连接" class="headerlink" title="内连接"></a>内连接</h3><p>选择一个公共列</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT <br>    productCode, <br>    productName, <br>    textDescription<br>FROM<br>    products<br>INNER JOIN productlines USING (productline);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select concat(contactFirstName,&quot; &quot;,contactLastName) as name,orderNumber,status from orders inner join customers using (customerNumber) limit 5;<br>+-------------------+-------------+---------+<br>| name              | orderNumber | status  |<br>+-------------------+-------------+---------+<br>| Dorothy Young     |       10100 | Shipped |<br>| Roland Keitel     |       10101 | Shipped |<br>| Michael Frick     |       10102 | Shipped |<br>| Jonas  Bergulfsen |       10103 | Shipped |<br>| Diego  Freyre     |       10104 | Shipped |<br>+-------------------+-------------+---------+<br>5 rows in set (0.00 sec)<br><br></code></pre></td></tr></table></figure><p>也可以使用多表连接 表之间选不同的外键</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select customerNumber,orderNumber,orderDate,productCode from orders inner join customers using (customerNumber) inner join orderdetails using (orderNumber) limit 5;<br>+----------------+-------------+------------+-------------+<br>| customerNumber | orderNumber | orderDate  | productCode |<br>+----------------+-------------+------------+-------------+<br>|            363 |       10100 | 2003-01-06 | S18_1749    |<br>|            363 |       10100 | 2003-01-06 | S18_2248    |<br>|            363 |       10100 | 2003-01-06 | S18_4409    |<br>|            363 |       10100 | 2003-01-06 | S24_3969    |<br>|            128 |       10101 | 2003-01-09 | S18_2325    |<br>+----------------+-------------+------------+-------------+<br>5 rows in set (0.00 sec)<br><br></code></pre></td></tr></table></figure><h3 id="左连接"><a href="#左连接" class="headerlink" title="左连接"></a>左连接</h3><p><img src="/home/shanwen/Documents/Note/Pic/image-20240701174431761.png" alt="image-20240701174431761"></p><p>对比内连接来看 内连接相当于<code>交集</code> </p><p><code>from</code> 选择的表就是<code>左表</code></p><p>然后利用两表中的<code>公共列</code> 查询<code>left join</code>的<code>右表</code></p><p>若找到了 就返回相应的数据 没找到就返回<code>NULL</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select customerNumber Number,customerName,orderNumber,status from customers inner join orders using (customerNumber) where orderNumber IS NULL;<br>Empty set (0.00 sec)<br><br>mysql&gt; select customerNumber Number,customerName,orderNumber,status from customers left join orders<br>using (customerNumber) limit 10;<br>+--------+----------------------------+-------------+---------+<br>| Number | customerName               | orderNumber | status  |<br>+--------+----------------------------+-------------+---------+<br>|    103 | Atelier graphique          |       10123 | Shipped |<br>|    103 | Atelier graphique          |       10298 | Shipped |<br>|    103 | Atelier graphique          |       10345 | Shipped |<br>|    112 | Signal Gift Stores         |       10124 | Shipped |<br>|    112 | Signal Gift Stores         |       10278 | Shipped |<br>|    112 | Signal Gift Stores         |       10346 | Shipped |<br>|    114 | Australian Collectors, Co. |       10120 | Shipped |<br>|    114 | Australian Collectors, Co. |       10125 | Shipped |<br>|    114 | Australian Collectors, Co. |       10223 | Shipped |<br>|    114 | Australian Collectors, Co. |       10342 | Shipped |<br>+--------+----------------------------+-------------+---------+<br>10 rows in set (0.00 sec)<br><br>mysql&gt; select customerNumber Number,customerName,orderNumber,status from customers left join orders<br>using (customerNumber) where orderNumber IS NULL limit 5;<br>+--------+----------------------------+-------------+--------+<br>| Number | customerName               | orderNumber | status |<br>+--------+----------------------------+-------------+--------+<br>|    125 | Havel &amp; Zbyszek Co         |        NULL | NULL   |<br>|    168 | American Souvenirs Inc     |        NULL | NULL   |<br>|    169 | Porto Imports Co.          |        NULL | NULL   |<br>|    206 | Asian Shopping Network, Co |        NULL | NULL   |<br>|    223 | NatÃ¼rlich Autos           |        NULL | NULL   |<br>+--------+----------------------------+-------------+--------+<br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h3 id="右连接"><a href="#右连接" class="headerlink" title="右连接"></a>右连接</h3><p>和 <code>左连接</code>一样 选取两个表 <code>from</code> 后面是左表 <code>join</code> 后面是 <code>右表</code></p><p>在<code>右表</code> 中找数据和<code>左表</code>匹配 <code>左表</code> 匹配不上的就返回 NULL <code>右表</code> 正常输出 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select t1.officeCode,concat(t1.firstName,&#x27; &#x27;,t1.lastName) as name,t2.city,t2.state from employees t1 left join offices t2 using (officeCode);<br>+------------+-------------------+---------------+------------+<br>| officeCode | name              | city          | state      |<br>+------------+-------------------+---------------+------------+<br>| 1          | Diane Murphy      | San Francisco | CA         |<br>| 1          | Mary Patterson    | San Francisco | CA         |<br>| 1          | Jeff Firrelli     | San Francisco | CA         |<br>| 6          | William Patterson | Sydney        | NULL       |<br>| 4          | Gerard Bondur     | Paris         | NULL       |<br>| 1          | Anthony Bow       | San Francisco | CA         |<br>| 1          | Leslie Jennings   | San Francisco | CA         |<br>| 1          | Leslie Thompson   | San Francisco | CA         |<br>| 2          | Julie Firrelli    | Boston        | MA         |<br>| 2          | Steve Patterson   | Boston        | MA         |<br>| 3          | Foon Yue Tseng    | NYC           | NY         |<br>| 3          | George Vanauf     | NYC           | NY         |<br>| 4          | Loui Bondur       | Paris         | NULL       |<br>| 4          | Gerard Hernandez  | Paris         | NULL       |<br>| 4          | Pamela Castillo   | Paris         | NULL       |<br>| 7          | Larry Bott        | London        | NULL       |<br>| 7          | Barry Jones       | London        | NULL       |<br>| 6          | Andy Fixter       | Sydney        | NULL       |<br>| 6          | Peter Marsh       | Sydney        | NULL       |<br>| 6          | Tom King          | Sydney        | NULL       |<br>| 5          | Mami Nishi        | Tokyo         | Chiyoda-Ku |<br>| 5          | Yoshimi Kato      | Tokyo         | Chiyoda-Ku |<br>| 4          | Martin Gerard     | Paris         | NULL       |<br>+------------+-------------------+---------------+------------+<br>23 rows in set (0.00 sec)<br><br>mysql&gt; select t1.officeCode,concat(t1.firstName,&#x27; &#x27;,t1.lastName) as name,t2.city,t2.state from employees t1 right join offices t2 using (officeCode);<br>+------------+-------------------+---------------+------------+<br>| officeCode | name              | city          | state      |<br>+------------+-------------------+---------------+------------+<br>| 1          | Diane Murphy      | San Francisco | CA         |<br>| 1          | Mary Patterson    | San Francisco | CA         |<br>| 1          | Jeff Firrelli     | San Francisco | CA         |<br>| 1          | Anthony Bow       | San Francisco | CA         |<br>| 1          | Leslie Jennings   | San Francisco | CA         |<br>| 1          | Leslie Thompson   | San Francisco | CA         |<br>| 2          | Julie Firrelli    | Boston        | MA         |<br>| 2          | Steve Patterson   | Boston        | MA         |<br>| 3          | Foon Yue Tseng    | NYC           | NY         |<br>| 3          | George Vanauf     | NYC           | NY         |<br>| 4          | Gerard Bondur     | Paris         | NULL       |<br>| 4          | Loui Bondur       | Paris         | NULL       |<br>| 4          | Gerard Hernandez  | Paris         | NULL       |<br>| 4          | Pamela Castillo   | Paris         | NULL       |<br>| 4          | Martin Gerard     | Paris         | NULL       |<br>| 5          | Mami Nishi        | Tokyo         | Chiyoda-Ku |<br>| 5          | Yoshimi Kato      | Tokyo         | Chiyoda-Ku |<br>| 6          | William Patterson | Sydney        | NULL       |<br>| 6          | Andy Fixter       | Sydney        | NULL       |<br>| 6          | Peter Marsh       | Sydney        | NULL       |<br>| 6          | Tom King          | Sydney        | NULL       |<br>| 7          | Larry Bott        | London        | NULL       |<br>| 7          | Barry Jones       | London        | NULL       |<br>+------------+-------------------+---------------+------------+<br>23 rows in set (0.00 sec)<br><br></code></pre></td></tr></table></figure><h3 id="自连接"><a href="#自连接" class="headerlink" title="自连接"></a>自连接</h3><p>利用 <code>t1</code> 的 <code>employees</code> 字段在 <code>t2 </code> 的 <code>reportsTo</code> 字段查找</p><p><code>t1.employeeNumber = t2.reportsTo</code> 也就是找到了一行数据 包括了<code>Master</code>和<code>Slave</code></p><p>因为使用的是 <code>inner</code> 内连接 两边都有数据 才会返回 就可以查找出<code>Master</code> 和 <code>Slave</code> 的对应关系</p><p>注意</p><pre><code class="hljs">- 必须使用**表别名** `As`- 查找的方式和`inner`,`left`,`right`一样</code></pre><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt;  select t1.employeeNumber as Master,t2.employeeNumber as Slave from employees as t1 inner join employees as t2 on t1.employeeNumber = t2.reportsTo order by Master ;<br>+--------+-------+<br>| Master | Slave |<br>+--------+-------+<br>|   1002 |  1076 |<br>|   1002 |  1056 |<br>|   1056 |  1088 |<br>|   1056 |  1102 |<br>|   1056 |  1143 |<br>|   1056 |  1621 |<br>|   1088 |  1611 |<br>|   1088 |  1612 |<br>|   1088 |  1619 |<br>|   1102 |  1401 |<br>|   1102 |  1702 |<br>|   1102 |  1504 |<br>|   1102 |  1501 |<br>|   1102 |  1370 |<br>|   1102 |  1337 |<br>|   1143 |  1165 |<br>|   1143 |  1166 |<br>|   1143 |  1188 |<br>|   1143 |  1216 |<br>|   1143 |  1286 |<br>|   1143 |  1323 |<br>|   1621 |  1625 |<br>+--------+-------+<br>22 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h3 id="交叉连接"><a href="#交叉连接" class="headerlink" title="交叉连接"></a>交叉连接</h3><h2 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h2><p>什么叫分组查询呢？先来可以个例子</p><p><img src="/home/shanwen/Documents/Note/Pic/image-20240702172005549.png" alt="image-20240702172005549"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select status,count(status) from orders group by status ;<br>+------------+---------------+<br>| status     | count(status) |<br>+------------+---------------+<br>| Shipped    |           303 |<br>| Resolved   |             4 |<br>| Cancelled  |             6 |<br>| On Hold    |             4 |<br>| Disputed   |             3 |<br>| In Process |             6 |<br>+------------+---------------+<br>6 rows in set (0.00 sec)<br><br>mysql&gt; select count(status) from orders; <br>+---------------+<br>| count(status) |<br>+---------------+<br>|           326 |<br>+---------------+<br>1 row in set (0.00 sec)<br><br></code></pre></td></tr></table></figure><p>根据查询规则 首先使用 <code>group by</code> 对<code>status</code> 列进行分组 然后使用<code>count</code> 对分组后的数据进行统计 最后输出分类后的<code>status</code> 和 <code>count(status)</code></p><h3 id="HAVING"><a href="#HAVING" class="headerlink" title="HAVING"></a>HAVING</h3><p>关于where和having的区别</p><blockquote><p><code>HAVING</code> 子句和 <code>WHERE</code> 子句在 MySQL 查询中都是用于数据过滤的,但它们之间有以下几个主要区别:</p><ol><li><strong>作用时机</strong><ul><li><code>WHERE</code> 子句在数据读取阶段起作用,过滤原始数据。</li><li><code>HAVING</code> 子句在数据分组后起作用,过滤聚合结果。</li></ul></li><li><strong>对象不同</strong><ul><li><code>WHERE</code> 子句作用于单行记录,可以使用各种比较运算符。</li><li><code>HAVING</code> 子句作用于分组,可以使用聚合函数如 <code>SUM</code>、<code>AVG</code> 等。</li></ul></li><li><strong>执行顺序</strong><ul><li>SQL 执行顺序是: <code>FROM</code> -&gt; <code>WHERE</code> -&gt; <code>GROUP BY</code> -&gt; <code>HAVING</code> -&gt; <code>SELECT</code> -&gt; <code>ORDER BY</code>。</li><li>也就是说 <code>WHERE</code> 先于 <code>HAVING</code> 执行。</li></ul></li><li><strong>是否使用聚合函数</strong><ul><li><code>WHERE</code> 子句不能使用聚合函数,只能使用普通的列引用。</li><li><code>HAVING</code> 子句可以使用聚合函数对分组数据进行过滤。</li></ul></li><li><strong>性能影响</strong><ul><li><code>WHERE</code> 子句的过滤效果更好,能够在数据读取阶段过滤掉无用数据。</li><li><code>HAVING</code> 子句需要先进行分组计算,然后再进行过滤,性能略差一些。</li></ul></li></ol></blockquote><p>过滤数据 有这样一个表</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; desc orderdetails;<br>+-----------------+---------------+------+-----+---------+-------+<br>| Field           | Type          | Null | Key | Default | Extra |<br>+-----------------+---------------+------+-----+---------+-------+<br>| orderNumber     | int           | NO   | PRI | NULL    |       |<br>| productCode     | varchar(15)   | NO   | PRI | NULL    |       |<br>| quantityOrdered | int           | NO   |     | NULL    |       |<br>| priceEach       | decimal(10,2) | NO   |     | NULL    |       |<br>| orderLineNumber | smallint      | NO   |     | NULL    |       |<br>+-----------------+---------------+------+-----+---------+-------+<br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select count(productCode) from orderdetails;<br>+--------------------+<br>| count(productCode) |<br>+--------------------+<br>|               2996 |<br>+--------------------+<br>1 row in set (0.01 sec)<br><br>mysql&gt; select productCode from orderdetails group by productCode;<br>...<br>| S72_1253    |<br>| S72_3212    |<br>+-------------+<br>109 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>表结构就是 一个订单<code>orderNumber</code>对应多个产品编号<code>productCode</code>  每一个产品又被订购了<code>quantityOrdered</code>份 单价为<code>priceEach</code></p><p>所以 想知道那个订单中 那个订单少于5000</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select orderNumber,sum(quantityOrdered*priceEach) as Total from orderdetails group by orderNumber having Total &lt; 5000;<br>+-------------+---------+<br>| orderNumber | Total   |<br>+-------------+---------+<br>|       10116 | 1627.56 |<br>|       10118 | 3101.40 |<br>|       10132 | 2880.00 |<br>|       10144 | 1128.20 |<br>|       10154 | 4465.85 |<br>|       10156 | 4599.52 |<br>|       10158 | 1491.38 |<br>|       10189 | 3879.96 |<br>|       10242 | 1679.92 |<br>|       10255 | 4632.31 |<br>|       10256 | 4710.73 |<br>|       10277 | 2611.84 |<br>|       10286 | 1960.80 |<br>|       10294 | 4424.40 |<br>|       10303 | 3474.66 |<br>|       10317 | 2434.25 |<br>|       10345 | 1676.14 |<br>|       10364 | 1834.56 |<br>|       10376 | 3452.75 |<br>|       10385 | 4466.71 |<br>|       10387 | 3516.04 |<br>|       10408 |  615.45 |<br>|       10409 | 2326.18 |<br>+-------------+---------+<br>23 rows in set (0.01 sec)<br><br>mysql&gt; select orderNumber,sum(quantityOrdered*priceEach) as Total from orderdetails where orderNumber != 10116 group by orderNumber having Total &lt; 5000 ;<br>+-------------+---------+<br>| orderNumber | Total   |<br>+-------------+---------+<br>|       10118 | 3101.40 |<br>|       10132 | 2880.00 |<br>|       10144 | 1128.20 |<br>|       10154 | 4465.85 |<br>|       10156 | 4599.52 |<br>|       10158 | 1491.38 |<br>|       10189 | 3879.96 |<br>|       10242 | 1679.92 |<br>|       10255 | 4632.31 |<br>|       10256 | 4710.73 |<br>|       10277 | 2611.84 |<br>|       10286 | 1960.80 |<br>|       10294 | 4424.40 |<br>|       10303 | 3474.66 |<br>|       10317 | 2434.25 |<br>|       10345 | 1676.14 |<br>|       10364 | 1834.56 |<br>|       10376 | 3452.75 |<br>|       10385 | 4466.71 |<br>|       10387 | 3516.04 |<br>|       10408 |  615.45 |<br>|       10409 | 2326.18 |<br>+-------------+---------+<br>22 rows in set (0.01 sec)<br></code></pre></td></tr></table></figure><h3 id="HAVING-COUNT"><a href="#HAVING-COUNT" class="headerlink" title="HAVING COUNT"></a>HAVING COUNT</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; desc orders;<br>+----------------+-------------+------+-----+---------+-------+<br>| Field          | Type        | Null | Key | Default | Extra |<br>+----------------+-------------+------+-----+---------+-------+<br>| orderNumber    | int         | NO   | PRI | NULL    |       |<br>| orderDate      | date        | NO   |     | NULL    |       |<br>| requiredDate   | date        | NO   |     | NULL    |       |<br>| shippedDate    | date        | YES  |     | NULL    |       |<br>| status         | varchar(15) | NO   |     | NULL    |       |<br>| comments       | text        | YES  |     | NULL    |       |<br>| customerNumber | int         | NO   | MUL | NULL    |       |<br>+----------------+-------------+------+-----+---------+-------+<br>7 rows in set (0.00 sec)<br><br>mysql&gt; select status,count(status) from orders group by status having count(status);<br>+------------+---------------+<br>| status     | count(status) |<br>+------------+---------------+<br>| Shipped    |           303 |<br>| Resolved   |             4 |<br>| Cancelled  |             6 |<br>| On Hold    |             4 |<br>| Disputed   |             3 |<br>| In Process |             6 |<br>+------------+---------------+<br>6 rows in set (0.00 sec)<br><br>mysql&gt; select status,count(status) from orders group by status having count(status)=4;<br>+----------+---------------+<br>| status   | count(status) |<br>+----------+---------------+<br>| Resolved |             4 |<br>| On Hold  |             4 |<br>+----------+---------------+<br>2 rows in set (0.00 sec)<br><br></code></pre></td></tr></table></figure><h3 id="WITH-ROLLUP"><a href="#WITH-ROLLUP" class="headerlink" title="WITH ROLLUP"></a>WITH ROLLUP</h3><p>可以实现类似小计这样的效果</p><p>分组的步骤就是</p><p>(<code>productCode</code> , <code>quantityOrdered</code>)</p><p>(<code>productCode</code>)</p><p>(<code> </code>)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select productCode,count(quantityOrdered) as `订单数` from orderdetails group by productCode,quantityOrdered with rollup limit 20;<br>+-------------+-----------+<br>| productCode | 订单数    |<br>+-------------+-----------+<br>| S10_1678    |         1 |<br>| S10_1678    |         1 |<br>| S10_1678    |         1 |<br>| S10_1678    |         2 |<br>| S10_1678    |         1 |<br>| S10_1678    |         1 |<br>| S10_1678    |         1 |<br>| S10_1678    |         2 |<br>| S10_1678    |         2 |<br>| S10_1678    |         1 |<br>| S10_1678    |         1 |<br>| S10_1678    |         4 |<br>| S10_1678    |         3 |<br>| S10_1678    |         2 |<br>| S10_1678    |         1 |<br>| S10_1678    |         1 |<br>| S10_1678    |         1 |<br>| S10_1678    |         1 |<br>| S10_1678    |         1 |<br>| S10_1678    |        28 |<br>+-------------+-----------+<br>20 rows in set (0.01 sec)<br><br>mysql&gt; select productCode,count(quantityOrdered) as `订单数` from orderdetails group by productCode,quantityOrdered with rollup ;<br>...<br>| S72_3212    |         1 |<br>| S72_3212    |         1 |<br>| S72_3212    |         2 |<br>| S72_3212    |        27 |<br>| NULL        |      2996 |<br>+-------------+-----------+<br>2153 rows in set (0.01 sec)<br></code></pre></td></tr></table></figure><h2 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h2><p>MySQL 子查询称为内部查询，而包含子查询的查询称为外部查询。子查询可以在使用表达式的任何地方使用，并且必须用括号括起来。</p><p>以下查询使用子查询返回在美国办公室工作的员工。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; desc offices; <br>+--------------+-------------+------+-----+---------+-------+<br>| Field        | Type        | Null | Key | Default | Extra |<br>+--------------+-------------+------+-----+---------+-------+<br>| officeCode   | varchar(10) | NO   | PRI | NULL    |       |<br>| city         | varchar(50) | NO   |     | NULL    |       |<br>| phone        | varchar(50) | NO   |     | NULL    |       |<br>| addressLine1 | varchar(50) | NO   |     | NULL    |       |<br>| addressLine2 | varchar(50) | YES  |     | NULL    |       |<br>| state        | varchar(50) | YES  |     | NULL    |       |<br>| country      | varchar(50) | NO   |     | NULL    |       |<br>| postalCode   | varchar(15) | NO   |     | NULL    |       |<br>| territory    | varchar(10) | NO   |     | NULL    |       |<br>+--------------+-------------+------+-----+---------+-------+<br>9 rows in set (0.03 sec)<br><br>mysql&gt; desc employees;<br>+----------------+--------------+------+-----+---------+-------+<br>| Field          | Type         | Null | Key | Default | Extra |<br>+----------------+--------------+------+-----+---------+-------+<br>| employeeNumber | int          | NO   | PRI | NULL    |       |<br>| lastName       | varchar(50)  | NO   |     | NULL    |       |<br>| firstName      | varchar(50)  | NO   |     | NULL    |       |<br>| extension      | varchar(10)  | NO   |     | NULL    |       |<br>| email          | varchar(100) | NO   |     | NULL    |       |<br>| officeCode     | varchar(10)  | NO   | MUL | NULL    |       |<br>| reportsTo      | int          | YES  | MUL | NULL    |       |<br>| jobTitle       | varchar(50)  | NO   |     | NULL    |       |<br>+----------------+--------------+------+-----+---------+-------+<br>8 rows in set (0.00 sec)<br><br>mysql&gt; select concat(firstName,&#x27; &#x27;,lastName) as name,officeCode from employees where officeCode in (select officeCode from offices where country=&#x27;USA&#x27;);<br>+-----------------+------------+<br>| name            | officeCode |<br>+-----------------+------------+<br>| Diane Murphy    | 1          |<br>| Mary Patterson  | 1          |<br>| Jeff Firrelli   | 1          |<br>| Anthony Bow     | 1          |<br>| Leslie Jennings | 1          |<br>| Leslie Thompson | 1          |<br>| Julie Firrelli  | 2          |<br>| Steve Patterson | 2          |<br>| Foon Yue Tseng  | 3          |<br>| George Vanauf   | 3          |<br>+-----------------+------------+<br>10 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>步骤先执行内部查询<code>select officeCode from offices where country=&#39;USA&#39;</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select officeCode from offices where country=&#x27;USA&#x27;;<br>+------------+<br>| officeCode |<br>+------------+<br>| 1          |<br>| 2          |<br>| 3          |<br>+------------+<br>3 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>然后执行外部查询<code>select concat(firstName,&#39; &#39;,lastName) as name,officeCode from employees where officeCode in (1,2,3)</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select concat(firstName,&#x27; &#x27;,lastName) as name,officeCode from employees where officeCode in (1,2,3);<br>+-----------------+------------+<br>| name            | officeCode |<br>+-----------------+------------+<br>| Diane Murphy    | 1          |<br>| Mary Patterson  | 1          |<br>| Jeff Firrelli   | 1          |<br>| Anthony Bow     | 1          |<br>| Leslie Jennings | 1          |<br>| Leslie Thompson | 1          |<br>| Julie Firrelli  | 2          |<br>| Steve Patterson | 2          |<br>| Foon Yue Tseng  | 3          |<br>| George Vanauf   | 3          |<br>+-----------------+------------+<br>10 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>也可以用<code>内连接</code>完成</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select concat(firstName,&#x27; &#x27;,lastName) as name,officeCode,country from employees inner join offices using (officeCode) where country=&#x27;USA&#x27;;<br>+-----------------+------------+---------+<br>| name            | officeCode | country |<br>+-----------------+------------+---------+<br>| Diane Murphy    | 1          | USA     |<br>| Mary Patterson  | 1          | USA     |<br>| Jeff Firrelli   | 1          | USA     |<br>| Anthony Bow     | 1          | USA     |<br>| Leslie Jennings | 1          | USA     |<br>| Leslie Thompson | 1          | USA     |<br>| Julie Firrelli  | 2          | USA     |<br>| Steve Patterson | 2          | USA     |<br>| Foon Yue Tseng  | 3          | USA     |<br>| George Vanauf   | 3          | USA     |<br>+-----------------+------------+---------+<br>10 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h2 id="派生表"><a href="#派生表" class="headerlink" title="派生表"></a>派生表</h2><p>子查询是将内部查询作为外部查询的条件 派生表就是将内部查询的结果作为外部查询的数据来源 </p><p>与子查询不同，派生表必须具有别名，以便稍后在查询中引用其名称。如果派生表没有别名，MySQL 将发出以下错误：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">Every derived table must have its own alias.<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ysql&gt; desc orderdetails;<br>+-----------------+---------------+------+-----+---------+-------+<br>| Field           | Type          | Null | Key | Default | Extra |<br>+-----------------+---------------+------+-----+---------+-------+<br>| orderNumber     | int           | NO   | PRI | NULL    |       |<br>| productCode     | varchar(15)   | NO   | PRI | NULL    |       |<br>| quantityOrdered | int           | NO   |     | NULL    |       |<br>| priceEach       | decimal(10,2) | NO   |     | NULL    |       |<br>| orderLineNumber | smallint      | NO   |     | NULL    |       |<br>+-----------------+---------------+------+-----+---------+-------+<br>5 rows in set (0.00 sec)<br><br>mysql&gt; select orderNumber ,dj*dd as total from (select orderNumber,quantityOrdered as dj,priceEach as dd from orderdetails ) alias_tables where dj*dd  &lt; 500;<br>+-------------+--------+<br>| orderNumber | total  |<br>+-------------+--------+<br>|       10419 | 481.50 |<br>+-------------+--------+<br>1 row in set (0.01 sec)<br></code></pre></td></tr></table></figure><h2 id="临时表"><a href="#临时表" class="headerlink" title="临时表"></a>临时表</h2><p>仅仅在会话中存在的表 对话结束后删除</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TEMPORARY TABLE table_name(<br>   column1 datatype constraints,<br>   column1 datatype constraints,<br>   ...,<br>   table_constraints<br>);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select database();<br>+------------+<br>| database() |<br>+------------+<br>| test1      |<br>+------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; show tables;<br>+-----------------+<br>| Tables_in_test1 |<br>+-----------------+<br>| t1              |<br>| t2              |<br>+-----------------+<br>2 rows in set (0.01 sec)<br><br>mysql&gt; create temporary table temporary_t2 (select * from t2); <br>Query OK, 0 rows affected (0.02 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br></code></pre></td></tr></table></figure><h4 id="删除-1"><a href="#删除-1" class="headerlink" title="删除"></a>删除</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; drop temporary table temporary_t2;<br>Query OK, 0 rows affected (0.00 sec)<br></code></pre></td></tr></table></figure><h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><ol><li><strong>原子性 (Atomicity)</strong><ul><li>事务是最小的执行单位,要么全部执行成功,要么全部执行失败。</li><li>事务中的所有操作要么全部完成,要么全部不执行,不会出现中间状态。</li></ul></li><li><strong>一致性 (Consistency)</strong><ul><li>事务执行前后,数据库都必须从一个一致性状态转换到另一个一致性状态。</li><li>一致性约束要求事务完成后,数据库的完整性约束没有被破坏。</li></ul></li><li><strong>隔离性 (Isolation)</strong><ul><li>事务的执行不受其他事务的干扰,事务之间是相互独立的。</li><li>高并发环境下,各个事务之间的操作互不影响。</li></ul></li><li><strong>持久性 (Durability)</strong><ul><li>一个事务一旦被提交,它对数据库的改变就是永久性的。</li><li>即使发生系统崩溃,已经提交的事务的结果也不会丢失。</li></ul></li></ol><p>注意选择支持事务的存储引擎 比如 Innodb</p><p>当我们使用<code>Start Transaction</code> 就相当于拍了一次快照 并创建一个事务环境</p><p>使用<code>Commit</code> 或者 <code>rollback</code> 都会结束这次事务环境</p><p>不同得是</p><ul><li><p><code>Rollback</code>将数据恢复到执行<code>Start Transaction</code>的快照状态 快照和事务环境也会随之销毁</p></li><li><p><code>Commit</code> 将事务环境内发生的数据变化写入磁盘永久保存 快照和事务环境也会随之销毁</p></li></ul><p>自动提交是默认开启的 我们给他关闭</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> &quot;autocommit&quot;;<br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-------+</span><br><span class="hljs-operator">|</span> Variable_name <span class="hljs-operator">|</span> <span class="hljs-keyword">Value</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-------+</span><br><span class="hljs-operator">|</span> autocommit    <span class="hljs-operator">|</span> <span class="hljs-keyword">ON</span>    <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> session autocommit<span class="hljs-operator">=</span>off;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> &quot;autocommit&quot;;<br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-------+</span><br><span class="hljs-operator">|</span> Variable_name <span class="hljs-operator">|</span> <span class="hljs-keyword">Value</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-------+</span><br><span class="hljs-operator">|</span> autocommit    <span class="hljs-operator">|</span> OFF   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create table</span> t1 ( id <span class="hljs-type">int</span> <span class="hljs-keyword">primary key</span> auto_increment, name <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">not null</span>,  age <span class="hljs-type">int</span> <span class="hljs-keyword">not null</span>) <br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">character set</span> utf8, <br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> engine<span class="hljs-operator">=</span>innodb; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.08</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> t1 <span class="hljs-keyword">values</span> (<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;zs&#x27;</span>,<span class="hljs-number">18</span>);<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">start</span> transaction; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> t1 <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span>; <br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t1;<br><span class="hljs-keyword">Empty</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">rollback</span>; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t1;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+-----+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span> age <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+-----+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> zs   <span class="hljs-operator">|</span>  <span class="hljs-number">18</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+-----+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>注意 rollback并不会回滚到执行的前一句命令 而是快照开启的时候</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create table</span> transaction ( id <span class="hljs-type">int</span> <span class="hljs-keyword">primary key</span> auto_increment, name <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">not null</span> ); <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.09</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">start</span> transaction; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert  into</span> transaction <span class="hljs-keyword">values</span> (<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;zs&#x27;</span>);<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert  into</span> transaction <span class="hljs-keyword">values</span> (<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;ls&#x27;</span>);<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">rollback</span>; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> transaction;<br><span class="hljs-operator">+</span><span class="hljs-comment">----------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------+</span><br><span class="hljs-operator">|</span>        <span class="hljs-number">0</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><h2 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h2><h3 id="Read"><a href="#Read" class="headerlink" title="Read"></a>Read</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from transaction;<br>Empty set (0.00 sec)<br><br>mysql&gt; select connection_id(); <br>+-----------------+<br>| connection_id() |<br>+-----------------+<br>|              11 |<br>+-----------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; insert into transaction values (1,&#x27;zs&#x27;); <br>Query OK, 1 row affected (0.02 sec)<br><br>mysql&gt; lock tables transaction read; <br>Query OK, 0 rows affected (0.00 sec)<br><br>mysql&gt; insert into transaction values (2,&#x27;ls&#x27;);<br>ERROR 1099 (HY000): Table &#x27;transaction&#x27; was locked with a READ lock and can&#x27;t be updated<br><br>mysql&gt; select * from transaction;<br>+----+------+<br>| id | name |<br>+----+------+<br>|  1 | zs   |<br>+----+------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>在当前连接开启锁 <strong>所有连接</strong>插入数据时就会报错 因为是<code>Read</code>锁 只可读</p><p>打开一个新连接 尝试向该表中 插入数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> connection_id(); <br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-operator">|</span> connection_id() <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-operator">|</span>              <span class="hljs-number">12</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> testDB.transaction;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> zs   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-number">1</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> transaction <span class="hljs-keyword">values</span> (<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;ls&#x27;</span>);<br><br></code></pre></td></tr></table></figure><p>新连接会卡住 因为它在等待<code>锁的释放</code> </p><p>在有锁的连接中释放锁(其他连接无法解锁) 该连接的语句就会执行</p><p>或者关闭有锁的连接 这个锁也会释放</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> unlock tables; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> connection_id();<br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-operator">|</span> connection_id() <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-operator">|</span>              <span class="hljs-number">11</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> connection_id(); <br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-operator">|</span> connection_id() <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-operator">|</span>              <span class="hljs-number">12</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> transaction <span class="hljs-keyword">values</span> (<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;ls&#x27;</span>);<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">2</span> min <span class="hljs-number">28.10</span> sec)<br><br></code></pre></td></tr></table></figure><h3 id="Write"><a href="#Write" class="headerlink" title="Write"></a>Write</h3><p><code>Read</code> 锁开启时 主连接和其他连接都不能写入数据 但都可以读取数据</p><p><code>Write</code> 锁开启时 <strong>主连接可以读写 其他连接不能读取</strong></p><p>也就是独享和共享的区别</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> transaction; <br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> zs   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span> ls   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">3</span> <span class="hljs-operator">|</span> ww   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-number">3</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> connection_id(); <br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-operator">|</span> connection_id() <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-operator">|</span>              <span class="hljs-number">11</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> lock tables transaction write; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> transaction <span class="hljs-keyword">values</span> (<span class="hljs-number">4</span>,<span class="hljs-string">&#x27;zl&#x27;</span>); <br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> transaction;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> zs   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span> ls   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">3</span> <span class="hljs-operator">|</span> ww   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">4</span> <span class="hljs-operator">|</span> zl   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-number">4</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>其他连接在<code>Write</code>锁下 读取和写入将会挂起 等待锁的释放 甚至无法进入存在锁表的数据库</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> connection_id();<br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-operator">|</span> connection_id() <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-operator">|</span>              <span class="hljs-number">15</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> transaction;<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> use testDB;<br>Reading <span class="hljs-keyword">table</span> information <span class="hljs-keyword">for</span> completion <span class="hljs-keyword">of</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">column</span> names<br>You can turn off this feature <span class="hljs-keyword">to</span> <span class="hljs-keyword">get</span> a quicker startup <span class="hljs-keyword">with</span> <span class="hljs-operator">-</span>A<br><br></code></pre></td></tr></table></figure><p>在主连接释放锁后  其他表即可继续操作</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> connection_id();<br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-operator">|</span> connection_id() <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-operator">|</span>              <span class="hljs-number">15</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> transaction;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> zs   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span> ls   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">3</span> <span class="hljs-operator">|</span> ww   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">4</span> <span class="hljs-operator">|</span> zl   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-number">4</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">1</span> min <span class="hljs-number">24.29</span> sec)<br><br></code></pre></td></tr></table></figure><h1 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h1><p>数据库编程</p><h2 id="创建存储函数"><a href="#创建存储函数" class="headerlink" title="创建存储函数"></a>创建存储函数</h2><p>默认的SQl语句会在输入<code>;</code>后结束 存储过程需要<code>;</code>当作普通语言中的<code>&#123;&#125;</code></p><h3 id="更改结束符"><a href="#更改结束符" class="headerlink" title="更改结束符"></a>更改结束符</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; delimiter ~<br></code></pre></td></tr></table></figure><h3 id="书写存储函数"><a href="#书写存储函数" class="headerlink" title="书写存储函数"></a>书写存储函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span> Selects() <span class="hljs-keyword">begin</span> <span class="hljs-keyword">declare</span> Poerson <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>); <span class="hljs-keyword">declare</span> Number <span class="hljs-type">int</span>; <span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">into</span> Number <span class="hljs-keyword">from</span> 员工表 <span class="hljs-keyword">where</span> 部门<span class="hljs-operator">=</span><span class="hljs-string">&#x27;销售部&#x27;</span> ; <span class="hljs-keyword">set</span> Poerson<span class="hljs-operator">=</span><span class="hljs-string">&#x27;销售部&#x27;</span>; <span class="hljs-keyword">select</span> Poerson,Number; <span class="hljs-keyword">end</span>;<span class="hljs-operator">~</span><br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">call</span> Selects()<span class="hljs-operator">~</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------+--------+</span><br><span class="hljs-operator">|</span> Poerson   <span class="hljs-operator">|</span> Number <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------+--------+</span><br><span class="hljs-operator">|</span> 销售部    <span class="hljs-operator">|</span>      <span class="hljs-number">6</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------+--------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><h3 id="结束符修改为"><a href="#结束符修改为" class="headerlink" title="结束符修改为;"></a>结束符修改为<code>;</code></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; delimiter ~<br></code></pre></td></tr></table></figure><h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><h2 id="count"><a href="#count" class="headerlink" title="count"></a>count</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select count(*) from customers;<br>+----------+<br>| count(*) |<br>+----------+<br>|      122 |<br>+----------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><h2 id="concat"><a href="#concat" class="headerlink" title="concat"></a>concat</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select concat(&#x27;1&#x27;,&#x27;2&#x27;); <br>+-----------------+<br>| concat(&#x27;1&#x27;,&#x27;2&#x27;) |<br>+-----------------+<br>| 12              |<br>+-----------------+<br></code></pre></td></tr></table></figure><h2 id="concat-ws"><a href="#concat-ws" class="headerlink" title="concat_ws"></a>concat_ws</h2><p>和<code>concat</code>差不多 只是在第一个字段就指定了分隔符</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select concat_ws(&#x27; &#x27;,firstName,lastName) as name,email from employees limit 5;<br>+-------------------+---------------------------------+<br>| name              | email                           |<br>+-------------------+---------------------------------+<br>| Diane Murphy      | dmurphy@classicmodelcars.com    |<br>| Mary Patterson    | mpatterso@classicmodelcars.com  |<br>| Jeff Firrelli     | jfirrelli@classicmodelcars.com  |<br>| William Patterson | wpatterson@classicmodelcars.com |<br>| Gerard Bondur     | gbondur@classicmodelcars.com    |<br>+-------------------+---------------------------------+<br>5 rows in set (0.00 sec)<br><br>mysql&gt; select concat(firstName,&#x27; &#x27;,lastName) as name,email from employees limit 5;<br>+-------------------+---------------------------------+<br>| name              | email                           |<br>+-------------------+---------------------------------+<br>| Diane Murphy      | dmurphy@classicmodelcars.com    |<br>| Mary Patterson    | mpatterso@classicmodelcars.com  |<br>| Jeff Firrelli     | jfirrelli@classicmodelcars.com  |<br>| William Patterson | wpatterson@classicmodelcars.com |<br>| Gerard Bondur     | gbondur@classicmodelcars.com    |<br>+-------------------+---------------------------------+<br>5 rows in set (0.00 sec)<br><br>## Full name 需要使用` `修饰<br>mysql&gt; select concat(firstName,&#x27; &#x27;,lastName) as `Full name`,email from employees limit 5;<br>+-------------------+---------------------------------+<br>| Full name         | email                           |<br>+-------------------+---------------------------------+<br>| Diane Murphy      | dmurphy@classicmodelcars.com    |<br>| Mary Patterson    | mpatterso@classicmodelcars.com  |<br>| Jeff Firrelli     | jfirrelli@classicmodelcars.com  |<br>| William Patterson | wpatterson@classicmodelcars.com |<br>| Gerard Bondur     | gbondur@classicmodelcars.com    |<br>+-------------------+---------------------------------+<br>5 rows in set (0.01 sec)<br></code></pre></td></tr></table></figure><h1 id="备份恢复"><a href="#备份恢复" class="headerlink" title="备份恢复"></a>备份恢复</h1><h2 id="mysqldump导出"><a href="#mysqldump导出" class="headerlink" title="mysqldump导出"></a>mysqldump导出</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">Dumping structure <span class="hljs-keyword">and</span> contents <span class="hljs-keyword">of</span> MySQL databases <span class="hljs-keyword">and</span> tables.<br>Usage: mysqldump [OPTIONS] database [tables]<br><span class="hljs-keyword">OR</span>     mysqldump [OPTIONS] <span class="hljs-comment">--databases [OPTIONS] DB1 [DB2 DB3...]</span><br><span class="hljs-keyword">OR</span>     mysqldump [OPTIONS] <span class="hljs-comment">--all-databases [OPTIONS]</span><br></code></pre></td></tr></table></figure><h3 id="导出数据表"><a href="#导出数据表" class="headerlink" title="导出数据表"></a>导出数据表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# mysqldump <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>p testDB t1 <span class="hljs-operator">&gt;</span> testDB.t1.sql<br>Enter password: <br>[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# wc <span class="hljs-operator">-</span>l testDB.t1.sql <br><span class="hljs-number">51</span> testDB.t1.sql<br>[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# cat testDB.t1.sql <br><span class="hljs-comment">-- MySQL dump 10.13  Distrib 8.0.38, for Linux (x86_64)</span><br><span class="hljs-comment">--</span><br><span class="hljs-comment">-- Host: localhost    Database: testDB</span><br><span class="hljs-comment">-- ------------------------------------------------------</span><br><span class="hljs-comment">-- Server version8.0.38</span><br><br><span class="hljs-comment">/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */</span>;<br><span class="hljs-comment">/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */</span>;<br><span class="hljs-comment">/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */</span>;<br><span class="hljs-comment">/*!50503 SET NAMES utf8mb4 */</span>;<br><span class="hljs-comment">/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */</span>;<br><span class="hljs-comment">/*!40103 SET TIME_ZONE=&#x27;+00:00&#x27; */</span>;<br><span class="hljs-comment">/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */</span>;<br><span class="hljs-comment">/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */</span>;<br><span class="hljs-comment">/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE=&#x27;NO_AUTO_VALUE_ON_ZERO&#x27; */</span>;<br><span class="hljs-comment">/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */</span>;<br><br><span class="hljs-comment">--</span><br><span class="hljs-comment">-- Table structure for table `t1`</span><br><span class="hljs-comment">--</span><br><br><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">EXISTS</span> `t1`;<br><span class="hljs-comment">/*!40101 SET @saved_cs_client     = @@character_set_client */</span>;<br><span class="hljs-comment">/*!50503 SET character_set_client = utf8mb4 */</span>;<br><span class="hljs-keyword">CREATE TABLE</span> `t1` (<br>  `id` <span class="hljs-type">int</span> <span class="hljs-keyword">NOT NULL</span> AUTO_INCREMENT,<br>  `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT NULL</span>,<br>  <span class="hljs-keyword">PRIMARY KEY</span> (`id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB AUTO_INCREMENT<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb3;<br><span class="hljs-comment">/*!40101 SET character_set_client = @saved_cs_client */</span>;<br><br><span class="hljs-comment">--</span><br><span class="hljs-comment">-- Dumping data for table `t1`</span><br><span class="hljs-comment">--</span><br><br>LOCK TABLES `t1` WRITE;<br><span class="hljs-comment">/*!40000 ALTER TABLE `t1` DISABLE KEYS */</span>;<br><span class="hljs-keyword">INSERT INTO</span> `t1` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;zs&#x27;</span>);<br><span class="hljs-comment">/*!40000 ALTER TABLE `t1` ENABLE KEYS */</span>;<br>UNLOCK TABLES;<br><span class="hljs-comment">/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */</span>;<br><br><span class="hljs-comment">/*!40101 SET SQL_MODE=@OLD_SQL_MODE */</span>;<br><span class="hljs-comment">/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */</span>;<br><span class="hljs-comment">/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */</span>;<br><span class="hljs-comment">/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */</span>;<br><span class="hljs-comment">/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */</span>;<br><span class="hljs-comment">/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */</span>;<br><span class="hljs-comment">/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */</span>;<br><br><span class="hljs-comment">-- Dump completed on 2024-08-05 18:17:07</span><br></code></pre></td></tr></table></figure><h3 id="导出数据库"><a href="#导出数据库" class="headerlink" title="导出数据库"></a>导出数据库</h3><p>导出表时也会将创建库时间语句dump下来</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# mysqldump <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>p testDB <span class="hljs-operator">&gt;</span> testDB.sql<br>Enter password: <br><br>[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# wc <span class="hljs-operator">-</span>l testDB.t1.sql<br><span class="hljs-number">51</span> testDB.t1.sql<br>[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# wc <span class="hljs-operator">-</span>l testDB.sql <br><span class="hljs-number">51</span> testDB.sql<br><br></code></pre></td></tr></table></figure><h3 id="导出所有数据库"><a href="#导出所有数据库" class="headerlink" title="导出所有数据库"></a>导出所有数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# mysqldump <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>p <span class="hljs-comment">--all-databases &gt; all.sql</span><br>Enter password: <br>[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# wc <span class="hljs-operator">-</span>l all.sql<br><span class="hljs-number">1071</span> all.sql<br><br></code></pre></td></tr></table></figure><h2 id="导入SQL文件"><a href="#导入SQL文件" class="headerlink" title="导入SQL文件"></a>导入SQL文件</h2><h3 id="导入表"><a href="#导入表" class="headerlink" title="导入表"></a>导入表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>pqweQWE123 testDB <span class="hljs-operator">-</span>e <span class="hljs-string">&#x27;drop table t1&#x27;</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br><br>[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>pqweQWE123 testDB <span class="hljs-operator">&lt;</span> testDB.t1.sql <br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br><br>[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>pqweQWE123 testDB <span class="hljs-operator">-</span>e <span class="hljs-string">&#x27;show tables;&#x27;</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span><br><span class="hljs-operator">|</span> Tables_in_testDB <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span><br><span class="hljs-operator">|</span> t1               <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span><br></code></pre></td></tr></table></figure><h3 id="导入库"><a href="#导入库" class="headerlink" title="导入库"></a>导入库</h3><p>需要导入的库 需要提前存在</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>p  <span class="hljs-operator">-</span>e  <span class="hljs-string">&#x27;show databases;&#x27;</span><br>Enter password: <br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql              <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> sys                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br>[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>pqweQWE123 <span class="hljs-operator">-</span>e <span class="hljs-string">&#x27;create database testDB;&#x27;</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br>[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>pqweQWE123 <span class="hljs-operator">&lt;</span> testDB.sql <br>[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>pqweQWE123 <span class="hljs-operator">-</span>e <span class="hljs-string">&#x27;show databases;&#x27;</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql              <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> sys                <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> testDB             <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br></code></pre></td></tr></table></figure><h3 id="导入全部库"><a href="#导入全部库" class="headerlink" title="导入全部库"></a>导入全部库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>pqweQWE123 <span class="hljs-operator">-</span>e <span class="hljs-string">&#x27;show databases;&#x27;</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql              <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> sys                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br>[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>pqweQWE123 <span class="hljs-operator">&lt;</span> all.sql <br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br>[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>pqweQWE123 <span class="hljs-operator">-</span>e <span class="hljs-string">&#x27;show databases;&#x27;</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql              <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> sys                <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> testDB             <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><br></code></pre></td></tr></table></figure><h3 id="source"><a href="#source" class="headerlink" title="source"></a>source</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; source /path/file.sql<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; source /root/mysqlsampledatabase.sql <br>Query OK, 1 row affected (0.04 sec)<br><br>Database changed<br>Query OK, 0 rows affected, 1 warning (0.00 sec)<br><br>Query OK, 0 rows affected, 1 warning (0.00 sec)<br><br>Query OK, 0 rows affected, 1 warning (0.01 sec)<br><br>Query OK, 0 rows affected, 1 warning (0.01 sec)<br><br>Query OK, 0 rows affected, 1 warning (0.00 sec)<br><br>Query OK, 0 rows affected, 1 warning (0.01 sec)<br><br>Query OK, 0 rows affected, 1 warning (0.00 sec)<br><br>Query OK, 0 rows affected, 1 warning (0.01 sec)<br><br>mysql&gt; show databases;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| classicmodels      |<br>| information_schema |<br>| mysql              |<br>| performance_schema |<br>| sys                |<br>+--------------------+<br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h1 id="主备"><a href="#主备" class="headerlink" title="主备"></a>主备</h1><p>主备是通过<code>Binlog</code>的文件进行的 </p><ol><li>主库会维护自己的<code>Binlog</code> 从库也会定时从主库获取<code>Binlog</code>的信息 这叫做<code>中继日志拉取</code></li><li>从库将<code>Binlog</code> 导入到自己的 <code>中继日志</code> 然后读取<code>中继日志</code> 执行这些<code>Binlog</code> 实现同步</li><li><strong>主从同步机制</strong>:<ul><li>全量复制: 当从库第一次与主库建立连接时,需要进行全量复制,即从主库将整个数据库复制到从库。</li><li>增量复制: 全量复制完成后,从库会持续拉取主库的二进制日志,实现增量同步。</li></ul></li></ol><h2 id="Binlog"><a href="#Binlog" class="headerlink" title="Binlog"></a>Binlog</h2><p>二进制日志是存储对 MySQL 数据库的更改的文件。这些日志包含一系列事件，这些事件表示对数据和数据库对象 （如表、视图、数据库等） 的修改。<code>Create Drop Delete</code>  </p><p>只有导致数据库发生更改的语句才会记录 <code>Select Show</code>等语句就不会记录到<code>Binlog</code>中 </p><p><code>Binlog</code>的作用包括 <strong>时间点恢复</strong>、<strong>主备复制</strong></p><p>当然也会对性能产生影响 默认是开启的且格式为<code>ROW</code> 且无法在服务器运行时关闭 只能在配置文件中指定<strong>参数</strong>关闭</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> <span class="hljs-keyword">global</span> variables <span class="hljs-keyword">like</span> &quot;log_bin&quot;; <br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-------+</span><br><span class="hljs-operator">|</span> Variable_name <span class="hljs-operator">|</span> <span class="hljs-keyword">Value</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-------+</span><br><span class="hljs-operator">|</span> log_bin       <span class="hljs-operator">|</span> <span class="hljs-keyword">ON</span>    <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> <span class="hljs-keyword">global</span> variables <span class="hljs-keyword">like</span> &quot;log_bin&quot;;<br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-------+</span><br><span class="hljs-operator">|</span> Variable_name <span class="hljs-operator">|</span> <span class="hljs-keyword">Value</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-------+</span><br><span class="hljs-operator">|</span> log_bin       <span class="hljs-operator">|</span> OFF   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">global</span> log_bin <span class="hljs-operator">=</span> off;<br>ERROR <span class="hljs-number">1238</span> (HY000): Variable <span class="hljs-string">&#x27;log_bin&#x27;</span> <span class="hljs-keyword">is</span> a read <span class="hljs-keyword">only</span> variable<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@MySQL01 ~]# mysqld --verbose --help | grep log-bin<br>  --log-bin[=name]    Configures the name prefix to use for binary log files.<br>                      If the --log-bin option is not supplied, the name prefix<br>                      defaults to &quot;binlog&quot;. If the --log-bin option is supplied<br>                      --log-bin=name. To disable binary logging, use the<br>                      --skip-log-bin or --disable-log-bin option.<br><br>[root@MySQL01 ~]# systemctl restart mysqld.service <br>[root@MySQL01 ~]# cat /etc/my.cnf<br>[client-server]<br><br>[mysqld]<br>skip-log-bin<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">show global variables like <span class="hljs-string">&quot;log_bin&quot;</span>;</span><br>+---------------+-------+<br>| Variable_name | Value |<br>+---------------+-------+<br>| log_bin       | OFF   |<br>+---------------+-------+<br>1 row in set (0.02 sec)<br></code></pre></td></tr></table></figure><p><code>Binlog</code>支持多种格式</p><ul><li>基于语句的 （） – 允许日志记录使用基于行的日志记录。<code>STATEMENT</code></li><li>Row-based （） – 允许日志记录使用基于行的。<code>ROW</code></li><li>Mixed format （） – 允许日志记录使用混合格式。<code>MIXED</code></li></ul><h3 id="保存位置"><a href="#保存位置" class="headerlink" title="保存位置"></a>保存位置</h3><p>默认保存在<code>datadir</code>目录下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">mysql&gt; show variables like <span class="hljs-string">&quot;%datadir%&quot;</span>;<br>+---------------+-----------------+<br>| Variable_name | Value           |<br>+---------------+-----------------+<br>| datadir       | /var/lib/mysql/ |<br>+---------------+-----------------+<br>1 row <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.01 sec)<br><br>mysql&gt; ^DBye<br>[root@MySQL01 ~]# <span class="hljs-built_in">cat</span> /etc/my.cnf.d/mysql-server.cnf | grep -v <span class="hljs-string">&#x27;#&#x27;</span><br><br>[mysqld]<br>datadir=/var/lib/mysql<br>socket=/var/lib/mysql/mysql.sock<br>log-error=/var/log/mysql/mysqld.log<br>pid-file=/run/mysqld/mysqld.pid<br><br>[root@MySQL01 ~]# <span class="hljs-built_in">ls</span> /var/lib/mysql | grep binlog | <span class="hljs-built_in">wc</span> -l <br>16<br></code></pre></td></tr></table></figure><h3 id="显示当前的Binlog"><a href="#显示当前的Binlog" class="headerlink" title="显示当前的Binlog"></a>显示当前的<code>Binlog</code></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> <span class="hljs-type">binary</span> logs; <br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-----------+-----------+</span><br><span class="hljs-operator">|</span> Log_name      <span class="hljs-operator">|</span> File_size <span class="hljs-operator">|</span> Encrypted <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-----------+-----------+</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000001</span> <span class="hljs-operator">|</span>      <span class="hljs-number">7595</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000002</span> <span class="hljs-operator">|</span>   <span class="hljs-number">1260239</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000003</span> <span class="hljs-operator">|</span>       <span class="hljs-number">808</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000004</span> <span class="hljs-operator">|</span>      <span class="hljs-number">2215</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000005</span> <span class="hljs-operator">|</span>      <span class="hljs-number">5533</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000006</span> <span class="hljs-operator">|</span>      <span class="hljs-number">3046</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000007</span> <span class="hljs-operator">|</span>      <span class="hljs-number">1752</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000008</span> <span class="hljs-operator">|</span>       <span class="hljs-number">180</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000009</span> <span class="hljs-operator">|</span>       <span class="hljs-number">180</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000010</span> <span class="hljs-operator">|</span>       <span class="hljs-number">157</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000011</span> <span class="hljs-operator">|</span>       <span class="hljs-number">378</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000012</span> <span class="hljs-operator">|</span>       <span class="hljs-number">180</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000013</span> <span class="hljs-operator">|</span>       <span class="hljs-number">180</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000014</span> <span class="hljs-operator">|</span>       <span class="hljs-number">180</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000015</span> <span class="hljs-operator">|</span>       <span class="hljs-number">157</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-----------+-----------+</span><br><span class="hljs-number">15</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> master status;<br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+----------+--------------+------------------+-------------------+</span><br><span class="hljs-operator">|</span> File          <span class="hljs-operator">|</span> Position <span class="hljs-operator">|</span> Binlog_Do_DB <span class="hljs-operator">|</span> Binlog_Ignore_DB <span class="hljs-operator">|</span> Executed_Gtid_Set <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+----------+--------------+------------------+-------------------+</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000015</span> <span class="hljs-operator">|</span>      <span class="hljs-number">157</span> <span class="hljs-operator">|</span>              <span class="hljs-operator">|</span>                  <span class="hljs-operator">|</span>                   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+----------+--------------+------------------+-------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br></code></pre></td></tr></table></figure><h3 id="删除binlog"><a href="#删除binlog" class="headerlink" title="删除binlog"></a>删除<code>binlog</code></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show binary logs; <br>+---------------+-----------+-----------+<br>| Log_name      | File_size | Encrypted |<br>+---------------+-----------+-----------+<br>| binlog.000001 |      7595 | No        |<br>| binlog.000002 |   1260239 | No        |<br>| binlog.000003 |       808 | No        |<br>| binlog.000004 |      2215 | No        |<br>| binlog.000005 |      5533 | No        |<br>| binlog.000006 |      3046 | No        |<br>| binlog.000007 |      1752 | No        |<br>| binlog.000008 |       180 | No        |<br>| binlog.000009 |       180 | No        |<br>| binlog.000010 |       157 | No        |<br>| binlog.000011 |       378 | No        |<br>| binlog.000012 |       180 | No        |<br>| binlog.000013 |       180 | No        |<br>| binlog.000014 |       180 | No        |<br>| binlog.000015 |       157 | No        |<br>| binlog.000016 |       180 | No        |<br>| binlog.000017 |       180 | No        |<br>| binlog.000018 |       180 | No        |<br>| binlog.000019 |       180 | No        |<br>| binlog.000020 |       157 | No        |<br>+---------------+-----------+-----------+<br>20 rows in set (0.00 sec)<br><br>mysql&gt; purge binary logs to &#x27;binlog.000020&#x27;;<br>Query OK, 0 rows affected (0.02 sec)<br><br>mysql&gt; show binary logs; <br>+---------------+-----------+-----------+<br>| Log_name      | File_size | Encrypted |<br>+---------------+-----------+-----------+<br>| binlog.000020 |       157 | No        |<br>+---------------+-----------+-----------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; show master status;<br>+---------------+----------+--------------+------------------+-------------------+<br>| File          | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |<br>+---------------+----------+--------------+------------------+-------------------+<br>| binlog.000020 |      157 |              |                  |                   |<br>+---------------+----------+--------------+------------------+-------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><h3 id="刷新Binlog"><a href="#刷新Binlog" class="headerlink" title="刷新Binlog"></a>刷新<code>Binlog</code></h3><p>这会直接结束当前的<code>binlog</code> 使用下一个<code>binlog</code></p><blockquote><p> flush binary logs; </p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> master status; <br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+----------+--------------+------------------+-------------------+</span><br><span class="hljs-operator">|</span> File          <span class="hljs-operator">|</span> Position <span class="hljs-operator">|</span> Binlog_Do_DB <span class="hljs-operator">|</span> Binlog_Ignore_DB <span class="hljs-operator">|</span> Executed_Gtid_Set <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+----------+--------------+------------------+-------------------+</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000020</span> <span class="hljs-operator">|</span>      <span class="hljs-number">735</span> <span class="hljs-operator">|</span>              <span class="hljs-operator">|</span>                  <span class="hljs-operator">|</span>                   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+----------+--------------+------------------+-------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> flush <span class="hljs-type">binary</span> logs; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> master status;<br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+----------+--------------+------------------+-------------------+</span><br><span class="hljs-operator">|</span> File          <span class="hljs-operator">|</span> Position <span class="hljs-operator">|</span> Binlog_Do_DB <span class="hljs-operator">|</span> Binlog_Ignore_DB <span class="hljs-operator">|</span> Executed_Gtid_Set <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+----------+--------------+------------------+-------------------+</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000021</span> <span class="hljs-operator">|</span>      <span class="hljs-number">157</span> <span class="hljs-operator">|</span>              <span class="hljs-operator">|</span>                  <span class="hljs-operator">|</span>                   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+----------+--------------+------------------+-------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> <span class="hljs-type">binary</span> logs; <br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-----------+-----------+</span><br><span class="hljs-operator">|</span> Log_name      <span class="hljs-operator">|</span> File_size <span class="hljs-operator">|</span> Encrypted <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-----------+-----------+</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000020</span> <span class="hljs-operator">|</span>       <span class="hljs-number">779</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000021</span> <span class="hljs-operator">|</span>       <span class="hljs-number">157</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-----------+-----------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br><br></code></pre></td></tr></table></figure><h3 id="查看binlog内容"><a href="#查看binlog内容" class="headerlink" title="查看binlog内容"></a>查看<code>binlog</code>内容</h3><p>直接查看时会乱码 使用<code>mysqlbinlog</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@MySQL01 mysql]# <span class="hljs-built_in">cat</span> binlog.000020<br>b�<span class="hljs-keyword">in</span>��fz~8.0.38��f<br><br><br>**4<br>(����f#����a���f<span class="hljs-string">&quot;M��7�[� ¦8-2����f2 �Estd���</span><br><span class="hljs-string">                                            testDB2</span><br><span class="hljs-string">�testDB2create database testDB2;*)�</span><br><span class="hljs-string">                                   ��f&quot;</span>M����\� ¦8r�3<br><br>                                                    ��f2 �Estd���<br>                                                                 testDB3<br>                                                                        �testDB3create database testDB3&amp;,��f<span class="hljs-string">&quot;Mn&quot;</span>��^� ��8�S�,��f0 �Estd���<br>                      testDB2�testDB2drop database testDB2�/�e���f,<br>                                                                   binlog.000021���S[root@MySQL01 mysql]# <br><br><br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@MySQL01</span> mysql]# mysqlbinlog binlog<span class="hljs-number">.000020</span> <span class="hljs-operator">&gt;</span> <span class="hljs-operator">~</span><span class="hljs-operator">/</span>binlog20.sql<br>[root<span class="hljs-variable">@MySQL01</span> mysql]# vim <span class="hljs-operator">~</span><span class="hljs-operator">/</span>binlog20.sql<br><br></code></pre></td></tr></table></figure><h3 id="时间点恢复"><a href="#时间点恢复" class="headerlink" title="时间点恢复"></a>时间点恢复</h3><p>需要<code>innode</code>存储引擎支持 并且服务器开启<code>binlog</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> <span class="hljs-type">binary</span> logs; <br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-----------+-----------+</span><br><span class="hljs-operator">|</span> Log_name      <span class="hljs-operator">|</span> File_size <span class="hljs-operator">|</span> Encrypted <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-----------+-----------+</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000020</span> <span class="hljs-operator">|</span>       <span class="hljs-number">779</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000021</span> <span class="hljs-operator">|</span>       <span class="hljs-number">157</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-----------+-----------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> purge <span class="hljs-type">binary</span> logs <span class="hljs-keyword">to</span> <span class="hljs-string">&#x27;binlog.000021&#x27;</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.04</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> master status;<br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+----------+--------------+------------------+-------------------+</span><br><span class="hljs-operator">|</span> File          <span class="hljs-operator">|</span> Position <span class="hljs-operator">|</span> Binlog_Do_DB <span class="hljs-operator">|</span> Binlog_Ignore_DB <span class="hljs-operator">|</span> Executed_Gtid_Set <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+----------+--------------+------------------+-------------------+</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000021</span> <span class="hljs-operator">|</span>      <span class="hljs-number">157</span> <span class="hljs-operator">|</span>              <span class="hljs-operator">|</span>                  <span class="hljs-operator">|</span>                   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+----------+--------------+------------------+-------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br><br></code></pre></td></tr></table></figure><p>创建一个数据库和表 并插入数据 <code>binlogs</code> <code>t1</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases; <br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql              <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> sys                <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> testDB             <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> testDB3            <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-number">6</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> database logbins; <br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.06</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create table</span> logbins.t1 (id <span class="hljs-type">int</span> <span class="hljs-keyword">primary key</span> auto_increment,name <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">not null</span>); <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.14</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> logbins.t1 <span class="hljs-keyword">values</span> (<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;zs&#x27;</span>),(<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;ls&#x27;</span>); <br>Query OK, <span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.07</span> sec)<br>Records: <span class="hljs-number">2</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> logbins.t1; <br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> zs   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span> ls   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>删除数据库<code>binlogs</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">drop</span> database logbins; <br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.07</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> <span class="hljs-type">binary</span> logs; <br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-----------+-----------+</span><br><span class="hljs-operator">|</span> Log_name      <span class="hljs-operator">|</span> File_size <span class="hljs-operator">|</span> Encrypted <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-----------+-----------+</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000021</span> <span class="hljs-operator">|</span>      <span class="hljs-number">1081</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-----------+-----------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br><br></code></pre></td></tr></table></figure><p>利用<code>mysqlbinlog</code>进行时间点恢复</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@MySQL01</span> <span class="hljs-operator">~</span>]#  mysqlbinlog  <span class="hljs-comment">--verbose /var/lib/mysql/binlog.000021 | grep -i -C 10 drop</span><br>#<span class="hljs-number">240827</span> <span class="hljs-number">16</span>:<span class="hljs-number">40</span>:<span class="hljs-number">17</span> server id <span class="hljs-number">1</span>  end_log_pos <span class="hljs-number">968</span> CRC32 <span class="hljs-number">0x1e24d6cf</span> Anonymous_GTIDlast_committed<span class="hljs-operator">=</span><span class="hljs-number">3</span>sequence_number<span class="hljs-operator">=</span><span class="hljs-number">4</span>rbr_only<span class="hljs-operator">=</span><span class="hljs-keyword">no</span>original_committed_timestamp<span class="hljs-operator">=</span><span class="hljs-number">1724748017242734</span>immediate_commit_timestamp<span class="hljs-operator">=</span><span class="hljs-number">1724748017242734</span>transaction_length<span class="hljs-operator">=</span><span class="hljs-number">190</span><br># original_commit_timestamp<span class="hljs-operator">=</span><span class="hljs-number">1724748017242734</span> (<span class="hljs-number">2024</span><span class="hljs-number">-08</span><span class="hljs-number">-27</span> <span class="hljs-number">16</span>:<span class="hljs-number">40</span>:<span class="hljs-number">17.242734</span> CST)<br># immediate_commit_timestamp<span class="hljs-operator">=</span><span class="hljs-number">1724748017242734</span> (<span class="hljs-number">2024</span><span class="hljs-number">-08</span><span class="hljs-number">-27</span> <span class="hljs-number">16</span>:<span class="hljs-number">40</span>:<span class="hljs-number">17.242734</span> CST)<br><span class="hljs-comment">/*!80001 SET @@session.original_commit_timestamp=1724748017242734*/</span><span class="hljs-comment">/*!*/</span>;<br><span class="hljs-comment">/*!80014 SET @@session.original_server_version=80038*/</span><span class="hljs-comment">/*!*/</span>;<br><span class="hljs-comment">/*!80014 SET @@session.immediate_server_version=80038*/</span><span class="hljs-comment">/*!*/</span>;<br><span class="hljs-keyword">SET</span> @<span class="hljs-variable">@SESSION</span>.GTID_NEXT<span class="hljs-operator">=</span> <span class="hljs-string">&#x27;ANONYMOUS&#x27;</span><span class="hljs-comment">/*!*/</span>;<br># <span class="hljs-keyword">at</span> <span class="hljs-number">968</span><br>#<span class="hljs-number">240827</span> <span class="hljs-number">16</span>:<span class="hljs-number">40</span>:<span class="hljs-number">17</span> server id <span class="hljs-number">1</span>  end_log_pos <span class="hljs-number">1081</span> CRC32 <span class="hljs-number">0x73d6f519</span> Querythread_id<span class="hljs-operator">=</span><span class="hljs-number">9</span>exec_time<span class="hljs-operator">=</span><span class="hljs-number">0</span>error_code<span class="hljs-operator">=</span><span class="hljs-number">0</span>Xid <span class="hljs-operator">=</span> <span class="hljs-number">34</span><br><span class="hljs-keyword">SET</span> <span class="hljs-type">TIMESTAMP</span><span class="hljs-operator">=</span><span class="hljs-number">1724748017</span><span class="hljs-comment">/*!*/</span>;<br><span class="hljs-keyword">drop</span> database logbins<br><span class="hljs-comment">/*!*/</span>;<br><span class="hljs-keyword">SET</span> @<span class="hljs-variable">@SESSION</span>.GTID_NEXT<span class="hljs-operator">=</span> <span class="hljs-string">&#x27;AUTOMATIC&#x27;</span> <span class="hljs-comment">/* added by mysqlbinlog */</span> <span class="hljs-comment">/*!*/</span>;<br>DELIMITER ;<br># <span class="hljs-keyword">End</span> <span class="hljs-keyword">of</span> log file<br><span class="hljs-comment">/*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/</span>;<br><span class="hljs-comment">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/</span>;<br>[root<span class="hljs-variable">@MySQL01</span> <span class="hljs-operator">~</span>]# <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#240827 16:40:17 server id 1  end_log_pos 1081 CRC32 0x73d6f519 Querythread_id=9exec_time=0error_code=0Xid = 34</span><br></code></pre></td></tr></table></figure><p>我们要恢复到这个时间点</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@MySQL01</span> <span class="hljs-operator">~</span>]# mysqlbinlog <span class="hljs-comment">--stop-datetime=&quot;2024-08-27 16:40:17&quot; --verbose /var/lib/mysql/binlog.000021 | mysql -uroot -pqweQWE123</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br>[root<span class="hljs-variable">@MySQL01</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>pqweQWE123<br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases; <br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> logbins            <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql              <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> sys                <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> testDB             <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> testDB3            <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-number">7</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>  logbins.t1 ;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> zs   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span> ls   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2025/02/06/OpenStack/"/>
    <url>/2025/02/06/OpenStack/</url>
    
    <content type="html"><![CDATA[<h1 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h1><p>全部组件： <a href="https://www.openstack.org/software/project-navigator/openstack-components#openstack-services">https://www.openstack.org/software/project-navigator/openstack-components#openstack-services</a></p><p><img src="/../Pic/image-20240626175737473.png" alt="image-20240626175737473"></p><p>OpenStack是一个开源的云操作内核，他通过组件化的配置，每个组件都可以通过下层提供的接口，对接对应的资源，形成资源池。最后通过这些资源创建我们需要的服务。</p><ul><li><p>仪表盘</p><ul><li><p>Horizon     dashboard</p></li><li><p>Skyline      新一代仪表盘</p></li></ul></li><li><p>公共服务</p><ul><li>Keystone    身份认证</li><li>Placment    放置服务</li><li>Images       镜像服务 </li><li>Barbican    密钥管理</li></ul></li><li><p>计算 </p><ul><li>Nova    虚拟化</li><li>Zun      容器化</li></ul></li><li><p>存储</p><ul><li><p>Cinder     块存储SAN</p></li><li><p>Swift        对象存储S3</p></li><li><p>Manila     文件存储NAS</p></li></ul></li><li><p>网络</p><ul><li>Neutron      SDN</li><li>Octavia       负载均衡</li><li>Designate   域名解析</li></ul></li><li><p>硬件</p><ul><li>Ironic    裸金属</li><li>Cyborg   GPU等加速设备</li></ul></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
