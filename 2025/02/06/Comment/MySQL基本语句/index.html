

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="服务器数据库语言分类 DDL 数据库定义语言 Create drop  DML 数据库操作语言 update delete  DQL 数据库查询语言 select  DCL 数据库操作语言 grant   配置文件1234567891011121314151617mysql&gt; show global variables like &quot;%default%&quot;;+--------">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/2025/02/06/Comment/MySQL%E5%9F%BA%E6%9C%AC%E8%AF%AD%E5%8F%A5/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="服务器数据库语言分类 DDL 数据库定义语言 Create drop  DML 数据库操作语言 update delete  DQL 数据库查询语言 select  DCL 数据库操作语言 grant   配置文件1234567891011121314151617mysql&gt; show global variables like &quot;%default%&quot;;+--------">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/home/shanwen/Documents/Note/Pic/image-20240806174952905.png">
<meta property="og:image" content="http://example.com/home/shanwen/Documents/Note/Pic/image-20240702172005549.png">
<meta property="og:image" content="http://example.com/home/shanwen/Documents/Note/Pic/image-20240628160906100.png">
<meta property="og:image" content="http://example.com/home/shanwen/Documents/Note/Pic/image-20240701174431761.png">
<meta property="og:image" content="http://example.com/home/shanwen/Documents/Note/Pic/image-20240702172005549.png">
<meta property="article:published_time" content="2025-02-06T07:10:04.874Z">
<meta property="article:modified_time" content="2025-01-11T08:42:06.409Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/home/shanwen/Documents/Note/Pic/image-20240806174952905.png">
  
  
  
  <title>Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text=""></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-02-06 15:10" pubdate>
          2025年2月6日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          15k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          125 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header"></h1>
            
            
              <div class="markdown-body">
                
                <h1 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h1><h1 id="数据库语言分类"><a href="#数据库语言分类" class="headerlink" title="数据库语言分类"></a>数据库语言分类</h1><ul>
<li><p>DDL</p>
<p>数据库定义语言 <code>Create drop</code></p>
</li>
<li><p>DML</p>
<p>数据库操作语言 <code>update delete</code></p>
</li>
<li><p>DQL</p>
<p>数据库查询语言 <code>select</code></p>
</li>
<li><p>DCL</p>
<p>数据库操作语言 <code>grant</code></p>
</li>
</ul>
<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show global variables like &quot;%default%&quot;;<br>+------------------------------------------+--------------------+<br>| Variable_name                            | Value              |<br>+------------------------------------------+--------------------+<br>| default_collation_for_utf8mb4            | utf8mb4_0900_ai_ci |<br>| default_password_lifetime                | 0                  |<br>| default_storage_engine                   | InnoDB             |<br>| default_table_encryption                 | OFF                |<br>| default_tmp_storage_engine               | InnoDB             |<br>| default_week_format                      | 0                  |<br>| explicit_defaults_for_timestamp          | ON                 |<br>| innodb_default_row_format                | dynamic            |<br>| mysqlx_deflate_default_compression_level | 3                  |<br>| mysqlx_lz4_default_compression_level     | 2                  |<br>| mysqlx_zstd_default_compression_level    | 3                  |<br>+------------------------------------------+--------------------+<br>11 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<p>配置文件可以在服务器启动时修改<strong>一些</strong>启动变量 比如默认的存储引擎是InnoDB 默认的行格式是dynamic </p>
<table>
<thead>
<tr>
<th align="center">优先级</th>
<th align="center">目录</th>
<th align="center">文件名</th>
</tr>
</thead>
<tbody><tr>
<td align="center">最低</td>
<td align="center">&#x2F;etc&#x2F;</td>
<td align="center">my.cnf</td>
</tr>
<tr>
<td align="center">低</td>
<td align="center">&#x2F;etc&#x2F;mysql&#x2F;</td>
<td align="center">my.cnf</td>
</tr>
<tr>
<td align="center">中</td>
<td align="center">~&#x2F;</td>
<td align="center">.my.cnf</td>
</tr>
<tr>
<td align="center">高</td>
<td align="center">指定目录</td>
<td align="center">defalts-file 指定文件名称</td>
</tr>
<tr>
<td align="center">最高</td>
<td align="center">-</td>
<td align="center">-命令行参数方式传入</td>
</tr>
</tbody></table>
<h2 id="字符集和比较规则"><a href="#字符集和比较规则" class="headerlink" title="字符集和比较规则"></a>字符集和比较规则</h2><p>从上到下三个级别</p>
<ul>
<li><p>服务器</p>
<ul>
<li>character_set_server     | utf8mb4</li>
<li>collation_server              | utf8mb4_0900_ai_ci</li>
</ul>
</li>
<li><p>数据库</p>
<ul>
<li>character_set_database   | utf8mb4</li>
<li>collation_database           | utf8mb4_0900_ai_ci</li>
</ul>
</li>
<li><p>表</p>
<ul>
<li>创建表时指定</li>
</ul>
</li>
<li><p>行</p>
<ul>
<li>创建表时指定</li>
</ul>
</li>
</ul>
<p>未显式指定的字符集会按照上一级的配置 字符集和比较规则是一一对应的 修改一个 另一个也会修改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show character set; <br>+----------+---------------------------------+---------------------+--------+<br>| Charset  | Description                     | Default collation   | Maxlen |<br>+----------+---------------------------------+---------------------+--------+<br>| armscii8 | ARMSCII-8 Armenian              | armscii8_general_ci |      1 |<br>| ascii    | US ASCII                        | ascii_general_ci    |      1 |<br>| big5     | Big5 Traditional Chinese        | big5_chinese_ci     |      2 |<br>| binary   | Binary pseudo charset           | binary              |      1 |<br>| cp1250   | Windows Central European        | cp1250_general_ci   |      1 |<br>| cp1251   | Windows Cyrillic                | cp1251_general_ci   |      1 |<br>| cp1256   | Windows Arabic                  | cp1256_general_ci   |      1 |<br>| cp1257   | Windows Baltic                  | cp1257_general_ci   |      1 |<br>| cp850    | DOS West European               | cp850_general_ci    |      1 |<br>| cp852    | DOS Central European            | cp852_general_ci    |      1 |<br>| cp866    | DOS Russian                     | cp866_general_ci    |      1 |<br>| cp932    | SJIS for Windows Japanese       | cp932_japanese_ci   |      2 |<br>| dec8     | DEC West European               | dec8_swedish_ci     |      1 |<br>| eucjpms  | UJIS for Windows Japanese       | eucjpms_japanese_ci |      3 |<br>| euckr    | EUC-KR Korean                   | euckr_korean_ci     |      2 |<br>| gb18030  | China National Standard GB18030 | gb18030_chinese_ci  |      4 |<br>| gb2312   | GB2312 Simplified Chinese       | gb2312_chinese_ci   |      2 |<br>| gbk      | GBK Simplified Chinese          | gbk_chinese_ci      |      2 |<br>| geostd8  | GEOSTD8 Georgian                | geostd8_general_ci  |      1 |<br>| greek    | ISO 8859-7 Greek                | greek_general_ci    |      1 |<br>| hebrew   | ISO 8859-8 Hebrew               | hebrew_general_ci   |      1 |<br>| hp8      | HP West European                | hp8_english_ci      |      1 |<br>| keybcs2  | DOS Kamenicky Czech-Slovak      | keybcs2_general_ci  |      1 |<br>| koi8r    | KOI8-R Relcom Russian           | koi8r_general_ci    |      1 |<br>| koi8u    | KOI8-U Ukrainian                | koi8u_general_ci    |      1 |<br>| latin1   | cp1252 West European            | latin1_swedish_ci   |      1 |<br>| latin2   | ISO 8859-2 Central European     | latin2_general_ci   |      1 |<br>| latin5   | ISO 8859-9 Turkish              | latin5_turkish_ci   |      1 |<br>| latin7   | ISO 8859-13 Baltic              | latin7_general_ci   |      1 |<br>| macce    | Mac Central European            | macce_general_ci    |      1 |<br>| macroman | Mac West European               | macroman_general_ci |      1 |<br>| sjis     | Shift-JIS Japanese              | sjis_japanese_ci    |      2 |<br>| swe7     | 7bit Swedish                    | swe7_swedish_ci     |      1 |<br>| tis620   | TIS620 Thai                     | tis620_thai_ci      |      1 |<br>| ucs2     | UCS-2 Unicode                   | ucs2_general_ci     |      2 |<br>| ujis     | EUC-JP Japanese                 | ujis_japanese_ci    |      3 |<br>| utf16    | UTF-16 Unicode                  | utf16_general_ci    |      4 |<br>| utf16le  | UTF-16LE Unicode                | utf16le_general_ci  |      4 |<br>| utf32    | UTF-32 Unicode                  | utf32_general_ci    |      4 |<br>| utf8mb3  | UTF-8 Unicode                   | utf8mb3_general_ci  |      3 |<br>| utf8mb4  | UTF-8 Unicode                   | utf8mb4_0900_ai_ci  |      4 |<br>+----------+---------------------------------+---------------------+--------+<br>41 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show global variables like &quot;%character%&quot;;<br>+--------------------------+--------------------------------+<br>| Variable_name            | Value                          |<br>+--------------------------+--------------------------------+<br>| character_set_client     | utf8mb4                        |<br>| character_set_connection | utf8mb4                        |<br>| character_set_database   | utf8mb4                        |<br>| character_set_filesystem | binary                         |<br>| character_set_results    | utf8mb4                        |<br>| character_set_server     | utf8mb4                        |<br>| character_set_system     | utf8mb3                        |<br>| character_sets_dir       | /usr/share/mysql-8.4/charsets/ |<br>+--------------------------+--------------------------------+<br>8 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show global variables like &quot;%collation%&quot;;<br>+-------------------------------+--------------------+<br>| Variable_name                 | Value              |<br>+-------------------------------+--------------------+<br>| collation_connection          | utf8mb4_0900_ai_ci |<br>| collation_database            | utf8mb4_0900_ai_ci |<br>| collation_server              | utf8mb4_0900_ai_ci |<br>| default_collation_for_utf8mb4 | utf8mb4_0900_ai_ci |<br>+-------------------------------+--------------------+<br>4 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<h1 id="DDL"><a href="#DDL" class="headerlink" title="DDL"></a>DDL</h1><h2 id="创建库"><a href="#创建库" class="headerlink" title="创建库"></a>创建库</h2><p>现式指定字符集 否则就是数据库级别的 <code>utf8mb4</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create database test1 default character set ascii collate ascii_general_ci;<br>Query OK, 1 row affected (0.03 sec)<br><br>mysql&gt; show create database test1\G <br>*************************** 1. row ***************************<br>       Database: test1<br>Create Database: CREATE DATABASE `test1` /*!40100 DEFAULT CHARACTER SET ascii */ /*!80016 DEFAULT ENCRYPTION=&#x27;N&#x27; */<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; alter database test1 default character set utf8;<br>Query OK, 1 row affected, 1 warning (0.03 sec)<br><br>mysql&gt; show create database test1\G<br>*************************** 1. row ***************************<br>       Database: test1<br>Create Database: CREATE DATABASE `test1` /*!40100 DEFAULT CHARACTER SET utf8mb3 */ /*!80016 DEFAULT ENCRYPTION=&#x27;N&#x27; */<br>1 row in set (0.00 sec)<br><br></code></pre></td></tr></table></figure>

<blockquote>
<p>Mysql中的utf8是<code>utf8mb3</code>占<code>3</code>字节</p>
<p>原版的utf8叫<code>utf8mb4</code> 占<code>4</code>字节</p>
<p>不现式指定就是<code>utf8mb3</code></p>
</blockquote>
<h2 id="删除库"><a href="#删除库" class="headerlink" title="删除库"></a>删除库</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; drop database test1;<br>Query OK, 0 rows affected (0.04 sec)<br><br>mysql&gt; show databases; <br>+--------------------+<br>| Database           |<br>+--------------------+<br>| classicmodels      |<br>| information_schema |<br>| mysql              |<br>| performance_schema |<br>| sys                |<br>+--------------------+<br>5 rows in set (0.00 sec)表<br></code></pre></td></tr></table></figure>

<h2 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE [IF NOT EXISTS] table_name(<br>   column1 datatype constraints,<br>   column2 datatype constraints,<br>   ...<br>) ENGINE=storage_engine;<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create database test1 character set utf8mb4 collate utf8mb4_0900_ai_ci;<br>Query OK, 1 row affected (0.03 sec)<br><br>mysql&gt; show create database test1\G<br>*************************** 1. row ***************************<br>       Database: test1<br>Create Database: CREATE DATABASE `test1` /*!40100 DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci */ /*!80016 DEFAULT ENCRYPTION=&#x27;N&#x27; */<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<p>在该数据库中创建表 不显式指定字符集和比较规则就会是数据库级别的<code>utf8mb4</code> <code>utf8mb4_0900_ai_ci</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create table t1 (id int auto_increment not null primary key,name varchar(10) not null) engine=innodb character set utf8mb3;<br>Query OK, 0 rows affected, 1 warning (0.06 sec)<br><br>mysql&gt; show create table t1\G<br>*************************** 1. row ***************************<br>       Table: t1<br>Create Table: CREATE TABLE `t1` (<br>  `id` int NOT NULL AUTO_INCREMENT,<br>  `name` varchar(10) NOT NULL,<br>  PRIMARY KEY (`id`)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<p>存储引擎默认是InnoDB 也可以指定其他engines <code>show engines </code> 查看支持的引擎</p>
<h3 id="列"><a href="#列" class="headerlink" title="列"></a>列</h3><h4 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; alter table t1 add column city varchar(10) not null,charset ascii;<br>Query OK, 0 rows affected (0.09 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt; alter table t1 add column habbit text null after name, character set utf8mb4;<br>Query OK, 0 rows affected (0.16 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt; alter table t1 add column age int not null;<br>Query OK, 0 rows affected (0.05 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br></code></pre></td></tr></table></figure>

<ul>
<li>列不指定字符集 就会安装数据表级别的 <code>utf8mb3</code></li>
<li>不指定列的位置就会在最后 使用 <code>after</code> 创建在一列之后</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show full columns from t1\G <br>*************************** 1. row ***************************<br>     Field: id<br>      Type: int<br> Collation: NULL<br>      Null: NO<br>       Key: PRI<br>   Default: NULL<br>     Extra: auto_increment<br>Privileges: select,insert,update,references<br>   Comment: <br>*************************** 2. row ***************************<br>     Field: name<br>      Type: varchar(10)<br> Collation: utf8mb3_general_ci<br>      Null: NO<br>       Key: <br>   Default: NULL<br>     Extra: <br>Privileges: select,insert,update,references<br>   Comment: <br>*************************** 3. row ***************************<br>     Field: habbit<br>      Type: text<br> Collation: utf8mb4_0900_ai_ci<br>      Null: YES<br>       Key: <br>   Default: NULL<br>     Extra: <br>Privileges: select,insert,update,references<br>   Comment: <br>*************************** 4. row ***************************<br>     Field: city<br>      Type: varchar(10)<br> Collation: ascii_general_ci<br>      Null: NO<br>       Key: <br>   Default: NULL<br>     Extra: <br>Privileges: select,insert,update,references<br>   Comment: <br>*************************** 5. row ***************************<br>     Field: age<br>      Type: int<br> Collation: NULL<br>      Null: NO<br>       Key: <br>   Default: NULL<br>     Extra: <br>Privileges: select,insert,update,references<br>   Comment: <br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show columns from t1; <br>+--------+-------------+------+-----+---------+----------------+<br>| Field  | Type        | Null | Key | Default | Extra          |<br>+--------+-------------+------+-----+---------+----------------+<br>| id     | int         | NO   | PRI | NULL    | auto_increment |<br>| name   | varchar(10) | NO   |     | NULL    |                |<br>| habbit | text        | YES  |     | NULL    |                |<br>| city   | varchar(10) | NO   |     | NULL    |                |<br>| age    | int         | NO   |     | NULL    |                |<br>+--------+-------------+------+-----+---------+----------------+<br>5 rows in set (0.00 sec)<br><br>mysql&gt; alter table t1 drop column habbit, drop column city;<br>Query OK, 0 rows affected (0.15 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt; show columns from t1;<br>+-------+-------------+------+-----+---------+----------------+<br>| Field | Type        | Null | Key | Default | Extra          |<br>+-------+-------------+------+-----+---------+----------------+<br>| id    | int         | NO   | PRI | NULL    | auto_increment |<br>| name  | varchar(10) | NO   |     | NULL    |                |<br>| age   | int         | NO   |     | NULL    |                |<br>+-------+-------------+------+-----+---------+----------------+<br>3 rows in set (0.01 sec)<br></code></pre></td></tr></table></figure>



<h3 id="一些约束字段"><a href="#一些约束字段" class="headerlink" title="一些约束字段"></a>一些约束字段</h3><h4 id="auto-increment"><a href="#auto-increment" class="headerlink" title="auto_increment"></a>auto_increment</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show columns from t1;<br>+-------+-------------+------+-----+---------+----------------+<br>| Field | Type        | Null | Key | Default | Extra          |<br>+-------+-------------+------+-----+---------+----------------+<br>| id    | int         | NO   | PRI | NULL    | auto_increment |<br>| name  | varchar(10) | NO   |     | NULL    |                |<br>+-------+-------------+------+-----+---------+----------------+<br>2 rows in set (0.00 sec)<br><br>mysql&gt; insert into t1(name) values <br>    -&gt; (&quot;ZhangSan&quot;),<br>    -&gt; (&quot;LiSi&quot;); <br>Query OK, 2 rows affected (0.03 sec)<br>Records: 2  Duplicates: 0  Warnings: 0<br><br>mysql&gt; select * from t1 as aa; <br>+----+----------+<br>| id | name     |<br>+----+----------+<br>|  1 | ZhangSan |<br>|  2 | LiSi     |<br>+----+----------+<br>2 rows in set (0.00 sec)<br><br>### 获取当前插入的ID<br>mysql&gt; select last_insert_id(id) from t1 as t1_as;<br>+--------------------+<br>| last_insert_id(id) |<br>+--------------------+<br>|                  1 |<br>|                  2 |<br>+--------------------+<br>2 rows in set (0.00 sec)<br><br></code></pre></td></tr></table></figure>

<h5 id="更改递增开始值"><a href="#更改递增开始值" class="headerlink" title="更改递增开始值"></a>更改递增开始值</h5><blockquote>
<p>只有大于表中的最大值 才会生效</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from t1 as aa;<br>+----+----------+<br>| id | name     |<br>+----+----------+<br>|  1 | ZhangSan |<br>|  2 | LiSi     |<br>+----+----------+<br>2 rows in set (0.01 sec)<br><br>mysql&gt; alter table t1 auto_increment=1; <br>Query OK, 0 rows affected (0.02 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt; insert into t1(name) values (&quot;ZhangSan2&quot;);<br>Query OK, 1 row affected (0.02 sec)<br><br>mysql&gt; select * from t1 as aa;<br>+----+-----------+<br>| id | name      |<br>+----+-----------+<br>|  1 | ZhangSan  |<br>|  2 | LiSi      |<br>|  3 | ZhangSan2 |<br>+----+-----------+<br>3 rows in set (0.01 sec)<br><br>mysql&gt; alter table t1 auto_increment=5;<br>Query OK, 0 rows affected (0.02 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt; insert into t1(name) values (&quot;ZhangSan3&quot;);<br>Query OK, 1 row affected (0.02 sec)<br><br>mysql&gt; select * from t1 as aa;<br>+----+-----------+<br>| id | name      |<br>+----+-----------+<br>|  1 | ZhangSan  |<br>|  2 | LiSi      |<br>|  3 | ZhangSan2 |<br>|  5 | ZhangSan3 |<br>+----+-----------+<br>4 rows in set (0.00 sec)<br><br></code></pre></td></tr></table></figure>

<h5 id="清除数据"><a href="#清除数据" class="headerlink" title="清除数据"></a>清除数据</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; truncate table t1; <br>Query OK, 0 rows affected (0.12 sec)<br><br>mysql&gt; select * from t1 as aa;<br>Empty set (0.01 sec) <br></code></pre></td></tr></table></figure>

<h4 id="PARIMARY-KEY"><a href="#PARIMARY-KEY" class="headerlink" title="PARIMARY KEY"></a>PARIMARY KEY</h4><h5 id="多主键创建"><a href="#多主键创建" class="headerlink" title="多主键创建"></a>多主键创建</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create table t3 (<br>    -&gt; id int not null primary key, <br>    -&gt; name varchar(10) not null primary key); <br>ERROR 1068 (42000): Multiple primary key defined<br><br>mysql&gt; create table t3 ( id int not null , name varchar(10) not null ,primary key(id,name));<br>Query OK, 0 rows affected (0.08 sec)<br><br>mysql&gt; desc t3; <br>+-------+-------------+------+-----+---------+-------+<br>| Field | Type        | Null | Key | Default | Extra |<br>+-------+-------------+------+-----+---------+-------+<br>| id    | int         | NO   | PRI | NULL    |       |<br>| name  | varchar(10) | NO   | PRI | NULL    |       |<br>+-------+-------------+------+-----+---------+-------+<br>2 rows in set (0.03 sec)<br></code></pre></td></tr></table></figure>

<h5 id="添加新列为主键"><a href="#添加新列为主键" class="headerlink" title="添加新列为主键"></a>添加新列为主键</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create table t4 ( col1 int not null); <br>Query OK, 0 rows affected (0.07 sec)<br><br>mysql&gt; desc t4; <br>+-------+------+------+-----+---------+-------+<br>| Field | Type | Null | Key | Default | Extra |<br>+-------+------+------+-----+---------+-------+<br>| col1  | int  | NO   |     | NULL    |       |<br>+-------+------+------+-----+---------+-------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; alter table t4 add column col int not null primary key first; <br>Query OK, 0 rows affected (0.14 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt; desc t4;<br>+-------+------+------+-----+---------+-------+<br>| Field | Type | Null | Key | Default | Extra |<br>+-------+------+------+-----+---------+-------+<br>| col   | int  | NO   | PRI | NULL    |       |<br>| col1  | int  | NO   |     | NULL    |       |<br>+-------+------+------+-----+---------+-------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<h5 id="删除列的主键"><a href="#删除列的主键" class="headerlink" title="删除列的主键"></a>删除列的主键</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; desc t3;<br>+-------+-------------+------+-----+---------+-------+<br>| Field | Type        | Null | Key | Default | Extra |<br>+-------+-------------+------+-----+---------+-------+<br>| id    | int         | NO   | PRI | NULL    |       |<br>| name  | varchar(10) | NO   | PRI | NULL    |       |<br>+-------+-------------+------+-----+---------+-------+<br>2 rows in set (0.01 sec)<br><br>mysql&gt; alter table t3 drop primary key;<br>Query OK, 0 rows affected (0.15 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt; desc t3;<br>+-------+-------------+------+-----+---------+-------+<br>| Field | Type        | Null | Key | Default | Extra |<br>+-------+-------------+------+-----+---------+-------+<br>| id    | int         | NO   |     | NULL    |       |<br>| name  | varchar(10) | NO   |     | NULL    |       |<br>+-------+-------------+------+-----+---------+-------+<br>2 rows in set (0.00 sec)<br><br>mysql&gt; alter table t3 modify id int primary key;<br>Query OK, 0 rows affected (0.14 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt; desc t3;<br>+-------+-------------+------+-----+---------+-------+<br>| Field | Type        | Null | Key | Default | Extra |<br>+-------+-------------+------+-----+---------+-------+<br>| id    | int         | NO   | PRI | NULL    |       |<br>| name  | varchar(10) | NO   |     | NULL    |       |<br>+-------+-------------+------+-----+---------+-------+<br>2 rows in set (0.01 sec)<br></code></pre></td></tr></table></figure>

<h4 id="Foreign-Key"><a href="#Foreign-Key" class="headerlink" title="!! Foreign Key"></a>!! Foreign Key</h4><p>Mysql为关系形数据库 在一个表中存在<strong>另一个表的主键</strong> 就叫做外键(foreign key)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; desc orders;<br>+----------------+-------------+------+-----+---------+-------+<br>| Field          | Type        | Null | Key | Default | Extra |<br>+----------------+-------------+------+-----+---------+-------+<br>| orderNumber    | int         | NO   | PRI | NULL    |       |<br>| orderDate      | date        | NO   |     | NULL    |       |<br>| requiredDate   | date        | NO   |     | NULL    |       |<br>| shippedDate    | date        | YES  |     | NULL    |       |<br>| status         | varchar(15) | NO   |     | NULL    |       |<br>| comments       | text        | YES  |     | NULL    |       |<br>| customerNumber | int         | NO   | MUL | NULL    |       |<br>+----------------+-------------+------+-----+---------+-------+<br>7 rows in set (0.00 sec)<br><br>mysql&gt; desc customers; <br>+------------------------+---------------+------+-----+---------+-------+<br>| Field                  | Type          | Null | Key | Default | Extra |<br>+------------------------+---------------+------+-----+---------+-------+<br>| customerNumber         | int           | NO   | PRI | NULL    |       |<br>| customerName           | varchar(50)   | NO   |     | NULL    |       |<br>| contactLastName        | varchar(50)   | NO   |     | NULL    |       |<br>| contactFirstName       | varchar(50)   | NO   |     | NULL    |       |<br>| phone                  | varchar(50)   | NO   |     | NULL    |       |<br>| addressLine1           | varchar(50)   | NO   |     | NULL    |       |<br>| addressLine2           | varchar(50)   | YES  |     | NULL    |       |<br>| city                   | varchar(50)   | NO   |     | NULL    |       |<br>| state                  | varchar(50)   | YES  |     | NULL    |       |<br>| postalCode             | varchar(15)   | YES  |     | NULL    |       |<br>| country                | varchar(50)   | NO   |     | NULL    |       |<br>| salesRepEmployeeNumber | int           | YES  | MUL | NULL    |       |<br>| creditLimit            | decimal(10,2) | YES  |     | NULL    |       |<br>+------------------------+---------------+------+-----+---------+-------+<br>13 rows in set (0.01 sec)<br></code></pre></td></tr></table></figure>

<p>其中 <code>orders</code> 表的外键为 <code>customerNumber</code> 也就是 <code>customers</code> 的主键</p>
<p><code>orders</code> 表就称为 <code>customers</code> 的子表</p>
<p><code>customers</code> 表就称为主表</p>
<h5 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">[CONSTRAINT constraint_name]<br>FOREIGN KEY [foreign_key_name] (column_name, ...)<br>REFERENCES parent_table(colunm_name,...)<br>[ON DELETE reference_option]<br>[ON UPDATE reference_option]<br></code></pre></td></tr></table></figure>

<ol>
<li>ON DELETE 约束:<ul>
<li>定义在从表(子表)的外键列上,当主表记录被删除时,从表记录如何处理。</li>
<li>主要选项包括:<ul>
<li>CASCADE: 级联删除从表相关记录。</li>
<li>SET NULL: 将从表外键列设置为 NULL。</li>
<li>SET DEFAULT: 将从表外键列设置为默认值。</li>
<li>NO ACTION: 不做任何操作,如果从表有关联记录则无法删除主表记录。</li>
</ul>
</li>
</ul>
</li>
<li>ON UPDATE 约束:<ul>
<li>定义在从表(子表)的外键列上,当主表记录的键值被更新时,从表记录如何处理。</li>
<li>主要选项包括:<ul>
<li>CASCADE: 级联更新从表相关记录。</li>
<li>SET NULL: 将从表外键列设置为 NULL。</li>
<li>SET DEFAULT: 将从表外键列设置为默认值。</li>
<li>NO ACTION: 不做任何操作,如果从表有关联记录则无法更新主表记录。</li>
</ul>
</li>
</ul>
</li>
<li>RESTRICT 约束:<ul>
<li>默认行为,当主表记录被删除或更新时,如果从表有关联记录,则拒绝操作。</li>
</ul>
</li>
<li>SET DEFAULT 约束:<ul>
<li>当主表记录被删除时,将从表外键列设置为默认值。</li>
</ul>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create table t2_fk (t2_fk_id int primary key auto_increment, comment text null, t2_fk int ,constraint t2_fk foreign key (t2_fk) references t2(id));<br>Query OK, 0 rows affected (0.10 sec)<br></code></pre></td></tr></table></figure>

<h4 id="unique"><a href="#unique" class="headerlink" title="unique"></a>unique</h4><p>可以保证一列数据的独立性</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create table t3 ( id int primary key auto_increment, mail text not null );<br>Query OK, 0 rows affected (0.08 sec)<br><br>mysql&gt; insert into t3(id,mail) values (1,&quot;1@qq.com&quot;);<br>Query OK, 1 row affected (0.03 sec)<br><br>mysql&gt; insert into t3(id,mail) values (2,&quot;1@qq.com&quot;);<br>Query OK, 1 row affected (0.04 sec<br><br>mysql&gt; alter table t3 modify column mail varchar(100) unique;<br>ERROR 1062 (23000): Duplicate entry &#x27;1@qq.com&#x27; for key &#x27;t3.mail&#x27;<br><br>mysql&gt; delete from  t3 where id=2;<br>Query OK, 1 row affected (0.03 sec)<br><br>mysql&gt; alter table t3 modify column mail varchar(100) unique;<br>Query OK, 1 row affected (0.10 sec)<br>Records: 1  Duplicates: 0  Warnings: 0<br><br>mysql&gt; insert into t3(mail) values (&quot;2@qq.com&quot;);<br>Query OK, 1 row affected (0.04 sec)<br><br>mysql&gt; select * from t3;<br>+----+----------+<br>| id | mail     |<br>+----+----------+<br>|  1 | 1@qq.com |<br>|  3 | 2@qq.com |<br>+----+----------+<br>2 rows in set (0.00 sec)<br><br>mysql&gt; insert into t3(mail) values (&quot;2@qq.com&quot;);<br>ERROR 1062 (23000): Duplicate entry &#x27;2@qq.com&#x27; for key &#x27;t3.mail&#x27;<br></code></pre></td></tr></table></figure>

<p>NULL不能确定唯一</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; insert into t3 values (4,NULL); <br>Query OK, 1 row affected (0.03 sec)<br><br>mysql&gt; insert into t3 values (5,NULL);<br>Query OK, 1 row affected (0.03 sec)<br><br>mysql&gt; select * from t3;<br>+----+----------+<br>| id | mail     |<br>+----+----------+<br>|  4 | NULL     |<br>|  5 | NULL     |<br>|  1 | 1@qq.com |<br>|  3 | 2@qq.com |<br>+----+----------+<br>4 rows in set (0.00 sec)<br><br></code></pre></td></tr></table></figure>

<h4 id="check"><a href="#check" class="headerlink" title="check"></a>check</h4><h5 id="列级别"><a href="#列级别" class="headerlink" title="列级别"></a>列级别</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create table tCheck ( productId int primary key, detail int not null check (detail &gt; 0), number int not null check (number &gt;= 1) );<br>Query OK, 0 rows affected (0.09 sec)<br><br>mysql&gt; desc tCheck; <br>+-----------+------+------+-----+---------+-------+<br>| Field     | Type | Null | Key | Default | Extra |<br>+-----------+------+------+-----+---------+-------+<br>| productId | int  | NO   | PRI | NULL    |       |<br>| detail    | int  | NO   |     | NULL    |       |<br>| number    | int  | NO   |     | NULL    |       |<br>+-----------+------+------+-----+---------+-------+<br>3 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<p>以上表约束了 <code>detail&gt; 0</code>  <code>number &gt;= 1</code> 当我们尝试插入违规数据 将会报错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; insert into tCheck(productId,detail,number) values (1,100,2);<br>Query OK, 1 row affected (0.03 sec)  <br><br>mysql&gt; insert into tCheck(productId,detail,number) values (2,0,2);<br>ERROR 3819 (HY000): Check constraint &#x27;tCheck_chk_1&#x27; is violated.<br><br>mysql&gt; insert into tCheck(productId,detail,number) values (2,1,0);<br>ERROR 3819 (HY000): Check constraint &#x27;tCheck_chk_2&#x27; is violated.<br><br>mysql&gt; select * from tCheck; <br>+-----------+--------+--------+<br>| productId | detail | number |<br>+-----------+--------+--------+<br>|         1 |    100 |      2 |<br>+-----------+--------+--------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; show create table tCheck\G<br>*************************** 1. row ***************************<br>       Table: tCheck<br>Create Table: CREATE TABLE `tCheck` (<br>  `productId` int NOT NULL,<br>  `detail` int NOT NULL,<br>  `number` int NOT NULL,<br>  PRIMARY KEY (`productId`),<br>  CONSTRAINT `tCheck_chk_1` CHECK ((`detail` &gt; 0)),<br>  CONSTRAINT `tCheck_chk_2` CHECK ((`number` &gt;= 1))<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci<br>1 row in set (0.01 sec)<br></code></pre></td></tr></table></figure>

<h5 id="表级别"><a href="#表级别" class="headerlink" title="表级别"></a>表级别</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create table tCheck_T ( id int, age int, constraint ageCheck check(age &gt;= 18) );<br>Query OK, 0 rows affected (0.06 sec)<br><br>mysql&gt; show create table tCheck_T\G<br>*************************** 1. row ***************************<br>       Table: tCheck_T<br>Create Table: CREATE TABLE `tCheck_T` (<br>  `id` int DEFAULT NULL,<br>  `age` int DEFAULT NULL,<br>  CONSTRAINT `ageCheck` CHECK ((`age` &gt;= 18))<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci<br>1 row in set (0.00 sec)<br><br>mysql&gt; insert into tCheck_T values (1,18);<br>Query OK, 1 row affected (0.04 sec)<br><br>mysql&gt; insert into tCheck_T values (2,17);<br>ERROR 3819 (HY000): Check constraint &#x27;ageCheck&#x27; is violated.<br></code></pre></td></tr></table></figure>

<h5 id="添加check到表"><a href="#添加check到表" class="headerlink" title="添加check到表"></a>添加check到表</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; alter table t1 add check (age &gt;= 18);<br>ERROR 3819 (HY000): Check constraint &#x27;t1_chk_1&#x27; is violated.<br><br>mysql&gt; select * from t1; <br>+----+-----------+-----+<br>| id | name      | age |<br>+----+-----------+-----+<br>|  1 | ZhangSan  |   0 |<br>|  2 | LiSi      |   0 |<br>|  3 | ZhangSan2 |   0 |<br>|  5 | ZhangSan3 |   0 |<br>+----+-----------+-----+<br>4 rows in set (0.00 sec)<br><br>mysql&gt; delete from t1 where age=0;<br>Query OK, 4 rows affected (0.04 sec)<br><br>mysql&gt; select * from t1;<br>Empty set (0.00 sec)<br><br>mysql&gt; alter table t1 add check (age &gt;= 18);<br>Query OK, 0 rows affected (0.10 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt; insert into t1(name,age) values (&#x27;a&#x27;,17); <br>ERROR 3819 (HY000): Check constraint &#x27;t1_chk_1&#x27; is violated.<br><br>mysql&gt; insert into t1(name,age) values (&#x27;a&#x27;,18);<br>Query OK, 1 row affected (0.03 sec)<br></code></pre></td></tr></table></figure>

<h4 id="DEFAULT"><a href="#DEFAULT" class="headerlink" title="DEFAULT"></a>DEFAULT</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create table tDefault ( <br>    -&gt; name varchar(7) not null primary key, <br>    -&gt; gender enum(&#x27;Male&#x27;,&#x27;Female&#x27;) not null default &#x27;Male&#x27;<br>    -&gt; ); <br>Query OK, 0 rows affected (0.05 sec)<br><br>mysql&gt; desc tDefault; <br>+--------+-----------------------+------+-----+---------+-------+<br>| Field  | Type                  | Null | Key | Default | Extra |<br>+--------+-----------------------+------+-----+---------+-------+<br>| name   | varchar(7)            | NO   | PRI | NULL    |       |<br>| gender | enum(&#x27;Male&#x27;,&#x27;Female&#x27;) | NO   |     | Male    |       |<br>+--------+-----------------------+------+-----+---------+-------+<br>2 rows in set (0.00 sec)<br><br>mysql&gt; insert into tDefault(name) values (&#x27;zs&#x27;);<br>Query OK, 1 row affected (0.02 sec)<br><br>mysql&gt; select * from tDefault; <br>+------+--------+<br>| name | gender |<br>+------+--------+<br>| zs   | Male   |<br>+------+--------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<h5 id="增加DEFAULT到表"><a href="#增加DEFAULT到表" class="headerlink" title="增加DEFAULT到表"></a>增加DEFAULT到表</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; alter table tDefault add column age int not null;<br>Query OK, 0 rows affected (0.07 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt; desc tDefault; <br>+--------+-----------------------+------+-----+---------+-------+<br>| Field  | Type                  | Null | Key | Default | Extra |<br>+--------+-----------------------+------+-----+---------+-------+<br>| name   | varchar(7)            | NO   | PRI | NULL    |       |<br>| gender | enum(&#x27;Male&#x27;,&#x27;Female&#x27;) | NO   |     | Male    |       |<br>| age    | int                   | NO   |     | NULL    |       |<br>+--------+-----------------------+------+-----+---------+-------+<br>3 rows in set (0.00 sec)<br><br>mysql&gt; alter table tDefault alter column age set default &#x27;18&#x27;;<br>Query OK, 0 rows affected (0.04 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt; desc tDefault; <br>+--------+-----------------------+------+-----+---------+-------+<br>| Field  | Type                  | Null | Key | Default | Extra |<br>+--------+-----------------------+------+-----+---------+-------+<br>| name   | varchar(7)            | NO   | PRI | NULL    |       |<br>| gender | enum(&#x27;Male&#x27;,&#x27;Female&#x27;) | NO   |     | Male    |       |<br>| age    | int                   | NO   |     | 18      |       |<br>+--------+-----------------------+------+-----+---------+-------+<br>3 rows in set (0.01 sec)<br><br>mysql&gt; insert into tDefault(name) values (&#x27;lisi&#x27;);<br>Query OK, 1 row affected (0.03 sec)<br><br>mysql&gt; select * from tDefault;<br>+------+--------+------+<br>| name | gender | age  |<br>+------+--------+------+<br>| lisi | Male   |   18 |<br>| zs   | Male   |   18 |<br>+------+--------+------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<h5 id="从表中删除DEFAULT"><a href="#从表中删除DEFAULT" class="headerlink" title="从表中删除DEFAULT"></a>从表中删除DEFAULT</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; alter table tDefault alter column age drop default;<br>Query OK, 0 rows affected (0.04 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt; desc tDefault;<br>+--------+-----------------------+------+-----+---------+-------+<br>| Field  | Type                  | Null | Key | Default | Extra |<br>+--------+-----------------------+------+-----+---------+-------+<br>| name   | varchar(7)            | NO   | PRI | NULL    |       |<br>| gender | enum(&#x27;Male&#x27;,&#x27;Female&#x27;) | NO   |     | Male    |       |<br>| age    | int                   | NO   |     | NULL    |       |<br>+--------+-----------------------+------+-----+---------+-------+<br>3 rows in set (0.01 sec)<br><br></code></pre></td></tr></table></figure>

<h4 id="NOT-NULL"><a href="#NOT-NULL" class="headerlink" title="NOT NULL"></a>NOT NULL</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create table tNotNull ( <br>    -&gt; name varchar(7) primary key, <br>    -&gt; habbit text); <br>Query OK, 0 rows affected (0.08 sec)<br><br>mysql&gt; desc tNotNull; <br>+--------+------------+------+-----+---------+-------+<br>| Field  | Type       | Null | Key | Default | Extra |<br>+--------+------------+------+-----+---------+-------+<br>| name   | varchar(7) | NO   | PRI | NULL    |       |<br>| habbit | text       | YES  |     | NULL    |       |<br>+--------+------------+------+-----+---------+-------+<br>2 rows in set (0.00 sec)<br><br>mysql&gt; insert into tNotNull values (&#x27;zs&#x27;,null);<br>Query OK, 1 row affected (0.03 sec)<br><br>mysql&gt; select * from tNotNull; <br>+------+--------+<br>| name | habbit |<br>+------+--------+<br>| zs   | NULL   |<br>+------+--------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<h5 id="列添加NOT-NUll约束"><a href="#列添加NOT-NUll约束" class="headerlink" title="列添加NOT NUll约束"></a>列添加NOT NUll约束</h5><p>向表中&#96;&#96;habbit<code>列添加</code>NOT NULL&#96; 报错 因为表中已经有了NULL数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; alter table tNotNull modify habbit text not null; <br>ERROR 1138 (22004): Invalid use of NULL value<br><br>mysql&gt; delete from tNotNull where habbit is null; <br>Query OK, 1 row affected (0.03 sec)<br><br>mysql&gt; alter table tNotNull modify habbit text not null;<br>Query OK, 0 rows affected (0.14 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt; desc tNotNull;<br>+--------+------------+------+-----+---------+-------+<br>| Field  | Type       | Null | Key | Default | Extra |<br>+--------+------------+------+-----+---------+-------+<br>| name   | varchar(7) | NO   | PRI | NULL    |       |<br>| habbit | text       | NO   |     | NULL    |       |<br>+--------+------------+------+-----+---------+-------+<br>2 rows in set (0.01 sec)<br></code></pre></td></tr></table></figure>

<h5 id="删除列NOT-NUll约束"><a href="#删除列NOT-NUll约束" class="headerlink" title="删除列NOT NUll约束"></a>删除列NOT NUll约束</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; alter table tNotNull modify column habbit text null;<br>Query OK, 0 rows affected (0.14 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt; desc tNotNull;<br>+--------+------------+------+-----+---------+-------+<br>| Field  | Type       | Null | Key | Default | Extra |<br>+--------+------------+------+-----+---------+-------+<br>| name   | varchar(7) | NO   | PRI | NULL    |       |<br>| habbit | text       | YES  |     | NULL    |       |<br>+--------+------------+------+-----+---------+-------+<br>2 rows in set (0.00 sec)<br><br></code></pre></td></tr></table></figure>

<h4 id="外键"><a href="#外键" class="headerlink" title="外键"></a>外键</h4><p>主键所在的表就是主表（父表），外键所在的表就是从表（子表）</p>
<p><strong>定义外键时，需要遵守下列规则：</strong></p>
<ul>
<li>主表必须已经存在于数据库中，或者是当前正在创建的表。如果是后一种情况，则主表与从表是同一个表，这样的表称为自参照表，这种结构称为自参照完整性。</li>
<li>必须为主表定义主键。</li>
<li>主键不能包含空值，但允许在外键中出现空值。也就是说，只要外键的每个非空值出现在指定的主键中，这个外键的内容就是正确的。</li>
<li>在主表的表名后面指定列名或列名的组合。这个列或列的组合必须是主表的主键或候选键。</li>
<li>外键中列的数目必须和主表的主键中列的数目相同。</li>
<li>外键中列的数据类型必须和主表主键中对应列的数据类型相同。</li>
<li>被外键引用的列需要唯一。</li>
</ul>
<h5 id="创建外键"><a href="#创建外键" class="headerlink" title="创建外键"></a>创建外键</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">[<span class="hljs-keyword">CONSTRAINT</span> constraint_name]<br><span class="hljs-keyword">FOREIGN KEY</span> [foreign_key_name] (column_name, ...)<br><span class="hljs-keyword">REFERENCES</span> parent_table(colunm_name,...)<br>[<span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> reference_option]<br>[<span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> reference_option]<br></code></pre></td></tr></table></figure>

<p>MySQL 有五个引用选项： <code>CASCADE</code> 、 <code>SET NULL</code> 、 <code>NO ACTION</code> 、 <code>RESTRICT</code>和<code>SET DEFAULT</code> 。</p>
<ul>
<li><code>CASCADE</code> ：如果父表中的一行被删除或更新，子表中匹配行的值将自​​动删除或更新。</li>
<li><code>SET NULL</code> ：如果删除或更新父表中的行，则子表中的外键列（或多列）的值将设置为<code>NULL</code> 。</li>
<li><code>RESTRICT</code> ：如果父表中的行在子表中具有匹配的行，则 MySQL 拒绝删除或更新父表中的行。</li>
<li><code>NO ACTION</code> ：与<code>RESTRICT</code>相同。</li>
<li><code>SET DEFAULT</code> ：被 MySQL 解析器识别。但是，此操作会被 InnoDB 和 NDB 表拒绝。</li>
</ul>
<p>事实上，MySQL 完全支持三种操作： <code>RESTRICT</code> 、 <code>CASCADE</code>和<code>SET NULL</code> 。</p>
<p>如果未指定<code>ON DELETE</code>和<code>ON UPDATE</code>子句，则默认操作为<code>RESTRICT</code> 。</p>
<p>首先创建主表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create table</span> `Product List` (<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> id <span class="hljs-type">int</span> <span class="hljs-keyword">primary key</span> auto_increment,<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> catagoryID <span class="hljs-type">int</span> <span class="hljs-keyword">not null</span>,<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> detail <span class="hljs-type">int</span> <span class="hljs-keyword">not null</span> <span class="hljs-keyword">check</span>(detail <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>)<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> );<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create table</span> `Catagory List` (<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> name <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">primary key</span>,<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> catagoryID <span class="hljs-type">int</span>,<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">constraint</span> fkProduct <span class="hljs-keyword">foreign key</span> (catagoryID) <span class="hljs-keyword">references</span> `Product List`(catagoryID)<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> );<br>ERROR <span class="hljs-number">6125</span> (HY000): Failed <span class="hljs-keyword">to</span> <span class="hljs-keyword">add</span> the <span class="hljs-keyword">foreign key</span> constraint. Missing <span class="hljs-keyword">unique</span> key <span class="hljs-keyword">for</span> <span class="hljs-keyword">constraint</span> <span class="hljs-string">&#x27;fkProduct&#x27;</span> <span class="hljs-keyword">in</span> the referenced <span class="hljs-keyword">table</span> <span class="hljs-string">&#x27;Product List&#x27;</span><br></code></pre></td></tr></table></figure>

<p>报错了 因为<strong>外键</strong>引用的列 需要唯一</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">alter table</span> `Product List` modify <span class="hljs-keyword">column</span> catagoryID <span class="hljs-type">int</span> <span class="hljs-keyword">not null</span> <span class="hljs-keyword">unique</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br>Records: <span class="hljs-number">0</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create table</span> `Catagory List` ( name <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">primary key</span>, catagoryID <span class="hljs-type">int</span>, <span class="hljs-keyword">constraint</span> `fk_product` <span class="hljs-keyword">foreign key</span> (catagoryID) <span class="hljs-keyword">references</span> `Product List`(catagoryID) );<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">desc</span> `Product List`;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------+------+------+-----+---------+----------------+</span><br><span class="hljs-operator">|</span> Field      <span class="hljs-operator">|</span> Type <span class="hljs-operator">|</span> <span class="hljs-keyword">Null</span> <span class="hljs-operator">|</span> Key <span class="hljs-operator">|</span> <span class="hljs-keyword">Default</span> <span class="hljs-operator">|</span> Extra          <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------+------+------+-----+---------+----------------+</span><br><span class="hljs-operator">|</span> id         <span class="hljs-operator">|</span> <span class="hljs-type">int</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">NO</span>   <span class="hljs-operator">|</span> PRI <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span> auto_increment <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> catagoryID <span class="hljs-operator">|</span> <span class="hljs-type">int</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">NO</span>   <span class="hljs-operator">|</span> UNI <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> detail     <span class="hljs-operator">|</span> <span class="hljs-type">int</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">NO</span>   <span class="hljs-operator">|</span>     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------+------+------+-----+---------+----------------+</span><br><span class="hljs-number">3</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">desc</span> `Catagory List`;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------+-------------+------+-----+---------+-------+</span><br><span class="hljs-operator">|</span> Field      <span class="hljs-operator">|</span> Type        <span class="hljs-operator">|</span> <span class="hljs-keyword">Null</span> <span class="hljs-operator">|</span> Key <span class="hljs-operator">|</span> <span class="hljs-keyword">Default</span> <span class="hljs-operator">|</span> Extra <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------+-------------+------+-----+---------+-------+</span><br><span class="hljs-operator">|</span> name       <span class="hljs-operator">|</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-operator">|</span> <span class="hljs-keyword">NO</span>   <span class="hljs-operator">|</span> PRI <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> catagoryID <span class="hljs-operator">|</span> <span class="hljs-type">int</span>         <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span> MUL <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------+-------------+------+-----+---------+-------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<p>插入数据测试</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> `Product List`(id,catagoryID,detail) <span class="hljs-keyword">values</span> (<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">10</span>), (<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">11</span>);<br>Query OK, <span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br>Records: <span class="hljs-number">2</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `Product List`;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------+--------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> catagoryID <span class="hljs-operator">|</span> detail <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------+--------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span>     <span class="hljs-number">10</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span>          <span class="hljs-number">2</span> <span class="hljs-operator">|</span>     <span class="hljs-number">11</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------+--------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec) <br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span>  `Catagory List`(name,catagoryID) <span class="hljs-keyword">values</span> (&quot;Apple&quot;,<span class="hljs-number">1</span>),(&quot;banana&quot;,<span class="hljs-number">2</span>);<br>Query OK, <span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br>Records: <span class="hljs-number">2</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span>  `Catagory List`(name,catagoryID) <span class="hljs-keyword">values</span> (&quot;Shit&quot;,<span class="hljs-number">4</span>);<br>ERROR <span class="hljs-number">1452</span> (<span class="hljs-number">23000</span>): Cannot <span class="hljs-keyword">add</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">update</span> a child <span class="hljs-type">row</span>: a <span class="hljs-keyword">foreign key</span> <span class="hljs-keyword">constraint</span> fails (`testDB`.`Catagory List`, <span class="hljs-keyword">CONSTRAINT</span> `fk_product` <span class="hljs-keyword">FOREIGN KEY</span> (`catagoryID`) <span class="hljs-keyword">REFERENCES</span> `Product List` (`catagoryID`)) <br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `Catagory List`;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------+------------+</span><br><span class="hljs-operator">|</span> name   <span class="hljs-operator">|</span> catagoryID <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------+------------+</span><br><span class="hljs-operator">|</span> Apple  <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> banana <span class="hljs-operator">|</span>          <span class="hljs-number">2</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------+------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span>  `Product List` <span class="hljs-keyword">where</span> catagoryID <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>ERROR <span class="hljs-number">1451</span> (<span class="hljs-number">23000</span>): Cannot <span class="hljs-keyword">delete</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">update</span> a parent <span class="hljs-type">row</span>: a <span class="hljs-keyword">foreign key</span> <span class="hljs-keyword">constraint</span> fails (`testDB`.`Catagory List`, <span class="hljs-keyword">CONSTRAINT</span> `fk_product` <span class="hljs-keyword">FOREIGN KEY</span> (`catagoryID`) <span class="hljs-keyword">REFERENCES</span> `Product List` (`catagoryID`))  <br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">update</span> `Product List` <span class="hljs-keyword">set</span> catagoryID <span class="hljs-operator">=</span> <span class="hljs-number">4</span> <span class="hljs-keyword">where</span> catagoryID <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>ERROR <span class="hljs-number">1451</span> (<span class="hljs-number">23000</span>): Cannot <span class="hljs-keyword">delete</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">update</span> a parent <span class="hljs-type">row</span>: a <span class="hljs-keyword">foreign key</span> <span class="hljs-keyword">constraint</span> fails (`testDB`.`Catagory List`, <span class="hljs-keyword">CONSTRAINT</span> `fk_product` <span class="hljs-keyword">FOREIGN KEY</span> (`catagoryID`) <span class="hljs-keyword">REFERENCES</span> `Product List` (`catagoryID`))<br></code></pre></td></tr></table></figure>

<p>只有存在于主表 <code>Product List</code>中 <code>catagory</code> 列中的数据 才能添加到从表中</p>
<p>因为我们没有指定主表和从表之间的级联关系 默认是RESTRICT,主表是是无法update存在的数据</p>
<p>    <code>RESTRICT</code> ：如果父表中的行在子表中具有匹配的行，则 MySQL 拒绝删除或更新父表中的行。</p>
<h5 id="完整性"><a href="#完整性" class="headerlink" title="完整性"></a>完整性</h5><h6 id="CASCAED"><a href="#CASCAED" class="headerlink" title="CASCAED"></a>CASCAED</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> <span class="hljs-keyword">create table</span> `Catagory List`\G<br><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-number">1.</span> <span class="hljs-type">row</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><br>       <span class="hljs-keyword">Table</span>: Catagory List<br><span class="hljs-keyword">Create Table</span>: <span class="hljs-keyword">CREATE TABLE</span> `Catagory List` (<br>  `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT NULL</span>,<br>  `catagoryID` <span class="hljs-type">int</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY KEY</span> (`name`),<br>  KEY `fk_product` (`catagoryID`),<br>  <span class="hljs-keyword">CONSTRAINT</span> `fk_product` <span class="hljs-keyword">FOREIGN KEY</span> (`catagoryID`) <span class="hljs-keyword">REFERENCES</span> `Product List` (`catagoryID`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_0900_ai_ci<br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> `Catagory List`;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span>  <span class="hljs-keyword">CREATE TABLE</span> `Catagory List` (   `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT NULL</span>,   `catagoryID` <span class="hljs-type">int</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,   <span class="hljs-keyword">PRIMARY KEY</span> (`name`),   KEY `fk_product` (`catagoryID`),   <span class="hljs-keyword">CONSTRAINT</span> `fk_product` <span class="hljs-keyword">FOREIGN KEY</span> (`catagoryID`) <span class="hljs-keyword">REFERENCES</span> `Product List` (`catagoryID`)  <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> CASCADE );<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `Catagory List`;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------+------------+</span><br><span class="hljs-operator">|</span> name   <span class="hljs-operator">|</span> catagoryID <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------+------------+</span><br><span class="hljs-operator">|</span> Apple  <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> banana <span class="hljs-operator">|</span>          <span class="hljs-number">2</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------+------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<p>现在更新主表<code>Apple</code>的<code>CatagoryID</code>为100 根据<code>CASCADE</code>的规则 从表会随着父表更新</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">update</span> `Product List` <span class="hljs-keyword">set</span> catagoryID <span class="hljs-operator">=</span> <span class="hljs-number">100</span> <span class="hljs-keyword">where</span> catagoryID <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.01</span> sec)<br><span class="hljs-keyword">Rows</span> matched: <span class="hljs-number">1</span>  Changed: <span class="hljs-number">1</span>  Warnings: <span class="hljs-number">0</span><br><br>mysql<span class="hljs-operator">&gt;</span>  <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `Catagory List`;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------+------------+</span><br><span class="hljs-operator">|</span> name   <span class="hljs-operator">|</span> catagoryID <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------+------------+</span><br><span class="hljs-operator">|</span> banana <span class="hljs-operator">|</span>          <span class="hljs-number">2</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> Apple  <span class="hljs-operator">|</span>        <span class="hljs-number">100</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------+------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)  <br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> `Product List` <span class="hljs-keyword">where</span> catagoryID <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span>  <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `Catagory List`;<br><span class="hljs-operator">+</span><span class="hljs-comment">-------+------------+</span><br><span class="hljs-operator">|</span> name  <span class="hljs-operator">|</span> catagoryID <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+------------+</span><br><span class="hljs-operator">|</span> Apple <span class="hljs-operator">|</span>        <span class="hljs-number">100</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span>  <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `Product List`;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------+--------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> catagoryID <span class="hljs-operator">|</span> detail <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------+--------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span>        <span class="hljs-number">100</span> <span class="hljs-operator">|</span>     <span class="hljs-number">10</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------+--------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<h6 id="set-null"><a href="#set-null" class="headerlink" title="set null"></a>set null</h6><p>顾名思义 再主表更新时 将从表对应的字段设置为<code>null</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span>  <span class="hljs-keyword">CREATE TABLE</span> `Catagory List` (<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>   `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>   `catagoryID` <span class="hljs-type">int</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>   <span class="hljs-keyword">PRIMARY KEY</span> (`name`),<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>   KEY `fk_product` (`catagoryID`),<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>   <span class="hljs-keyword">CONSTRAINT</span> `fk_product` <span class="hljs-keyword">FOREIGN KEY</span> (`catagoryID`) <span class="hljs-keyword">REFERENCES</span> `Product List` (`catagoryID`) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">ON</span><br> <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">null</span> );<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec) <br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `Product List`;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------+--------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> catagoryID <span class="hljs-operator">|</span> detail <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------+--------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span>        <span class="hljs-number">100</span> <span class="hljs-operator">|</span>     <span class="hljs-number">10</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------+--------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> `Catagory List` <span class="hljs-keyword">values</span> (<span class="hljs-string">&#x27;apple&#x27;</span>,<span class="hljs-number">100</span>);<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `Catagory List`;<br><span class="hljs-operator">+</span><span class="hljs-comment">-------+------------+</span><br><span class="hljs-operator">|</span> name  <span class="hljs-operator">|</span> catagoryID <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+------------+</span><br><span class="hljs-operator">|</span> apple <span class="hljs-operator">|</span>        <span class="hljs-number">100</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">update</span> `Product List` <span class="hljs-keyword">set</span> catagoryID <span class="hljs-operator">=</span> <span class="hljs-number">200</span> <span class="hljs-keyword">where</span> catagoryID <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.01</span> sec)<br><br><span class="hljs-keyword">Rows</span> matched: <span class="hljs-number">1</span>  Changed: <span class="hljs-number">1</span>  Warnings: <span class="hljs-number">0</span>   <br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> `Product List` <span class="hljs-keyword">values</span> (<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">50</span>);<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> `Catagory List` <span class="hljs-keyword">values</span> (<span class="hljs-string">&#x27;shit&#x27;</span>,<span class="hljs-number">2</span>);<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `Product List` <span class="hljs-keyword">AS</span> Product;<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `Catagory List`;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------+--------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> catagoryID <span class="hljs-operator">|</span> detail <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------+--------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span>        <span class="hljs-number">200</span> <span class="hljs-operator">|</span>     <span class="hljs-number">10</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span>          <span class="hljs-number">2</span> <span class="hljs-operator">|</span>     <span class="hljs-number">50</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------+--------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+------------+</span><br><span class="hljs-operator">|</span> name  <span class="hljs-operator">|</span> catagoryID <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+------------+</span><br><span class="hljs-operator">|</span> apple <span class="hljs-operator">|</span>       <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> shit  <span class="hljs-operator">|</span>          <span class="hljs-number">2</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">update</span> `Product List` <span class="hljs-keyword">set</span> catagoryID <span class="hljs-operator">=</span> <span class="hljs-number">20</span> <span class="hljs-keyword">where</span> catagoryID <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.01</span> sec)<br><span class="hljs-keyword">Rows</span> matched: <span class="hljs-number">1</span>  Changed: <span class="hljs-number">1</span>  Warnings: <span class="hljs-number">0</span><br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `Product List` <span class="hljs-keyword">AS</span> Product;<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `Catagory List`;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------+--------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> catagoryID <span class="hljs-operator">|</span> detail <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------+--------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span>        <span class="hljs-number">200</span> <span class="hljs-operator">|</span>     <span class="hljs-number">10</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span>         <span class="hljs-number">20</span> <span class="hljs-operator">|</span>     <span class="hljs-number">50</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------+--------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+------------+</span><br><span class="hljs-operator">|</span> name  <span class="hljs-operator">|</span> catagoryID <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+------------+</span><br><span class="hljs-operator">|</span> apple <span class="hljs-operator">|</span>       <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> shit  <span class="hljs-operator">|</span>       <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<p>删除主表<code>Product List</code>列的字段 从表中<code>CatagoryID</code>列的对应字段就会设置为<code>NULL</code></p>
<h5 id="删除外键"><a href="#删除外键" class="headerlink" title="删除外键"></a>删除外键</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> <span class="hljs-keyword">create table</span> `Catagory List`\G<br><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-number">1.</span> <span class="hljs-type">row</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><br>       <span class="hljs-keyword">Table</span>: Catagory List<br><span class="hljs-keyword">Create Table</span>: <span class="hljs-keyword">CREATE TABLE</span> `Catagory List` (<br>  `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT NULL</span>,<br>  `catagoryID` <span class="hljs-type">int</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY KEY</span> (`name`),<br>  KEY `fk_product` (`catagoryID`),<br>  <span class="hljs-keyword">CONSTRAINT</span> `fk_product` <span class="hljs-keyword">FOREIGN KEY</span> (`catagoryID`) <span class="hljs-keyword">REFERENCES</span> `Product List` (`catagoryID`) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">SET</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">SET</span> <span class="hljs-keyword">NULL</span><br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_0900_ai_ci<br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">alter table</span> `Catagory List` <span class="hljs-keyword">drop</span> <span class="hljs-keyword">foreign key</span> fk_product;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.01</span> sec)<br>Records: <span class="hljs-number">0</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>

<h3 id="使用列生成列"><a href="#使用列生成列" class="headerlink" title="使用列生成列"></a>使用列生成列</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-built_in">column_name</span> data_type [<span class="hljs-keyword">GENERATED</span> <span class="hljs-keyword">ALWAYS</span>] <span class="hljs-keyword">AS</span> (expression)<br>   [VIRTUAL | STORED] [<span class="hljs-keyword">UNIQUE</span> [KEY]]<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create table t3 ( id int not null auto_increment primary key, firtName varchar(10) not null,<br>lastName varchar(10) not null, fullName varchar(21) generated always as (concat(firtName,&#x27; &#x27;,lastName)));<br>Query OK, 0 rows affected (0.08 sec)<br><br>mysql&gt; show columns from t3; <br>+----------+-------------+------+-----+---------+-------------------+<br>| Field    | Type        | Null | Key | Default | Extra             |<br>+----------+-------------+------+-----+---------+-------------------+<br>| id       | int         | NO   | PRI | NULL    | auto_increment    |<br>| firtName | varchar(10) | NO   |     | NULL    |                   |<br>| lastName | varchar(10) | NO   |     | NULL    |                   |<br>| fullName | varchar(21) | YES  |     | NULL    | VIRTUAL GENERATED |<br>+----------+-------------+------+-----+---------+-------------------+<br>4 rows in set (0.00 sec)<br><br>mysql&gt; insert into t3(firtName,lastName) values (&quot;Zhang&quot;,&quot;San&quot;);<br>Query OK, 1 row affected (0.05 sec)<br><br>mysql&gt; select * from t3; <br>+----+----------+----------+-----------+<br>| id | firtName | lastName | fullName  |<br>+----+----------+----------+-----------+<br>|  1 | Zhang    | San      | Zhang San |<br>+----+----------+----------+-----------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; alter table t3 add column alias varchar(15) generated always as (concat(&#x27;Dear&#x27;,&#x27; &#x27;,lastName));<br>Query OK, 0 rows affected (0.06 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt; show columns from t3;<br>+----------+-------------+------+-----+---------+-------------------+<br>| Field    | Type        | Null | Key | Default | Extra             |<br>+----------+-------------+------+-----+---------+-------------------+<br>| id       | int         | NO   | PRI | NULL    | auto_increment    |<br>| firtName | varchar(10) | NO   |     | NULL    |                   |<br>| lastName | varchar(10) | NO   |     | NULL    |                   |<br>| fullName | varchar(21) | YES  |     | NULL    | VIRTUAL GENERATED |<br>| alias    | varchar(15) | YES  |     | NULL    | VIRTUAL GENERATED |<br>+----------+-------------+------+-----+---------+-------------------+<br>5 rows in set (0.00 sec)<br><br>mysql&gt; select * from t3;<br>+----+----------+----------+-----------+----------+<br>| id | firtName | lastName | fullName  | alias    |<br>+----+----------+----------+-----------+----------+<br>|  1 | Zhang    | San      | Zhang San | Dear San |<br>+----+----------+----------+-----------+----------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<h2 id="复制表"><a href="#复制表" class="headerlink" title="复制表"></a>复制表</h2><h3 id="仅复制表"><a href="#仅复制表" class="headerlink" title="仅复制表"></a>仅复制表</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create table t2 like t1; <br>Query OK, 0 rows affected (0.08 sec)<br><br>mysql&gt; show tables;<br>+-----------------+<br>| Tables_in_test1 |<br>+-----------------+<br>| t1              |<br>| t2              |<br>+-----------------+<br>2 rows in set (0.00 sec)<br><br>mysql&gt; select * from t2;<br>Empty set (0.00 sec)<br><br>mysql&gt; select * from t1;<br>+----+-----------+-----+<br>| id | name      | age |<br>+----+-----------+-----+<br>|  1 | ZhangSan  |   0 |<br>|  2 | LiSi      |   0 |<br>|  3 | ZhangSan2 |   0 |<br>|  5 | ZhangSan3 |   0 |<br>+----+-----------+-----+<br>4 rows in set (0.00 sec)<br><br></code></pre></td></tr></table></figure>

<h3 id="复制表和数据"><a href="#复制表和数据" class="headerlink" title="复制表和数据"></a>复制表和数据</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show tables; <br>+-------------------------+<br>| Tables_in_classicmodels |<br>+-------------------------+<br>| customers               |<br>| employees               |<br>| offices                 |<br>| orderdetails            |<br>| orders                  |<br>| payments                |<br>| productlines            |<br>| products                |<br>| tables1                 |<br>+-------------------------+<br>9 rows in set (0.00 sec)<br><br>mysql&gt; create table test1.testT1 (select * from tables1);<br>Query OK, 4 rows affected (0.09 sec)<br>Records: 4  Duplicates: 0  Warnings: 0<br><br>mysql&gt; check table test1.testT1;<br>+--------------+-------+----------+----------+<br>| Table        | Op    | Msg_type | Msg_text |<br>+--------------+-------+----------+----------+<br>| test1.testT1 | check | status   | OK       |<br>+--------------+-------+----------+----------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select * from test1.testT1; <br>+----+-----------+-----+<br>| id | name      | age |<br>+----+-----------+-----+<br>|  1 | ZhangSan  |   0 |<br>|  2 | LiSi      |   0 |<br>|  3 | ZhangSan2 |   0 |<br>|  5 | ZhangSan3 |   0 |<br>+----+-----------+-----+<br>4 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<h2 id="删除表"><a href="#删除表" class="headerlink" title="删除表"></a>删除表</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show tables; <br>+-------------------------+<br>| Tables_in_classicmodels |<br>+-------------------------+<br>| customers               |<br>| employees               |<br>| offices                 |<br>| orderdetails            |<br>| orders                  |<br>| payments                |<br>| productlines            |<br>| products                |<br>| tables1                 |<br>+-------------------------+<br>9 rows in set (0.00 sec)<br><br>mysql&gt; drop table tables1;<br>Query OK, 0 rows affected (0.06 sec)<br><br>mysql&gt; show tables like &quot;tables1&quot;;<br>Empty set (0.00 sec)<br></code></pre></td></tr></table></figure>

<h2 id="重命名表"><a href="#重命名表" class="headerlink" title="重命名表"></a>重命名表</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show tables; <br>+-----------------+<br>| Tables_in_test1 |<br>+-----------------+<br>| testT1          |<br>+-----------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; rename table testT1 to T1;<br>Query OK, 0 rows affected (0.08 sec)<br><br>mysql&gt; show tables;<br>+-----------------+<br>| Tables_in_test1 |<br>+-----------------+<br>| T1              |<br>+-----------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; alter table T1 rename to t1; <br>Query OK, 0 rows affected (0.07 sec)<br><br>mysql&gt; show tables;<br>+-----------------+<br>| Tables_in_test1 |<br>+-----------------+<br>| t1              |<br>+-----------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<h1 id="DML"><a href="#DML" class="headerlink" title="DML"></a>DML</h1><h2 id="insert"><a href="#insert" class="headerlink" title="insert"></a>insert</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> T1(id,name) <span class="hljs-keyword">values</span> (<span class="hljs-number">1</span>,&quot;ZhangSan&quot;);<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> T1 <span class="hljs-keyword">values</span> (<span class="hljs-number">2</span>,&quot;LiSi&quot;),(<span class="hljs-number">3</span>,&quot;WangWu&quot;);<br>Query OK, <span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br>Records: <span class="hljs-number">2</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> T1; <br><span class="hljs-operator">+</span><span class="hljs-comment">----+----------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> name     <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+----------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> ZhangSan <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span> LiSi     <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">3</span> <span class="hljs-operator">|</span> WangWu   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+----------+</span><br><span class="hljs-number">3</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; use testDB; <br>Database changed<br>mysql&gt; create table t1 ( <br>    -&gt; id int primary key auto_increment, <br>    -&gt; name varchar(10) not null, <br>    -&gt; date date not null) <br>    -&gt; character set utf8 engine=MYISAM; <br>Query OK, 0 rows affected, 1 warning (0.03 sec)<br><br>mysql&gt; insert into t1 values (1,&#x27;ZS&#x27;,&#x27;2021-8-9&#x27;),(2,&#x27;LiSi&#x27;,current_time());<br>Query OK, 2 rows affected, 1 warning (0.03 sec)<br>Records: 2  Duplicates: 0  Warnings: 1<br><br>mysql&gt; select * from t1; <br>+----+------+------------+<br>| id | name | date       |<br>+----+------+------------+<br>|  1 | ZS   | 2021-08-09 |<br>|  2 | LiSi | 2024-07-30 |<br>+----+------+------------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<h2 id="insert-into-select"><a href="#insert-into-select" class="headerlink" title="insert into select"></a>insert into select</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">truncate</span> t1;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t2;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+--------+------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> name   <span class="hljs-operator">|</span> <span class="hljs-type">date</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+--------+------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> ZS     <span class="hljs-operator">|</span> <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-09</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span> LiSi   <span class="hljs-operator">|</span> <span class="hljs-number">2024</span><span class="hljs-number">-07</span><span class="hljs-number">-30</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">3</span> <span class="hljs-operator">|</span> WangWu <span class="hljs-operator">|</span> <span class="hljs-number">2024</span><span class="hljs-number">-07</span><span class="hljs-number">-30</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">4</span> <span class="hljs-operator">|</span> MaZi   <span class="hljs-operator">|</span> <span class="hljs-number">2024</span><span class="hljs-number">-07</span><span class="hljs-number">-30</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+--------+------------+</span><br><span class="hljs-number">4</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> t1(name,<span class="hljs-type">date</span>) <span class="hljs-keyword">select</span> name,<span class="hljs-type">date</span> <span class="hljs-keyword">from</span> t2 <span class="hljs-keyword">where</span> id <span class="hljs-operator">&gt;</span> <span class="hljs-number">2</span>; <br>Query OK, <span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br>Records: <span class="hljs-number">2</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t1;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+--------+------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> name   <span class="hljs-operator">|</span> <span class="hljs-type">date</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+--------+------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> WangWu <span class="hljs-operator">|</span> <span class="hljs-number">2024</span><span class="hljs-number">-07</span><span class="hljs-number">-30</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span> MaZi   <span class="hljs-operator">|</span> <span class="hljs-number">2024</span><span class="hljs-number">-07</span><span class="hljs-number">-30</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+--------+------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<h2 id="INSERT-INTO-ON-DUPLICATE-KEY-UPDATE"><a href="#INSERT-INTO-ON-DUPLICATE-KEY-UPDATE" class="headerlink" title="INSERT INTO ON DUPLICATE KEY UPDATE"></a>INSERT INTO ON DUPLICATE KEY UPDATE</h2><p>在插入的数据中 因为<code>unique</code>和主键的约束 导致一些值无法插入 可以使用<code>INSERT INTO ON DUPLICATE KEY UPDATE</code>更新插入错误数据的其他值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> <span class="hljs-keyword">create table</span> t3\G<br><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-number">1.</span> <span class="hljs-type">row</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><br>       <span class="hljs-keyword">Table</span>: t3<br><span class="hljs-keyword">Create Table</span>: <span class="hljs-keyword">CREATE TABLE</span> `t3` (<br>  `id` <span class="hljs-type">int</span> <span class="hljs-keyword">NOT NULL</span> AUTO_INCREMENT,<br>  `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT NULL</span>,<br>  `emails` <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT NULL</span>,<br>  <span class="hljs-keyword">PRIMARY KEY</span> (`id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `emails` (`emails`)<br>) ENGINE<span class="hljs-operator">=</span>MyISAM AUTO_INCREMENT<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb3<br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> t3(name,emails)  <span class="hljs-keyword">values</span> (<span class="hljs-string">&#x27;ZhangSan&#x27;</span>,<span class="hljs-string">&#x27;1@qq.com&#x27;</span>),(<span class="hljs-string">&#x27;LiSi&#x27;</span>,<span class="hljs-string">&#x27;1@qq.com&#x27;</span>); <br>ERROR <span class="hljs-number">1062</span> (<span class="hljs-number">23000</span>): Duplicate entry <span class="hljs-string">&#x27;1@qq.com&#x27;</span> <span class="hljs-keyword">for</span> key <span class="hljs-string">&#x27;t3.emails&#x27;</span><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t3; <br><span class="hljs-operator">+</span><span class="hljs-comment">----+----------+----------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> name     <span class="hljs-operator">|</span> emails   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+----------+----------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> ZhangSan <span class="hljs-operator">|</span> <span class="hljs-number">1</span><span class="hljs-variable">@qq</span>.com <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+----------+----------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> t3(name,emails) <span class="hljs-keyword">values</span> (&quot;asd&quot;,&quot;1@qq.com&quot;) <span class="hljs-keyword">on</span> duplicate key <span class="hljs-keyword">update</span> name<span class="hljs-operator">=</span><span class="hljs-keyword">values</span>(name); <br>Query OK, <span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> affected, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t3;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+----------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span> emails   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+----------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> asd  <span class="hljs-operator">|</span> <span class="hljs-number">1</span><span class="hljs-variable">@qq</span>.com <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+----------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; insert into t3 values (1,&quot;ZhangSan&quot;,&quot;1@qq.com&quot;),(2,&quot;LiSi&quot;,&quot;1@qq.com&quot;) on duplicate key update name=values(name);<br>Query OK, 3 rows affected, 1 warning (0.02 sec)<br>Records: 2  Duplicates: 1  Warnings: 1<br><br>mysql&gt; select * from t3; <br>+----+------+----------+<br>| id | name | emails   |<br>+----+------+----------+<br>|  1 | LiSi | 1@qq.com |<br>+----+------+----------+<br>1 row in set (0.00 sec)<br><br></code></pre></td></tr></table></figure>

<h2 id="MySQL-INSERT-IGNORE-Statement"><a href="#MySQL-INSERT-IGNORE-Statement" class="headerlink" title="MySQL INSERT IGNORE Statement"></a>MySQL INSERT IGNORE Statement</h2><p>在插入数据无效时的处理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show create table t4\G<br>*************************** 1. row ***************************<br>       Table: t4<br>Create Table: CREATE TABLE `t4` (<br>  `name` varchar(10) NOT NULL,<br>  `age` int NOT NULL,<br>  PRIMARY KEY (`name`),<br>  CONSTRAINT `t4_chk_1` CHECK ((`age` &gt; 18))<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci<br>1 row in set (0.00 sec)<br><br>mysql&gt; insert into t4 values (&#x27;zs&#x27;,18),(&#x27;ls&#x27;,15); <br>ERROR 3819 (HY000): Check constraint &#x27;t4_chk_1&#x27; is violated.<br><br>mysql&gt; select * from t4; <br>Empty set (0.01 sec)<br><br>mysql&gt; insert ignore into t4 values (&#x27;zs&#x27;,19),(&#x27;ls&#x27;,15);<br>Query OK, 1 row affected, 1 warning (0.03 sec)<br>Records: 1  Duplicates: 0  Warnings: 1<br><br>mysql&gt; select * from t4;<br>+------+-----+<br>| name | age |<br>+------+-----+<br>| zs   |  19 |<br>+------+-----+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create table</span> t5 (name <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">unique</span> <span class="hljs-keyword">not null</span>,age <span class="hljs-type">int</span> <span class="hljs-keyword">not null</span>);<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.09</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> t5 <span class="hljs-keyword">values</span> (<span class="hljs-string">&#x27;zs&#x27;</span>,<span class="hljs-number">2</span>),(<span class="hljs-string">&#x27;zs&#x27;</span>,<span class="hljs-number">4</span>);<br>ERROR <span class="hljs-number">1062</span> (<span class="hljs-number">23000</span>): Duplicate entry <span class="hljs-string">&#x27;zs&#x27;</span> <span class="hljs-keyword">for</span> key <span class="hljs-string">&#x27;t5.name&#x27;</span><br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t5;<br><span class="hljs-keyword">Empty</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert</span> ignore <span class="hljs-keyword">into</span> t5 <span class="hljs-keyword">values</span> (<span class="hljs-string">&#x27;zs&#x27;</span>,<span class="hljs-number">2</span>),(<span class="hljs-string">&#x27;zs&#x27;</span>,<span class="hljs-number">4</span>);<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.02</span> sec)<br>Records: <span class="hljs-number">2</span>  Duplicates: <span class="hljs-number">1</span>  Warnings: <span class="hljs-number">1</span><br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t5;<br><span class="hljs-operator">+</span><span class="hljs-comment">------+-----+</span><br><span class="hljs-operator">|</span> name <span class="hljs-operator">|</span> age <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+-----+</span><br><span class="hljs-operator">|</span> zs   <span class="hljs-operator">|</span>   <span class="hljs-number">2</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+-----+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br></code></pre></td></tr></table></figure>

<h2 id="update"><a href="#update" class="headerlink" title="update"></a>update</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create table</span> t6 (name <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">primary key</span>, gender enum(&quot;m&quot;,&quot;w&quot;) <span class="hljs-keyword">default</span>(&quot;m&quot;),age <span class="hljs-type">int</span> <span class="hljs-keyword">not null</span>); <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.05</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span>  t6 <span class="hljs-keyword">values</span> (<span class="hljs-string">&#x27;zs&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-number">18</span>),(<span class="hljs-string">&#x27;ls&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>,<span class="hljs-number">29</span>);<br>Query OK, <span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br>Records: <span class="hljs-number">2</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t6; <br><span class="hljs-operator">+</span><span class="hljs-comment">------+--------+-----+</span><br><span class="hljs-operator">|</span> name <span class="hljs-operator">|</span> gender <span class="hljs-operator">|</span> age <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+--------+-----+</span><br><span class="hljs-operator">|</span> ls   <span class="hljs-operator">|</span> w      <span class="hljs-operator">|</span>  <span class="hljs-number">29</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> zs   <span class="hljs-operator">|</span> m      <span class="hljs-operator">|</span>  <span class="hljs-number">18</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+--------+-----+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">update</span> t6 <span class="hljs-keyword">set</span> age<span class="hljs-operator">=</span><span class="hljs-number">10</span> <span class="hljs-keyword">where</span> name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;ls&#x27;</span>;<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.02</span> sec)<br><span class="hljs-keyword">Rows</span> matched: <span class="hljs-number">1</span>  Changed: <span class="hljs-number">1</span>  Warnings: <span class="hljs-number">0</span><br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">update</span> t6 <span class="hljs-keyword">set</span> age<span class="hljs-operator">=</span><span class="hljs-number">15</span>,gender<span class="hljs-operator">=</span><span class="hljs-string">&#x27;w&#x27;</span> <span class="hljs-keyword">where</span> name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;zs&#x27;</span>;<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.03</span> sec)<br><span class="hljs-keyword">Rows</span> matched: <span class="hljs-number">1</span>  Changed: <span class="hljs-number">1</span>  Warnings: <span class="hljs-number">0</span><br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t6; <br><span class="hljs-operator">+</span><span class="hljs-comment">------+--------+-----+</span><br><span class="hljs-operator">|</span> name <span class="hljs-operator">|</span> gender <span class="hljs-operator">|</span> age <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+--------+-----+</span><br><span class="hljs-operator">|</span> ls   <span class="hljs-operator">|</span> w      <span class="hljs-operator">|</span>  <span class="hljs-number">10</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> zs   <span class="hljs-operator">|</span> w      <span class="hljs-operator">|</span>  <span class="hljs-number">15</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+--------+-----+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<h2 id="delete-truncate"><a href="#delete-truncate" class="headerlink" title="delete &amp; truncate"></a>delete &amp; truncate</h2><p>delete: 删除多行数据</p>
<p>truncate: 清除表中全部数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t7; <br><span class="hljs-operator">+</span><span class="hljs-comment">------+--------+-----+</span><br><span class="hljs-operator">|</span> name <span class="hljs-operator">|</span> gender <span class="hljs-operator">|</span> age <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+--------+-----+</span><br><span class="hljs-operator">|</span> ls   <span class="hljs-operator">|</span> w      <span class="hljs-operator">|</span>  <span class="hljs-number">10</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> zs   <span class="hljs-operator">|</span> w      <span class="hljs-operator">|</span>  <span class="hljs-number">15</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> ww   <span class="hljs-operator">|</span> m      <span class="hljs-operator">|</span>   <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> wmz  <span class="hljs-operator">|</span> m      <span class="hljs-operator">|</span>  <span class="hljs-number">15</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+--------+-----+</span><br><span class="hljs-number">4</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> t7 <span class="hljs-keyword">where</span> age<span class="hljs-operator">=</span><span class="hljs-number">15</span> <span class="hljs-keyword">and</span> gender<span class="hljs-operator">=</span><span class="hljs-string">&#x27;m&#x27;</span>;<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.20</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">truncate</span> t7; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.07</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t7; <br><span class="hljs-keyword">Empty</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<h1 id="DCL"><a href="#DCL" class="headerlink" title="DCL"></a>DCL</h1><h2 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h2><p>MySQL安装是 会自带几个关键数据库 其中mysql.user中就是用户的表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases; <br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql              <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> sys                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-number">4</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> Host,<span class="hljs-keyword">User</span> <span class="hljs-keyword">from</span> mysql.user;<br><span class="hljs-operator">+</span><span class="hljs-comment">-----------+------------------+</span><br><span class="hljs-operator">|</span> Host      <span class="hljs-operator">|</span> <span class="hljs-keyword">User</span>             <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------+------------------+</span><br><span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span> mysql.infoschema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span> mysql.session    <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span> mysql.sys        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span> root             <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------+------------------+</span><br><span class="hljs-number">4</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<p>用户的格式是 user@host </p>
<p><code>user</code> 为用户名 <code>host</code> 为连接数据库的主机名</p>
<h3 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h3><p>创建了两个用户 <code>shanwen</code> 只能在主机名为<code>localhost</code>的主机登陆 而<code>others</code>可以在所有主机上登陆 密码都为qweQWE123..</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> shanwen<span class="hljs-variable">@localhost</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;qweQWE123..&#x27;</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.04</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> others@&quot;%&quot; identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;qweQWE123..&#x27;</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> Host,<span class="hljs-keyword">User</span> <span class="hljs-keyword">from</span> mysql.user;<br><span class="hljs-operator">+</span><span class="hljs-comment">-----------+------------------+</span><br><span class="hljs-operator">|</span> Host      <span class="hljs-operator">|</span> <span class="hljs-keyword">User</span>             <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------+------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span> others           <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span> mysql.infoschema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span> mysql.session    <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span> mysql.sys        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span> root             <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span> shanwen          <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------+------------------+</span><br><span class="hljs-number">6</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec<br></code></pre></td></tr></table></figure>

<p>其他客户端只能登陆<code>others</code> 用户 不能使用<code>shanwen</code>登陆</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@Client</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uothers <span class="hljs-operator">-</span>pqweQWE123.. <span class="hljs-operator">-</span>h192<span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.101</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>(); <br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>()                 <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------+</span><br><span class="hljs-operator">|</span> others<span class="hljs-variable">@192</span><span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.110</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>[root<span class="hljs-variable">@Client</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>ushanwen <span class="hljs-operator">-</span>pqweQWE123.. <span class="hljs-operator">-</span>h192<span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.101</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br>ERROR <span class="hljs-number">1045</span> (<span class="hljs-number">28000</span>): Access denied <span class="hljs-keyword">for</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;shanwen&#x27;</span>@<span class="hljs-string">&#x27;192.168.100.110&#x27;</span> (<span class="hljs-keyword">using</span> password: YES)<br></code></pre></td></tr></table></figure>

<p>现在无法进行任何操作 因为没有相关的权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> database d1;<br>ERROR <span class="hljs-number">1044</span> (<span class="hljs-number">42000</span>): Access denied <span class="hljs-keyword">for</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;others&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> <span class="hljs-keyword">to</span> database <span class="hljs-string">&#x27;d1&#x27;</span><br></code></pre></td></tr></table></figure>

<h3 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h3><p>查看存在用户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>,host <span class="hljs-keyword">from</span> mysql.user; <br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>             <span class="hljs-operator">|</span> host      <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> others           <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.infoschema <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.session    <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.sys        <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> root             <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> shanwen          <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-number">6</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<p>创建示例用户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> u1@<span class="hljs-string">&#x27;%&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;qweQWE123..&#x27;</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.05</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> u2@<span class="hljs-string">&#x27;%&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;qweQWE123..&#x27;</span>; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.05</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>,host <span class="hljs-keyword">from</span> mysql.user;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>             <span class="hljs-operator">|</span> host      <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> others           <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> u1               <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> u2               <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.infoschema <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.session    <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.sys        <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> root             <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> shanwen          <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-number">8</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">drop</span> <span class="hljs-keyword">user</span> u1@<span class="hljs-string">&#x27;%&#x27;</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">drop</span> <span class="hljs-keyword">user</span> u2@<span class="hljs-string">&#x27;%&#x27;</span>,shanwen<span class="hljs-variable">@localhost</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.05</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>,host <span class="hljs-keyword">from</span> mysql.user;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>             <span class="hljs-operator">|</span> host      <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> others           <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.infoschema <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.session    <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.sys        <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> root             <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-number">5</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<p>查看在线进程 </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> processlist \G<br><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-number">1.</span> <span class="hljs-type">row</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><br>     Id: <span class="hljs-number">5</span><br>   <span class="hljs-keyword">User</span>: event_scheduler<br>   Host: localhost<br>     db: <span class="hljs-keyword">NULL</span><br>Command: Daemon<br>   <span class="hljs-type">Time</span>: <span class="hljs-number">2667</span><br>  State: Waiting <span class="hljs-keyword">on</span> <span class="hljs-keyword">empty</span> queue<br>   Info: <span class="hljs-keyword">NULL</span><br><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-number">2.</span> <span class="hljs-type">row</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><br>     Id: <span class="hljs-number">20</span><br>   <span class="hljs-keyword">User</span>: root<br>   Host: localhost<br>     db: <span class="hljs-keyword">NULL</span><br>Command: Query<br>   <span class="hljs-type">Time</span>: <span class="hljs-number">0</span><br>  State: init<br>   Info: <span class="hljs-keyword">show</span> processlist<br><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-number">3.</span> <span class="hljs-type">row</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><br>     Id: <span class="hljs-number">21</span><br>   <span class="hljs-keyword">User</span>: test1<br>   Host: <span class="hljs-number">192.168</span><span class="hljs-number">.100</span><span class="hljs-number">.110</span>:<span class="hljs-number">56274</span><br>     db: <span class="hljs-keyword">NULL</span><br>Command: Sleep<br>   <span class="hljs-type">Time</span>: <span class="hljs-number">11</span><br>  State: <br>   Info: <span class="hljs-keyword">NULL</span><br><span class="hljs-number">3</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<p><code>test1</code>仍然在进程中 建议手动<code>kill</code>后<code>drop</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> kill <span class="hljs-number">21</span>; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">drop</span> <span class="hljs-keyword">user</span> test1@<span class="hljs-string">&#x27;%&#x27;</span>; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.04</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> processlist \G<br><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-number">1.</span> <span class="hljs-type">row</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><br>     Id: <span class="hljs-number">5</span><br>   <span class="hljs-keyword">User</span>: event_scheduler<br>   Host: localhost<br>     db: <span class="hljs-keyword">NULL</span><br>Command: Daemon<br>   <span class="hljs-type">Time</span>: <span class="hljs-number">2742</span><br>  State: Waiting <span class="hljs-keyword">on</span> <span class="hljs-keyword">empty</span> queue<br>   Info: <span class="hljs-keyword">NULL</span><br><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-number">2.</span> <span class="hljs-type">row</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><br>     Id: <span class="hljs-number">20</span><br>   <span class="hljs-keyword">User</span>: root<br>   Host: localhost<br>     db: <span class="hljs-keyword">NULL</span><br>Command: Query<br>   <span class="hljs-type">Time</span>: <span class="hljs-number">0</span><br>  State: init<br>   Info: <span class="hljs-keyword">show</span> processlist<br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<p>客户端</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases; <br>ERROR <span class="hljs-number">2013</span> (HY000): Lost connection <span class="hljs-keyword">to</span> MySQL server during query<br><span class="hljs-keyword">No</span> connection. Trying <span class="hljs-keyword">to</span> reconnect...<br>ERROR <span class="hljs-number">1045</span> (<span class="hljs-number">28000</span>): Access denied <span class="hljs-keyword">for</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;test1&#x27;</span>@<span class="hljs-string">&#x27;192.168.100.110&#x27;</span> (<span class="hljs-keyword">using</span> password: YES)<br>ERROR: <br>Can<span class="hljs-string">&#x27;t connect to the server</span><br></code></pre></td></tr></table></figure>

<h3 id="更改密码"><a href="#更改密码" class="headerlink" title="更改密码"></a>更改密码</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>,host <span class="hljs-keyword">from</span> mysql.user;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>             <span class="hljs-operator">|</span> host      <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> others           <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> shanwen          <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.infoschema <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.session    <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.sys        <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> root             <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-number">6</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> test1 identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;qweQWE123..&#x27;</span>; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.04</span> sec)<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@Client</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>utest1 <span class="hljs-operator">-</span>pqweQWE123.. <span class="hljs-operator">-</span>h192<span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.101</span> <span class="hljs-operator">-</span>e <span class="hljs-string">&#x27;select user();&#x27;</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>()                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------+</span><br><span class="hljs-operator">|</span> test1<span class="hljs-variable">@192</span><span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.110</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------+</span><br></code></pre></td></tr></table></figure>

<p>修改密码</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">alter</span> <span class="hljs-keyword">user</span> test1 identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;qweQWE123@!&#x27;</span>; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.04</span> sec)<br><br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@Client</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>utest1 <span class="hljs-operator">-</span>pqweQWE123.. <span class="hljs-operator">-</span>h192<span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.101</span> <span class="hljs-operator">-</span>e <span class="hljs-string">&#x27;select user();&#x27;</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br>ERROR <span class="hljs-number">1045</span> (<span class="hljs-number">28000</span>): Access denied <span class="hljs-keyword">for</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;test1&#x27;</span>@<span class="hljs-string">&#x27;192.168.100.110&#x27;</span> (<span class="hljs-keyword">using</span> password: YES)<br>[root<span class="hljs-variable">@Client</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>utest1 <span class="hljs-operator">-</span>pqweQWE123@<span class="hljs-operator">!</span> <span class="hljs-operator">-</span>h192<span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.101</span> <span class="hljs-operator">-</span>e <span class="hljs-string">&#x27;select user();&#x27;</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>()                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------+</span><br><span class="hljs-operator">|</span> test1<span class="hljs-variable">@192</span><span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.110</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------+</span><br><br></code></pre></td></tr></table></figure>

<h3 id="重命名账号"><a href="#重命名账号" class="headerlink" title="重命名账号"></a>重命名账号</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> rename <span class="hljs-keyword">user</span> test1 <span class="hljs-keyword">to</span> testUser; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.05</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>,host <span class="hljs-keyword">from</span> mysql.user; <br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>             <span class="hljs-operator">|</span> host      <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> others           <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> shanwen          <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> testUser         <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.infoschema <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.session    <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.sys        <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> root             <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-number">7</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@Client</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>utest1 <span class="hljs-operator">-</span>pqweQWE123@<span class="hljs-operator">!</span> <span class="hljs-operator">-</span>h192<span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.101</span> <span class="hljs-operator">-</span>e <span class="hljs-string">&#x27;select user();&#x27;</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br>ERROR <span class="hljs-number">1045</span> (<span class="hljs-number">28000</span>): Access denied <span class="hljs-keyword">for</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;test1&#x27;</span>@<span class="hljs-string">&#x27;192.168.100.110&#x27;</span> (<span class="hljs-keyword">using</span> password: YES)<br>[root<span class="hljs-variable">@Client</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>utestUser <span class="hljs-operator">-</span>pqweQWE123@<span class="hljs-operator">!</span> <span class="hljs-operator">-</span>h192<span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.101</span> <span class="hljs-operator">-</span>e <span class="hljs-string">&#x27;select user();&#x27;</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>()                   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------+</span><br><span class="hljs-operator">|</span> testUser<span class="hljs-variable">@192</span><span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.110</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------+</span><br><br></code></pre></td></tr></table></figure>

<h3 id="锁定账号"><a href="#锁定账号" class="headerlink" title="锁定账号"></a>锁定账号</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">alter</span> <span class="hljs-keyword">user</span> testUser account lock; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@Client</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>utestUser <span class="hljs-operator">-</span>pqweQWE123@<span class="hljs-operator">!</span> <span class="hljs-operator">-</span>h192<span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.101</span> <span class="hljs-operator">-</span>e <span class="hljs-string">&#x27;select user();&#x27;</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br>ERROR <span class="hljs-number">3118</span> (HY000): Access denied <span class="hljs-keyword">for</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;testUser&#x27;</span>@<span class="hljs-string">&#x27;192.168.100.110&#x27;</span>. Account <span class="hljs-keyword">is</span> locked.<br><br></code></pre></td></tr></table></figure>

<h3 id="解锁账号"><a href="#解锁账号" class="headerlink" title="解锁账号"></a>解锁账号</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">alter</span> <span class="hljs-keyword">user</span> testUser account unlock;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.04</span> sec)<br><br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@Client</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>utestUser <span class="hljs-operator">-</span>pqweQWE123@<span class="hljs-operator">!</span> <span class="hljs-operator">-</span>h192<span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.101</span> <span class="hljs-operator">-</span>e <span class="hljs-string">&#x27;select user();&#x27;</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br>ERROR <span class="hljs-number">3118</span> (HY000): Access denied <span class="hljs-keyword">for</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;testUser&#x27;</span>@<span class="hljs-string">&#x27;192.168.100.110&#x27;</span>. Account <span class="hljs-keyword">is</span> locked.<br>[root<span class="hljs-variable">@Client</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>utestUser <span class="hljs-operator">-</span>pqweQWE123@<span class="hljs-operator">!</span> <span class="hljs-operator">-</span>h192<span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.101</span> <span class="hljs-operator">-</span>e <span class="hljs-string">&#x27;select user();&#x27;</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>()                   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------+</span><br><span class="hljs-operator">|</span> testUser<span class="hljs-variable">@192</span><span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.110</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------+</span><br><br></code></pre></td></tr></table></figure>

<h2 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h2><p><img src="/home/shanwen/Documents/Note/Pic/image-20240806174952905.png" srcset="/img/loading.gif" lazyload alt="image-20240806174952905"></p>
<p>全局权限 </p>
<ul>
<li>对数据库所有库</li>
</ul>
<p>库权限 </p>
<ul>
<li>对一个库的权限</li>
</ul>
<p>表权限</p>
<ul>
<li>对某库中的某个表有权限</li>
</ul>
<p>列权限</p>
<ul>
<li>对某个列有权限</li>
</ul>
<p>存储过程权限</p>
<ul>
<li>对存储过程权限</li>
</ul>
<p>代理权限</p>
<ul>
<li>使某个用户具有其他用户的权限 代理</li>
</ul>
<h3 id="赋予权限"><a href="#赋予权限" class="headerlink" title="赋予权限"></a>赋予权限</h3><p>查看权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> others@<span class="hljs-string">&#x27;%&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------+</span><br><span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> others@<span class="hljs-operator">%</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>` <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> shanwen<span class="hljs-variable">@localhost</span>; <br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------------+</span><br><span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> shanwen<span class="hljs-variable">@localhost</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `shanwen`@`localhost` <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br></code></pre></td></tr></table></figure>

<h4 id="全局权限"><a href="#全局权限" class="headerlink" title="全局权限"></a>全局权限</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">grant</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">on</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">to</span> others@<span class="hljs-string">&#x27;%&#x27;</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> flush privileges;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>(); <br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>()         <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@Client</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uothers <span class="hljs-operator">-</span>pqweQWE123.. <span class="hljs-operator">-</span>h192<span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.101</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>(); <br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>()                 <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------+</span><br><span class="hljs-operator">|</span> others<span class="hljs-variable">@192</span><span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.110</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases; <br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql              <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> sys                <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> testDB             <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-number">5</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<h4 id="库权限"><a href="#库权限" class="headerlink" title="库权限"></a>库权限</h4><p>这时候我想other增加一个在<code>testDB</code>库中创建表的权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">grant</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">on</span> testDB.<span class="hljs-operator">*</span> <span class="hljs-keyword">to</span> others@<span class="hljs-string">&#x27;%&#x27;</span>; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> flush privileges; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>(); <br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>()                 <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------+</span><br><span class="hljs-operator">|</span> others<span class="hljs-variable">@192</span><span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.110</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create table</span> testDB.t2(id <span class="hljs-type">int</span> <span class="hljs-keyword">primary key</span> auto_increment ); <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">1.12</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> tables <span class="hljs-keyword">from</span> testDB;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span><br><span class="hljs-operator">|</span> Tables_in_testDB <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span><br><span class="hljs-operator">|</span> t1               <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> t2               <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br></code></pre></td></tr></table></figure>

<h4 id="表权限"><a href="#表权限" class="headerlink" title="表权限"></a>表权限</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> testDB.t2 <span class="hljs-keyword">values</span> (<span class="hljs-number">1</span>); <br>ERROR <span class="hljs-number">1142</span> (<span class="hljs-number">42000</span>): <span class="hljs-keyword">INSERT</span> command denied <span class="hljs-keyword">to</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;others&#x27;</span>@<span class="hljs-string">&#x27;192.168.100.110&#x27;</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">table</span> <span class="hljs-string">&#x27;t2&#x27;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">grant</span> <span class="hljs-keyword">insert</span> <span class="hljs-keyword">on</span> testDB.t2 <span class="hljs-keyword">to</span> others@<span class="hljs-string">&#x27;%&#x27;</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> flush privileges; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)			<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> testDB.t2 <span class="hljs-keyword">values</span> (<span class="hljs-number">1</span>);<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.06</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> testDB.t2; <br><span class="hljs-operator">+</span><span class="hljs-comment">----+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<h4 id="列权限"><a href="#列权限" class="headerlink" title="列权限"></a>列权限</h4><p>赋予<code>others@%</code> 对 <code>testDB.t2</code> <code>id</code> 列的<code>insert</code> 权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> others@<span class="hljs-string">&#x27;%&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------------------+</span><br><span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> others@<span class="hljs-operator">%</span>                           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>`           <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">ON</span> `testDB`.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>`    <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">ON</span> `testDB`.`t2` <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>` <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------------------+</span><br><span class="hljs-number">3</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> testDB.t1; <br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> zs   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">grant</span> <span class="hljs-keyword">insert</span>(id) <span class="hljs-keyword">on</span> testDB.t1 <span class="hljs-keyword">to</span> others@<span class="hljs-string">&#x27;%&#x27;</span>; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> flush privileges; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">desc</span> testDB.t1; <br><span class="hljs-operator">+</span><span class="hljs-comment">-------+-------------+------+-----+---------+----------------+</span><br><span class="hljs-operator">|</span> Field <span class="hljs-operator">|</span> Type        <span class="hljs-operator">|</span> <span class="hljs-keyword">Null</span> <span class="hljs-operator">|</span> Key <span class="hljs-operator">|</span> <span class="hljs-keyword">Default</span> <span class="hljs-operator">|</span> Extra          <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+-------------+------+-----+---------+----------------+</span><br><span class="hljs-operator">|</span> id    <span class="hljs-operator">|</span> <span class="hljs-type">int</span>         <span class="hljs-operator">|</span> <span class="hljs-keyword">NO</span>   <span class="hljs-operator">|</span> PRI <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span> auto_increment <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> name  <span class="hljs-operator">|</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-operator">|</span> <span class="hljs-keyword">NO</span>   <span class="hljs-operator">|</span>     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+-------------+------+-----+---------+----------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> testDB.t1 <span class="hljs-keyword">values</span> (<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;ls&#x27;</span>);<br>ERROR <span class="hljs-number">1142</span> (<span class="hljs-number">42000</span>): <span class="hljs-keyword">INSERT</span> command denied <span class="hljs-keyword">to</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;others&#x27;</span>@<span class="hljs-string">&#x27;192.168.100.110&#x27;</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">table</span> <span class="hljs-string">&#x27;t1&#x27;</span><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> testDB.t1(id) <span class="hljs-keyword">values</span> (<span class="hljs-number">2</span>);<br>ERROR <span class="hljs-number">1364</span> (HY000): Field <span class="hljs-string">&#x27;name&#x27;</span> doesn<span class="hljs-string">&#x27;t have a default value</span><br></code></pre></td></tr></table></figure>

<p>因为<code>testDB.t1</code>的<code>name</code>约束有<code>not null</code> 且没有默认值 所以无法只插入<code>id</code> </p>
<p>修改<code>testDB.t1</code>的表属性</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">alter table</span> testDB.t1 modify <span class="hljs-keyword">column</span> name <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">null</span>; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.18</span> sec)<br>Records: <span class="hljs-number">0</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> testDB.t1(id) <span class="hljs-keyword">values</span> (<span class="hljs-number">2</span>);<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.04</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> testDB.t1; <br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> zs   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> testDB.t1 <span class="hljs-keyword">values</span> (<span class="hljs-number">3</span>,<span class="hljs-string">&#x27;ww&#x27;</span>);<br>ERROR <span class="hljs-number">1142</span> (<span class="hljs-number">42000</span>): <span class="hljs-keyword">INSERT</span> command denied <span class="hljs-keyword">to</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;others&#x27;</span>@<span class="hljs-string">&#x27;192.168.100.110&#x27;</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">table</span> <span class="hljs-string">&#x27;t1&#x27;</span><br></code></pre></td></tr></table></figure>

<h4 id="代理用户权限"><a href="#代理用户权限" class="headerlink" title="代理用户权限"></a>代理用户权限</h4><p>将<code>shanwen@localhost</code>设置为<code>root@localhost</code>的代理用户 这样<code>shanwen@localhost</code>就拥有了<code>root@localhost</code>的权限 </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">grant</span> proxy <span class="hljs-keyword">on</span> root <span class="hljs-keyword">to</span> shanwen<span class="hljs-variable">@localhost</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> flush privileges; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>(); <br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>()         <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> shanwen<span class="hljs-variable">@localhost</span>; <br><span class="hljs-operator">+</span><span class="hljs-comment">----------------------------------------------------+</span><br><span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> shanwen<span class="hljs-variable">@localhost</span>                       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `shanwen`@`localhost`        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> PROXY <span class="hljs-keyword">ON</span> `root`@`<span class="hljs-operator">%</span>` <span class="hljs-keyword">TO</span> `shanwen`@`localhost` <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------------------------------------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@MySQL01</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>ushanwen <span class="hljs-operator">-</span>pqweQWE123..<br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants; <br><span class="hljs-operator">+</span><span class="hljs-comment">----------------------------------------------------+</span><br><span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> shanwen<span class="hljs-variable">@localhost</span>                       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `shanwen`@`localhost`        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> PROXY <span class="hljs-keyword">ON</span> `root`@`<span class="hljs-operator">%</span>` <span class="hljs-keyword">TO</span> `shanwen`@`localhost` <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------------------------------------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br></code></pre></td></tr></table></figure>

<h3 id="撤销权限"><a href="#撤销权限" class="headerlink" title="撤销权限"></a>撤销权限</h3><h4 id="全局权限-1"><a href="#全局权限-1" class="headerlink" title="全局权限"></a>全局权限</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;others&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>; <br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------------+</span><br><span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> others@<span class="hljs-operator">%</span>                                  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>`                  <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">ON</span> `testDB`.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>`           <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">INSERT</span> (`id`) <span class="hljs-keyword">ON</span> `testDB`.`t1` <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>` <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">ON</span> `testDB`.`t2` <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>`        <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------------+</span><br><span class="hljs-number">4</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">revoke</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">on</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `others`@`<span class="hljs-operator">%</span>`; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> flush privileges; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;others&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------------+</span><br><span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> others@<span class="hljs-operator">%</span>                                  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>`                   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">ON</span> `testDB`.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>`           <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">INSERT</span> (`id`) <span class="hljs-keyword">ON</span> `testDB`.`t1` <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>` <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">ON</span> `testDB`.`t2` <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>`        <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------------+</span><br><span class="hljs-number">4</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<p>是不是少了几张表 testDB会被看到是因为赋予了该用户testDB库下表的权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> testDB             <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-number">3</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<h4 id="库权限-1"><a href="#库权限-1" class="headerlink" title="库权限"></a>库权限</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">revoke</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">ON</span> `testDB`.<span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `others`@`<span class="hljs-operator">%</span>`<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> ;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> flush privileges;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;others&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------------+</span><br><span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> others@<span class="hljs-operator">%</span>                                  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>`                   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">INSERT</span> (`id`) <span class="hljs-keyword">ON</span> `testDB`.`t1` <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>` <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">ON</span> `testDB`.`t2` <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>`        <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------------+</span><br><span class="hljs-number">3</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> testDB             <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-number">3</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> tables <span class="hljs-keyword">from</span> testDB; <br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span><br><span class="hljs-operator">|</span> Tables_in_testDB <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span><br><span class="hljs-operator">|</span> t1               <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> t2               <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<h4 id="表权限-1"><a href="#表权限-1" class="headerlink" title="表权限"></a>表权限</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">revoke</span> <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">on</span> testDB.t2 <span class="hljs-keyword">from</span> `others`@`<span class="hljs-operator">%</span>`; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> flush privileges; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;others&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------------+</span><br><span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> others@<span class="hljs-operator">%</span>                                  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>`                   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">INSERT</span> (`id`) <span class="hljs-keyword">ON</span> `testDB`.`t1` <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>` <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<p>因为撤销了<code>testDB.t2</code>的相关权限 以及看不到<code>testDB.t2</code>了</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> testDB             <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-number">3</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> tables <span class="hljs-keyword">from</span> testDB;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span><br><span class="hljs-operator">|</span> Tables_in_testDB <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span><br><span class="hljs-operator">|</span> t1               <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br></code></pre></td></tr></table></figure>

<h4 id="列权限-1"><a href="#列权限-1" class="headerlink" title="列权限"></a>列权限</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">revoke</span> <span class="hljs-keyword">insert</span>(id) <span class="hljs-keyword">on</span> testDB.t1 <span class="hljs-keyword">from</span> others@`<span class="hljs-operator">%</span>`; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> flush privileges; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;others&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------+</span><br><span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> others@<span class="hljs-operator">%</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>` <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br></code></pre></td></tr></table></figure>

<p>因为<code>testDB.t1</code>的权限撤销 该账户在<code>testDB</code>库中没有任何权限 所以也看不见<code>testDB</code>了</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> tables <span class="hljs-keyword">from</span> testDB;<br>ERROR <span class="hljs-number">1044</span> (<span class="hljs-number">42000</span>): Access denied <span class="hljs-keyword">for</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;others&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> <span class="hljs-keyword">to</span> database <span class="hljs-string">&#x27;testDB&#x27;</span><br></code></pre></td></tr></table></figure>

<p>使用权限是无法删除的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">revoke</span> usage <span class="hljs-keyword">on</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `others`@`<span class="hljs-operator">%</span>`;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> flush privileges; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;others&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------+</span><br><span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> others@<span class="hljs-operator">%</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `others`@`<span class="hljs-operator">%</span>` <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br></code></pre></td></tr></table></figure>

<h4 id="代理人权限"><a href="#代理人权限" class="headerlink" title="代理人权限"></a>代理人权限</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">revoke</span> proxy <span class="hljs-keyword">on</span> root <span class="hljs-keyword">from</span> shanwen<span class="hljs-variable">@localhost</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> shanwen<span class="hljs-variable">@localhost</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------------+</span><br><span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> shanwen<span class="hljs-variable">@localhost</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `shanwen`@`localhost` <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br></code></pre></td></tr></table></figure>

<h2 id="角色管理"><a href="#角色管理" class="headerlink" title="角色管理"></a>角色管理</h2><p>某一些用户需要拥有相同的权限 就可以创建角色 将权限赋予给角色 在将角色授权给用户 </p>
<h4 id="创建角色"><a href="#创建角色" class="headerlink" title="创建角色"></a>创建角色</h4><p>角色的格式也是(role@Host) 省略Host则为’%’</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> role admin,guest; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.05</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>,host <span class="hljs-keyword">from</span> mysql.user; <br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>             <span class="hljs-operator">|</span> host      <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> admin            <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> guest            <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> others           <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.infoschema <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.session    <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.sys        <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> root             <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-number">7</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<h4 id="为角色赋予权限"><a href="#为角色赋予权限" class="headerlink" title="为角色赋予权限"></a>为角色赋予权限</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">grant</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">on</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">to</span> guest;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.04</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">on</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">to</span> admin; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.04</span> sec)<br><br></code></pre></td></tr></table></figure>

<h4 id="创建用户-1"><a href="#创建用户-1" class="headerlink" title="创建用户"></a>创建用户</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> user1 identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;qweQWE123..&#x27;</span>; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.04</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> admin1 identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;qweQWE123..&#x27;</span>; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.04</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> shanwen identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;qweQWE123..&#x27;</span>; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>,host <span class="hljs-keyword">from</span> mysql.user; <br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>             <span class="hljs-operator">|</span> host      <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> admin            <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> admin1           <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> guest            <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> others           <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> shanwen          <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> user1            <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.infoschema <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.session    <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.sys        <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> root             <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-number">10</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br></code></pre></td></tr></table></figure>

<h4 id="将角色授权给用户"><a href="#将角色授权给用户" class="headerlink" title="将角色授权给用户"></a>将角色授权给用户</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">grant</span> admin <span class="hljs-keyword">to</span> admin1; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">grant</span> guest <span class="hljs-keyword">to</span> user1;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.18</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">grant</span> guest,admin <span class="hljs-keyword">to</span> shanwen;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.04</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> shanwen; <br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------+</span><br><span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> shanwen@<span class="hljs-operator">%</span>                           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `shanwen`@`<span class="hljs-operator">%</span>`            <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> `admin`@`<span class="hljs-operator">%</span>`,`guest`@`<span class="hljs-operator">%</span>` <span class="hljs-keyword">TO</span> `shanwen`@`<span class="hljs-operator">%</span>` <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> admin1;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------+</span><br><span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> admin1@<span class="hljs-operator">%</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `admin1`@`<span class="hljs-operator">%</span>` <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> `admin`@`<span class="hljs-operator">%</span>` <span class="hljs-keyword">TO</span> `admin1`@`<span class="hljs-operator">%</span>`  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> user1;<br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------+</span><br><span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> user1@<span class="hljs-operator">%</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `user1`@`<span class="hljs-operator">%</span>` <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> `guest`@`<span class="hljs-operator">%</span>` <span class="hljs-keyword">TO</span> `user1`@`<span class="hljs-operator">%</span>`  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<p>登陆测试 发现没有权限 </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@Client</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uadmin1 <span class="hljs-operator">-</span>pqweQWE123.. <span class="hljs-operator">-</span>h192<span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.101</span><br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br></code></pre></td></tr></table></figure>

<p>查看当前用户和角色 </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">current_user</span>(); <br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">current_user</span>() <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> admin1@<span class="hljs-operator">%</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">current_role</span>();<br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">current_role</span>() <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">NONE</span>           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br></code></pre></td></tr></table></figure>

<p>设置角色</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> role admin; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">current_role</span>();<br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">current_role</span>() <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> `admin`@`<span class="hljs-operator">%</span>`    <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql              <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> sys                <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> testDB             <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-number">5</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<p>如果不想手动切换角色 可以为用户设置默认角色(root用户权限)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">default</span> role guest <span class="hljs-keyword">to</span> user1;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>[root<span class="hljs-variable">@Client</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uuser1 <span class="hljs-operator">-</span>pqweQWE123.. <span class="hljs-operator">-</span>h192<span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.101</span><br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">current_role</span>(); <br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">current_role</span>() <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> `guest`@`<span class="hljs-operator">%</span>`    <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<p>多角色权限管理</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">default</span> role <span class="hljs-keyword">all</span> <span class="hljs-keyword">to</span> shanwen; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>[root<span class="hljs-variable">@Client</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>ushanwen <span class="hljs-operator">-</span>pqweQWE123.. <span class="hljs-operator">-</span>h192<span class="hljs-number">.168</span><span class="hljs-number">.100</span><span class="hljs-number">.101</span><br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">current_role</span>();<br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">current_role</span>()          <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+</span><br><span class="hljs-operator">|</span> `admin`@`<span class="hljs-operator">%</span>`,`guest`@`<span class="hljs-operator">%</span>` <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<p>也可以手动切换</p>
<p><code>set role none|all|admin|admin,guest</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">current_role</span>();<br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">current_role</span>()          <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+</span><br><span class="hljs-operator">|</span> `admin`@`<span class="hljs-operator">%</span>`,`guest`@`<span class="hljs-operator">%</span>` <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> role <span class="hljs-keyword">none</span>; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">current_role</span>();<br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">current_role</span>() <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">NONE</span>           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> role admin; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">current_role</span>();<br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">current_role</span>() <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> `admin`@`<span class="hljs-operator">%</span>`    <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> role <span class="hljs-keyword">none</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">current_role</span>();<br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">current_role</span>() <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">NONE</span>           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> role <span class="hljs-keyword">all</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">current_role</span>();<br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">current_role</span>()          <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+</span><br><span class="hljs-operator">|</span> `admin`@`<span class="hljs-operator">%</span>`,`guest`@`<span class="hljs-operator">%</span>` <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<h4 id="撤销权限-1"><a href="#撤销权限-1" class="headerlink" title="撤销权限"></a>撤销权限</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">revoke</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">on</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> admin; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">current_role</span>();<br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">current_role</span>()          <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+</span><br><span class="hljs-operator">|</span> `admin`@`<span class="hljs-operator">%</span>`,`guest`@`<span class="hljs-operator">%</span>` <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases; <br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql              <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> sys                <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> testDB             <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-number">5</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br><br>ERROR <span class="hljs-number">1044</span> (<span class="hljs-number">42000</span>): Access denied <span class="hljs-keyword">for</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;shanwen&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> <span class="hljs-keyword">to</span> database <span class="hljs-string">&#x27;test1&#x27;</span><br></code></pre></td></tr></table></figure>

<h4 id="删除角色"><a href="#删除角色" class="headerlink" title="删除角色"></a>删除角色</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">drop</span> role admin; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.04</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>,host <span class="hljs-keyword">from</span> mysql.user;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>             <span class="hljs-operator">|</span> host      <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> admin1           <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> guest            <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> others           <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> shanwen          <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> user1            <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.infoschema <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.session    <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.sys        <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> root             <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-number">9</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>



<h1 id="DQL"><a href="#DQL" class="headerlink" title="DQL"></a>DQL</h1><p><img src="/home/shanwen/Documents/Note/Pic/image-20240702172005549.png" srcset="/img/loading.gif" lazyload alt="image-20240702172005549"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; use classicmodels -A;<br>Database changed<br>mysql&gt; show tables; <br>+-------------------------+<br>| Tables_in_classicmodels |<br>+-------------------------+<br>| customers               |<br>| employees               |<br>| offices                 |<br>| orderdetails            |<br>| orders                  |<br>| payments                |<br>| productlines            |<br>| products                |<br>+-------------------------+<br>8 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<p>查看表结构</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show columns from classicmodels.offices; <br>+--------------+-------------+------+-----+---------+-------+<br>| Field        | Type        | Null | Key | Default | Extra |<br>+--------------+-------------+------+-----+---------+-------+<br>| officeCode   | varchar(10) | NO   | PRI | NULL    |       |<br>| city         | varchar(50) | NO   |     | NULL    |       |<br>| phone        | varchar(50) | NO   |     | NULL    |       |<br>| addressLine1 | varchar(50) | NO   |     | NULL    |       |<br>| addressLine2 | varchar(50) | YES  |     | NULL    |       |<br>| state        | varchar(50) | YES  |     | NULL    |       |<br>| country      | varchar(50) | NO   |     | NULL    |       |<br>| postalCode   | varchar(15) | NO   |     | NULL    |       |<br>| territory    | varchar(10) | NO   |     | NULL    |       |<br>+--------------+-------------+------+-----+---------+-------+<br>9 rows in set (0.02 sec)<br><br>mysql&gt; desc offices;<br>+--------------+-------------+------+-----+---------+-------+<br>| Field        | Type        | Null | Key | Default | Extra |<br>+--------------+-------------+------+-----+---------+-------+<br>| officeCode   | varchar(10) | NO   | PRI | NULL    |       |<br>| city         | varchar(50) | NO   |     | NULL    |       |<br>| phone        | varchar(50) | NO   |     | NULL    |       |<br>| addressLine1 | varchar(50) | NO   |     | NULL    |       |<br>| addressLine2 | varchar(50) | YES  |     | NULL    |       |<br>| state        | varchar(50) | YES  |     | NULL    |       |<br>| country      | varchar(50) | NO   |     | NULL    |       |<br>| postalCode   | varchar(15) | NO   |     | NULL    |       |<br>| territory    | varchar(10) | NO   |     | NULL    |       |<br>+--------------+-------------+------+-----+---------+-------+<br>9 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<h2 id="Select"><a href="#Select" class="headerlink" title="Select"></a>Select</h2><p>\G垂直显示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from offices\G<br>*************************** 1. row ***************************<br>  officeCode: 1<br>        city: San Francisco<br>       phone: +1 650 219 4782<br>addressLine1: 100 Market Street<br>addressLine2: Suite 300<br>       state: CA<br>     country: USA<br>  postalCode: 94080<br>   territory: NA<br>*************************** 2. row ***************************<br>  officeCode: 2<br>        city: Boston<br>       phone: +1 215 837 0825<br>addressLine1: 1550 Court Place<br>addressLine2: Suite 102<br>       state: MA<br>     country: USA<br>  postalCode: 02107<br>   territory: NA<br></code></pre></td></tr></table></figure>

<p>选择字段查询</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select city,phone from offices; <br>+---------------+------------------+<br>| city          | phone            |<br>+---------------+------------------+<br>| San Francisco | +1 650 219 4782  |<br>| Boston        | +1 215 837 0825  |<br>| NYC           | +1 212 555 3000  |<br>| Paris         | +33 14 723 4404  |<br>| Tokyo         | +81 33 224 5000  |<br>| Sydney        | +61 2 9264 2451  |<br>| London        | +44 20 7877 2041 |<br>+---------------+------------------+<br>7 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>



<p>select可以不指定表</p>
<h3 id="数值计算"><a href="#数值计算" class="headerlink" title="数值计算"></a>数值计算</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select 1=1;<br>+-----+<br>| 1=1 |<br>+-----+<br>|   1 |<br>+-----+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select 1=2;<br>+-----+<br>| 1=2 |<br>+-----+<br>|   0 |<br>+-----+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select 1+1;<br>+-----+<br>| 1+1 |<br>+-----+<br>|   2 |<br>+-----+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<h3 id="输出函数"><a href="#输出函数" class="headerlink" title="输出函数"></a>输出函数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select now(); <br>+---------------------+<br>| now()               |<br>+---------------------+<br>| 2024-06-28 07:42:16 |<br>+---------------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select current_date();<br>+----------------+<br>| current_date() |<br>+----------------+<br>| 2024-06-28     |<br>+----------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select current_time();<br>+----------------+<br>| current_time() |<br>+----------------+<br>| 07:42:38       |<br>+----------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<h3 id="带参数的函数"><a href="#带参数的函数" class="headerlink" title="带参数的函数"></a>带参数的函数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select concat(&#x27;A&#x27;,&#x27; &#x27;,&#x27;Sample&#x27;);<br>+--------------------------+<br>| concat(&#x27;A&#x27;,&#x27; &#x27;,&#x27;Sample&#x27;) |<br>+--------------------------+<br>| A Sample                 |<br>+--------------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<h2 id="As-别名"><a href="#As-别名" class="headerlink" title="As 别名"></a>As 别名</h2><h4 id="字段别名"><a href="#字段别名" class="headerlink" title="字段别名"></a>字段别名</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select city Chengshi,phone Dianhua from offices;<br>+---------------+------------------+<br>| Chengshi      | Dianhua          |<br>+---------------+------------------+<br>| San Francisco | +1 650 219 4782  |<br>| Boston        | +1 215 837 0825  |<br>| NYC           | +1 212 555 3000  |<br>| Paris         | +33 14 723 4404  |<br>| Tokyo         | +81 33 224 5000  |<br>| Sydney        | +61 2 9264 2451  |<br>| London        | +44 20 7877 2041 |<br>+---------------+------------------+<br>7 rows in set (0.00 sec)<br><br>mysql&gt; select city as Chengshi,phone as Dianhua from offices;<br>+---------------+------------------+<br>| Chengshi      | Dianhua          |<br>+---------------+------------------+<br>| San Francisco | +1 650 219 4782  |<br>| Boston        | +1 215 837 0825  |<br>| NYC           | +1 212 555 3000  |<br>| Paris         | +33 14 723 4404  |<br>| Tokyo         | +81 33 224 5000  |<br>| Sydney        | +61 2 9264 2451  |<br>| London        | +44 20 7877 2041 |<br>+---------------+------------------+<br>7 rows in set (0.00 sec)<br><br>mysql&gt; select concat (&#x27;舒克&#x27;,&#x27;和贝塔&#x27;) As 节目名;<br>+-----------------+<br>| 节目名          |<br>+-----------------+<br>| 舒克和贝塔      |<br>+-----------------+<br>1 row in set (0.01 sec)<br><br>mysql&gt; select concat_ws(&#x27; &#x27;,firstName,lastName) as name,email from employees limit 5;<br>+-------------------+---------------------------------+<br>| name              | email                           |<br>+-------------------+---------------------------------+<br>| Diane Murphy      | dmurphy@classicmodelcars.com    |<br>| Mary Patterson    | mpatterso@classicmodelcars.com  |<br>| Jeff Firrelli     | jfirrelli@classicmodelcars.com  |<br>| William Patterson | wpatterson@classicmodelcars.com |<br>| Gerard Bondur     | gbondur@classicmodelcars.com    |<br>+-------------------+---------------------------------+<br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<h4 id="表别名"><a href="#表别名" class="headerlink" title="表别名"></a>表别名</h4><p>查询时 尽量使用<code>As</code> 别名表 有如下好处</p>
<blockquote>
<ol>
<li><strong>简化查询语句</strong><ul>
<li>使用表别名可以让 SQL 语句更加简洁和易读。</li>
<li>特别是在查询涉及多个表时,表别名可以大大减少字符输入。</li>
</ul>
</li>
<li><strong>区分多个表</strong><ul>
<li>当查询中涉及多个同名表时,使用表别名可以明确指定要引用的是哪个表。</li>
<li>这对于避免歧义和正确识别字段非常重要。</li>
</ul>
</li>
<li><strong>提高查询性能</strong><ul>
<li>表别名可以作为字段前缀,减少字段名称的冗长度。</li>
<li>这样可以减少查询解析时的资源消耗,提高查询性能。</li>
</ul>
</li>
<li><strong>支持自连接</strong><ul>
<li>表别名是实现自连接的关键,因为同一张表需要以不同的别名引用。</li>
<li>通过自连接可以实现复杂的层级查询和树形结构的遍历。</li>
</ul>
</li>
<li><strong>增强可读性</strong><ul>
<li>合理使用表别名可以让 SQL 语句更加语义化和易于理解。</li>
<li>这对于维护和优化查询非常有帮助。</li>
</ul>
</li>
</ol>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select count(t1.orderNumber) from orderdetails as t1;<br>+-----------------------+<br>| count(t1.orderNumber) |<br>+-----------------------+<br>|                  2996 |<br>+-----------------------+<br>1 row in set (0.00 sec)<br><br></code></pre></td></tr></table></figure>

<h2 id="ORDER-BY-排序"><a href="#ORDER-BY-排序" class="headerlink" title="ORDER BY 排序"></a>ORDER BY 排序</h2><p>根据<code>排序规则</code>来 排序<code>列</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show full columns from products\G<br>*************************** 1. row ***************************<br>     Field: productCode<br>      Type: varchar(15)<br> Collation: utf8mb4_0900_ai_ci<br>      Null: NO<br>       Key: PRI<br>   Default: NULL<br>     Extra: <br>Privileges: select,insert,update,references<br>   Comment: <br>*************************** 2. row ***************************<br>     Field: productName<br>      Type: varchar(70)<br> Collation: utf8mb4_0900_ai_ci<br>      Null: NO<br>       Key: <br>   Default: NULL<br>     Extra: <br>Privileges: select,insert,update,references<br>   Comment: <br>...<br>9 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<p>这个表的<code>productCode</code>字段排序规则是<code>utf8mb4_0900_ai_ci</code> </p>
<p><img src="/home/shanwen/Documents/Note/Pic/image-20240628160906100.png" srcset="/img/loading.gif" lazyload alt="image-20240628160906100"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select customerNumber,city from customers order by customerNumber;<br>+----------------+-------------------+<br>| customerNumber | city              |<br>+----------------+-------------------+<br>|            103 | Nantes            |<br>|            112 | Las Vegas         |<br><br>mysql&gt; select customerNumber,city from customers order by customerNumber asc;<br>+----------------+-------------------+<br>| customerNumber | city              |<br>+----------------+-------------------+<br>|            103 | Nantes            |<br>|            112 | Las Vegas         |<br><br>mysql&gt; select customerNumber,city from customers order by customerNumber desc;<br>+----------------+-------------------+<br>| customerNumber | city              |<br>+----------------+-------------------+<br>|            496 | Auckland          |<br>|            495 | Boston            |<br></code></pre></td></tr></table></figure>

<p>升序<code>ase</code> 降序<code>desc</code>  不显式指定就是<code>asc</code> </p>
<blockquote>
<p>在使用asc排序时 null会在数据前面</p>
</blockquote>
<p>也可一次设置多个排序规则</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select customerNumber,city from customers order by customerNumber desc, state desc;<br>+----------------+-------------------+<br>| customerNumber | city              |<br>+----------------+-------------------+<br>|            496 | Auckland          |<br>|            495 | Boston            |<br>|            489 | London            |<br><br></code></pre></td></tr></table></figure>

<p>用算数运算符重命名一个新字段 并利用新字段排序 <code>limit</code>限制输出为10行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select orderNumber,orderLineNumber,quantityOrdered * priceEach total from orderdetails order by total limit 10; <br>+-------------+-----------------+--------+<br>| orderNumber | orderLineNumber | total  |<br>+-------------+-----------------+--------+<br>|       10419 |               7 | 481.50 |<br>|       10420 |               3 | 529.35 |<br>|       10322 |               3 | 531.00 |<br>|       10407 |               3 | 546.66 |<br>|       10425 |               6 | 553.52 |<br>|       10344 |               6 | 557.60 |<br>|       10110 |               3 | 577.60 |<br>|       10280 |              12 | 597.40 |<br>|       10408 |               1 | 615.45 |<br>|       10409 |               2 | 625.50 |<br>+-------------+-----------------+--------+<br>10 rows in set (0.01 sec)<br><br></code></pre></td></tr></table></figure>

<h2 id="GROUP-BY-分组"><a href="#GROUP-BY-分组" class="headerlink" title="GROUP BY 分组"></a>GROUP BY 分组</h2><p>选择字段分组 使得选择的列 数据的唯一</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select status from orders limit 10;<br>+---------+<br>| status  |<br>+---------+<br>| Shipped |<br>| Shipped |<br>| Shipped |<br>| Shipped |<br>| Shipped |<br>| Shipped |<br>| Shipped |<br>| Shipped |<br>| Shipped |<br>| Shipped |<br>+---------+<br>10 rows in set (0.00 sec)<br><br>mysql&gt; select status from orders group by status;<br>+------------+<br>| status     |<br>+------------+<br>| Shipped    |<br>| Resolved   |<br>| Cancelled  |<br>| On Hold    |<br>| Disputed   |<br>| In Process |<br>+------------+<br>6 rows in set (0.00 sec)<br><br></code></pre></td></tr></table></figure>



<h2 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h2><h3 id="WHERE"><a href="#WHERE" class="headerlink" title="WHERE"></a>WHERE</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT <br>    selectList<br>FROM<br>    tableName<br>WHERE<br>    searchCondition;<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select *  from employees where employeeNumber=1002\G<br>*************************** 1. row ***************************<br>employeeNumber: 1002<br>      lastName: Murphy<br>     firstName: Diane<br>     extension: x5800<br>         email: dmurphy@classicmodelcars.com<br>    officeCode: 1<br>     reportsTo: NULL<br>      jobTitle: President<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<h3 id="AND-OR"><a href="#AND-OR" class="headerlink" title="AND OR"></a>AND OR</h3><p><code>And</code> 全真为真 有假为假</p>
<p><code>Or</code>   全假为假 有真为真</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select 1 and 1 , 1 and 0 ;<br>+---------+---------+<br>| 1 and 1 | 1 and 0 |<br>+---------+---------+<br>|       1 |       0 |<br>+---------+---------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select 1 or 1, 0 or 1, 0 or 0; <br>+--------+--------+--------+<br>| 1 or 1 | 0 or 1 | 0 or 0 |<br>+--------+--------+--------+<br>|      1 |      1 |      0 |<br>+--------+--------+--------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select *  from employees where jobTitle=&quot;Sales Rep&quot; and officeCode=&quot;1&quot;\G<br>*************************** 1. row ***************************<br>employeeNumber: 1165<br>      lastName: Jennings<br>     firstName: Leslie<br>     extension: x3291<br>         email: ljennings@classicmodelcars.com<br>    officeCode: 1<br>     reportsTo: 1143<br>      jobTitle: Sales Rep<br>*************************** 2. row ***************************<br>employeeNumber: 1166<br>      lastName: Thompson<br>     firstName: Leslie<br>     extension: x4065<br>         email: lthompson@classicmodelcars.com<br>    officeCode: 1<br>     reportsTo: 1143<br>      jobTitle: Sales Rep<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from employees where jobTitle=&quot;Sales Manager (NA)&quot; or jobTitle=&quot;VP Sales&quot;\G<br>*************************** 1. row ***************************<br>employeeNumber: 1056<br>      lastName: Patterson<br>     firstName: Mary<br>     extension: x4611<br>         email: mpatterso@classicmodelcars.com<br>    officeCode: 1<br>     reportsTo: 1002<br>      jobTitle: VP Sales<br>*************************** 2. row ***************************<br>employeeNumber: 1143<br>      lastName: Bow<br>     firstName: Anthony<br>     extension: x5428<br>         email: abow@classicmodelcars.com<br>    officeCode: 1<br>     reportsTo: 1056<br>      jobTitle: Sales Manager (NA)<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<h3 id="NOT-BETWEEN"><a href="#NOT-BETWEEN" class="headerlink" title="(NOT) BETWEEN"></a>(NOT) BETWEEN</h3><p>查找字段的值位于 x和y 之间</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from employees where officeCode between 4 and 6 limit 3\G<br>*************************** 1. row ***************************<br>employeeNumber: 1088<br>      lastName: Patterson<br>     firstName: William<br>     extension: x4871<br>         email: wpatterson@classicmodelcars.com<br>    officeCode: 6<br>     reportsTo: 1056<br>      jobTitle: Sales Manager (APAC)<br>*************************** 2. row ***************************<br>employeeNumber: 1102<br>      lastName: Bondur<br>     firstName: Gerard<br>     extension: x5408<br>         email: gbondur@classicmodelcars.com<br>    officeCode: 4<br>     reportsTo: 1056<br>      jobTitle: Sale Manager (EMEA)<br><br>mysql&gt; select * from employees where officeCode &gt; 4 and officeCode &lt; 6 limit 3\G<br>*************************** 1. row ***************************<br>employeeNumber: 1621<br>      lastName: Nishi<br>     firstName: Mami<br>     extension: x101<br>         email: mnishi@classicmodelcars.com<br>    officeCode: 5<br>     reportsTo: 1056<br>      jobTitle: Sales Rep<br>*************************** 2. row ***************************<br>employeeNumber: 1625<br>      lastName: Kato<br>     firstName: Yoshimi<br>     extension: x102<br>         email: ykato@classicmodelcars.com<br>    officeCode: 5<br>     reportsTo: 1621<br>      jobTitle: Sales Rep<br>2 rows in set (0.00 sec)<br><br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select jobTitle,officeCode from employees where officeCode not between 1 and 3 limit 5;<br>+----------------------+------------+<br>| jobTitle             | officeCode |<br>+----------------------+------------+<br>| Sales Manager (APAC) | 6          |<br>| Sale Manager (EMEA)  | 4          |<br>| Sales Rep            | 4          |<br>| Sales Rep            | 4          |<br>| Sales Rep            | 4          |<br>+----------------------+------------+<br>5 rows in set (0.00 sec)<br><br></code></pre></td></tr></table></figure>



<h3 id="NOT-LIKE"><a href="#NOT-LIKE" class="headerlink" title="(NOT) LIKE"></a>(NOT) LIKE</h3><p>MySQL 提供了两个用于构造模式的通配符：百分比%和下划线_。</p>
<ul>
<li>百分比 <code>%</code> 通配符可匹配零个或多个字符的任意字符串。</li>
<li>下划线 <code>_ </code> 通配符匹配任意单个字符。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select jobTitle,email from employees where jobTitle like &quot;%Sale%&quot;;<br>+----------------------+---------------------------------+<br>| jobTitle             | email                           |<br>+----------------------+---------------------------------+<br>| VP Sales             | mpatterso@classicmodelcars.com  |<br>| Sales Manager (APAC) | wpatterson@classicmodelcars.com |<br>| Sale Manager (EMEA)  | gbondur@classicmodelcars.com    |<br>| Sales Manager (NA)   | abow@classicmodelcars.com       |<br>| Sales Rep            | ljennings@classicmodelcars.com  |<br>| Sales Rep            | lthompson@classicmodelcars.com  |<br>| Sales Rep            | jfirrelli@classicmodelcars.com  |<br><br>mysql&gt; select jobTitle,email from employees where jobTitle like &quot;Sale%&quot;;<br>+----------------------+---------------------------------+<br>| jobTitle             | email                           |<br>+----------------------+---------------------------------+<br>| Sales Manager (APAC) | wpatterson@classicmodelcars.com |<br>| Sale Manager (EMEA)  | gbondur@classicmodelcars.com    |<br>| Sales Manager (NA)   | abow@classicmodelcars.com       |<br>| Sales Rep            | ljennings@classicmodelcars.com  |<br>| Sales Rep            | lthompson@classicmodelcars.com  |<br><br>mysql&gt; select jobTitle,email from employees where jobTitle like &quot;Sales%&quot;;<br>+----------------------+---------------------------------+<br>| jobTitle             | email                           |<br>+----------------------+---------------------------------+<br>| Sales Manager (APAC) | wpatterson@classicmodelcars.com |<br>| Sales Manager (NA)   | abow@classicmodelcars.com       |<br>| Sales Rep            | ljennings@classicmodelcars.com  |<br><br>mysql&gt;  select jobTitle,email from employees where jobTitle like &quot;Sale_____&quot;;<br>+-----------+---------------------------------+<br>| jobTitle  | email                           |<br>+-----------+---------------------------------+<br>| Sales Rep | ljennings@classicmodelcars.com  |<br>| Sales Rep | lthompson@classicmodelcars.com  |<br>+-----------+---------------------------------+<br>17 rows in set (0.00 sec)<br><br>mysql&gt;  select jobTitle,email from employees where jobTitle like &quot;%Sale_&quot;;<br>+----------+--------------------------------+<br>| jobTitle | email                          |<br>+----------+--------------------------------+<br>| VP Sales | mpatterso@classicmodelcars.com |<br>+----------+--------------------------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select jobTitle,email from employees where jobTitle not like &quot;%Sale_&quot; limit 6;<br>+----------------------+---------------------------------+<br>| jobTitle             | email                           |<br>+----------------------+---------------------------------+<br>| President            | dmurphy@classicmodelcars.com    |<br>| VP Marketing         | jfirrelli@classicmodelcars.com  |<br>| Sales Manager (APAC) | wpatterson@classicmodelcars.com |<br>| Sale Manager (EMEA)  | gbondur@classicmodelcars.com    |<br>| Sales Manager (NA)   | abow@classicmodelcars.com       |<br>| Sales Rep            | ljennings@classicmodelcars.com  |<br>+----------------------+---------------------------------+<br>6 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<h4 id="转义"><a href="#转义" class="headerlink" title="转义"></a>转义</h4><p>默认为 <code>\</code></p>
<p>也可以用 <code>escape</code> 指定转义符</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT productCode,productName FROM products where productCode LIKE &#x27;%\_20%&#x27;;<br>+-------------+-------------------------------------------+<br>| productCode | productName                               |<br>+-------------+-------------------------------------------+<br>| S10_2016    | 1996 Moto Guzzi 1100i                     |<br>| S24_2000    | 1960 BSA Gold Star DBD34                  |<br>| S24_2011    | 18th century schooner                     |<br>| S24_2022    | 1938 Cadillac V-16 Presidential Limousine |<br>| S700_2047   | HMS Bounty                                |<br>+-------------+-------------------------------------------+<br>5 rows in set (0.00 sec)<br><br>mysql&gt; SELECT productCode,productName FROM products where productCode LIKE &#x27;%$_20%&#x27; escape &#x27;$&#x27;;<br>+-------------+-------------------------------------------+<br>| productCode | productName                               |<br>+-------------+-------------------------------------------+<br>| S10_2016    | 1996 Moto Guzzi 1100i                     |<br>| S24_2000    | 1960 BSA Gold Star DBD34                  |<br>| S24_2011    | 18th century schooner                     |<br>| S24_2022    | 1938 Cadillac V-16 Presidential Limousine |<br>| S700_2047   | HMS Bounty                                |<br>+-------------+-------------------------------------------+<br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<h3 id="IN-NOT-IN"><a href="#IN-NOT-IN" class="headerlink" title="IN , NOT IN"></a>IN , NOT IN</h3><p>查询某个值是否在记录中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select 1 in (1,2,3);<br>+--------------+<br>| 1 in (1,2,3) |<br>+--------------+<br>|            1 |<br>+--------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select 4 in (1,2,3);<br>+--------------+<br>| 4 in (1,2,3) |<br>+--------------+<br>|            0 |<br>+--------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select 4 not in (1,2,3);<br>+------------------+<br>| 4 not in (1,2,3) |<br>+------------------+<br>|                1 |<br>+------------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select 1 not in (1,2,3);<br>mysql&gt; select 1 not in (1,2,3);<br>+------------------+<br>| 1 not in (1,2,3) |<br>+------------------+<br>|                0 |<br>+------------------+<br>1 row in set (0.00 sec)<br><br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select lastName,firstName,officeCode from employees where officeCode in (4,5,6) order by officeCode;<br>+-----------+-----------+------------+<br>| lastName  | firstName | officeCode |<br>+-----------+-----------+------------+<br>| Bondur    | Gerard    | 4          |<br>| Bondur    | Loui      | 4          |<br>| Hernandez | Gerard    | 4          |<br>| Castillo  | Pamela    | 4          |<br>| Gerard    | Martin    | 4          |<br>| Nishi     | Mami      | 5          |<br>| Kato      | Yoshimi   | 5          |<br>| Patterson | William   | 6          |<br>| Fixter    | Andy      | 6          |<br>| Marsh     | Peter     | 6          |<br>| King      | Tom       | 6          |<br>+-----------+-----------+------------+<br>11 rows in set (0.00 sec)<br><br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select lastName,firstName,officeCode from employees where officeCode not in (4,5,6) order by officeCode;<br>+-----------+-----------+------------+<br>| lastName  | firstName | officeCode |<br>+-----------+-----------+------------+<br>| Murphy    | Diane     | 1          |<br>| Patterson | Mary      | 1          |<br>| Firrelli  | Jeff      | 1          |<br>| Bow       | Anthony   | 1          |<br>| Jennings  | Leslie    | 1          |<br>| Thompson  | Leslie    | 1          |<br>| Firrelli  | Julie     | 2          |<br>| Patterson | Steve     | 2          |<br>| Tseng     | Foon Yue  | 3          |<br>| Vanauf    | George    | 3          |<br>| Bott      | Larry     | 7          |<br>| Jones     | Barry     | 7          |<br>+-----------+-----------+------------+<br>12 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<h3 id="数字运算"><a href="#数字运算" class="headerlink" title="数字运算"></a>数字运算</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select lastName,firstName,officeCode from employees where officeCode &gt; 5 order by officeCode;<br>+-----------+-----------+------------+<br>| lastName  | firstName | officeCode |<br>+-----------+-----------+------------+<br>| Patterson | William   | 6          |<br>| Fixter    | Andy      | 6          |<br>| Marsh     | Peter     | 6          |<br>| King      | Tom       | 6          |<br>| Bott      | Larry     | 7          |<br>| Jones     | Barry     | 7          |<br>+-----------+-----------+------------+<br>6 rows in set (0.01 sec)<br><br>mysql&gt; select lastName,firstName,officeCode from employees where officeCode = 5;<br>+----------+-----------+------------+<br>| lastName | firstName | officeCode |<br>+----------+-----------+------------+<br>| Nishi    | Mami      | 5          |<br>| Kato     | Yoshimi   | 5          |<br>+----------+-----------+------------+<br>2 rows in set (0.00 sec)<br><br>mysql&gt; select lastName,firstName,officeCode from employees where officeCode != 5 limit 5;<br>+-----------+-----------+------------+<br>| lastName  | firstName | officeCode |<br>+-----------+-----------+------------+<br>| Murphy    | Diane     | 1          |<br>| Patterson | Mary      | 1          |<br>| Firrelli  | Jeff      | 1          |<br>| Patterson | William   | 6          |<br>| Bondur    | Gerard    | 4          |<br>+-----------+-----------+------------+<br>5 rows in set (0.00 sec)<br><br>mysql&gt; select lastName,firstName,officeCode from employees where officeCode &gt;= 5 limit 5;<br>+-----------+-----------+------------+<br>| lastName  | firstName | officeCode |<br>+-----------+-----------+------------+<br>| Patterson | William   | 6          |<br>| Bott      | Larry     | 7          |<br>| Jones     | Barry     | 7          |<br>| Fixter    | Andy      | 6          |<br>| Marsh     | Peter     | 6          |<br>+-----------+-----------+------------+<br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<h3 id="DISTINCT"><a href="#DISTINCT" class="headerlink" title="DISTINCT"></a>DISTINCT</h3><p>按字段去除重复项</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT DISTINCT<br>    select_list<br>FROM<br>    table_name<br>WHERE <br>    search_condition<br>ORDER BY <br>    sort_expression;<br></code></pre></td></tr></table></figure>

<p>去除 <code>jobTitile</code> 的重复项</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select jobTitle from employees;<br>+----------------------+<br>| jobTitle             |<br>+----------------------+<br>| President            |<br>| VP Sales             |<br>| VP Marketing         |<br>| Sales Manager (APAC) |<br>| Sale Manager (EMEA)  |<br>| Sales Manager (NA)   |<br>| Sales Rep            |<br>| Sales Rep            |<br>| Sales Rep            |<br>...<br>+----------------------+<br>23 rows in set (0.00 sec)<br><br>mysql&gt; select distinct jobTitle from employees;<br>+----------------------+<br>| jobTitle             |<br>+----------------------+<br>| President            |<br>| VP Sales             |<br>| VP Marketing         |<br>| Sales Manager (APAC) |<br>| Sale Manager (EMEA)  |<br>| Sales Manager (NA)   |<br>| Sales Rep            |<br>+----------------------+<br>7 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<p>输出 <code>jobTitle </code>和<code>officeCode</code> 并清除都重复的项</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select jobTitle,officeCode from employees order by officeCode; <br>+----------------------+------------+<br>| jobTitle             | officeCode |<br>+----------------------+------------+<br>| VP Sales             | 1          |<br>| VP Marketing         | 1          |<br>| President            | 1          |<br>| Sales Manager (NA)   | 1          |<br>| Sales Rep            | 1          |<br>| Sales Rep            | 1          |<br>| Sales Rep            | 2          |<br>| Sales Rep            | 2          |<br>| Sales Rep            | 3          |<br>| Sales Rep            | 3          |<br>| Sale Manager (EMEA)  | 4          |<br>| Sales Rep            | 4          |<br>| Sales Rep            | 4          |<br>| Sales Rep            | 4          |<br>| Sales Rep            | 4          |<br>| Sales Rep            | 5          |<br>| Sales Rep            | 5          |<br>| Sales Manager (APAC) | 6          |<br>| Sales Rep            | 6          |<br>| Sales Rep            | 6          |<br>| Sales Rep            | 6          |<br>| Sales Rep            | 7          |<br>| Sales Rep            | 7          |<br>+----------------------+------------+<br>23 rows in set (0.00 sec)<br><br>mysql&gt; select distinct jobTitle,officeCode from employees order by officeCode;<br>+----------------------+------------+<br>| jobTitle             | officeCode |<br>+----------------------+------------+<br>| President            | 1          |<br>| Sales Manager (NA)   | 1          |<br>| Sales Rep            | 1          |<br>| VP Marketing         | 1          |<br>| VP Sales             | 1          |<br>| Sales Rep            | 2          |<br>| Sales Rep            | 3          |<br>| Sale Manager (EMEA)  | 4          |<br>| Sales Rep            | 4          |<br>| Sales Rep            | 5          |<br>| Sales Manager (APAC) | 6          |<br>| Sales Rep            | 6          |<br>| Sales Rep            | 7          |<br>+----------------------+------------+<br>13 rows in set (0.00 sec)<br><br></code></pre></td></tr></table></figure>

<h3 id="IS-NOT-NULL"><a href="#IS-NOT-NULL" class="headerlink" title="IS (NOT) NULL"></a>IS (NOT) NULL</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select 1 is not null; <br>+---------------+<br>| 1 is not null |<br>+---------------+<br>|             1 |<br>+---------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select null is not null;<br>+------------------+<br>| null is not null |<br>+------------------+<br>|                0 |<br>+------------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select null is  null;<br>+---------------+<br>| null is  null |<br>+---------------+<br>|             1 |<br>+---------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select 1 is  null;<br>+------------+<br>| 1 is  null |<br>+------------+<br>|          0 |<br>+------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select customerName,state from customers where state is null limit 5;<br>+----------------------+-------+<br>| customerName         | state |<br>+----------------------+-------+<br>| Atelier graphique    | NULL  |<br>| La Rochelle Gifts    | NULL  |<br>| Baane Mini Imports   | NULL  |<br>| Havel &amp; Zbyszek Co   | NULL  |<br>| Blauer See Auto, Co. | NULL  |<br>+----------------------+-------+<br>5 rows in set (0.00 sec)<br><br>mysql&gt; select customerName,state from customers where state is not null;<br>+-----------------------------------+---------------+<br>| customerName                      | state         |<br>+-----------------------------------+---------------+<br>| Signal Gift Stores                | NV            |<br>| Australian Collectors, Co.        | Victoria      |<br>| Mini Gifts Distributors Ltd.      | CA            |<br>| Mini Wheels Co.                   | CA            |<br>| Land of Toys Inc.                 | NY            |<br>| Diecast Collectables              | MA            |<br>+-----------------------------------+---------------+<br>49 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<h3 id="LIMIT"><a href="#LIMIT" class="headerlink" title="LIMIT"></a>LIMIT</h3><p>从第一行开始输出5行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select lastName,jobTitle from employees limit 5;<br>+-----------+----------------------+<br>| lastName  | jobTitle             |<br>+-----------+----------------------+<br>| Murphy    | President            |<br>| Patterson | VP Sales             |<br>| Firrelli  | VP Marketing         |<br>| Patterson | Sales Manager (APAC) |<br>| Bondur    | Sale Manager (EMEA)  |<br>+-----------+----------------------+<br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<p>从第5行开始 输出10行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select lastName,jobTitle from employees limit 10;<br>+-----------+----------------------+<br>| lastName  | jobTitle             |<br>+-----------+----------------------+<br>| Murphy    | President            |<br>| Patterson | VP Sales             |<br>| Firrelli  | VP Marketing         |<br>| Patterson | Sales Manager (APAC) |<br>| Bondur    | Sale Manager (EMEA)  |<br>| Bow       | Sales Manager (NA)   |<br>| Jennings  | Sales Rep            |<br>| Thompson  | Sales Rep            |<br>| Firrelli  | Sales Rep            |<br>| Patterson | Sales Rep            |<br>+-----------+----------------------+<br>10 rows in set (0.00 sec)<br><br>mysql&gt; select lastName,jobTitle from employees limit 5,5;<br>+-----------+--------------------+<br>| lastName  | jobTitle           |<br>+-----------+--------------------+<br>| Bow       | Sales Manager (NA) |<br>| Jennings  | Sales Rep          |<br>| Thompson  | Sales Rep          |<br>| Firrelli  | Sales Rep          |<br>| Patterson | Sales Rep          |<br>+-----------+--------------------+<br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<p>配合Order 获取最小\最大值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select customerName,creditLimit from customers order by creditLimit limit 1;<br>+--------------------+-------------+<br>| customerName       | creditLimit |<br>+--------------------+-------------+<br>| Havel &amp; Zbyszek Co |        0.00 |<br>+--------------------+-------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select customerName,creditLimit from customers order by creditLimit desc limit 1;<br>+------------------------+-------------+<br>| customerName           | creditLimit |<br>+------------------------+-------------+<br>| Euro+ Shopping Channel |   227600.00 |<br>+------------------------+-------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<h2 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h2><p>Mysql作为关系形数据库 表中除了<code>主键</code> 还有<code>外键</code> A表中的主键可以是B表，C表的外键</p>
<p>所以可以利用这些<code>外键</code>为基础 链接多个表进行查询</p>
<p>MySQL支持以下类型的联接：</p>
<ol>
<li>内部连接</li>
<li>左联接</li>
<li>右加入</li>
<li>交叉联接</li>
</ol>
<h3 id="内连接"><a href="#内连接" class="headerlink" title="内连接"></a>内连接</h3><p>选择一个公共列</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT <br>    productCode, <br>    productName, <br>    textDescription<br>FROM<br>    products<br>INNER JOIN productlines USING (productline);<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select concat(contactFirstName,&quot; &quot;,contactLastName) as name,orderNumber,status from orders inner join customers using (customerNumber) limit 5;<br>+-------------------+-------------+---------+<br>| name              | orderNumber | status  |<br>+-------------------+-------------+---------+<br>| Dorothy Young     |       10100 | Shipped |<br>| Roland Keitel     |       10101 | Shipped |<br>| Michael Frick     |       10102 | Shipped |<br>| Jonas  Bergulfsen |       10103 | Shipped |<br>| Diego  Freyre     |       10104 | Shipped |<br>+-------------------+-------------+---------+<br>5 rows in set (0.00 sec)<br><br></code></pre></td></tr></table></figure>

<p>也可以使用多表连接 表之间选不同的外键</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select customerNumber,orderNumber,orderDate,productCode from orders inner join customers using (customerNumber) inner join orderdetails using (orderNumber) limit 5;<br>+----------------+-------------+------------+-------------+<br>| customerNumber | orderNumber | orderDate  | productCode |<br>+----------------+-------------+------------+-------------+<br>|            363 |       10100 | 2003-01-06 | S18_1749    |<br>|            363 |       10100 | 2003-01-06 | S18_2248    |<br>|            363 |       10100 | 2003-01-06 | S18_4409    |<br>|            363 |       10100 | 2003-01-06 | S24_3969    |<br>|            128 |       10101 | 2003-01-09 | S18_2325    |<br>+----------------+-------------+------------+-------------+<br>5 rows in set (0.00 sec)<br><br></code></pre></td></tr></table></figure>

<h3 id="左连接"><a href="#左连接" class="headerlink" title="左连接"></a>左连接</h3><p><img src="/home/shanwen/Documents/Note/Pic/image-20240701174431761.png" srcset="/img/loading.gif" lazyload alt="image-20240701174431761"></p>
<p>对比内连接来看 内连接相当于<code>交集</code> </p>
<p><code>from</code> 选择的表就是<code>左表</code></p>
<p>然后利用两表中的<code>公共列</code> 查询<code>left join</code>的<code>右表</code></p>
<p>若找到了 就返回相应的数据 没找到就返回<code>NULL</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select customerNumber Number,customerName,orderNumber,status from customers inner join orders using (customerNumber) where orderNumber IS NULL;<br>Empty set (0.00 sec)<br><br>mysql&gt; select customerNumber Number,customerName,orderNumber,status from customers left join orders<br>using (customerNumber) limit 10;<br>+--------+----------------------------+-------------+---------+<br>| Number | customerName               | orderNumber | status  |<br>+--------+----------------------------+-------------+---------+<br>|    103 | Atelier graphique          |       10123 | Shipped |<br>|    103 | Atelier graphique          |       10298 | Shipped |<br>|    103 | Atelier graphique          |       10345 | Shipped |<br>|    112 | Signal Gift Stores         |       10124 | Shipped |<br>|    112 | Signal Gift Stores         |       10278 | Shipped |<br>|    112 | Signal Gift Stores         |       10346 | Shipped |<br>|    114 | Australian Collectors, Co. |       10120 | Shipped |<br>|    114 | Australian Collectors, Co. |       10125 | Shipped |<br>|    114 | Australian Collectors, Co. |       10223 | Shipped |<br>|    114 | Australian Collectors, Co. |       10342 | Shipped |<br>+--------+----------------------------+-------------+---------+<br>10 rows in set (0.00 sec)<br><br>mysql&gt; select customerNumber Number,customerName,orderNumber,status from customers left join orders<br>using (customerNumber) where orderNumber IS NULL limit 5;<br>+--------+----------------------------+-------------+--------+<br>| Number | customerName               | orderNumber | status |<br>+--------+----------------------------+-------------+--------+<br>|    125 | Havel &amp; Zbyszek Co         |        NULL | NULL   |<br>|    168 | American Souvenirs Inc     |        NULL | NULL   |<br>|    169 | Porto Imports Co.          |        NULL | NULL   |<br>|    206 | Asian Shopping Network, Co |        NULL | NULL   |<br>|    223 | NatÃ¼rlich Autos           |        NULL | NULL   |<br>+--------+----------------------------+-------------+--------+<br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<h3 id="右连接"><a href="#右连接" class="headerlink" title="右连接"></a>右连接</h3><p>和 <code>左连接</code>一样 选取两个表 <code>from</code> 后面是左表 <code>join</code> 后面是 <code>右表</code></p>
<p>在<code>右表</code> 中找数据和<code>左表</code>匹配 <code>左表</code> 匹配不上的就返回 NULL <code>右表</code> 正常输出 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select t1.officeCode,concat(t1.firstName,&#x27; &#x27;,t1.lastName) as name,t2.city,t2.state from employees t1 left join offices t2 using (officeCode);<br>+------------+-------------------+---------------+------------+<br>| officeCode | name              | city          | state      |<br>+------------+-------------------+---------------+------------+<br>| 1          | Diane Murphy      | San Francisco | CA         |<br>| 1          | Mary Patterson    | San Francisco | CA         |<br>| 1          | Jeff Firrelli     | San Francisco | CA         |<br>| 6          | William Patterson | Sydney        | NULL       |<br>| 4          | Gerard Bondur     | Paris         | NULL       |<br>| 1          | Anthony Bow       | San Francisco | CA         |<br>| 1          | Leslie Jennings   | San Francisco | CA         |<br>| 1          | Leslie Thompson   | San Francisco | CA         |<br>| 2          | Julie Firrelli    | Boston        | MA         |<br>| 2          | Steve Patterson   | Boston        | MA         |<br>| 3          | Foon Yue Tseng    | NYC           | NY         |<br>| 3          | George Vanauf     | NYC           | NY         |<br>| 4          | Loui Bondur       | Paris         | NULL       |<br>| 4          | Gerard Hernandez  | Paris         | NULL       |<br>| 4          | Pamela Castillo   | Paris         | NULL       |<br>| 7          | Larry Bott        | London        | NULL       |<br>| 7          | Barry Jones       | London        | NULL       |<br>| 6          | Andy Fixter       | Sydney        | NULL       |<br>| 6          | Peter Marsh       | Sydney        | NULL       |<br>| 6          | Tom King          | Sydney        | NULL       |<br>| 5          | Mami Nishi        | Tokyo         | Chiyoda-Ku |<br>| 5          | Yoshimi Kato      | Tokyo         | Chiyoda-Ku |<br>| 4          | Martin Gerard     | Paris         | NULL       |<br>+------------+-------------------+---------------+------------+<br>23 rows in set (0.00 sec)<br><br>mysql&gt; select t1.officeCode,concat(t1.firstName,&#x27; &#x27;,t1.lastName) as name,t2.city,t2.state from employees t1 right join offices t2 using (officeCode);<br>+------------+-------------------+---------------+------------+<br>| officeCode | name              | city          | state      |<br>+------------+-------------------+---------------+------------+<br>| 1          | Diane Murphy      | San Francisco | CA         |<br>| 1          | Mary Patterson    | San Francisco | CA         |<br>| 1          | Jeff Firrelli     | San Francisco | CA         |<br>| 1          | Anthony Bow       | San Francisco | CA         |<br>| 1          | Leslie Jennings   | San Francisco | CA         |<br>| 1          | Leslie Thompson   | San Francisco | CA         |<br>| 2          | Julie Firrelli    | Boston        | MA         |<br>| 2          | Steve Patterson   | Boston        | MA         |<br>| 3          | Foon Yue Tseng    | NYC           | NY         |<br>| 3          | George Vanauf     | NYC           | NY         |<br>| 4          | Gerard Bondur     | Paris         | NULL       |<br>| 4          | Loui Bondur       | Paris         | NULL       |<br>| 4          | Gerard Hernandez  | Paris         | NULL       |<br>| 4          | Pamela Castillo   | Paris         | NULL       |<br>| 4          | Martin Gerard     | Paris         | NULL       |<br>| 5          | Mami Nishi        | Tokyo         | Chiyoda-Ku |<br>| 5          | Yoshimi Kato      | Tokyo         | Chiyoda-Ku |<br>| 6          | William Patterson | Sydney        | NULL       |<br>| 6          | Andy Fixter       | Sydney        | NULL       |<br>| 6          | Peter Marsh       | Sydney        | NULL       |<br>| 6          | Tom King          | Sydney        | NULL       |<br>| 7          | Larry Bott        | London        | NULL       |<br>| 7          | Barry Jones       | London        | NULL       |<br>+------------+-------------------+---------------+------------+<br>23 rows in set (0.00 sec)<br><br></code></pre></td></tr></table></figure>

<h3 id="自连接"><a href="#自连接" class="headerlink" title="自连接"></a>自连接</h3><p>利用 <code>t1</code> 的 <code>employees</code> 字段在 <code>t2 </code> 的 <code>reportsTo</code> 字段查找</p>
<p><code>t1.employeeNumber = t2.reportsTo</code> 也就是找到了一行数据 包括了<code>Master</code>和<code>Slave</code></p>
<p>因为使用的是 <code>inner</code> 内连接 两边都有数据 才会返回 就可以查找出<code>Master</code> 和 <code>Slave</code> 的对应关系</p>
<p>注意</p>
<pre><code class="hljs">- 必须使用**表别名** `As`
- 查找的方式和`inner`,`left`,`right`一样
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt;  select t1.employeeNumber as Master,t2.employeeNumber as Slave from employees as t1 inner join employees as t2 on t1.employeeNumber = t2.reportsTo order by Master ;<br>+--------+-------+<br>| Master | Slave |<br>+--------+-------+<br>|   1002 |  1076 |<br>|   1002 |  1056 |<br>|   1056 |  1088 |<br>|   1056 |  1102 |<br>|   1056 |  1143 |<br>|   1056 |  1621 |<br>|   1088 |  1611 |<br>|   1088 |  1612 |<br>|   1088 |  1619 |<br>|   1102 |  1401 |<br>|   1102 |  1702 |<br>|   1102 |  1504 |<br>|   1102 |  1501 |<br>|   1102 |  1370 |<br>|   1102 |  1337 |<br>|   1143 |  1165 |<br>|   1143 |  1166 |<br>|   1143 |  1188 |<br>|   1143 |  1216 |<br>|   1143 |  1286 |<br>|   1143 |  1323 |<br>|   1621 |  1625 |<br>+--------+-------+<br>22 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<h3 id="交叉连接"><a href="#交叉连接" class="headerlink" title="交叉连接"></a>交叉连接</h3><h2 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h2><p>什么叫分组查询呢？先来可以个例子</p>
<p><img src="/home/shanwen/Documents/Note/Pic/image-20240702172005549.png" srcset="/img/loading.gif" lazyload alt="image-20240702172005549"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select status,count(status) from orders group by status ;<br>+------------+---------------+<br>| status     | count(status) |<br>+------------+---------------+<br>| Shipped    |           303 |<br>| Resolved   |             4 |<br>| Cancelled  |             6 |<br>| On Hold    |             4 |<br>| Disputed   |             3 |<br>| In Process |             6 |<br>+------------+---------------+<br>6 rows in set (0.00 sec)<br><br>mysql&gt; select count(status) from orders; <br>+---------------+<br>| count(status) |<br>+---------------+<br>|           326 |<br>+---------------+<br>1 row in set (0.00 sec)<br><br></code></pre></td></tr></table></figure>

<p>根据查询规则 首先使用 <code>group by</code> 对<code>status</code> 列进行分组 然后使用<code>count</code> 对分组后的数据进行统计 最后输出分类后的<code>status</code> 和 <code>count(status)</code></p>
<h3 id="HAVING"><a href="#HAVING" class="headerlink" title="HAVING"></a>HAVING</h3><p>关于where和having的区别</p>
<blockquote>
<p><code>HAVING</code> 子句和 <code>WHERE</code> 子句在 MySQL 查询中都是用于数据过滤的,但它们之间有以下几个主要区别:</p>
<ol>
<li><strong>作用时机</strong><ul>
<li><code>WHERE</code> 子句在数据读取阶段起作用,过滤原始数据。</li>
<li><code>HAVING</code> 子句在数据分组后起作用,过滤聚合结果。</li>
</ul>
</li>
<li><strong>对象不同</strong><ul>
<li><code>WHERE</code> 子句作用于单行记录,可以使用各种比较运算符。</li>
<li><code>HAVING</code> 子句作用于分组,可以使用聚合函数如 <code>SUM</code>、<code>AVG</code> 等。</li>
</ul>
</li>
<li><strong>执行顺序</strong><ul>
<li>SQL 执行顺序是: <code>FROM</code> -&gt; <code>WHERE</code> -&gt; <code>GROUP BY</code> -&gt; <code>HAVING</code> -&gt; <code>SELECT</code> -&gt; <code>ORDER BY</code>。</li>
<li>也就是说 <code>WHERE</code> 先于 <code>HAVING</code> 执行。</li>
</ul>
</li>
<li><strong>是否使用聚合函数</strong><ul>
<li><code>WHERE</code> 子句不能使用聚合函数,只能使用普通的列引用。</li>
<li><code>HAVING</code> 子句可以使用聚合函数对分组数据进行过滤。</li>
</ul>
</li>
<li><strong>性能影响</strong><ul>
<li><code>WHERE</code> 子句的过滤效果更好,能够在数据读取阶段过滤掉无用数据。</li>
<li><code>HAVING</code> 子句需要先进行分组计算,然后再进行过滤,性能略差一些。</li>
</ul>
</li>
</ol>
</blockquote>
<p>过滤数据 有这样一个表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; desc orderdetails;<br>+-----------------+---------------+------+-----+---------+-------+<br>| Field           | Type          | Null | Key | Default | Extra |<br>+-----------------+---------------+------+-----+---------+-------+<br>| orderNumber     | int           | NO   | PRI | NULL    |       |<br>| productCode     | varchar(15)   | NO   | PRI | NULL    |       |<br>| quantityOrdered | int           | NO   |     | NULL    |       |<br>| priceEach       | decimal(10,2) | NO   |     | NULL    |       |<br>| orderLineNumber | smallint      | NO   |     | NULL    |       |<br>+-----------------+---------------+------+-----+---------+-------+<br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select count(productCode) from orderdetails;<br>+--------------------+<br>| count(productCode) |<br>+--------------------+<br>|               2996 |<br>+--------------------+<br>1 row in set (0.01 sec)<br><br>mysql&gt; select productCode from orderdetails group by productCode;<br>...<br>| S72_1253    |<br>| S72_3212    |<br>+-------------+<br>109 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<p>表结构就是 一个订单<code>orderNumber</code>对应多个产品编号<code>productCode</code>  每一个产品又被订购了<code>quantityOrdered</code>份 单价为<code>priceEach</code></p>
<p>所以 想知道那个订单中 那个订单少于5000</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select orderNumber,sum(quantityOrdered*priceEach) as Total from orderdetails group by orderNumber having Total &lt; 5000;<br>+-------------+---------+<br>| orderNumber | Total   |<br>+-------------+---------+<br>|       10116 | 1627.56 |<br>|       10118 | 3101.40 |<br>|       10132 | 2880.00 |<br>|       10144 | 1128.20 |<br>|       10154 | 4465.85 |<br>|       10156 | 4599.52 |<br>|       10158 | 1491.38 |<br>|       10189 | 3879.96 |<br>|       10242 | 1679.92 |<br>|       10255 | 4632.31 |<br>|       10256 | 4710.73 |<br>|       10277 | 2611.84 |<br>|       10286 | 1960.80 |<br>|       10294 | 4424.40 |<br>|       10303 | 3474.66 |<br>|       10317 | 2434.25 |<br>|       10345 | 1676.14 |<br>|       10364 | 1834.56 |<br>|       10376 | 3452.75 |<br>|       10385 | 4466.71 |<br>|       10387 | 3516.04 |<br>|       10408 |  615.45 |<br>|       10409 | 2326.18 |<br>+-------------+---------+<br>23 rows in set (0.01 sec)<br><br>mysql&gt; select orderNumber,sum(quantityOrdered*priceEach) as Total from orderdetails where orderNumber != 10116 group by orderNumber having Total &lt; 5000 ;<br>+-------------+---------+<br>| orderNumber | Total   |<br>+-------------+---------+<br>|       10118 | 3101.40 |<br>|       10132 | 2880.00 |<br>|       10144 | 1128.20 |<br>|       10154 | 4465.85 |<br>|       10156 | 4599.52 |<br>|       10158 | 1491.38 |<br>|       10189 | 3879.96 |<br>|       10242 | 1679.92 |<br>|       10255 | 4632.31 |<br>|       10256 | 4710.73 |<br>|       10277 | 2611.84 |<br>|       10286 | 1960.80 |<br>|       10294 | 4424.40 |<br>|       10303 | 3474.66 |<br>|       10317 | 2434.25 |<br>|       10345 | 1676.14 |<br>|       10364 | 1834.56 |<br>|       10376 | 3452.75 |<br>|       10385 | 4466.71 |<br>|       10387 | 3516.04 |<br>|       10408 |  615.45 |<br>|       10409 | 2326.18 |<br>+-------------+---------+<br>22 rows in set (0.01 sec)<br></code></pre></td></tr></table></figure>

<h3 id="HAVING-COUNT"><a href="#HAVING-COUNT" class="headerlink" title="HAVING COUNT"></a>HAVING COUNT</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; desc orders;<br>+----------------+-------------+------+-----+---------+-------+<br>| Field          | Type        | Null | Key | Default | Extra |<br>+----------------+-------------+------+-----+---------+-------+<br>| orderNumber    | int         | NO   | PRI | NULL    |       |<br>| orderDate      | date        | NO   |     | NULL    |       |<br>| requiredDate   | date        | NO   |     | NULL    |       |<br>| shippedDate    | date        | YES  |     | NULL    |       |<br>| status         | varchar(15) | NO   |     | NULL    |       |<br>| comments       | text        | YES  |     | NULL    |       |<br>| customerNumber | int         | NO   | MUL | NULL    |       |<br>+----------------+-------------+------+-----+---------+-------+<br>7 rows in set (0.00 sec)<br><br>mysql&gt; select status,count(status) from orders group by status having count(status);<br>+------------+---------------+<br>| status     | count(status) |<br>+------------+---------------+<br>| Shipped    |           303 |<br>| Resolved   |             4 |<br>| Cancelled  |             6 |<br>| On Hold    |             4 |<br>| Disputed   |             3 |<br>| In Process |             6 |<br>+------------+---------------+<br>6 rows in set (0.00 sec)<br><br>mysql&gt; select status,count(status) from orders group by status having count(status)=4;<br>+----------+---------------+<br>| status   | count(status) |<br>+----------+---------------+<br>| Resolved |             4 |<br>| On Hold  |             4 |<br>+----------+---------------+<br>2 rows in set (0.00 sec)<br><br></code></pre></td></tr></table></figure>

<h3 id="WITH-ROLLUP"><a href="#WITH-ROLLUP" class="headerlink" title="WITH ROLLUP"></a>WITH ROLLUP</h3><p>可以实现类似小计这样的效果</p>
<p>分组的步骤就是</p>
<p>(<code>productCode</code> , <code>quantityOrdered</code>)</p>
<p>(<code>productCode</code>)</p>
<p>(<code> </code>)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select productCode,count(quantityOrdered) as `订单数` from orderdetails group by productCode,quantityOrdered with rollup limit 20;<br>+-------------+-----------+<br>| productCode | 订单数    |<br>+-------------+-----------+<br>| S10_1678    |         1 |<br>| S10_1678    |         1 |<br>| S10_1678    |         1 |<br>| S10_1678    |         2 |<br>| S10_1678    |         1 |<br>| S10_1678    |         1 |<br>| S10_1678    |         1 |<br>| S10_1678    |         2 |<br>| S10_1678    |         2 |<br>| S10_1678    |         1 |<br>| S10_1678    |         1 |<br>| S10_1678    |         4 |<br>| S10_1678    |         3 |<br>| S10_1678    |         2 |<br>| S10_1678    |         1 |<br>| S10_1678    |         1 |<br>| S10_1678    |         1 |<br>| S10_1678    |         1 |<br>| S10_1678    |         1 |<br>| S10_1678    |        28 |<br>+-------------+-----------+<br>20 rows in set (0.01 sec)<br><br>mysql&gt; select productCode,count(quantityOrdered) as `订单数` from orderdetails group by productCode,quantityOrdered with rollup ;<br>...<br>| S72_3212    |         1 |<br>| S72_3212    |         1 |<br>| S72_3212    |         2 |<br>| S72_3212    |        27 |<br>| NULL        |      2996 |<br>+-------------+-----------+<br>2153 rows in set (0.01 sec)<br></code></pre></td></tr></table></figure>

<h2 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h2><p>MySQL 子查询称为内部查询，而包含子查询的查询称为外部查询。子查询可以在使用表达式的任何地方使用，并且必须用括号括起来。</p>
<p>以下查询使用子查询返回在美国办公室工作的员工。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; desc offices; <br>+--------------+-------------+------+-----+---------+-------+<br>| Field        | Type        | Null | Key | Default | Extra |<br>+--------------+-------------+------+-----+---------+-------+<br>| officeCode   | varchar(10) | NO   | PRI | NULL    |       |<br>| city         | varchar(50) | NO   |     | NULL    |       |<br>| phone        | varchar(50) | NO   |     | NULL    |       |<br>| addressLine1 | varchar(50) | NO   |     | NULL    |       |<br>| addressLine2 | varchar(50) | YES  |     | NULL    |       |<br>| state        | varchar(50) | YES  |     | NULL    |       |<br>| country      | varchar(50) | NO   |     | NULL    |       |<br>| postalCode   | varchar(15) | NO   |     | NULL    |       |<br>| territory    | varchar(10) | NO   |     | NULL    |       |<br>+--------------+-------------+------+-----+---------+-------+<br>9 rows in set (0.03 sec)<br><br>mysql&gt; desc employees;<br>+----------------+--------------+------+-----+---------+-------+<br>| Field          | Type         | Null | Key | Default | Extra |<br>+----------------+--------------+------+-----+---------+-------+<br>| employeeNumber | int          | NO   | PRI | NULL    |       |<br>| lastName       | varchar(50)  | NO   |     | NULL    |       |<br>| firstName      | varchar(50)  | NO   |     | NULL    |       |<br>| extension      | varchar(10)  | NO   |     | NULL    |       |<br>| email          | varchar(100) | NO   |     | NULL    |       |<br>| officeCode     | varchar(10)  | NO   | MUL | NULL    |       |<br>| reportsTo      | int          | YES  | MUL | NULL    |       |<br>| jobTitle       | varchar(50)  | NO   |     | NULL    |       |<br>+----------------+--------------+------+-----+---------+-------+<br>8 rows in set (0.00 sec)<br><br>mysql&gt; select concat(firstName,&#x27; &#x27;,lastName) as name,officeCode from employees where officeCode in (select officeCode from offices where country=&#x27;USA&#x27;);<br>+-----------------+------------+<br>| name            | officeCode |<br>+-----------------+------------+<br>| Diane Murphy    | 1          |<br>| Mary Patterson  | 1          |<br>| Jeff Firrelli   | 1          |<br>| Anthony Bow     | 1          |<br>| Leslie Jennings | 1          |<br>| Leslie Thompson | 1          |<br>| Julie Firrelli  | 2          |<br>| Steve Patterson | 2          |<br>| Foon Yue Tseng  | 3          |<br>| George Vanauf   | 3          |<br>+-----------------+------------+<br>10 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<p>步骤先执行内部查询<code>select officeCode from offices where country=&#39;USA&#39;</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select officeCode from offices where country=&#x27;USA&#x27;;<br>+------------+<br>| officeCode |<br>+------------+<br>| 1          |<br>| 2          |<br>| 3          |<br>+------------+<br>3 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<p>然后执行外部查询<code>select concat(firstName,&#39; &#39;,lastName) as name,officeCode from employees where officeCode in (1,2,3)</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select concat(firstName,&#x27; &#x27;,lastName) as name,officeCode from employees where officeCode in (1,2,3);<br>+-----------------+------------+<br>| name            | officeCode |<br>+-----------------+------------+<br>| Diane Murphy    | 1          |<br>| Mary Patterson  | 1          |<br>| Jeff Firrelli   | 1          |<br>| Anthony Bow     | 1          |<br>| Leslie Jennings | 1          |<br>| Leslie Thompson | 1          |<br>| Julie Firrelli  | 2          |<br>| Steve Patterson | 2          |<br>| Foon Yue Tseng  | 3          |<br>| George Vanauf   | 3          |<br>+-----------------+------------+<br>10 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<p>也可以用<code>内连接</code>完成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select concat(firstName,&#x27; &#x27;,lastName) as name,officeCode,country from employees inner join offices using (officeCode) where country=&#x27;USA&#x27;;<br>+-----------------+------------+---------+<br>| name            | officeCode | country |<br>+-----------------+------------+---------+<br>| Diane Murphy    | 1          | USA     |<br>| Mary Patterson  | 1          | USA     |<br>| Jeff Firrelli   | 1          | USA     |<br>| Anthony Bow     | 1          | USA     |<br>| Leslie Jennings | 1          | USA     |<br>| Leslie Thompson | 1          | USA     |<br>| Julie Firrelli  | 2          | USA     |<br>| Steve Patterson | 2          | USA     |<br>| Foon Yue Tseng  | 3          | USA     |<br>| George Vanauf   | 3          | USA     |<br>+-----------------+------------+---------+<br>10 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<h2 id="派生表"><a href="#派生表" class="headerlink" title="派生表"></a>派生表</h2><p>子查询是将内部查询作为外部查询的条件 派生表就是将内部查询的结果作为外部查询的数据来源 </p>
<p>与子查询不同，派生表必须具有别名，以便稍后在查询中引用其名称。如果派生表没有别名，MySQL 将发出以下错误：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">Every derived table must have its own alias.<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ysql&gt; desc orderdetails;<br>+-----------------+---------------+------+-----+---------+-------+<br>| Field           | Type          | Null | Key | Default | Extra |<br>+-----------------+---------------+------+-----+---------+-------+<br>| orderNumber     | int           | NO   | PRI | NULL    |       |<br>| productCode     | varchar(15)   | NO   | PRI | NULL    |       |<br>| quantityOrdered | int           | NO   |     | NULL    |       |<br>| priceEach       | decimal(10,2) | NO   |     | NULL    |       |<br>| orderLineNumber | smallint      | NO   |     | NULL    |       |<br>+-----------------+---------------+------+-----+---------+-------+<br>5 rows in set (0.00 sec)<br><br>mysql&gt; select orderNumber ,dj*dd as total from (select orderNumber,quantityOrdered as dj,priceEach as dd from orderdetails ) alias_tables where dj*dd  &lt; 500;<br>+-------------+--------+<br>| orderNumber | total  |<br>+-------------+--------+<br>|       10419 | 481.50 |<br>+-------------+--------+<br>1 row in set (0.01 sec)<br></code></pre></td></tr></table></figure>

<h2 id="临时表"><a href="#临时表" class="headerlink" title="临时表"></a>临时表</h2><p>仅仅在会话中存在的表 对话结束后删除</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TEMPORARY TABLE table_name(<br>   column1 datatype constraints,<br>   column1 datatype constraints,<br>   ...,<br>   table_constraints<br>);<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select database();<br>+------------+<br>| database() |<br>+------------+<br>| test1      |<br>+------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; show tables;<br>+-----------------+<br>| Tables_in_test1 |<br>+-----------------+<br>| t1              |<br>| t2              |<br>+-----------------+<br>2 rows in set (0.01 sec)<br><br>mysql&gt; create temporary table temporary_t2 (select * from t2); <br>Query OK, 0 rows affected (0.02 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br></code></pre></td></tr></table></figure>

<h4 id="删除-1"><a href="#删除-1" class="headerlink" title="删除"></a>删除</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; drop temporary table temporary_t2;<br>Query OK, 0 rows affected (0.00 sec)<br></code></pre></td></tr></table></figure>

<h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><ol>
<li><strong>原子性 (Atomicity)</strong><ul>
<li>事务是最小的执行单位,要么全部执行成功,要么全部执行失败。</li>
<li>事务中的所有操作要么全部完成,要么全部不执行,不会出现中间状态。</li>
</ul>
</li>
<li><strong>一致性 (Consistency)</strong><ul>
<li>事务执行前后,数据库都必须从一个一致性状态转换到另一个一致性状态。</li>
<li>一致性约束要求事务完成后,数据库的完整性约束没有被破坏。</li>
</ul>
</li>
<li><strong>隔离性 (Isolation)</strong><ul>
<li>事务的执行不受其他事务的干扰,事务之间是相互独立的。</li>
<li>高并发环境下,各个事务之间的操作互不影响。</li>
</ul>
</li>
<li><strong>持久性 (Durability)</strong><ul>
<li>一个事务一旦被提交,它对数据库的改变就是永久性的。</li>
<li>即使发生系统崩溃,已经提交的事务的结果也不会丢失。</li>
</ul>
</li>
</ol>
<p>注意选择支持事务的存储引擎 比如 Innodb</p>
<p>当我们使用<code>Start Transaction</code> 就相当于拍了一次快照 并创建一个事务环境</p>
<p>使用<code>Commit</code> 或者 <code>rollback</code> 都会结束这次事务环境</p>
<p>不同得是</p>
<ul>
<li><p><code>Rollback</code>将数据恢复到执行<code>Start Transaction</code>的快照状态 快照和事务环境也会随之销毁</p>
</li>
<li><p><code>Commit</code> 将事务环境内发生的数据变化写入磁盘永久保存 快照和事务环境也会随之销毁</p>
</li>
</ul>
<p>自动提交是默认开启的 我们给他关闭</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> &quot;autocommit&quot;;<br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-------+</span><br><span class="hljs-operator">|</span> Variable_name <span class="hljs-operator">|</span> <span class="hljs-keyword">Value</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-------+</span><br><span class="hljs-operator">|</span> autocommit    <span class="hljs-operator">|</span> <span class="hljs-keyword">ON</span>    <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> session autocommit<span class="hljs-operator">=</span>off;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> &quot;autocommit&quot;;<br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-------+</span><br><span class="hljs-operator">|</span> Variable_name <span class="hljs-operator">|</span> <span class="hljs-keyword">Value</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-------+</span><br><span class="hljs-operator">|</span> autocommit    <span class="hljs-operator">|</span> OFF   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create table</span> t1 ( id <span class="hljs-type">int</span> <span class="hljs-keyword">primary key</span> auto_increment, name <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">not null</span>,  age <span class="hljs-type">int</span> <span class="hljs-keyword">not null</span>) <br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">character set</span> utf8, <br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> engine<span class="hljs-operator">=</span>innodb; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.08</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> t1 <span class="hljs-keyword">values</span> (<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;zs&#x27;</span>,<span class="hljs-number">18</span>);<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">start</span> transaction; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> t1 <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span>; <br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t1;<br><span class="hljs-keyword">Empty</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">rollback</span>; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t1;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+-----+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span> age <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+-----+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> zs   <span class="hljs-operator">|</span>  <span class="hljs-number">18</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+-----+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<p>注意 rollback并不会回滚到执行的前一句命令 而是快照开启的时候</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create table</span> transaction ( id <span class="hljs-type">int</span> <span class="hljs-keyword">primary key</span> auto_increment, name <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">not null</span> ); <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.09</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">start</span> transaction; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert  into</span> transaction <span class="hljs-keyword">values</span> (<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;zs&#x27;</span>);<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert  into</span> transaction <span class="hljs-keyword">values</span> (<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;ls&#x27;</span>);<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">rollback</span>; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> transaction;<br><span class="hljs-operator">+</span><span class="hljs-comment">----------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------+</span><br><span class="hljs-operator">|</span>        <span class="hljs-number">0</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<h2 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h2><h3 id="Read"><a href="#Read" class="headerlink" title="Read"></a>Read</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from transaction;<br>Empty set (0.00 sec)<br><br>mysql&gt; select connection_id(); <br>+-----------------+<br>| connection_id() |<br>+-----------------+<br>|              11 |<br>+-----------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; insert into transaction values (1,&#x27;zs&#x27;); <br>Query OK, 1 row affected (0.02 sec)<br><br>mysql&gt; lock tables transaction read; <br>Query OK, 0 rows affected (0.00 sec)<br><br>mysql&gt; insert into transaction values (2,&#x27;ls&#x27;);<br>ERROR 1099 (HY000): Table &#x27;transaction&#x27; was locked with a READ lock and can&#x27;t be updated<br><br>mysql&gt; select * from transaction;<br>+----+------+<br>| id | name |<br>+----+------+<br>|  1 | zs   |<br>+----+------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<p>在当前连接开启锁 <strong>所有连接</strong>插入数据时就会报错 因为是<code>Read</code>锁 只可读</p>
<p>打开一个新连接 尝试向该表中 插入数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> connection_id(); <br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-operator">|</span> connection_id() <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-operator">|</span>              <span class="hljs-number">12</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> testDB.transaction;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> zs   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-number">1</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> transaction <span class="hljs-keyword">values</span> (<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;ls&#x27;</span>);<br><br></code></pre></td></tr></table></figure>

<p>新连接会卡住 因为它在等待<code>锁的释放</code> </p>
<p>在有锁的连接中释放锁(其他连接无法解锁) 该连接的语句就会执行</p>
<p>或者关闭有锁的连接 这个锁也会释放</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> unlock tables; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> connection_id();<br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-operator">|</span> connection_id() <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-operator">|</span>              <span class="hljs-number">11</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> connection_id(); <br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-operator">|</span> connection_id() <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-operator">|</span>              <span class="hljs-number">12</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> transaction <span class="hljs-keyword">values</span> (<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;ls&#x27;</span>);<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">2</span> min <span class="hljs-number">28.10</span> sec)<br><br></code></pre></td></tr></table></figure>

<h3 id="Write"><a href="#Write" class="headerlink" title="Write"></a>Write</h3><p><code>Read</code> 锁开启时 主连接和其他连接都不能写入数据 但都可以读取数据</p>
<p><code>Write</code> 锁开启时 <strong>主连接可以读写 其他连接不能读取</strong></p>
<p>也就是独享和共享的区别</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> transaction; <br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> zs   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span> ls   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">3</span> <span class="hljs-operator">|</span> ww   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-number">3</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> connection_id(); <br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-operator">|</span> connection_id() <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-operator">|</span>              <span class="hljs-number">11</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> lock tables transaction write; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> transaction <span class="hljs-keyword">values</span> (<span class="hljs-number">4</span>,<span class="hljs-string">&#x27;zl&#x27;</span>); <br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> transaction;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> zs   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span> ls   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">3</span> <span class="hljs-operator">|</span> ww   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">4</span> <span class="hljs-operator">|</span> zl   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-number">4</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<p>其他连接在<code>Write</code>锁下 读取和写入将会挂起 等待锁的释放 甚至无法进入存在锁表的数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> connection_id();<br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-operator">|</span> connection_id() <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-operator">|</span>              <span class="hljs-number">15</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> transaction;<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> use testDB;<br>Reading <span class="hljs-keyword">table</span> information <span class="hljs-keyword">for</span> completion <span class="hljs-keyword">of</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">column</span> names<br>You can turn off this feature <span class="hljs-keyword">to</span> <span class="hljs-keyword">get</span> a quicker startup <span class="hljs-keyword">with</span> <span class="hljs-operator">-</span>A<br><br></code></pre></td></tr></table></figure>

<p>在主连接释放锁后  其他表即可继续操作</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> connection_id();<br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-operator">|</span> connection_id() <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-operator">|</span>              <span class="hljs-number">15</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> transaction;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> zs   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span> ls   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">3</span> <span class="hljs-operator">|</span> ww   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">4</span> <span class="hljs-operator">|</span> zl   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-number">4</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">1</span> min <span class="hljs-number">24.29</span> sec)<br><br></code></pre></td></tr></table></figure>

<h1 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h1><p>数据库编程</p>
<h2 id="创建存储函数"><a href="#创建存储函数" class="headerlink" title="创建存储函数"></a>创建存储函数</h2><p>默认的SQl语句会在输入<code>;</code>后结束 存储过程需要<code>;</code>当作普通语言中的<code>&#123;&#125;</code></p>
<h3 id="更改结束符"><a href="#更改结束符" class="headerlink" title="更改结束符"></a>更改结束符</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; delimiter ~<br></code></pre></td></tr></table></figure>
<h3 id="书写存储函数"><a href="#书写存储函数" class="headerlink" title="书写存储函数"></a>书写存储函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span> Selects() <span class="hljs-keyword">begin</span> <span class="hljs-keyword">declare</span> Poerson <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>); <span class="hljs-keyword">declare</span> Number <span class="hljs-type">int</span>; <span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">into</span> Number <span class="hljs-keyword">from</span> 员工表 <span class="hljs-keyword">where</span> 部门<span class="hljs-operator">=</span><span class="hljs-string">&#x27;销售部&#x27;</span> ; <span class="hljs-keyword">set</span> Poerson<span class="hljs-operator">=</span><span class="hljs-string">&#x27;销售部&#x27;</span>; <span class="hljs-keyword">select</span> Poerson,Number; <span class="hljs-keyword">end</span>;<span class="hljs-operator">~</span><br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">call</span> Selects()<span class="hljs-operator">~</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------+--------+</span><br><span class="hljs-operator">|</span> Poerson   <span class="hljs-operator">|</span> Number <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------+--------+</span><br><span class="hljs-operator">|</span> 销售部    <span class="hljs-operator">|</span>      <span class="hljs-number">6</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------+--------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>
<h3 id="结束符修改为"><a href="#结束符修改为" class="headerlink" title="结束符修改为;"></a>结束符修改为<code>;</code></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; delimiter ~<br></code></pre></td></tr></table></figure>

<h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><h2 id="count"><a href="#count" class="headerlink" title="count"></a>count</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select count(*) from customers;<br>+----------+<br>| count(*) |<br>+----------+<br>|      122 |<br>+----------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<h2 id="concat"><a href="#concat" class="headerlink" title="concat"></a>concat</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select concat(&#x27;1&#x27;,&#x27;2&#x27;); <br>+-----------------+<br>| concat(&#x27;1&#x27;,&#x27;2&#x27;) |<br>+-----------------+<br>| 12              |<br>+-----------------+<br></code></pre></td></tr></table></figure>

<h2 id="concat-ws"><a href="#concat-ws" class="headerlink" title="concat_ws"></a>concat_ws</h2><p>和<code>concat</code>差不多 只是在第一个字段就指定了分隔符</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select concat_ws(&#x27; &#x27;,firstName,lastName) as name,email from employees limit 5;<br>+-------------------+---------------------------------+<br>| name              | email                           |<br>+-------------------+---------------------------------+<br>| Diane Murphy      | dmurphy@classicmodelcars.com    |<br>| Mary Patterson    | mpatterso@classicmodelcars.com  |<br>| Jeff Firrelli     | jfirrelli@classicmodelcars.com  |<br>| William Patterson | wpatterson@classicmodelcars.com |<br>| Gerard Bondur     | gbondur@classicmodelcars.com    |<br>+-------------------+---------------------------------+<br>5 rows in set (0.00 sec)<br><br>mysql&gt; select concat(firstName,&#x27; &#x27;,lastName) as name,email from employees limit 5;<br>+-------------------+---------------------------------+<br>| name              | email                           |<br>+-------------------+---------------------------------+<br>| Diane Murphy      | dmurphy@classicmodelcars.com    |<br>| Mary Patterson    | mpatterso@classicmodelcars.com  |<br>| Jeff Firrelli     | jfirrelli@classicmodelcars.com  |<br>| William Patterson | wpatterson@classicmodelcars.com |<br>| Gerard Bondur     | gbondur@classicmodelcars.com    |<br>+-------------------+---------------------------------+<br>5 rows in set (0.00 sec)<br><br>## Full name 需要使用` `修饰<br>mysql&gt; select concat(firstName,&#x27; &#x27;,lastName) as `Full name`,email from employees limit 5;<br>+-------------------+---------------------------------+<br>| Full name         | email                           |<br>+-------------------+---------------------------------+<br>| Diane Murphy      | dmurphy@classicmodelcars.com    |<br>| Mary Patterson    | mpatterso@classicmodelcars.com  |<br>| Jeff Firrelli     | jfirrelli@classicmodelcars.com  |<br>| William Patterson | wpatterson@classicmodelcars.com |<br>| Gerard Bondur     | gbondur@classicmodelcars.com    |<br>+-------------------+---------------------------------+<br>5 rows in set (0.01 sec)<br></code></pre></td></tr></table></figure>

<h1 id="备份恢复"><a href="#备份恢复" class="headerlink" title="备份恢复"></a>备份恢复</h1><h2 id="mysqldump导出"><a href="#mysqldump导出" class="headerlink" title="mysqldump导出"></a>mysqldump导出</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">Dumping structure <span class="hljs-keyword">and</span> contents <span class="hljs-keyword">of</span> MySQL databases <span class="hljs-keyword">and</span> tables.<br>Usage: mysqldump [OPTIONS] database [tables]<br><span class="hljs-keyword">OR</span>     mysqldump [OPTIONS] <span class="hljs-comment">--databases [OPTIONS] DB1 [DB2 DB3...]</span><br><span class="hljs-keyword">OR</span>     mysqldump [OPTIONS] <span class="hljs-comment">--all-databases [OPTIONS]</span><br></code></pre></td></tr></table></figure>

<h3 id="导出数据表"><a href="#导出数据表" class="headerlink" title="导出数据表"></a>导出数据表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# mysqldump <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>p testDB t1 <span class="hljs-operator">&gt;</span> testDB.t1.sql<br>Enter password: <br>[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# wc <span class="hljs-operator">-</span>l testDB.t1.sql <br><span class="hljs-number">51</span> testDB.t1.sql<br>[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# cat testDB.t1.sql <br><span class="hljs-comment">-- MySQL dump 10.13  Distrib 8.0.38, for Linux (x86_64)</span><br><span class="hljs-comment">--</span><br><span class="hljs-comment">-- Host: localhost    Database: testDB</span><br><span class="hljs-comment">-- ------------------------------------------------------</span><br><span class="hljs-comment">-- Server version	8.0.38</span><br><br><span class="hljs-comment">/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */</span>;<br><span class="hljs-comment">/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */</span>;<br><span class="hljs-comment">/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */</span>;<br><span class="hljs-comment">/*!50503 SET NAMES utf8mb4 */</span>;<br><span class="hljs-comment">/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */</span>;<br><span class="hljs-comment">/*!40103 SET TIME_ZONE=&#x27;+00:00&#x27; */</span>;<br><span class="hljs-comment">/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */</span>;<br><span class="hljs-comment">/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */</span>;<br><span class="hljs-comment">/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE=&#x27;NO_AUTO_VALUE_ON_ZERO&#x27; */</span>;<br><span class="hljs-comment">/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */</span>;<br><br><span class="hljs-comment">--</span><br><span class="hljs-comment">-- Table structure for table `t1`</span><br><span class="hljs-comment">--</span><br><br><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">EXISTS</span> `t1`;<br><span class="hljs-comment">/*!40101 SET @saved_cs_client     = @@character_set_client */</span>;<br><span class="hljs-comment">/*!50503 SET character_set_client = utf8mb4 */</span>;<br><span class="hljs-keyword">CREATE TABLE</span> `t1` (<br>  `id` <span class="hljs-type">int</span> <span class="hljs-keyword">NOT NULL</span> AUTO_INCREMENT,<br>  `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT NULL</span>,<br>  <span class="hljs-keyword">PRIMARY KEY</span> (`id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB AUTO_INCREMENT<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb3;<br><span class="hljs-comment">/*!40101 SET character_set_client = @saved_cs_client */</span>;<br><br><span class="hljs-comment">--</span><br><span class="hljs-comment">-- Dumping data for table `t1`</span><br><span class="hljs-comment">--</span><br><br>LOCK TABLES `t1` WRITE;<br><span class="hljs-comment">/*!40000 ALTER TABLE `t1` DISABLE KEYS */</span>;<br><span class="hljs-keyword">INSERT INTO</span> `t1` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;zs&#x27;</span>);<br><span class="hljs-comment">/*!40000 ALTER TABLE `t1` ENABLE KEYS */</span>;<br>UNLOCK TABLES;<br><span class="hljs-comment">/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */</span>;<br><br><span class="hljs-comment">/*!40101 SET SQL_MODE=@OLD_SQL_MODE */</span>;<br><span class="hljs-comment">/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */</span>;<br><span class="hljs-comment">/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */</span>;<br><span class="hljs-comment">/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */</span>;<br><span class="hljs-comment">/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */</span>;<br><span class="hljs-comment">/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */</span>;<br><span class="hljs-comment">/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */</span>;<br><br><span class="hljs-comment">-- Dump completed on 2024-08-05 18:17:07</span><br></code></pre></td></tr></table></figure>

<h3 id="导出数据库"><a href="#导出数据库" class="headerlink" title="导出数据库"></a>导出数据库</h3><p>导出表时也会将创建库时间语句dump下来</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# mysqldump <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>p testDB <span class="hljs-operator">&gt;</span> testDB.sql<br>Enter password: <br><br>[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# wc <span class="hljs-operator">-</span>l testDB.t1.sql<br><span class="hljs-number">51</span> testDB.t1.sql<br>[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# wc <span class="hljs-operator">-</span>l testDB.sql <br><span class="hljs-number">51</span> testDB.sql<br><br></code></pre></td></tr></table></figure>

<h3 id="导出所有数据库"><a href="#导出所有数据库" class="headerlink" title="导出所有数据库"></a>导出所有数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# mysqldump <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>p <span class="hljs-comment">--all-databases &gt; all.sql</span><br>Enter password: <br>[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# wc <span class="hljs-operator">-</span>l all.sql<br><span class="hljs-number">1071</span> all.sql<br><br></code></pre></td></tr></table></figure>

<h2 id="导入SQL文件"><a href="#导入SQL文件" class="headerlink" title="导入SQL文件"></a>导入SQL文件</h2><h3 id="导入表"><a href="#导入表" class="headerlink" title="导入表"></a>导入表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>pqweQWE123 testDB <span class="hljs-operator">-</span>e <span class="hljs-string">&#x27;drop table t1&#x27;</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br><br>[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>pqweQWE123 testDB <span class="hljs-operator">&lt;</span> testDB.t1.sql <br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br><br>[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>pqweQWE123 testDB <span class="hljs-operator">-</span>e <span class="hljs-string">&#x27;show tables;&#x27;</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span><br><span class="hljs-operator">|</span> Tables_in_testDB <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span><br><span class="hljs-operator">|</span> t1               <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span><br></code></pre></td></tr></table></figure>

<h3 id="导入库"><a href="#导入库" class="headerlink" title="导入库"></a>导入库</h3><p>需要导入的库 需要提前存在</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>p  <span class="hljs-operator">-</span>e  <span class="hljs-string">&#x27;show databases;&#x27;</span><br>Enter password: <br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql              <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> sys                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br>[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>pqweQWE123 <span class="hljs-operator">-</span>e <span class="hljs-string">&#x27;create database testDB;&#x27;</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br>[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>pqweQWE123 <span class="hljs-operator">&lt;</span> testDB.sql <br>[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>pqweQWE123 <span class="hljs-operator">-</span>e <span class="hljs-string">&#x27;show databases;&#x27;</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql              <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> sys                <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> testDB             <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br></code></pre></td></tr></table></figure>

<h3 id="导入全部库"><a href="#导入全部库" class="headerlink" title="导入全部库"></a>导入全部库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>pqweQWE123 <span class="hljs-operator">-</span>e <span class="hljs-string">&#x27;show databases;&#x27;</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql              <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> sys                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br>[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>pqweQWE123 <span class="hljs-operator">&lt;</span> all.sql <br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br>[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>pqweQWE123 <span class="hljs-operator">-</span>e <span class="hljs-string">&#x27;show databases;&#x27;</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql              <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> sys                <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> testDB             <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><br></code></pre></td></tr></table></figure>

<h3 id="source"><a href="#source" class="headerlink" title="source"></a>source</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; source /path/file.sql<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; source /root/mysqlsampledatabase.sql <br>Query OK, 1 row affected (0.04 sec)<br><br>Database changed<br>Query OK, 0 rows affected, 1 warning (0.00 sec)<br><br>Query OK, 0 rows affected, 1 warning (0.00 sec)<br><br>Query OK, 0 rows affected, 1 warning (0.01 sec)<br><br>Query OK, 0 rows affected, 1 warning (0.01 sec)<br><br>Query OK, 0 rows affected, 1 warning (0.00 sec)<br><br>Query OK, 0 rows affected, 1 warning (0.01 sec)<br><br>Query OK, 0 rows affected, 1 warning (0.00 sec)<br><br>Query OK, 0 rows affected, 1 warning (0.01 sec)<br><br>mysql&gt; show databases;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| classicmodels      |<br>| information_schema |<br>| mysql              |<br>| performance_schema |<br>| sys                |<br>+--------------------+<br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<h1 id="主备"><a href="#主备" class="headerlink" title="主备"></a>主备</h1><p>主备是通过<code>Binlog</code>的文件进行的 </p>
<ol>
<li>主库会维护自己的<code>Binlog</code> 从库也会定时从主库获取<code>Binlog</code>的信息 这叫做<code>中继日志拉取</code></li>
<li>从库将<code>Binlog</code> 导入到自己的 <code>中继日志</code> 然后读取<code>中继日志</code> 执行这些<code>Binlog</code> 实现同步</li>
<li><strong>主从同步机制</strong>:<ul>
<li>全量复制: 当从库第一次与主库建立连接时,需要进行全量复制,即从主库将整个数据库复制到从库。</li>
<li>增量复制: 全量复制完成后,从库会持续拉取主库的二进制日志,实现增量同步。</li>
</ul>
</li>
</ol>
<h2 id="Binlog"><a href="#Binlog" class="headerlink" title="Binlog"></a>Binlog</h2><p>二进制日志是存储对 MySQL 数据库的更改的文件。这些日志包含一系列事件，这些事件表示对数据和数据库对象 （如表、视图、数据库等） 的修改。<code>Create Drop Delete</code>  </p>
<p>只有导致数据库发生更改的语句才会记录 <code>Select Show</code>等语句就不会记录到<code>Binlog</code>中 </p>
<p><code>Binlog</code>的作用包括 <strong>时间点恢复</strong>、<strong>主备复制</strong></p>
<p>当然也会对性能产生影响 默认是开启的且格式为<code>ROW</code> 且无法在服务器运行时关闭 只能在配置文件中指定<strong>参数</strong>关闭</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> <span class="hljs-keyword">global</span> variables <span class="hljs-keyword">like</span> &quot;log_bin&quot;; <br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-------+</span><br><span class="hljs-operator">|</span> Variable_name <span class="hljs-operator">|</span> <span class="hljs-keyword">Value</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-------+</span><br><span class="hljs-operator">|</span> log_bin       <span class="hljs-operator">|</span> <span class="hljs-keyword">ON</span>    <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> <span class="hljs-keyword">global</span> variables <span class="hljs-keyword">like</span> &quot;log_bin&quot;;<br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-------+</span><br><span class="hljs-operator">|</span> Variable_name <span class="hljs-operator">|</span> <span class="hljs-keyword">Value</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-------+</span><br><span class="hljs-operator">|</span> log_bin       <span class="hljs-operator">|</span> OFF   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">global</span> log_bin <span class="hljs-operator">=</span> off;<br>ERROR <span class="hljs-number">1238</span> (HY000): Variable <span class="hljs-string">&#x27;log_bin&#x27;</span> <span class="hljs-keyword">is</span> a read <span class="hljs-keyword">only</span> variable<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@MySQL01 ~]# mysqld --verbose --help | grep log-bin<br>  --log-bin[=name]    Configures the name prefix to use for binary log files.<br>                      If the --log-bin option is not supplied, the name prefix<br>                      defaults to &quot;binlog&quot;. If the --log-bin option is supplied<br>                      --log-bin=name. To disable binary logging, use the<br>                      --skip-log-bin or --disable-log-bin option.<br><br>[root@MySQL01 ~]# systemctl restart mysqld.service <br>[root@MySQL01 ~]# cat /etc/my.cnf<br>[client-server]<br><br>[mysqld]<br>skip-log-bin<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">show global variables like <span class="hljs-string">&quot;log_bin&quot;</span>;</span><br>+---------------+-------+<br>| Variable_name | Value |<br>+---------------+-------+<br>| log_bin       | OFF   |<br>+---------------+-------+<br>1 row in set (0.02 sec)<br></code></pre></td></tr></table></figure>

<p><code>Binlog</code>支持多种格式</p>
<ul>
<li>基于语句的 （） – 允许日志记录使用基于行的日志记录。<code>STATEMENT</code></li>
<li>Row-based （） – 允许日志记录使用基于行的。<code>ROW</code></li>
<li>Mixed format （） – 允许日志记录使用混合格式。<code>MIXED</code></li>
</ul>
<h3 id="保存位置"><a href="#保存位置" class="headerlink" title="保存位置"></a>保存位置</h3><p>默认保存在<code>datadir</code>目录下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">mysql&gt; show variables like <span class="hljs-string">&quot;%datadir%&quot;</span>;<br>+---------------+-----------------+<br>| Variable_name | Value           |<br>+---------------+-----------------+<br>| datadir       | /var/lib/mysql/ |<br>+---------------+-----------------+<br>1 row <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.01 sec)<br><br>mysql&gt; ^DBye<br>[root@MySQL01 ~]# <span class="hljs-built_in">cat</span> /etc/my.cnf.d/mysql-server.cnf | grep -v <span class="hljs-string">&#x27;#&#x27;</span><br><br>[mysqld]<br>datadir=/var/lib/mysql<br>socket=/var/lib/mysql/mysql.sock<br>log-error=/var/log/mysql/mysqld.log<br>pid-file=/run/mysqld/mysqld.pid<br><br>[root@MySQL01 ~]# <span class="hljs-built_in">ls</span> /var/lib/mysql | grep binlog | <span class="hljs-built_in">wc</span> -l <br>16<br></code></pre></td></tr></table></figure>

<h3 id="显示当前的Binlog"><a href="#显示当前的Binlog" class="headerlink" title="显示当前的Binlog"></a>显示当前的<code>Binlog</code></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> <span class="hljs-type">binary</span> logs; <br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-----------+-----------+</span><br><span class="hljs-operator">|</span> Log_name      <span class="hljs-operator">|</span> File_size <span class="hljs-operator">|</span> Encrypted <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-----------+-----------+</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000001</span> <span class="hljs-operator">|</span>      <span class="hljs-number">7595</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000002</span> <span class="hljs-operator">|</span>   <span class="hljs-number">1260239</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000003</span> <span class="hljs-operator">|</span>       <span class="hljs-number">808</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000004</span> <span class="hljs-operator">|</span>      <span class="hljs-number">2215</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000005</span> <span class="hljs-operator">|</span>      <span class="hljs-number">5533</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000006</span> <span class="hljs-operator">|</span>      <span class="hljs-number">3046</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000007</span> <span class="hljs-operator">|</span>      <span class="hljs-number">1752</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000008</span> <span class="hljs-operator">|</span>       <span class="hljs-number">180</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000009</span> <span class="hljs-operator">|</span>       <span class="hljs-number">180</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000010</span> <span class="hljs-operator">|</span>       <span class="hljs-number">157</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000011</span> <span class="hljs-operator">|</span>       <span class="hljs-number">378</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000012</span> <span class="hljs-operator">|</span>       <span class="hljs-number">180</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000013</span> <span class="hljs-operator">|</span>       <span class="hljs-number">180</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000014</span> <span class="hljs-operator">|</span>       <span class="hljs-number">180</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000015</span> <span class="hljs-operator">|</span>       <span class="hljs-number">157</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-----------+-----------+</span><br><span class="hljs-number">15</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> master status;<br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+----------+--------------+------------------+-------------------+</span><br><span class="hljs-operator">|</span> File          <span class="hljs-operator">|</span> Position <span class="hljs-operator">|</span> Binlog_Do_DB <span class="hljs-operator">|</span> Binlog_Ignore_DB <span class="hljs-operator">|</span> Executed_Gtid_Set <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+----------+--------------+------------------+-------------------+</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000015</span> <span class="hljs-operator">|</span>      <span class="hljs-number">157</span> <span class="hljs-operator">|</span>              <span class="hljs-operator">|</span>                  <span class="hljs-operator">|</span>                   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+----------+--------------+------------------+-------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br></code></pre></td></tr></table></figure>

<h3 id="删除binlog"><a href="#删除binlog" class="headerlink" title="删除binlog"></a>删除<code>binlog</code></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show binary logs; <br>+---------------+-----------+-----------+<br>| Log_name      | File_size | Encrypted |<br>+---------------+-----------+-----------+<br>| binlog.000001 |      7595 | No        |<br>| binlog.000002 |   1260239 | No        |<br>| binlog.000003 |       808 | No        |<br>| binlog.000004 |      2215 | No        |<br>| binlog.000005 |      5533 | No        |<br>| binlog.000006 |      3046 | No        |<br>| binlog.000007 |      1752 | No        |<br>| binlog.000008 |       180 | No        |<br>| binlog.000009 |       180 | No        |<br>| binlog.000010 |       157 | No        |<br>| binlog.000011 |       378 | No        |<br>| binlog.000012 |       180 | No        |<br>| binlog.000013 |       180 | No        |<br>| binlog.000014 |       180 | No        |<br>| binlog.000015 |       157 | No        |<br>| binlog.000016 |       180 | No        |<br>| binlog.000017 |       180 | No        |<br>| binlog.000018 |       180 | No        |<br>| binlog.000019 |       180 | No        |<br>| binlog.000020 |       157 | No        |<br>+---------------+-----------+-----------+<br>20 rows in set (0.00 sec)<br><br>mysql&gt; purge binary logs to &#x27;binlog.000020&#x27;;<br>Query OK, 0 rows affected (0.02 sec)<br><br>mysql&gt; show binary logs; <br>+---------------+-----------+-----------+<br>| Log_name      | File_size | Encrypted |<br>+---------------+-----------+-----------+<br>| binlog.000020 |       157 | No        |<br>+---------------+-----------+-----------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; show master status;<br>+---------------+----------+--------------+------------------+-------------------+<br>| File          | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |<br>+---------------+----------+--------------+------------------+-------------------+<br>| binlog.000020 |      157 |              |                  |                   |<br>+---------------+----------+--------------+------------------+-------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>

<h3 id="刷新Binlog"><a href="#刷新Binlog" class="headerlink" title="刷新Binlog"></a>刷新<code>Binlog</code></h3><p>这会直接结束当前的<code>binlog</code> 使用下一个<code>binlog</code></p>
<blockquote>
<p> flush binary logs; </p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> master status; <br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+----------+--------------+------------------+-------------------+</span><br><span class="hljs-operator">|</span> File          <span class="hljs-operator">|</span> Position <span class="hljs-operator">|</span> Binlog_Do_DB <span class="hljs-operator">|</span> Binlog_Ignore_DB <span class="hljs-operator">|</span> Executed_Gtid_Set <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+----------+--------------+------------------+-------------------+</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000020</span> <span class="hljs-operator">|</span>      <span class="hljs-number">735</span> <span class="hljs-operator">|</span>              <span class="hljs-operator">|</span>                  <span class="hljs-operator">|</span>                   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+----------+--------------+------------------+-------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> flush <span class="hljs-type">binary</span> logs; <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> master status;<br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+----------+--------------+------------------+-------------------+</span><br><span class="hljs-operator">|</span> File          <span class="hljs-operator">|</span> Position <span class="hljs-operator">|</span> Binlog_Do_DB <span class="hljs-operator">|</span> Binlog_Ignore_DB <span class="hljs-operator">|</span> Executed_Gtid_Set <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+----------+--------------+------------------+-------------------+</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000021</span> <span class="hljs-operator">|</span>      <span class="hljs-number">157</span> <span class="hljs-operator">|</span>              <span class="hljs-operator">|</span>                  <span class="hljs-operator">|</span>                   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+----------+--------------+------------------+-------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> <span class="hljs-type">binary</span> logs; <br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-----------+-----------+</span><br><span class="hljs-operator">|</span> Log_name      <span class="hljs-operator">|</span> File_size <span class="hljs-operator">|</span> Encrypted <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-----------+-----------+</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000020</span> <span class="hljs-operator">|</span>       <span class="hljs-number">779</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000021</span> <span class="hljs-operator">|</span>       <span class="hljs-number">157</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-----------+-----------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br><br></code></pre></td></tr></table></figure>

<h3 id="查看binlog内容"><a href="#查看binlog内容" class="headerlink" title="查看binlog内容"></a>查看<code>binlog</code>内容</h3><p>直接查看时会乱码 使用<code>mysqlbinlog</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@MySQL01 mysql]# <span class="hljs-built_in">cat</span> binlog.000020<br>b�<span class="hljs-keyword">in</span>��fz~8.0.38��f<br><br><br>**4<br>(����f#����a���f<span class="hljs-string">&quot;M��7�[� ¦8-2����f2 �Estd���</span><br><span class="hljs-string">                                            testDB2</span><br><span class="hljs-string">�testDB2create database testDB2;*)�</span><br><span class="hljs-string">                                   ��f&quot;</span>M����\� ¦8r�3<br><br>                                                    ��f2 �Estd���<br>                                                                 testDB3<br>                                                                        �testDB3create database testDB3&amp;,��f<span class="hljs-string">&quot;Mn&quot;</span>��^� ��8�S�,��f0 �Estd���<br>                      testDB2�testDB2drop database testDB2�/�e���f,<br>                                                                   binlog.000021���S[root@MySQL01 mysql]# <br><br><br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@MySQL01</span> mysql]# mysqlbinlog binlog<span class="hljs-number">.000020</span> <span class="hljs-operator">&gt;</span> <span class="hljs-operator">~</span><span class="hljs-operator">/</span>binlog20.sql<br>[root<span class="hljs-variable">@MySQL01</span> mysql]# vim <span class="hljs-operator">~</span><span class="hljs-operator">/</span>binlog20.sql<br><br></code></pre></td></tr></table></figure>

<h3 id="时间点恢复"><a href="#时间点恢复" class="headerlink" title="时间点恢复"></a>时间点恢复</h3><p>需要<code>innode</code>存储引擎支持 并且服务器开启<code>binlog</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> <span class="hljs-type">binary</span> logs; <br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-----------+-----------+</span><br><span class="hljs-operator">|</span> Log_name      <span class="hljs-operator">|</span> File_size <span class="hljs-operator">|</span> Encrypted <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-----------+-----------+</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000020</span> <span class="hljs-operator">|</span>       <span class="hljs-number">779</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000021</span> <span class="hljs-operator">|</span>       <span class="hljs-number">157</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-----------+-----------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> purge <span class="hljs-type">binary</span> logs <span class="hljs-keyword">to</span> <span class="hljs-string">&#x27;binlog.000021&#x27;</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.04</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> master status;<br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+----------+--------------+------------------+-------------------+</span><br><span class="hljs-operator">|</span> File          <span class="hljs-operator">|</span> Position <span class="hljs-operator">|</span> Binlog_Do_DB <span class="hljs-operator">|</span> Binlog_Ignore_DB <span class="hljs-operator">|</span> Executed_Gtid_Set <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+----------+--------------+------------------+-------------------+</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000021</span> <span class="hljs-operator">|</span>      <span class="hljs-number">157</span> <span class="hljs-operator">|</span>              <span class="hljs-operator">|</span>                  <span class="hljs-operator">|</span>                   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+----------+--------------+------------------+-------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br><br></code></pre></td></tr></table></figure>

<p>创建一个数据库和表 并插入数据 <code>binlogs</code> <code>t1</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases; <br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql              <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> sys                <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> testDB             <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> testDB3            <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-number">6</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> database logbins; <br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.06</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create table</span> logbins.t1 (id <span class="hljs-type">int</span> <span class="hljs-keyword">primary key</span> auto_increment,name <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">not null</span>); <br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.14</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> logbins.t1 <span class="hljs-keyword">values</span> (<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;zs&#x27;</span>),(<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;ls&#x27;</span>); <br>Query OK, <span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.07</span> sec)<br>Records: <span class="hljs-number">2</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> logbins.t1; <br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> zs   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span> ls   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<p>删除数据库<code>binlogs</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">drop</span> database logbins; <br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.07</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> <span class="hljs-type">binary</span> logs; <br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-----------+-----------+</span><br><span class="hljs-operator">|</span> Log_name      <span class="hljs-operator">|</span> File_size <span class="hljs-operator">|</span> Encrypted <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-----------+-----------+</span><br><span class="hljs-operator">|</span> binlog<span class="hljs-number">.000021</span> <span class="hljs-operator">|</span>      <span class="hljs-number">1081</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">No</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-----------+-----------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br><br></code></pre></td></tr></table></figure>

<p>利用<code>mysqlbinlog</code>进行时间点恢复</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@MySQL01</span> <span class="hljs-operator">~</span>]#  mysqlbinlog  <span class="hljs-comment">--verbose /var/lib/mysql/binlog.000021 | grep -i -C 10 drop</span><br>#<span class="hljs-number">240827</span> <span class="hljs-number">16</span>:<span class="hljs-number">40</span>:<span class="hljs-number">17</span> server id <span class="hljs-number">1</span>  end_log_pos <span class="hljs-number">968</span> CRC32 <span class="hljs-number">0x1e24d6cf</span> 	Anonymous_GTID	last_committed<span class="hljs-operator">=</span><span class="hljs-number">3</span>	sequence_number<span class="hljs-operator">=</span><span class="hljs-number">4</span>	rbr_only<span class="hljs-operator">=</span><span class="hljs-keyword">no</span>	original_committed_timestamp<span class="hljs-operator">=</span><span class="hljs-number">1724748017242734</span>	immediate_commit_timestamp<span class="hljs-operator">=</span><span class="hljs-number">1724748017242734</span>transaction_length<span class="hljs-operator">=</span><span class="hljs-number">190</span><br># original_commit_timestamp<span class="hljs-operator">=</span><span class="hljs-number">1724748017242734</span> (<span class="hljs-number">2024</span><span class="hljs-number">-08</span><span class="hljs-number">-27</span> <span class="hljs-number">16</span>:<span class="hljs-number">40</span>:<span class="hljs-number">17.242734</span> CST)<br># immediate_commit_timestamp<span class="hljs-operator">=</span><span class="hljs-number">1724748017242734</span> (<span class="hljs-number">2024</span><span class="hljs-number">-08</span><span class="hljs-number">-27</span> <span class="hljs-number">16</span>:<span class="hljs-number">40</span>:<span class="hljs-number">17.242734</span> CST)<br><span class="hljs-comment">/*!80001 SET @@session.original_commit_timestamp=1724748017242734*/</span><span class="hljs-comment">/*!*/</span>;<br><span class="hljs-comment">/*!80014 SET @@session.original_server_version=80038*/</span><span class="hljs-comment">/*!*/</span>;<br><span class="hljs-comment">/*!80014 SET @@session.immediate_server_version=80038*/</span><span class="hljs-comment">/*!*/</span>;<br><span class="hljs-keyword">SET</span> @<span class="hljs-variable">@SESSION</span>.GTID_NEXT<span class="hljs-operator">=</span> <span class="hljs-string">&#x27;ANONYMOUS&#x27;</span><span class="hljs-comment">/*!*/</span>;<br># <span class="hljs-keyword">at</span> <span class="hljs-number">968</span><br>#<span class="hljs-number">240827</span> <span class="hljs-number">16</span>:<span class="hljs-number">40</span>:<span class="hljs-number">17</span> server id <span class="hljs-number">1</span>  end_log_pos <span class="hljs-number">1081</span> CRC32 <span class="hljs-number">0x73d6f519</span> 	Query	thread_id<span class="hljs-operator">=</span><span class="hljs-number">9</span>	exec_time<span class="hljs-operator">=</span><span class="hljs-number">0</span>	error_code<span class="hljs-operator">=</span><span class="hljs-number">0</span>	Xid <span class="hljs-operator">=</span> <span class="hljs-number">34</span><br><span class="hljs-keyword">SET</span> <span class="hljs-type">TIMESTAMP</span><span class="hljs-operator">=</span><span class="hljs-number">1724748017</span><span class="hljs-comment">/*!*/</span>;<br><span class="hljs-keyword">drop</span> database logbins<br><span class="hljs-comment">/*!*/</span>;<br><span class="hljs-keyword">SET</span> @<span class="hljs-variable">@SESSION</span>.GTID_NEXT<span class="hljs-operator">=</span> <span class="hljs-string">&#x27;AUTOMATIC&#x27;</span> <span class="hljs-comment">/* added by mysqlbinlog */</span> <span class="hljs-comment">/*!*/</span>;<br>DELIMITER ;<br># <span class="hljs-keyword">End</span> <span class="hljs-keyword">of</span> log file<br><span class="hljs-comment">/*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/</span>;<br><span class="hljs-comment">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/</span>;<br>[root<span class="hljs-variable">@MySQL01</span> <span class="hljs-operator">~</span>]# <br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#240827 16:40:17 server id 1  end_log_pos 1081 CRC32 0x73d6f519 	Query	thread_id=9	exec_time=0	error_code=0	Xid = 34</span><br></code></pre></td></tr></table></figure>

<p>我们要恢复到这个时间点</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@MySQL01</span> <span class="hljs-operator">~</span>]# mysqlbinlog <span class="hljs-comment">--stop-datetime=&quot;2024-08-27 16:40:17&quot; --verbose /var/lib/mysql/binlog.000021 | mysql -uroot -pqweQWE123</span><br>mysql: [Warning] <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br>[root<span class="hljs-variable">@MySQL01</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>pqweQWE123<br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases; <br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> logbins            <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql              <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> sys                <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> testDB             <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> testDB3            <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-number">7</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>  logbins.t1 ;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> zs   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span> ls   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>


                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div></div>
      <div>http://example.com/2025/02/06/Comment/MySQL基本语句/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>John Doe</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年2月6日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/02/06/Comment/VXLAN/" title="">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile"></span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/02/06/Comment/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6/" title="">
                        <span class="hidden-mobile"></span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
