

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="分类提供方类型  厂商硬件存储 Huawei DELL IMC   软件存储 CEPH GlusterFS Minio    按组网方式  DAS 直连存储 NAS 文件存储 NFS、CIFS SAN 块存储 FC—SAN 光纤交换机 IP-SAN 通过TCP&#x2F;IP实现    按存储形态  文件存储 块存储 对象存储  按存储方式  集中式存储 分布式存储  硬件存储通常是厂商提供的硬件">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/2025/02/06/Storage/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="分类提供方类型  厂商硬件存储 Huawei DELL IMC   软件存储 CEPH GlusterFS Minio    按组网方式  DAS 直连存储 NAS 文件存储 NFS、CIFS SAN 块存储 FC—SAN 光纤交换机 IP-SAN 通过TCP&#x2F;IP实现    按存储形态  文件存储 块存储 对象存储  按存储方式  集中式存储 分布式存储  硬件存储通常是厂商提供的硬件">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/Pic/Pasted%20image%2020250114113054.png">
<meta property="og:image" content="http://example.com/Pic/Pasted%20image%2020250114113120.png">
<meta property="og:image" content="http://example.com/Pic/Pasted%20image%2020250114122022.png">
<meta property="og:image" content="http://example.com/Pic/Pasted%20image%2020250114121915.png">
<meta property="og:image" content="http://example.com/Pic/image-20241007171452885.png">
<meta property="og:image" content="http://example.com/Pic/image-20241013134408782.png">
<meta property="og:image" content="http://example.com/Pic/image-20241013153430927.png">
<meta property="og:image" content="http://example.com/Pic/image-20241013162814455.png">
<meta property="og:image" content="http://example.com/Pic/image-20241013170943626.png">
<meta property="article:published_time" content="2025-02-06T07:10:04.874Z">
<meta property="article:modified_time" content="2025-01-14T04:20:24.036Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/Pic/Pasted%20image%2020250114113054.png">
  
  
  
  <title>Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text=""></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-02-06 15:10" pubdate>
          2025年2月6日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          2.5k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          21 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header"></h1>
            
            
              <div class="markdown-body">
                
                <h1 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h1><p>提供方类型</p>
<ul>
<li>厂商硬件存储<ul>
<li>Huawei</li>
<li>DELL IMC</li>
</ul>
</li>
<li>软件存储<ul>
<li>CEPH</li>
<li>GlusterFS</li>
<li>Minio</li>
</ul>
</li>
</ul>
<p>按组网方式</p>
<ul>
<li>DAS 直连存储</li>
<li>NAS 文件存储 NFS、CIFS</li>
<li>SAN 块存储<ul>
<li>FC—SAN 光纤交换机</li>
<li>IP-SAN 通过TCP&#x2F;IP实现</li>
</ul>
</li>
</ul>
<p>按存储形态</p>
<ul>
<li>文件存储</li>
<li>块存储</li>
<li>对象存储</li>
</ul>
<p>按存储方式</p>
<ul>
<li>集中式存储</li>
<li>分布式存储</li>
</ul>
<h1 id="硬件存储"><a href="#硬件存储" class="headerlink" title="硬件存储"></a>硬件存储</h1><p>通常是厂商提供的硬件存储解决方案，他有自己的存储芯片，存储架构。</p>
<p><img src="/../Pic/Pasted%20image%2020250114113054.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/../Pic/Pasted%20image%2020250114113120.png" srcset="/img/loading.gif" lazyload></p>
<p>上下分别为<strong>A控</strong>和<strong>B控</strong>；为了提供冗余<br><strong>H0-H3</strong> 业务口；为存储客户端提供访问<br><strong>Exp</strong>   级连口；连接其他的存储服务器<br><strong>H4-h5</strong> 管理口；为管理员提供访问<br><strong>Console口</strong>；管理口无法连接时；电脑直连该口管理</p>
<h2 id="华为存储"><a href="#华为存储" class="headerlink" title="华为存储"></a>华为存储</h2><h3 id="模拟器"><a href="#模拟器" class="headerlink" title="模拟器"></a>模拟器</h3><p><img src="/../Pic/Pasted%20image%2020250114122022.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/../Pic/Pasted%20image%2020250114121915.png" srcset="/img/loading.gif" lazyload></p>
<h1 id="软件存储"><a href="#软件存储" class="headerlink" title="软件存储"></a>软件存储</h1><h2 id="GlusterFS"><a href="#GlusterFS" class="headerlink" title="GlusterFS"></a>GlusterFS</h2><p>文件级存储(NAS) 提供快照 复制 条带卷</p>
<h3 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h3><ul>
<li>磁盘分区挂载</li>
<li>守护进程</li>
<li>Firewalld SElinux</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">0 ~&gt; ansible GlusterFS -m shell -a  <span class="hljs-string">&quot;df -Th /GlusterFS&quot;</span><br>192.168.100.110 | CHANGED | rc=0 &gt;&gt;<br>Filesystem                          Type  Size  Used Avail Use% Mounted on<br>/dev/mapper/GlusterFSVg-Glu..M   20G   3% /GlusterFS<br>192.168.100.112 | CHANGED | rc=0 &gt;&gt;<br>Filesystem                          Type  Size  Used Avail Use% Mounted on<br>/dev/mapper/GlusterFSVg-GlusterFSLv xfs    20G  424M   20G   3% /GlusterFS<br>192.168.100.111 | CHANGED | rc=0 &gt;&gt;<br>Filesystem                          Type  Size  Used Avail Use% Mounted on<br>/dev/mapper/GlusterFSVg-GlusterFSLv xfs    20G  424M   20G   3% /GlusterFS<br><br>0 ~&gt; ansible GlusterFS -m shell -a  <span class="hljs-string">&quot;systemctl status glusterd | grep active&quot;</span><br>192.168.100.110 | CHANGED | rc=0 &gt;&gt;<br>     Active: active (running) since Mon 2024-10-07 16:39:39 CST; 16min ago<br>192.168.100.111 | CHANGED | rc=0 &gt;&gt;<br>     Active: active (running) since Mon 2024-10-07 16:39:39 CST; 15min ago<br>192.168.100.112 | CHANGED | rc=0 &gt;&gt;<br>     Active: active (running) since Mon 2024-10-07 16:39:40 CST; 15min ago<br>0 ~&gt; <br></code></pre></td></tr></table></figure>

<h4 id="配置信任池"><a href="#配置信任池" class="headerlink" title="配置信任池"></a>配置信任池</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">130 ~/WorkSpace/Ansible&gt; ansible GlusterFS01 -m shell -a <span class="hljs-string">&quot;gluster peer probe GlusterFS02 &amp;&amp; gluster peer probe GlusterFS03&quot;</span><br>192.168.100.110 | CHANGED | rc=0 &gt;&gt;<br>peer probe: success<br>peer probe: success<br>0 ~/WorkSpace/Ansible&gt; ansible GlusterFS02 -m shell -a <span class="hljs-string">&quot;gluster peer probe GlusterFS03 &amp;&amp; gluster peer probe GlusterFS01&quot;</span><br>192.168.100.111 | CHANGED | rc=0 &gt;&gt;<br>peer probe: Host GlusterFS03 port 24007 already <span class="hljs-keyword">in</span> peer list<br>peer probe: Host GlusterFS01 port 24007 already <span class="hljs-keyword">in</span> peer list<br></code></pre></td></tr></table></figure>

<blockquote>
<p>随意一方配置即可</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">0 ~/WorkSpace/Ansible&gt; ansible GlusterFS -m shell -a <span class="hljs-string">&quot;gluster peer status&quot;</span><br>192.168.100.110 | CHANGED | rc=0 &gt;&gt;<br>Number of Peers: 2<br><br>Hostname: GlusterFS02<br>Uuid: 8e1de9fd-a094-49c1-ab69-32773f78296a<br>State: Peer <span class="hljs-keyword">in</span> Cluster (Connected)<br><br>Hostname: GlusterFS03<br>Uuid: 7a82c9c4-9a84-4398-91d7-fc195f7a2178<br>State: Peer <span class="hljs-keyword">in</span> Cluster (Connected)<br>192.168.100.112 | CHANGED | rc=0 &gt;&gt;<br>Number of Peers: 2<br><br>Hostname: GlusterFS01<br>Uuid: 449da5fe-c09b-43f3-a865-3500b108e7ad<br>State: Peer <span class="hljs-keyword">in</span> Cluster (Connected)<br><br>Hostname: GlusterFS02<br>Uuid: 8e1de9fd-a094-49c1-ab69-32773f78296a<br>State: Peer <span class="hljs-keyword">in</span> Cluster (Connected)<br>192.168.100.111 | CHANGED | rc=0 &gt;&gt;<br>Number of Peers: 2<br><br>Hostname: GlusterFS01<br>Uuid: 449da5fe-c09b-43f3-a865-3500b108e7ad<br>State: Peer <span class="hljs-keyword">in</span> Cluster (Connected)<br><br>Hostname: GlusterFS03<br>Uuid: 7a82c9c4-9a84-4398-91d7-fc195f7a2178<br>State: Peer <span class="hljs-keyword">in</span> Cluster (Connected)<br></code></pre></td></tr></table></figure>

<h3 id="卷类型"><a href="#卷类型" class="headerlink" title="卷类型"></a>卷类型</h3><h4 id="分布式卷"><a href="#分布式卷" class="headerlink" title="分布式卷"></a>分布式卷</h4><p>将多台服务器提供的brick看作一个整体 写入的数据由底层brick随意(位置)存放 无冗余</p>
<p><img src="/../Pic/image-20241007171452885.png" srcset="/img/loading.gif" lazyload alt="image-20241007171452885"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">gluster volume create NEW-VOLNAME [transport [tcp | rdma | tcp,rdma]] NEW-BRICK...<br><br></code></pre></td></tr></table></figure>

<p>创建brick目录 为卷提供存储位置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">0 ~/WorkSpace/Ansible&gt; ansible GlusterFS -m shell -a <span class="hljs-string">&quot;mkdir /GlusterFS/gv01&quot;</span><br>192.168.100.112 | CHANGED | rc=0 &gt;&gt;<br><br>192.168.100.110 | CHANGED | rc=0 &gt;&gt;<br><br>192.168.100.111 | CHANGED | rc=0 &gt;&gt;<br><br></code></pre></td></tr></table></figure>

<p>创建分布式卷 并启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">1 ~/WorkSpace/Ansible&gt; ssh root@GlusterFS01<br><br>[root@GlusterFS01 ~]# gluster volume create -h<br>Usage:<br>volume create &lt;NEW-VOLNAME&gt; [[replica &lt;COUNT&gt; [arbiter &lt;COUNT&gt;]]|[replica 2 thin-arbiter 1]] [disperse [&lt;COUNT&gt;]] [disperse-data &lt;COUNT&gt;] [redundancy &lt;COUNT&gt;] [transport &lt;tcp|rdma|tcp,rdma&gt;] &lt;NEW-BRICK&gt; &lt;TA-BRICK&gt;... [force]<br><br>[root@GlusterFS01 ~]# gluster volume create gv01Dis GlusterFS01:/GlusterFS/gv01 GlusterFS02:/GlusterFS/gv01 GlusterFS03:/GlusterFS/gv01<br>volume create: gv01Dis: success: please start the volume to access data<br><br>[root@GlusterFS01 ~]# gluster volume start gv01Dis<br>volume start: gv01Dis: success<br><br>[root@GlusterFS01 ~]# gluster volume info gv01Dis <br> <br>Volume Name: gv01Dis<br>Type: Distribute<br>Volume ID: 9e29bb17-20e7-4619-84f6-362d5461e4b5<br>Status: Started<br>Snapshot Count: 0<br>Number of Bricks: 3<br>Transport-<span class="hljs-built_in">type</span>: tcp<br>Bricks:<br>Brick1: GlusterFS01:/GlusterFS/gv01<br>Brick2: GlusterFS02:/GlusterFS/gv01<br>Brick3: GlusterFS03:/GlusterFS/gv01<br>Options Reconfigured:<br>storage.fips-mode-rchecksum: on<br>transport.address-family: inet<br>nfs.disable: on<br></code></pre></td></tr></table></figure>

<p>客户端测试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">0 ~/WorkSpace/Ansible&gt; <span class="hljs-built_in">sudo</span> mount -t glusterfs GlusterFS01:/gv01Dis /tmp/test<br><span class="hljs-comment">## 随机任一个节点都可以</span><br><span class="hljs-comment">## 0 ~/WorkSpace/Ansible&gt; sudo umount /tmp/test</span><br><span class="hljs-comment">## 0 ~/WorkSpace/Ansible&gt; sudo mount -t glusterfs  GlusterFS02:/gv01Dis /tmp/test</span><br><span class="hljs-comment">## 0 ~/WorkSpace/Ansible&gt; df -Th /tmp/test</span><br><span class="hljs-comment">## 文件系统             类型            大小  已用  可用 已用% 挂载点</span><br><span class="hljs-comment">## GlusterFS02:/gv01Dis fuse.glusterfs   60G  1.9G   58G    4% /tmp/test</span><br><br><br>1 ~/WorkSpace/Ansible&gt; <span class="hljs-built_in">df</span> -Th /tmp/test/<br>文件系统             类型            大小  已用  可用 已用% 挂载点<br>GlusterFS01:/gv01Dis fuse.glusterfs   60G  1.9G   58G    4% /tmp/test<br><br>0 ~/WorkSpace/Ansible&gt; <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> `<span class="hljs-built_in">seq</span> 1 100`; <span class="hljs-keyword">do</span> <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">touch</span> /tmp/test/<span class="hljs-variable">$i</span>; <span class="hljs-keyword">done</span><br>0 ~/WorkSpace/Ansible&gt; <br></code></pre></td></tr></table></figure>

<p>在我们创建100个文件后 他会被随机分布到brick服务器的目录上</p>
<p>在删除这些文件后 底层也会随之删除</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">0 ~/WorkSpace/Ansible&gt; <span class="hljs-built_in">ls</span> /tmp/test/<br>1    12  16  2   23  27  30  34  38  41  45  49  52  56  6   63  67  70  74  78  81  85  89  92  96<br>10   13  17  20  24  28  31  35  39  42  46  5   53  57  60  64  68  71  75  79  82  86  9   93  97<br>100  14  18  21  25  29  32  36  4   43  47  50  54  58  61  65  69  72  76  8   83  87  90  94  98<br>11   15  19  22  26  3   33  37  40  44  48  51  55  59  62  66  7   73  77  80  84  88  91  95  99<br>0 ~/WorkSpace/Ansible&gt; ansible GlusterFS -m shell -a <span class="hljs-string">&quot;ls /GlusterFS/gv01 | wc -l&quot;</span><br>192.168.100.112 | CHANGED | rc=0 &gt;&gt;<br>29<br>192.168.100.110 | CHANGED | rc=0 &gt;&gt;<br>35<br>192.168.100.111 | CHANGED | rc=0 &gt;&gt;<br>36<br>0 ~/WorkSpace/Ansible&gt;<br>0 ~/WorkSpace/Ansible&gt; <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">rm</span> -rf /tmp/test/*<br>0 ~/WorkSpace/Ansible&gt; ansible GlusterFS -m shell -a <span class="hljs-string">&quot;ls /GlusterFS/gv01 | wc -l&quot;</span><br>192.168.100.110 | CHANGED | rc=0 &gt;&gt;<br>0<br>192.168.100.112 | CHANGED | rc=0 &gt;&gt;<br>0<br>192.168.100.111 | CHANGED | rc=0 &gt;&gt;<br>0<br></code></pre></td></tr></table></figure>

<h4 id="复制卷"><a href="#复制卷" class="headerlink" title="复制卷"></a>复制卷</h4><p><strong>分布式卷</strong>会将用户的数据打散成多份(组成卷的Brick数量) 随机存储到底层的Brick</p>
<p><strong>复制卷</strong>就是将数据在底层的Brick各存储一分 实现数据冗余 只要还存活一个Brick 那么数据就仍然可以访问</p>
<p><img src="/../Pic/image-20241013134408782.png" srcset="/img/loading.gif" lazyload alt="image-20241013134408782"></p>
<p>创建复制的卷</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gluster volume create NEW-VOLNAME [replica COUNT] [transport [tcp |rdma | tcp,rdma]] NEW-BRICK...<br></code></pre></td></tr></table></figure>

<p>Brick创建卷存储路径</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">0 ~&gt; ansible GlusterFS -m shell -a <span class="hljs-string">&quot;mkdir /GlusterFS/gv02; ls /GlusterFS&quot;</span><br>192.168.100.112 | CHANGED | rc=0 &gt;&gt;<br>gv01<br>gv02<br>192.168.100.110 | CHANGED | rc=0 &gt;&gt;<br>gv01<br>gv02<br>192.168.100.111 | CHANGED | rc=0 &gt;&gt;<br>gv01<br>gv02<br>0 ~&gt; <br></code></pre></td></tr></table></figure>

<p>GlusterFS Cli创建、激活卷</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs nginx">[root@<span class="hljs-attribute">GlusterFS01</span> ~]<span class="hljs-comment"># gluster volume create gv02rep replica 3 GlusterFS01:/GlusterFS/gv02 GlusterFS02:/GlusterFS/gv02 GlusterFS03:/GlusterFS/gv02</span><br>volume create: gv02rep: success: please start the volume to access data     <br><br>[root<span class="hljs-variable">@GlusterFS01</span> ~]<span class="hljs-comment"># gluster volume start gv02rep</span><br>volume start: gv02rep: success<br><br>[root<span class="hljs-variable">@GlusterFS01</span> ~]<span class="hljs-comment"># gluster volume info gv02rep</span><br> <br>Volume Name: gv02rep<br>Type: Replicate<br>Volume ID: 152a1093-dbc4-<span class="hljs-number">4792</span>-86e1-1d3a00af35b4<br>Status: Started<br>Snapshot Count: <span class="hljs-number">0</span><br>Number of Bricks: <span class="hljs-number">1</span> x <span class="hljs-number">3</span> = <span class="hljs-number">3</span><br>Transport-type: tcp<br>Bricks:<br>Brick1: GlusterFS01:/GlusterFS/gv02<br>Brick2: GlusterFS02:/GlusterFS/gv02<br>Brick3: GlusterFS03:/GlusterFS/gv02<br>Options Reconfigured:<br>cluster.granular-entry-heal: <span class="hljs-literal">on</span><br>storage.fips-mode-rchecksum: <span class="hljs-literal">on</span><br>transport.address-family: inet<br>nfs.disable: <span class="hljs-literal">on</span><br>performance.client-io-threads: <span class="hljs-literal">off</span><br></code></pre></td></tr></table></figure>

<p>客户端测试</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs nginx">0 ~&gt; <span class="hljs-attribute">mkdir</span> /tmp/test<br><span class="hljs-number">1</span> ~&gt; sudo mount -t glusterfs GlusterFS01:/gv02rep /tmp/test/<br>grep: 警告：- 前有多余的 \<br><span class="hljs-number">0</span> ~&gt; df -Th /tmp/test/<br>文件系统             类型            大小  已用  可用 已用% 挂载点<br>GlusterFS01:/gv02rep fuse.glusterfs   <span class="hljs-number">20G</span>  <span class="hljs-number">628M</span>   <span class="hljs-number">20G</span>    <span class="hljs-number">4</span>% /tmp/test<br></code></pre></td></tr></table></figure>

<p>每一个Brick都有该卷的副本	</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs nginx">0 ~&gt; <span class="hljs-attribute">for</span> i in `seq <span class="hljs-number">1</span> <span class="hljs-number">33</span>` ; <span class="hljs-attribute">do</span> sudo touch /tmp/test/<span class="hljs-variable">$i</span>; <span class="hljs-attribute">done</span><br><span class="hljs-number">0</span> ~&gt; ls /tmp/test/ | wc -l<br><span class="hljs-number">33</span><br><span class="hljs-number">0</span> ~&gt; ansible GlusterFS -m shell -a <span class="hljs-string">&quot;ls /GlusterFS/gv02 | wc -l&quot;</span><br><span class="hljs-number">192.168.100.112</span> | CHANGED | rc=<span class="hljs-number">0</span> &gt;&gt;<br><span class="hljs-number">33</span><br><span class="hljs-number">192.168.100.110</span> | CHANGED | rc=<span class="hljs-number">0</span> &gt;&gt;<br><span class="hljs-number">33</span><br><span class="hljs-number">192.168.100.111</span> | CHANGED | rc=<span class="hljs-number">0</span> &gt;&gt;<br><span class="hljs-number">33</span><br></code></pre></td></tr></table></figure>

<h4 id="分布式复制卷"><a href="#分布式复制卷" class="headerlink" title="分布式复制卷"></a>分布式复制卷</h4><p><img src="/../Pic/image-20241013153430927.png" srcset="/img/loading.gif" lazyload alt="image-20241013153430927"></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">gluster</span> volume create NEW-VOLNAME [replica COUNT] [transport [tcp | rdma | tcp,rdma]] NEW-BRICK...<br></code></pre></td></tr></table></figure>

<p>此类卷结合了 <strong>复制卷</strong>和<strong>分布式卷</strong> 通过设置<code>replica</code>来指定一份文件的复制数量 而Brick最少需要<code>replica</code>的倍数</p>
<p>在3节点环境下 实现此实验 则需要复用Brick创建卷挂载点 </p>
<p>在每个节点创建两个卷挂载点 使得这两个挂载点 成为互相的复制</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx">0 ~&gt; <span class="hljs-attribute">ansible</span> GlusterFS -m shell -a <span class="hljs-string">&quot;mkdir /GlusterFS/gv03disRep;mkdir /GlusterFS/serverGv03DisRep ; ls /GlusterFS&quot;</span><br></code></pre></td></tr></table></figure>

<p>注意创建时需要加上force 否则提示错误</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@GlusterFS01 ~]# gluster volume create gv03DisRep replica 2 GlusterFS01:/GlusterFS/gv03disRep GlusterFS01:/GlusterFS/serverGv03DisRep GlusterFS02:/GlusterFS/gv03disRep GlusterFS02:/GlusterFS/serverGv03DisRep GlusterFS03:/GlusterFS/gv03disRep GlusterFS03:/GlusterFS/serverGv03DisRep<br>Replica 2 volumes are prone to split-brain. Use Arbiter or Replica 3 to avoid this. See: http://docs.gluster.org/en/latest/Administrator-Guide/Split-brain-and-ways-to-deal-with-it/.<br>Do you still want to <span class="hljs-built_in">continue</span>?<br> (y/n) y<br>volume create: gv03DisRep: failed: Multiple bricks of a replicate volume are present on the same server. This setup is not optimal. Bricks should be on different nodes to have best fault tolerant configuration. Use <span class="hljs-string">&#x27;force&#x27;</span> at the end of the <span class="hljs-built_in">command</span> <span class="hljs-keyword">if</span> you want to override this behavior. <br></code></pre></td></tr></table></figure>

<p>加上force 注意brick之间的位置 相邻数量(replica)的brick会成为一个<code>Replicated</code></p>
<p>根据文档 最后测试100个文件 会在每个<code>Relicated</code>下存入33 (<code>100/3</code>) 个文件 而<code>Replicated</code>的下的每个<code>brick</code>都会有这33(<code>replica</code>)个文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@GlusterFS01 ~]# gluster volume create gv03DisRep replica 2 \<br>&gt; GlusterFS01:/GlusterFS/gv03disRep GlusterFS01:/GlusterFS/serverGv03DisRep \<br>&gt; GlusterFS02:/GlusterFS/gv03disRep GlusterFS02:/GlusterFS/serverGv03DisRep \<br>&gt; GlusterFS03:/GlusterFS/gv03disRep GlusterFS03:/GlusterFS/serverGv03DisRep \<br>&gt; force<br>volume create: gv03DisRep: success: please start the volume to access data<br>[root@GlusterFS01 ~]# gluster volume  start  gv03DisRep <br>volume start: gv03DisRep: success<br></code></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">0 ~&gt; <span class="hljs-built_in">sudo</span> mount -t glusterfs GlusterFS02:/gv03DisRep /tmp/test/<br>grep: 警告：- 前有多余的 \<br>0 ~&gt; <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> `<span class="hljs-built_in">seq</span> 1 100`; <span class="hljs-keyword">do</span> <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">touch</span> /tmp/test/<span class="hljs-variable">$i</span> ; <span class="hljs-keyword">done</span><br>0 ~&gt; <span class="hljs-built_in">ls</span> /tmp/test/ | <span class="hljs-built_in">wc</span> -l<br>100<br><br>0 ~&gt; ansible GlusterFS -m shell -a <span class="hljs-string">&#x27;\</span><br><span class="hljs-string">echo &quot;gv03disRep dir---&quot; ; ls /GlusterFS/gv03disRep | wc -l ; \</span><br><span class="hljs-string">echo &quot;serverGv03DisRep dir---&quot; ; ls /GlusterFS/serverGv03DisRep | wc -l&#x27;</span><br><br>192.168.100.110 | CHANGED | rc=0 &gt;&gt;<br>gv03disRep <span class="hljs-built_in">dir</span>---<br>35<br>serverGv03DisRep <span class="hljs-built_in">dir</span>---<br>35<br>192.168.100.112 | CHANGED | rc=0 &gt;&gt;<br>gv03disRep <span class="hljs-built_in">dir</span>---<br>29<br>serverGv03DisRep <span class="hljs-built_in">dir</span>---<br>29<br>192.168.100.111 | CHANGED | rc=0 &gt;&gt;<br>gv03disRep <span class="hljs-built_in">dir</span>---<br>36<br>serverGv03DisRep <span class="hljs-built_in">dir</span>---<br>36<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@GlusterFS01 GlusterFS]# <span class="hljs-built_in">ls</span> gv03disRep/<br>10   12  15  2   25  3   31  39  40  45  52  59  66  74  76  81  87  95<br>100  14  17  21  29  30  36  4   42  50  55  6   67  75  77  84  90<br>[root@GlusterFS01 GlusterFS]# <span class="hljs-built_in">ls</span> serverGv03DisRep/<br>10   12  15  2   25  3   31  39  40  45  52  59  66  74  76  81  87  95<br>100  14  17  21  29  30  36  4   42  50  55  6   67  75  77  84  90<br></code></pre></td></tr></table></figure>

<h4 id="分散卷"><a href="#分散卷" class="headerlink" title="分散卷"></a>分散卷</h4><p>基于纠删码来实现数据的完整、冗余 在节点少的情况下实现高可用</p>
<p>注意 前面的复制卷、分布式卷、分布式复制卷都是不分割文件的 只会把存入的多个文件 随机负载到多个Brick上</p>
<p>分散卷会把<strong>数据切割成多份(<code>disperse</code>)</strong> 存入到Brick 然后算出纠删码存入到其中一个(<code>redundancy</code>)Brick中</p>
<p><img src="/../Pic/image-20241013162814455.png" srcset="/img/loading.gif" lazyload alt="image-20241013162814455"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">0 ~&gt; ansible GlusterFS -m shell -a <span class="hljs-string">&quot;mkdir /GlusterFS/gv04Disperse&quot;</span><br>192.168.100.111 | CHANGED | rc=0 &gt;&gt;<br><br>192.168.100.112 | CHANGED | rc=0 &gt;&gt;<br><br>192.168.100.110 | CHANGED | rc=0 &gt;&gt;<br><br>[root@GlusterFS01 ~]# gluster volume create gv04Disperse disperse 3 redundancy 1 GlusterFS01:/GlusterFS/gv04Disperse GlusterFS02:/GlusterFS/gv04Disperse GlusterFS03:/GlusterFS/gv04Disperse<br>volume create: gv04Disperse: success: please start the volume to access data<br><br>[root@GlusterFS01 ~]# gluster volume  start gv04Disperse <br>volume start: gv04Disperse: success<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">0 ~&gt; <span class="hljs-built_in">sudo</span> mount -t glusterfs GlusterFS03:/gv04Disperse /tmp/test/<br>grep: 警告：- 前有多余的 \<br>0 ~&gt; <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero count=1 bs=20M of=/tmp/test/testFiles<br>输入了 1+0 块记录<br>输出了 1+0 块记录<br>20971520 字节 (21 MB, 20 MiB) 已复制，0.0449326 s，467 MB/s<br>0 ~&gt; <span class="hljs-built_in">du</span> -ah /tmp/test/<br>20M	/tmp/test/testFiles<br>20M	/tmp/test/<br><br>0 ~&gt; ansible GlusterFS -m shell -a <span class="hljs-string">&quot;du -csh /GlusterFS/gv04Disperse&quot;</span><br>192.168.100.110 | CHANGED | rc=0 &gt;&gt;<br>11M	/GlusterFS/gv04Disperse<br>11M	total<br>192.168.100.112 | CHANGED | rc=0 &gt;&gt;<br>11M	/GlusterFS/gv04Disperse<br>11M	total<br>192.168.100.111 | CHANGED | rc=0 &gt;&gt;<br>11M	/GlusterFS/gv04Disperse<br>11M	total<br></code></pre></td></tr></table></figure>

<p>实际上每个Brick还有很多小文件 来实现纠删码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@GlusterFS02 gv04Disperse]# <span class="hljs-built_in">ls</span> -a<br>.  ..  .glusterfs  testFiles<br>[root@GlusterFS02 gv04Disperse]# <span class="hljs-built_in">ls</span> -a .glusterfs/<br>.   09  14  1f  2a  35  40  4b  56  61  6c  77  82  8d  98  a3  ae  b9  c4  cf          d9  e4  ef  fa<br>..  0a  15  20  2b  36  41  4c  57  62  6d  78  83  8e  99  a4  af  ba  c5  changelogs  da  e5  f0  fb<br>00  0b  16  21  2c  37  42  4d  58  63  6e  79  84  8f  9a  a5  b0  bb  c6  d0          db  e6  f1  <span class="hljs-built_in">fc</span><br>01  0c  17  22  2d  38  43  4e  59  64  6f  7a  85  90  9b  a6  b1  bc  c7  d1          dc  e7  f2  fd<br>02  0d  18  23  2e  39  44  4f  5a  65  70  7b  86  91  9c  a7  b2  bd  c8  d2          <span class="hljs-built_in">dd</span>  e8  f3  fe<br>03  0e  19  24  2f  3a  45  50  5b  66  71  7c  87  92  9d  a8  b3  be  c9  d3          de  e9  f4  ff<br>04  0f  1a  25  30  3b  46  51  5c  67  72  7d  88  93  9e  a9  b4  bf  ca  d4          <span class="hljs-built_in">df</span>  ea  f5  health_check<br>05  10  1b  26  31  3c  47  52  5d  68  73  7e  89  94  9f  aa  b5  c0  cb  d5          e0  eb  f6  indices<br>06  11  1c  27  32  3d  48  53  5e  69  74  7f  8a  95  a0  ab  b6  c1  cc  d6          e1  ec  f7  landfill<br>07  12  1d  28  33  3e  49  54  5f  6a  75  80  8b  96  a1  ac  b7  c2  <span class="hljs-built_in">cd</span>  d7          e2  ed  f8  <span class="hljs-built_in">unlink</span><br>08  13  1e  29  34  3f  4a  55  60  6b  76  81  8c  97  a2  ad  b8  c3  ce  d8          e3  ee  f9<br></code></pre></td></tr></table></figure>

<h4 id="分布式复制卷-1"><a href="#分布式复制卷-1" class="headerlink" title="分布式复制卷"></a>分布式复制卷</h4><p>和分布式复制卷差不多 </p>
<p><img src="/../Pic/image-20241013170943626.png" srcset="/img/loading.gif" lazyload alt="image-20241013170943626"></p>
<p>因为只有3节点 还是之前的做法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">0 ~&gt; ansible GlusterFS -m shell -a <span class="hljs-string">&quot;mkdir /GlusterFS/&#123;gv05Disdis,serverGv05Disdi&#125;&quot;</span><br>192.168.100.110 | CHANGED | rc=0 &gt;&gt;<br><br>192.168.100.112 | CHANGED | rc=0 &gt;&gt;<br><br>192.168.100.111 | CHANGED | rc=0 &gt;&gt;<br><br>[root@GlusterFS01 ~]# gluster volume create gv05Disdis disperse 3 redundancy 1 \<br>&gt; GlusterFS01:/GlusterFS/gv05Disdis GlusterFS01:/GlusterFS/serverGv05Disdi \<br>&gt; GlusterFS02:/GlusterFS/gv05Disdis GlusterFS02:/GlusterFS/serverGv05Disdi \<br>&gt; GlusterFS03:/GlusterFS/gv05Disdis GlusterFS03:/GlusterFS/serverGv05Disdi \<br>&gt; force<br>volume create: gv05Disdis: success: please start the volume to access data<br><br>[root@GlusterFS01 ~]# gluster volume start gv05Disdis <br>volume start: gv05Disdis: success<br><br></code></pre></td></tr></table></figure>

<p>三个节点都有该文件 然后在分布阶段就将整个文件<strong>切割</strong> 最后算出纠删码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">0 ~&gt; <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero count=1 bs=10M of=/tmp/test/gv05test<br>2 ~&gt; ansible GlusterFS -m shell -a <span class="hljs-string">&quot;du -chs /GlusterFS/gv05Disdis&quot;</span><br>192.168.100.110 | CHANGED | rc=0 &gt;&gt;<br>5.1M	/GlusterFS/gv05Disdis<br>5.1M	total<br>192.168.100.111 | CHANGED | rc=0 &gt;&gt;<br>5.1M	/GlusterFS/gv05Disdis<br>5.1M	total<br>192.168.100.112 | CHANGED | rc=0 &gt;&gt;<br>16K	/GlusterFS/gv05Disdis<br>16K	total<br>0 ~&gt; ansible GlusterFS -m shell -a <span class="hljs-string">&quot;du -chs /GlusterFS/serverGv05Disdi&quot;</span><br>192.168.100.110 | CHANGED | rc=0 &gt;&gt;<br>5.1M	/GlusterFS/serverGv05Disdi<br>5.1M	total<br>192.168.100.111 | CHANGED | rc=0 &gt;&gt;<br>16K	/GlusterFS/serverGv05Disdi<br>16K	total<br>192.168.100.112 | CHANGED | rc=0 &gt;&gt;<br>16K	/GlusterFS/serverGv05Disdi<br>16K	total<br></code></pre></td></tr></table></figure>

<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>每<code>start</code>一个<code>volume</code>就会在<code>Brick</code>上开启一个<code>glusterfsd</code>服务并打开一个端口</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@GlusterFS01 ~]# netstat -tunlp | grep gluster<br>tcp        0      0 0.0.0.0:53309           0.0.0.0:*               LISTEN      1138/glusterfsd     <br>tcp        0      0 0.0.0.0:56326           0.0.0.0:*               LISTEN      1305/glusterfsd     <br>tcp        0      0 0.0.0.0:51378           0.0.0.0:*               LISTEN      1098/glusterfsd     <br>tcp        0      0 0.0.0.0:52425           0.0.0.0:*               LISTEN      1425/glusterfsd     <br>tcp        0      0 0.0.0.0:55657           0.0.0.0:*               LISTEN      956/glusterfsd     ## will stop <br>tcp        0      0 0.0.0.0:24007           0.0.0.0:*               LISTEN      865/glusterd        <br>tcp        0      0 0.0.0.0:51744           0.0.0.0:*               LISTEN      1460/glusterfsd     <br>tcp        0      0 0.0.0.0:56234           0.0.0.0:*               LISTEN      1028/glusterfsd        <br>[root@GlusterFS01 ~]# gluster volume stop gv01Dis <br>Stopping volume will make its data inaccessible. Do you want to continue? (y/n) y<br>volume stop: gv01Dis: success<br>[root@GlusterFS01 ~]# netstat -tunlp | grep gluster<br>tcp        0      0 0.0.0.0:53309           0.0.0.0:*               LISTEN      1138/glusterfsd     <br>tcp        0      0 0.0.0.0:56326           0.0.0.0:*               LISTEN      1305/glusterfsd     <br>tcp        0      0 0.0.0.0:51378           0.0.0.0:*               LISTEN      1098/glusterfsd     <br>tcp        0      0 0.0.0.0:52425           0.0.0.0:*               LISTEN      1425/glusterfsd     <br>tcp        0      0 0.0.0.0:24007           0.0.0.0:*               LISTEN      865/glusterd        <br>tcp        0      0 0.0.0.0:51744           0.0.0.0:*               LISTEN      1460/glusterfsd     <br>tcp        0      0 0.0.0.0:56234           0.0.0.0:*               LISTEN      1028/glusterfsd <br></code></pre></td></tr></table></figure>

<p>每有一个<code>Volume</code>被挂载 就会在<code>Brick</code>上生成一个<code>glusterfs</code>的进程</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@GlusterFS01 ~]# pidstat | grep gluster<br>02:25:45 PM     0       856    0.01    0.01    0.00    0.00    0.02     0  glusterd<br>02:25:45 PM     0       955    0.00    0.01    0.00    0.00    0.01     1  glusterfsd<br>02:25:45 PM     0       990    0.00    0.01    0.00    0.00    0.01     1  glusterfsd<br>02:25:45 PM     0      1161    0.00    0.01    0.00    0.00    0.01     1  glusterfsd<br>02:25:45 PM     0      1267    0.00    0.01    0.00    0.00    0.01     0  glusterfsd<br>02:25:45 PM     0      1309    0.00    0.01    0.00    0.00    0.01     0  glusterfsd<br>02:25:45 PM     0      1347    0.00    0.01    0.00    0.00    0.01     1  glusterfsd<br>02:25:45 PM     0      1409    0.00    0.01    0.00    0.00    0.01     0  glusterfsd<br>02:25:45 PM     0      1496    0.02    0.01    0.00    0.00    0.03     1  glusterfs<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">0 /tmp/testDir&gt; <span class="hljs-built_in">df</span> -Th /tmp/testDir/<br>文件系统             类型            大小  已用  可用 已用% 挂载点<br>GlusterFS01:/gv01Dis fuse.glusterfs   60G  2.0G   58G    4% /tmp/testDir<br>32 /tmp/testDir&gt; <span class="hljs-built_in">cd</span><br>0 ~&gt; <span class="hljs-built_in">sudo</span> umount /tmp/testDir/<br></code></pre></td></tr></table></figure>


                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div></div>
      <div>http://example.com/2025/02/06/Storage/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>John Doe</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年2月6日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/02/06/HCIE/" title="">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile"></span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/02/06/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6/" title="">
                        <span class="hidden-mobile"></span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
